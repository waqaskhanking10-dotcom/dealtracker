'use strict';mix_d("TradeInDPCards__unified-trade-in:unified-trade-in__l4oFI43p","exports tslib @c/browser-operations @c/aui-utils @c/scoped-dom @c/scoped-metrics @c/remote-operations @p/a-events @c/navigation @c/logger".split(" "),function(aa,f,va,wa,xa,ya,za,Aa,Ba,ba){function D(a){return a&&"object"===typeof a&&"default"in a?a:{"default":a}}var H=D(va),p=D(wa),k=D(xa),t=D(za),w=D(Aa),T=D(Ba),v;(function(a){a.continueToNextPage="continueToNextPage";a.updateSelection="updateSelection";a.selectAnswer=
"selectAnswer";a.tryAnotherDevice="tryAnotherDevice";a.validateQuestionsAllAnswered="validateQuestionsAllAnswered";a.selectTradeInOption="selectTradeInOption";a.backToShopping="backToShopping";a.acceptOffer="acceptOffer";a.hideSidesheet="hideSidesheet";a.redirectToLogin="redirectToLogin";a.retryFromError="retryFromError";a.backToRefinementPage="backToRefinementPage";a.selectAddress="selectAddress"})(v||(v={}));var ca=v,Ca=function(){var a=k["default"].cardRoot.querySelector('[data-component-id="sidesheet"]'),
b=k["default"].cardRoot.querySelector('[data-component-id="darkened-background"]');p["default"].show(b);p["default"].show(a);p["default"].delay(function(){a.classList.add("_unified-trade-in_Sidesheet_shown__2WThr")},0)},Da=function(){var a=k["default"].cardRoot.querySelector('[data-component-id="sidesheet"]'),b=k["default"].cardRoot.querySelector('[data-component-id="darkened-background"]');p["default"].hide(b);p["default"].delay(function(){a.classList.contains("_unified-trade-in_Sidesheet_shown__2WThr")||
p["default"].hide(a)},500);a.classList.remove("_unified-trade-in_Sidesheet_shown__2WThr")},N;(function(a){a.ORDER="ORDER";a.INTENT="INTENT"})(N||(N={}));var da;(function(a){a.NO_INTENT="NO_INTENT";a.INTENT_CREATED="INTENT_CREATED";a.INTENT_BO_INVALID="INTENT_BO_INVALID";a.UNRECOVERABLE_ERROR="UNRECOVERABLE_ERROR"})(da||(da={}));var x;(function(a){a.SUCCESS="SUCCESS";a.SUCCESS_STATE_UPDATED="SUCCESS_STATE_UPDATED";a.ERROR="ERROR"})(x||(x={}));var A;(function(a){a.SUBMIT_TRADE_IN="submitTradeIn";a.PRICE_CAP=
"priceCap"})(A||(A={}));var Ea=function(){function a(){this.items=[]}a.prototype.addItem=function(b){this.items.push(b)};a.prototype.getItems=function(){return this.items};a.prototype.getCurrentItem=function(){return 0<this.items.length?this.items[this.items.length-1]:void 0};a.prototype.clear=function(){this.items=[]};return a}(),U=function(a){return"a:dropdown:refinement-dropdown-"+a+":select"},fa=function(a,b,c,d){w["default"].off(U(b));w["default"].on(U(b),function(e){Fa(e,a,m.selectionHistory,
b,c,d)});ea()},Fa=function(a,b,c,d,e,g){return f.__awaiter(void 0,void 0,void 0,function(){var h,l;return f.__generator(this,function(n){switch(n.label){case 0:if(!a.nativeItemNode||!a.nativeItemNode.dataset)throw m.countMetric("error:dropdownEvent:refinementSelectionPage"),Error("Missing nativeItemNode or dataset in dropdown selection event");var q;ea();var u=c.get().length;if(0<u&&d<u){for(u=(n=u===b)?u-1:u;u>d;u--)w["default"].off(U(u)),null===(q=e.lastElementChild)||void 0===q?void 0:q.remove(),
c.pop();n&&c.pop()}h=a.nativeItemNode.dataset;c.add(h.selectionKey,h.selectionData,h.selectionTitle);(l=e.children[d])&&(q=l.querySelector('[class*="refinement-helper-link"]'))&&q.parentElement&&p["default"].hide(q.parentElement);return 0===e.childElementCount||l&&"true"!==l.dataset.endOfResults?[4,Ga({refinementNumber:d+1,selectionHistory:c.get(),marketplaceId:g.marketplaceId,glProductGroup:g.glProductGroup,ingressAsin:g.ingressAsin,productType:g.productType,totalRefinementSelectionDropdownCount:b},
e)]:[3,2];case 1:return n.sent(),fa(b,d+1,e,g),[3,3];case 2:m.recordStepCompleted("refinementSelectionPage"),(q=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_refinement-selection-footer__2uBKP")[0])&&p["default"].show(q),n.label=3;case 3:return[2]}})})},ea=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_refinement-selection-footer__2uBKP")[0];a&&p["default"].hide(a)},V=function(a,b){!(a=a.querySelector("a"))||a.getAttribute("href")&&
""!==a.getAttribute("href")||(a.href=b,a.target="_blank")},ia=function(a){var b=O();Array.prototype.slice.call(b).forEach(function(c){var d=Number(c.dataset.index);d>a&&(p["default"].hide(c),Ha(c),ha(d))})},Ha=function(a){a=a.getElementsByClassName("_unified-trade-in_QuestionnairePage_answer-selector-button__2f7Tz");Array.prototype.slice.call(a).forEach(function(b){b.classList.remove("a-button-selected")})},ja=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_continue-button-row__3eqXr")[0];
p["default"].show(a);a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_try-another-device-button-row__2Hxj2")[0];p["default"].hide(a)},ha=function(a){a=I(a).getElementsByClassName("_unified-trade-in_QuestionnairePage_alert-view-container__2Mhab")[0];a.hasChildNodes()&&a.removeChild(a.lastChild)},Ia=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_QuestionnairePage_validation-alert__37oWf");Array.prototype.slice.call(a).forEach(function(b){p["default"].hide(b)})},
Ja=function(a){a=I(a).getElementsByClassName("_unified-trade-in_QuestionnairePage_answer-selector-button__2f7Tz");return Array.prototype.slice.call(a).some(function(b){return b.classList.contains("a-button-selected")})},Ka=function(){var a=O();return Array.prototype.slice.call(a).filter(function(b){return!b.classList.contains("aok-hidden")})},O=function(){return k["default"].cardRoot.getElementsByClassName("_unified-trade-in_QuestionnairePage_question-container__2J0aR")},I=function(a){return O()[a]},
La=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_QuestionnairePage_questionnaire-page-view__3B_Bw")[0];return(a=null===a||void 0===a?void 0:a.querySelector("._unified-trade-in_ItemSummaryWidget_header-image__1hy7U"))?a.src:""},W,X,y,ka=!1,Pa=function(){X="";y={};Ma();if(!ka){var a=H["default"].setup().define;a(v.selectAnswer,"click",function(b){return f.__awaiter(void 0,void 0,void 0,function(){return f.__generator(this,function(c){var d=b.currentTarget.dataset;
if(!d.index||!d.condition||!d.answer)throw m.countMetric("error:missingDatasetProperties:questionnairePage"),Error("Missing required dataset properties");c=Number(d.index);var e=d.condition;y[c]={answer:d.answer,condition:e,choiceDescriptionId:d.choiceDescriptionId};var g=I(c).getElementsByClassName("_unified-trade-in_QuestionnairePage_validation-alert__37oWf")[0];p["default"].hide(g);ia(c);Na(c);ha(c);var h=d.answer,l;g=I(c);d=g.getElementsByClassName("_unified-trade-in_QuestionnairePage_alert-view-container__2Mhab")[0];
d.hasChildNodes()&&d.removeChild(d.lastChild);h=g.querySelectorAll('[data-answer="'+CSS.escape(h)+'"]');0<h.length&&(h=null===(l=h[0].parentElement)||void 0===l?void 0:l.querySelector("._unified-trade-in_QuestionnairePage_alert-view__36oMJ"))&&(l=h.cloneNode(!0),p["default"].show(l),(h=l.getElementsByClassName("_unified-trade-in_QuestionnairePage_alert-content-message__3xqaT")[0])&&h.dataset.htmlMessage&&(h.innerHTML=h.dataset.htmlMessage,"unified-damaged-screen-question"===g.dataset.questiontextid&&
(g=g.dataset.majordamageurl)&&V(l,g)),d.appendChild(l));"Unacceptable"===e?(c=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_continue-button-row__3eqXr")[0],p["default"].hide(c),c=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_try-another-device-button-row__2Hxj2")[0],p["default"].show(c)):(e=O(),c+=1,c<e.length&&p["default"].show(e[c]),ja());return[2]})})});a(v.validateQuestionsAllAnswered,"click",function(){Oa()});a(v.tryAnotherDevice,"click",function(){m.countMetric("tryAnotherClick");
m.goToRefinementPage()});ka=!0}ia(0);ja()},Na=function(a){Object.keys(y).forEach(function(b){b=Number(b);b>a&&delete y[b]})},Oa=function(){Ia();var a=!0;Ka().forEach(function(b){b=Number(b.dataset.index);Ja(b)||(b=I(b).getElementsByClassName("_unified-trade-in_QuestionnairePage_validation-alert__37oWf")[0],p["default"].show(b),a=!1)});a&&(m.recordStepCompleted("questionnairePage"),Object.values(y).some(function(b){return"Unacceptable"===b.condition})||(Qa(),m.goToNextPage()))},Qa=function(){var a=
Ra();a.sort(function(b,c){return b.tiv-c.tiv});X=a[0].condition},Ra=function(){return Object.keys(y).filter(function(a){return Object.prototype.hasOwnProperty.call(y,a)}).map(function(a){a=y[a].condition;var b=W[a.toLowerCase()];if(!b)throw m.countMetric("error:conditionNotFound:questionnairePage"),Error("Condition not found in offer map: "+a);return{condition:a,tiv:b.amount}})},Ma=function(){W={};var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_QuestionnairePage_questionnaire-page-view__3B_Bw")[0],
b;for(b in a.dataset){var c=JSON.parse(a.dataset[b]),d=Number(c.amount);if(isNaN(d))throw m.countMetric("error:invalidAmount:questionnairePage"),Error("Invalid amount value");W[b]={amount:d,currencyCode:c.currencyCode,displayString:c.displayString,merchantId:c.merchantId}}},la=!1,ma=function(){if(!la){var a=H["default"].setup().define;a(v.selectTradeInOption,"click",function(b){b=b.currentTarget.dataset;if(b.value){var c=m.tradeInCart.getCurrentItem();if(c)c.returnOption=b.value;else throw m.countMetric("error:noCurrentItem:offerPage"),
Error("No current trade-in item found in cart");}});la=!0}},Sa=function(){var a=m.tradeInCart.getCurrentItem();return(null===a||void 0===a?void 0:a.returnOption)||"ACCEPT_WORSE"},r=new (function(){function a(){this.selectedAddressId=null;this.validationCache=new Map}a.prototype.setSelectedAddressId=function(b){this.selectedAddressId=b};a.prototype.getSelectedAddressId=function(){return this.selectedAddressId};a.prototype.setValidation=function(b,c){this.validationCache.set(b,c)};a.prototype.getValidation=
function(b){return this.validationCache.get(b)};a.prototype.hasValidation=function(b){return this.validationCache.has(b)};a.prototype.reset=function(){this.selectedAddressId=null;this.validationCache.clear()};return a}()),P,Ya=function(a){P=a;a=H["default"].setup().define;a(v.selectAddress,"click",function(b){var c;null!==(c=b.currentTarget)&&void 0!==c&&c.dataset&&Ta(b.currentTarget.dataset)});Ua();Va();Wa();Xa().catch(function(){})},Va=function(){var a=k["default"].cardRoot.querySelector("#change-address-link");
a&&a.addEventListener("click",function(){var b;m.countMetric("changeAddressClicked");var c=k["default"].cardRoot.querySelector("#selected-address-display"),d=k["default"].cardRoot.querySelector("#address-selection-container");c&&d&&(c.classList.add("a-hidden"),d.classList.remove("a-hidden"),(c=r.getSelectedAddressId())&&r.hasValidation(c)&&(c=null!==(b=r.getValidation(c))&&void 0!==b?b:!1,z(c)))})},Ua=function(){var a=k["default"].cardRoot.querySelector("#show-more-addresses");a&&a.addEventListener("click",
function(){var b,c=k["default"].cardRoot.querySelectorAll(".address-extra"),d=null===(b=c[0])||void 0===b?void 0:b.classList.contains("a-hidden");m.countMetric(d?"addressShowMoreClick":"addressShowLessClick");c.forEach(function(e){d?e.classList.remove("a-hidden"):e.classList.add("a-hidden")});b=a.querySelector("#show-more-text");c=a.querySelector("#show-fewer-text");b&&c&&(d?(b.classList.add("a-hidden"),c.classList.remove("a-hidden")):(b.classList.remove("a-hidden"),c.classList.add("a-hidden")))})},
Wa=function(){var a=k["default"].cardRoot.querySelector("[data-selected-address-id]");(null===a||void 0===a?0:a.dataset.selectedAddressId)&&r.setSelectedAddressId(a.dataset.selectedAddressId)},Xa=function(){return f.__awaiter(void 0,void 0,void 0,function(){var a,b,c,d,e;return f.__generator(this,function(g){switch(g.label){case 0:a=k["default"].cardRoot.querySelector("[data-selected-address-id]");b=null===a||void 0===a?void 0:a.dataset.selectedAddressId;if(!b)return[3,4];if(!r.hasValidation(b))return[3,
1];c=null!==(e=r.getValidation(b))&&void 0!==e?e:!1;z(c);return[3,4];case 1:return g.trys.push([1,3,,4]),[4,Y(f.__assign({addressId:b},P))];case 2:return d=g.sent(),void 0!==d.isValidShipment&&(r.setValidation(b,d.isValidShipment),z(d.isValidShipment)),[3,4];case 3:return g.sent(),[3,4];case 4:return[2]}})})},Ta=function(a){return f.__awaiter(void 0,void 0,void 0,function(){var b,c,d,e;return f.__generator(this,function(g){switch(g.label){case 0:b=a.addressId;m.countMetric("addressSelectionChange");
if(!b)return[3,4];na(b);if(r.hasValidation(b))return c=null!==(e=r.getValidation(b))&&void 0!==e?e:!1,z(c),[2];var h=k["default"].cardRoot.querySelector("#address-validation-alert");h&&h.classList.add("a-hidden");g.label=1;case 1:return g.trys.push([1,3,,4]),[4,Y(f.__assign({addressId:b},P))];case 2:return d=g.sent(),void 0!==d.isValidShipment&&(r.setValidation(b,d.isValidShipment),z(d.isValidShipment)),[3,4];case 3:return g.sent(),[3,4];case 4:return[2]}})})},z=function(a){var b=k["default"].cardRoot.querySelector("#address-validation-alert"),
c=k["default"].cardRoot.querySelector(".add-new-address-link");if(b)if(a)b.classList.add("a-hidden"),c&&c.classList.add("a-hidden");else{b.classList.remove("a-hidden");c&&(1===k["default"].cardRoot.querySelectorAll('input[name="return-address"]').length?(c.classList.remove("a-hidden"),b.insertAdjacentElement("afterend",c)):c.classList.add("a-hidden"));c=k["default"].cardRoot.querySelector("#address-selection-container");a=k["default"].cardRoot.querySelector("#selected-address-display");var d=k["default"].cardRoot.querySelector('input[name="return-address"]:checked');
c&&!c.classList.contains("a-hidden")&&(null===d||void 0===d?0:d.parentElement)?d.parentElement.insertAdjacentElement("afterend",b):a&&(c=a.querySelector('div[data-csa-c-action="changeAddress"]'),(c?c:a).insertAdjacentElement(c?"beforebegin":"afterend",b))}},Za=function(){return f.__awaiter(void 0,void 0,void 0,function(){var a,b,c;return f.__generator(this,function(d){switch(d.label){case 0:a=r.getSelectedAddressId();if(!a)return[2,!1];if(r.hasValidation(a)&&(b=r.getValidation(a),void 0!==b))return z(b),
[2,b];d.label=1;case 1:return d.trys.push([1,3,,4]),[4,Y(f.__assign({addressId:a},P))];case 2:return c=d.sent(),void 0!==c.isValidShipment?(r.setValidation(a,c.isValidShipment),z(c.isValidShipment),[2,c.isValidShipment]):[3,4];case 3:return d.sent(),r.setValidation(a,!1),z(!1),[2,!1];case 4:return r.setValidation(a,!1),z(!1),[2,!1]}})})},na=function(a){r.setSelectedAddressId(a);var b=k["default"].cardRoot.querySelector("[data-selected-address-id]");b&&(b.dataset.selectedAddressId=a)},$a={ATVPDKIKX0DER:"usflex",
AAHKV2X7AFYLW:"cnflex",A1PA6795UKMFR9:"deflex",A1F83G8C2ARO7P:"gbflex",A1RKKUPIHCS9HS:"esflex",AJZF8LZ1EJVJN:"esflex",A13V1IB3VIYZZH:"frflex",APJ6JRA9NG5V4:"itflex",A3HOBANJMCMD83:"itflex",A2EUQ1WTGCTBG2:"caflex",A1VC38T7YXB528:"jpflex",A21TJRUUN4KGV:"inflex",A2XZLSVIQ0F4JT:"inflex",A2Q3Y263D00KWC:"brflex",AZXD3QD5B39HD:"brflex",A1AM78C64UM0Y8:"mxflex",A3P3J5A7D2ZVXI:"mxflex",AD2EMQ3L3PG8S:"ruflex",A38NPJYVS5YHNH:"ruflex",A39IBJ37TRP1C6:"auflex",A1RNPCQ4K8U27I:"auflex",A1M3WC0SJ3A38T:"nlflex",A1805IZSGTT6HS:"nlflex",
A34GYYCZVDBSIK:"aeflex",A2VIGQ35RCS4UG:"aeflex",AUJPM9XGFJRC7:"egflex",ARBP9OOSHTCHU:"egflex",A1MQPSGJ6U9Q54:"saflex",A17E79C6D8DWNP:"saflex",A2QWGHQV78QQMU:"sgflex",AUK5T4I7X4ZCF:"sgflex",A3CQBQD3RGPJR8:"trflex",A33AVAJ2PDY3EV:"trflex",A1DQ6JV7I20JSG:"sgflex",A19VAU5U5O7RUS:"sgflex",AT614YYYNOC1S:"seflex",A2NODRKZP88ZB9:"seflex",AKY4K4WKH21YQ:"plflex",A1C3SOZRARQ6R3:"plflex",A1YFOMBPFBRY22:"beflex",AMEN7PMS3EDWL:"beflex",A1NOHO22DE3OHQ:"coflex",A1ZXRLSQW2V54D:"coflex",A2IDBVIE7EAGN4:"clflex",A2WDZJZ5TCRMLH:"clflex",
A3PJZM0QIA8QDU:"ngflex",A3OCL2LJ6GDH9T:"ngflex",A3TFQ1G9L8TQ5L:"zaflex",AE08WJ6YKNBMC:"zaflex"},ab={ATVPDKIKX0DER:"anywhere_v2_us",AAHKV2X7AFYLW:"anywhere_v2_cn",A1PA6795UKMFR9:"anywhere_v2_de",A1F83G8C2ARO7P:"anywhere_v2_uk",A1RKKUPIHCS9HS:"anywhere_v2_es",AJZF8LZ1EJVJN:"anywhere_v2_es",A13V1IB3VIYZZH:"anywhere_v2_fr",APJ6JRA9NG5V4:"anywhere_v2_it",A3HOBANJMCMD83:"anywhere_v2_it",A2EUQ1WTGCTBG2:"anywhere_v2_ca",A1VC38T7YXB528:"anywhere_v2_jp",A21TJRUUN4KGV:"anywhere_v2_in",A2XZLSVIQ0F4JT:"anywhere_v2_in",
A2Q3Y263D00KWC:"anywhere_v2_br",AZXD3QD5B39HD:"anywhere_v2_br",A1AM78C64UM0Y8:"anywhere_v2_mx",A3P3J5A7D2ZVXI:"anywhere_v2_mx",AD2EMQ3L3PG8S:"anywhere_v2_ru",A38NPJYVS5YHNH:"anywhere_v2_ru",A39IBJ37TRP1C6:"anywhere_v2_au",A1RNPCQ4K8U27I:"anywhere_v2_au",A1M3WC0SJ3A38T:"anywhere_v2_nl",A1805IZSGTT6HS:"anywhere_v2_nl",A34GYYCZVDBSIK:"anywhere_v2_ae",A2VIGQ35RCS4UG:"anywhere_v2_ae",AUJPM9XGFJRC7:"anywhere_v2_eg",ARBP9OOSHTCHU:"anywhere_v2_eg",A1MQPSGJ6U9Q54:"anywhere_v2_sa",A17E79C6D8DWNP:"anywhere_v2_sa",
A2QWGHQV78QQMU:"anywhere_v2_sg",AUK5T4I7X4ZCF:"anywhere_v2_sg",A3CQBQD3RGPJR8:"anywhere_v2_tr",A33AVAJ2PDY3EV:"anywhere_v2_tr",A1DQ6JV7I20JSG:"anywhere_v2_sg",A19VAU5U5O7RUS:"anywhere_v2_sg",AT614YYYNOC1S:"anywhere_v2_se",A2NODRKZP88ZB9:"anywhere_v2_se",AKY4K4WKH21YQ:"anywhere_v2_pl",A1C3SOZRARQ6R3:"anywhere_v2_pl",A1YFOMBPFBRY22:"anywhere_v2_be",AMEN7PMS3EDWL:"anywhere_v2_be",A1NOHO22DE3OHQ:"anywhere_v2_co",A1ZXRLSQW2V54D:"anywhere_v2_co",A2IDBVIE7EAGN4:"anywhere_v2_cl",A2WDZJZ5TCRMLH:"anywhere_v2_cl",
A3PJZM0QIA8QDU:"anywhere_v2_ng",A3OCL2LJ6GDH9T:"anywhere_v2_ng",A3TFQ1G9L8TQ5L:"anywhere_v2_za",AE08WJ6YKNBMC:"anywhere_v2_za"},J=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Sidesheet_loginView__3LzS8")[0],b="true"===a.dataset.isMobile,c=a.dataset.marketplaceId;if(!a.dataset.isMobile||!c)throw m.countMetric("error:loginViewMissingData"),Error("Login view is missing required data attributes");a=T["default"].getLocation().host;var d=b?ab[c]:$a[c];if(!d)throw Error((b?
"Mobile":"Default")+" association handle for marketplace "+c+" does not exist");b=new URLSearchParams({"openid.assoc_handle":d,"openid.mode":"checkid_setup","openid.ns":"http://specs.openid.net/auth/2.0","openid.pape.max_auth_age":"0","openid.return_to":T["default"].getLocation().href});b=new URL("https://"+a+"/ap/signin?"+b.toString());T["default"].setLocation(b.href)},Q;(function(a){a.ERROR="ERROR";a.FATAL="FATAL";a.WARN="WARN"})(Q||(Q={}));var R=function(a,b,c,d){m.countMetric("error:pageLoad:"+
a);ba.log(b,Q.ERROR,"Page load error occurred for "+a+":"+JSON.stringify(b));if("errorPage"!=a){var e=d.dataset;a=e.glProductGroup;b=e.ingressAsin;var g=e.marketplaceId;e=e.productType;oa(A.SUBMIT_TRADE_IN,{pageIndex:c,totalPages:4,errorType:A.SUBMIT_TRADE_IN,selectionHistory:m.selectionHistory.get(),glProductGroup:a||"unknown",ingressAsin:b||"unknown",marketplaceId:g||"unknown",productType:e||"unknown"},d,4)}},K=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Sidesheet_spinner__1z6Ox")[0];
p["default"].show(a)},E=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Sidesheet_spinner__1z6Ox")[0];p["default"].hide(a)},cb=function(a,b,c,d){K();return t["default"].setup().isSignInRequired().then(function(e){return f.__awaiter(void 0,void 0,void 0,function(){var g;return f.__generator(this,function(h){switch(h.label){case 0:g=e.signInRequired;if(!g)return[3,1];J();return[3,3];case 1:return[4,bb(a,b,c,d)];case 2:h.sent(),h.label=3;case 3:return[2]}})})}).catch(function(e){R("refinementSelectionPage",
e,1,b)}).finally(function(){E()})},bb=function(a,b,c,d){return f.__awaiter(void 0,void 0,void 0,function(){var e,g;return f.__generator(this,function(h){switch(h.label){case 0:return e=t["default"].setup(),[4,e.getRefinementPage(f.__assign(f.__assign({},a),{pageIndex:1,totalPages:c}))];case 1:g=h.sent();b.appendChild(g);h=a.refinementNumber;var l=k["default"].cardRoot.getElementsByClassName("dropdown-container")[0],n=l.querySelector("[data-total-dropdown-count]");fa(Number((null===n||void 0===n?void 0:
n.dataset.totalDropdownCount)||"0"),h,l,d);return[2]}})})},Ga=function(a,b){return f.__awaiter(void 0,void 0,void 0,function(){return f.__generator(this,function(c){switch(c.label){case 0:return[4,db(a,b)];case 1:return c.sent(),[2]}})})},db=function(a,b){return f.__awaiter(void 0,void 0,void 0,function(){var c,d;return f.__generator(this,function(e){switch(e.label){case 0:return c=t["default"].setup(),[4,c.getRefinementDropdown(a)];case 1:return d=e.sent(),b.appendChild(d),[2]}})})},fb=function(a,
b,c){K();return t["default"].setup().isSignInRequired().then(function(d){return f.__awaiter(void 0,void 0,void 0,function(){var e;return f.__generator(this,function(g){switch(g.label){case 0:e=d.signInRequired;if(!e)return[3,1];J();return[3,3];case 1:return[4,eb(a,b,c)];case 2:g.sent(),g.label=3;case 3:return[2]}})})}).catch(function(d){R("questionnairePage",d,2,b)}).finally(function(){E()})},eb=function(a,b,c){return f.__awaiter(void 0,void 0,void 0,function(){var d,e;return f.__generator(this,function(g){switch(g.label){case 0:return d=
t["default"].setup(),[4,d.getQuestionnairePage(f.__assign(f.__assign({},a),{pageIndex:2,totalPages:c}))];case 1:return e=g.sent(),b.appendChild(e),Pa(),[2]}})})},hb=function(a,b,c){K();return t["default"].setup().isSignInRequired().then(function(d){return f.__awaiter(void 0,void 0,void 0,function(){var e;return f.__generator(this,function(g){switch(g.label){case 0:e=d.signInRequired;if(!e)return[3,1];J();return[3,3];case 1:return[4,gb(a,b,c)];case 2:g.sent(),g.label=3;case 3:return[2]}})})}).catch(function(d){R("offerPage",
d,3,b)}).finally(function(){E()})},gb=function(a,b,c){return f.__awaiter(void 0,void 0,void 0,function(){var d,e,g,h,l,n,q,u,F;return f.__generator(this,function(G){switch(G.label){case 0:return d=t["default"].setup(),[4,Promise.all([d.getOfferPage(f.__assign(f.__assign({},a),{pageIndex:3,totalPages:c})),d.getAddressWidget({marketplaceId:a.marketplaceId,glProductGroup:a.glProductGroup,productType:a.productType,ingressAsin:a.ingressAsin,selectionHistory:a.selectionHistory,refinementNumber:0})])];case 1:e=
f.__read.apply(void 0,[G.sent(),2]);g=e[0];h=e[1];b.appendChild(g);if(l=g.querySelector("[data-address-widget-container]"))l.appendChild(h),Ya({marketplaceId:a.marketplaceId,glProductGroup:a.glProductGroup,productType:a.productType,ingressAsin:a.ingressAsin});ma();ib();n=jb();q=[{selector:'[data-csa-c-content-id="unifiedTradeInCard-offerFooter-termsAndConditions-content"]',url:n.termsAndConditionsUrl},{selector:'[data-whats-next-step="3"]',url:n.packageDeviceHelpUrl},{selector:'[data-whats-next-step="4"]',
url:n.tradeInValueHelpUrl}];q.forEach(function(B){var S=B.url;(B=k["default"].cardRoot.querySelector(B.selector))&&V(B,S)});(u=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_OfferPage_worse-conditions-list__2fDXc")[0])&&(F=u.querySelector('[data-condition="nonfunctional"]'))&&V(F,n.majorDamageUrl);return[2]}})})},oa=function(a,b,c,d){K();return t["default"].setup().isSignInRequired().then(function(e){return f.__awaiter(void 0,void 0,void 0,function(){var g;return f.__generator(this,
function(h){switch(h.label){case 0:g=e.signInRequired;if(!g)return[3,1];J();return[3,3];case 1:return[4,kb(a,b,c,d)];case 2:h.sent(),h.label=3;case 3:return[2]}})})}).catch(function(e){R("errorPage",e,3,c)}).finally(function(){E()})},kb=function(a,b,c,d){return f.__awaiter(void 0,void 0,void 0,function(){var e,g;return f.__generator(this,function(h){switch(h.label){case 0:return e=t["default"].setup(),[4,e.getErrorPage(f.__assign(f.__assign({},b),{totalPages:d,errorType:a}))];case 1:return g=h.sent(),
c.appendChild(g),[2]}})})},Y=function(a){return f.__awaiter(void 0,void 0,void 0,function(){var b;return f.__generator(this,function(c){b=t["default"].setup();return[2,b.handleAddressValidation(a)]})})},ib=function(){var a=k["default"].cardRoot.querySelector("[data-selected-address-id]");if(a=null===a||void 0===a?void 0:a.dataset.selectedAddressId)if(a=r.getValidation(a),void 0!==a){var b=k["default"].cardRoot.querySelector("#address-validation-alert");b&&(a?b.classList.add("a-hidden"):b.classList.remove("a-hidden"))}},
jb=function(){var a=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_OfferPage_offer-page-view__2AFaE")[0];return{termsAndConditionsUrl:(null===a||void 0===a?void 0:a.dataset.termsandconditionsurl)||"https://www.amazon.com/gp/help/customer/display.html?nodeId=G201889830&ref_=unified_trade_in_cards",packageDeviceHelpUrl:(null===a||void 0===a?void 0:a.dataset.packagedevicehelpurl)||"https://www.amazon.com/gp/help/customer/display.html?ref_=unified_trade_in_cards&nodeId=G2Q9VNXJ29E7AK89",
tradeInValueHelpUrl:(null===a||void 0===a?void 0:a.dataset.tradeinvaluehelpurl)||"https://www.amazon.com/gp/help/customer/display.html?ref_=unified_trade_in_cards&nodeId=GNESDAAB2JL84N3A",majorDamageUrl:(null===a||void 0===a?void 0:a.dataset.majordamageurl)||"https://www.amazon.com/b/?ie=UTF8&node=21162162011&ref_=unified_trade_in_cards#:~:text=What%27s%20major%20damage%3F"}},lb=function(){function a(b){this.selectionHistory=[];this.selectionHistory=f.__spread(b)}a.prototype.reset=function(){this.selectionHistory=
[]};a.prototype.get=function(){return this.selectionHistory};a.prototype.add=function(b,c,d){this.selectionHistory.push({data:c,key:b,title:d})};a.prototype.pop=function(){this.selectionHistory.pop()};return a}(),mb=function(){function a(){this.pagesReached=new Set;this.stepsCompleted=new Set;this.pageContainer=k["default"].cardRoot.getElementsByClassName("page-container")[0];this.totalPages=Number(this.pageContainer.dataset.totalPages);this.selectionHistory=new lb([]);this.tradeInCart=new Ea;var b=
this.pageContainer.dataset,c=b.glProductGroup,d=b.ingressAsin,e=b.marketplaceId;b=b.productType;if(!c||!e||!b)throw this.countMetric("error:missingDatasetProperties:cardSetUp"),Error("Missing required configuration properties in page container dataset: Missing one or more required properties");this.config={glProductGroup:c,ingressAsin:d,marketplaceId:e,productType:b};this.setupEventListeners()}a.prototype.setupEventListeners=function(){var b=this,c=H["default"].setup().define;c(v.continueToNextPage,
"click",function(){b.goToNextPage()});c(v.updateSelection,"click",function(){b.changeAnswers()});c(v.backToRefinementPage,"click",function(){b.backToRefinementPage()});c(v.backToShopping,"click",function(){b.backToShopping()});c(v.acceptOffer,"click",function(){b.acceptOffer()});c(v.retryFromError,"click",function(){b.retryFromError()});ma()};a.prototype.isPageContainerEmpty=function(){return 0===this.pageContainer.children.length};a.prototype.renderFirstPage=function(){return f.__awaiter(this,void 0,
void 0,function(){var b;return f.__generator(this,function(c){switch(c.label){case 0:return b=f.__assign({refinementNumber:0,selectionHistory:this.selectionHistory.get()},this.config),[4,cb(b,this.pageContainer,this.totalPages,this.config)];case 1:return c.sent(),this.recordStepReached("refinementSelectionPage"),[2]}})})};a.prototype.getCurrentPageType=function(){if(!this.pageContainer.lastChild)throw this.countMetric("error:noPageTypeFound:other"),Error("No page found");var b=this.pageContainer.lastChild;
if(b.classList.contains("_unified-trade-in_RefinementPage_refinement-page-view__14gcU"))return"refinementSelectionPage";if(b.classList.contains("_unified-trade-in_QuestionnairePage_questionnaire-page-view__3B_Bw"))return"questionnairePage";if(b.classList.contains("_unified-trade-in_OfferPage_offer-page-view__2AFaE"))return"offerPage";if(b.classList.contains("_unified-trade-in_ErrorPage_error-page-view__Z4ieC"))return"errorPage";this.countMetric("error:noPageTypeFound:other");throw Error("Unknown page type detected");
};a.prototype.goToNextPage=function(){return f.__awaiter(this,void 0,void 0,function(){var b,c;return f.__generator(this,function(d){switch(d.label){case 0:b=this.getCurrentPageType();this.hideCurrentPage();c=b;switch(c){case "refinementSelectionPage":return[3,1];case "questionnairePage":return[3,3]}return[3,5];case 1:return[4,this.goToQuestionnairePage()];case 2:return d.sent(),[3,5];case 3:return[4,this.goToOfferPage()];case 4:return d.sent(),[3,5];case 5:return[2]}})})};a.prototype.goToRefinementPage=
function(){this.removeAllPagesExceptFirst();this.showCurrentPage()};a.prototype.backToShopping=function(){this.countMetric("backToShoppingClick");Z()};a.prototype.acceptOffer=function(){return f.__awaiter(this,void 0,void 0,function(){var b,c,d,e;return f.__generator(this,function(g){switch(g.label){case 0:b=this.tradeInCart.getCurrentItem();if(!b)throw this.countMetric("error:noCurrentItem:offerPage"),Error("No current item in cart to accept offer for");return[4,Za()];case 1:c=g.sent();if(!c)return this.showAddressValidationPopover(),
[2];if(!this.config.ingressAsin||!this.isPriceCapExceeded(b.conditionOfferMap,b.gradedCondition))return[3,3];this.hideCurrentPage();return[4,this.goToErrorPage(A.PRICE_CAP)];case 2:return g.sent(),[2];case 3:K(),this.hideCurrentPage(),g.label=4;case 4:return g.trys.push([4,10,,13]),[4,this.handleTradeInSubmission(b)];case 5:return d=g.sent(),[4,this.handleCreateIntentEventForIngress(d)];case 6:return g.sent(),E(),d.aapiTimeout?[4,this.goToErrorPage(A.SUBMIT_TRADE_IN)]:[3,8];case 7:return g.sent(),
[3,9];case 8:this.countMetric("flowCompletes"),Z(!1),this.resetPageState(),g.label=9;case 9:return[3,13];case 10:return e=g.sent(),this.countMetric("error:tradeInSubmissionFailed:offerPage"),[4,this.handleCreateIntentEventForIngress({error:e})];case 11:return g.sent(),E(),[4,this.goToErrorPage(A.SUBMIT_TRADE_IN)];case 12:return g.sent(),[3,13];case 13:return[2]}})})};a.prototype.retryFromError=function(){this.pageContainer.lastChild&&this.pageContainer.removeChild(this.pageContainer.lastChild);this.pageContainer.lastChild?
this.showCurrentPage():this.renderFirstPage()};a.prototype.changeAnswers=function(){this.countMetric("changeButtonClick");this.goToRefinementPage()};a.prototype.backToRefinementPage=function(){this.countMetric("backButtonClick");this.goToRefinementPage()};a.prototype.goToQuestionnairePage=function(){return f.__awaiter(this,void 0,void 0,function(){var b;return f.__generator(this,function(c){switch(c.label){case 0:return this.prefetchAddresses().catch(function(){}),b=f.__assign({selectionHistory:this.selectionHistory.get()},
this.config),[4,fb(b,this.pageContainer,this.totalPages)];case 1:return c.sent(),this.recordStepReached("questionnairePage"),[2]}})})};a.prototype.prefetchAddresses=function(){return f.__awaiter(this,void 0,void 0,function(){var b,c,d,e,g;return f.__generator(this,function(h){switch(h.label){case 0:return b=t["default"].setup(),[4,b.getAddressWidget(this.config)];case 1:c=h.sent();d=c.querySelector("[data-selected-address-id]");e=null===d||void 0===d?void 0:d.dataset.selectedAddressId;if(!e)return[3,
5];h.label=2;case 2:return h.trys.push([2,4,,5]),[4,b.handleAddressValidation(f.__assign(f.__assign({},this.config),{addressId:e}))];case 3:return g=h.sent(),void 0!==g.isValidShipment&&r.setValidation(e,g.isValidShipment),[3,5];case 4:return h.sent(),[3,5];case 5:return[2]}})})};a.prototype.goToOfferPage=function(){return f.__awaiter(this,void 0,void 0,function(){var b,c,d,e,g,h,l;return f.__generator(this,function(n){switch(n.label){case 0:this.hideCurrentPage();b=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_Footer_validate-button__3uqCg")[0];
c=null===b||void 0===b?void 0:b.parentElement;if(!c)throw this.countMetric("error:missingButtonContainer:questionnairePage"),Error("Unable to determine estimated offer value");return[4,this.getTradeInCartItem(c.dataset)];case 1:d=n.sent();this.tradeInCart.addItem(d);e=this.tradeInCart.getCurrentItem();if(!(e&&e.gradedCondition&&e.conditionOfferMap[e.gradedCondition]&&e.conditionOfferMap[e.gradedCondition].displayString))throw this.countMetric("error:missingOfferValue:questionnairePage"),Error("Unable to determine estimated offer value");
return this.config.ingressAsin&&this.isPriceCapExceeded(e.conditionOfferMap,e.gradedCondition)?[4,this.goToErrorPage(A.PRICE_CAP)]:[3,3];case 2:return n.sent(),[2];case 3:return g=e.conditionOfferMap[e.gradedCondition].displayString,h=this.getWorseConditionValues(e.conditionOfferMap,e.gradedCondition),l=f.__assign(f.__assign({},this.config),{displayEstimatedOfferValue:g,worseDisplayConditions:h,selectionHistory:this.selectionHistory.get(),currentCartItem:d}),[4,hb(l,this.pageContainer,this.totalPages)];
case 4:return n.sent(),this.recordStepReached("offerPage"),this.recordStepCompleted("questionnairePage"),[2]}})})};a.prototype.goToErrorPage=function(b){return f.__awaiter(this,void 0,void 0,function(){var c;return f.__generator(this,function(d){switch(d.label){case 0:return this.countMetric("goToErrorPage:"+b),this.hideCurrentPage(),c=f.__assign({pageIndex:3,totalPages:this.totalPages,errorType:b,selectionHistory:this.selectionHistory.get()},this.config),[4,oa(c.errorType,c,this.pageContainer,this.totalPages)];
case 1:return d.sent(),[2]}})})};a.prototype.hideCurrentPage=function(){if(!this.pageContainer.lastChild)throw this.countMetric("error:noPageFound:other"),Error("No page found");p["default"].hide(this.pageContainer.lastChild)};a.prototype.showCurrentPage=function(){if(!this.pageContainer.lastChild)throw this.countMetric("error:noPageFound:other"),Error("No page found");p["default"].show(this.pageContainer.lastChild)};a.prototype.removeAllPages=function(){this.removePages(0)};a.prototype.resetPageState=
function(){this.removeAllPages();this.selectionHistory.reset();this.tradeInCart.clear();this.pagesReached.clear();this.stepsCompleted.clear()};a.prototype.removeAllPagesExceptFirst=function(){this.removePages(1)};a.prototype.removePages=function(b){for(;this.pageContainer.children.length>b;){if(!this.pageContainer.lastChild)throw this.countMetric("error:noPageFound:other"),Error("No page found");this.pageContainer.removeChild(this.pageContainer.lastChild)}};a.prototype.getTradeInCartItem=function(b){var c;
return f.__awaiter(this,void 0,void 0,function(){var d,e,g,h,l,n,q,u,F,G,B,S,pa,qa,ra,sa=this;return f.__generator(this,function(ta){switch(ta.label){case 0:d=b.catalogVersion;e=b.questionnaireRevisionId;g=b.productIdentifier;h=b.programCategory;if(!(d&&e&&g&&h))throw this.countMetric("error:missingRequiredData"),Error("Missing required data: catalogVersion="+d+", questionnaireRevisionId="+e+", productIdentifier="+g+", programCategory="+h);l={id:g,type:"ASIN"};n=k["default"].cardRoot.getElementsByClassName("_unified-trade-in_QuestionnairePage_questionnaire-page-view__3B_Bw")[0];
q=t["default"].setup();return[4,q.getConditionOffers(f.__assign({selectionHistory:this.selectionHistory.get(),catalogVersion:d},this.config))];case 1:return u=ta.sent(),F=this.getSortedConditionOfferMap(u.conditionOfferMap),G=X,B=y,S=F[G],pa=null===(c=S)||void 0===c?void 0:c.merchantId,qa=n.getElementsByClassName("_unified-trade-in_QuestionnairePage_question-container__2J0aR"),ra=Object.entries(B).map(function(L){var C=f.__read(L,2);L=C[0];C=C[1];var ua=qa[parseInt(L)].dataset.questiontextid;if(!ua)throw sa.countMetric("error:missingQuestionTextId"),
Error("Missing question text id for question at index "+L);if(!C.choiceDescriptionId)throw sa.countMetric("error:missingChoiceDescriptionId"),Error("Missing choice description id for choice "+C.answer+" of question at index "+L);return{answer:C.answer,condition:C.condition,question:ua,choiceDescriptionId:C.choiceDescriptionId}}),[2,{conditionOfferMap:F,gradedCondition:G,imageUrl:La(),questionnaireAnswers:B,selectionHistory:this.selectionHistory.get(),returnOption:Sa(),catalogVersion:d,questionnaireRevisionId:e,
merchantId:pa,questionnaire:{questionnaireAnswers:ra,revisionId:e},productIdentifier:l,programCategory:h}]}})})};a.prototype.getSortedConditionOfferMap=function(b){b=Object.entries(b);b.sort(function(d,e){return e[1].amount-d[1].amount});var c={};b.forEach(function(d){d=f.__read(d,2);c[d[0]]=d[1]});return c};a.prototype.getWorseConditionValues=function(b,c){b=Object.entries(b);var d=b.findIndex(function(e){return f.__read(e,1)[0]===c});return-1===d?[]:b.slice(d+1).map(function(e){e=f.__read(e,2);
var g=e[1];return{condition:e[0].toLowerCase(),tradeInValue:g}})};a.prototype.isPriceCapExceeded=function(b,c){var d=M.buyingOptionContext.getMaximumTradeInValue();if(!d)throw this.countMetric("error:buyingOptionContextUnavailable"),Error("Buying option context data is not available for price cap validation");if(!b[c])throw this.countMetric("error:gradedConditionUnavailable"),Error("Graded condition not available in condition offer map for price cap validation");return b[c].amount>=d.amount};a.prototype.handleCreateIntentEventForIngress=
function(b){return f.__awaiter(this,void 0,void 0,function(){var c,d;return f.__generator(this,function(e){switch(e.label){case 0:if(!this.config.ingressAsin)return[3,4];c=!b.aapiTimeout&&!b.error;e.label=1;case 1:return e.trys.push([1,3,,4]),[4,M.handleCreateIntentEvent(c)];case 2:return e.sent(),[3,4];case 3:return d=e.sent(),this.countMetric("error:ingressCreateIntentFailed"),ba.log(d,Q.ERROR,"Failed to handle ingress create intent event"),[3,4];case 4:return[2]}})})};a.prototype.handleTradeInSubmission=
function(b){return f.__awaiter(this,void 0,void 0,function(){var c,d,e,g,h;return f.__generator(this,function(l){switch(l.label){case 0:return c=t["default"].setup(),d=this.getSelectedAddressId(),e={cartItems:[b],ingressAsin:this.config.ingressAsin,marketplaceId:this.config.marketplaceId,glProductGroup:this.config.glProductGroup,productType:this.config.productType,selectedAddressId:d},g=this.config.ingressAsin?N.INTENT:N.ORDER,this.countMetric("tradeInOptionSelected:"+g+":"+b.returnOption),[4,c.submitTradeIn(f.__assign(f.__assign({},
e),{submissionType:g}))];case 1:return h=l.sent(),[2,h]}})})};a.prototype.countMetric=function(b,c){var d,e;void 0===c&&(c=1);var g=(null===(d=this.config)||void 0===d?void 0:d.glProductGroup)||"unknown";d=(null===(e=this.config)||void 0===e?void 0:e.productType)||"unknown";ya.count(b+":"+g+":"+d,c)};a.prototype.updatePageContainerDataset=function(b){var c;if(null===(c=this.pageContainer)||void 0===c?0:c.dataset)this.pageContainer.dataset.glProductGroup=b.glProductGroup,this.pageContainer.dataset.productType=
b.productType,this.pageContainer.dataset.ingressAsin=b.ingressAsin};a.prototype.getSelectedAddressId=function(){var b=r.getSelectedAddressId();if(b)return b;b=k["default"].cardRoot.querySelector("[data-selected-address-id]");if(null===b||void 0===b?0:b.dataset.selectedAddressId)return na(b.dataset.selectedAddressId),b.dataset.selectedAddressId;this.countMetric("error:noAddressSelected");throw Error("No address selected for trade-in submission");};a.prototype.showAddressValidationPopover=function(){var b=
k["default"].cardRoot.querySelector("#popover-trigger");b&&b.click()};a.prototype.recordStepMetric=function(b,c,d){d.has(b)||(d.add(b),this.countMetric(c+":"+b))};a.prototype.recordStepReached=function(b){this.recordStepMetric(b,"stepReached",this.pagesReached)};a.prototype.recordStepCompleted=function(b){this.recordStepMetric(b,"stepCompleted",this.stepsCompleted)};return a}(),nb=function(){function a(){this.buyingOptionContextMap={};this.buyingOptionIndex=""}a.prototype.setBuyingOptionData=function(b,
c){this.buyingOptionContextMap=b;this.buyingOptionIndex=c};a.prototype.getBuyingOptionContextMap=function(){return this.buyingOptionContextMap};a.prototype.getMaximumTradeInValue=function(){var b;return null===(b=this.buyingOptionContextMap[this.buyingOptionIndex])||void 0===b?void 0:b.price};a.prototype.getIntentId=function(){var b;return null===(b=this.buyingOptionContextMap[this.buyingOptionIndex])||void 0===b?void 0:b.intentId};return a}(),pb=function(){function a(b){this.buyingOptionContext=
new nb;this.config=b}a.prototype.initializeIngressEventListeners=function(){var b=this;w["default"].on("a:tradeIn:tanooki:v3:healthCheck",function(){w["default"].trigger("a:tradeIn:tanooki:v3:healthCheck:response",{status:x.SUCCESS})});w["default"].on("a:tradeIn:tanooki:v3:launch",function(c){return f.__awaiter(b,void 0,void 0,function(){var d,e,g,h,l,n;return f.__generator(this,function(q){switch(q.label){case 0:this.buyingOptionContext.setBuyingOptionData(c.buyingOptionContextMap,c.buyingOptionIndex);
if(!c.ingressAsin||!this.config.ingressAsin||c.ingressAsin===this.config.ingressAsin)return[3,4];m.resetPageState();q.label=1;case 1:return q.trys.push([1,3,,4]),d=t["default"].setup(),[4,d.updateConfigForIngressAsin({ingressAsin:c.ingressAsin})];case 2:return e=q.sent(),this.config=f.__assign(f.__assign(f.__assign({},this.config),e),{ingressAsin:c.ingressAsin}),g=m.config=this.config,h=g.glProductGroup,l=g.productType,n=g.ingressAsin,m.updatePageContainerDataset({glProductGroup:h,productType:l,ingressAsin:n}),
[3,4];case 3:return q.sent(),m.countMetric("error:configUpdateFailed"),w["default"].trigger("a:tradeIn:tanooki:v3:launch:response",this.buildResponseObject(x.ERROR,void 0,c.requestId)),[2];case 4:return ob(),w["default"].trigger("a:tradeIn:tanooki:v3:launch:response",this.buildResponseObject(x.SUCCESS,void 0,c.requestId)),[2]}})})});w["default"].on("a:tradeIn:tanooki:v3:intentAction:remove",function(c){return f.__awaiter(b,void 0,void 0,function(){var d,e,g,h;return f.__generator(this,function(l){switch(l.label){case 0:this.buyingOptionContext.setBuyingOptionData(c.buyingOptionContextMap,
c.buyingOptionIndex);c.ingressAsin&&(this.config=f.__assign(f.__assign({},this.config),{ingressAsin:c.ingressAsin}));d=this.buyingOptionContext.getIntentId();e={};if(!d)return[3,2];g=t["default"].setup();return[4,g.deleteIntent(f.__assign({intentId:d,requestId:c.requestId},this.config))];case 1:e=l.sent(),l.label=2;case 2:return(h=e.intentId?!0:!1)&&m.resetPageState(),[4,this.handleRemoveIntentEvent(h,e.requestId||c.requestId)];case 3:return l.sent(),[2]}})})});w["default"].on("a:tradeIn:tanooki:v3:fetchIngressMessaging",
function(c){return f.__awaiter(b,void 0,void 0,function(){return f.__generator(this,function(d){switch(d.label){case 0:return this.buyingOptionContext.setBuyingOptionData(c.buyingOptionContextMap,c.buyingOptionIndex),c.ingressAsin&&(this.config=f.__assign(f.__assign({},this.config),{ingressAsin:c.ingressAsin})),[4,this.handleFetchIngressMessagingEvent(c.requestId)];case 1:return d.sent(),[2]}})})})};a.prototype.handleCreateIntentEvent=function(b,c){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,
function(d){switch(d.label){case 0:return[4,this.handleIntentActionEvent("create",b,c)];case 1:return[2,d.sent()]}})})};a.prototype.handleRemoveIntentEvent=function(b,c){return f.__awaiter(this,void 0,void 0,function(){return f.__generator(this,function(d){switch(d.label){case 0:return[4,this.handleIntentActionEvent("remove",b,c)];case 1:return[2,d.sent()]}})})};a.prototype.handleFetchIngressMessagingEvent=function(b){return f.__awaiter(this,void 0,void 0,function(){var c;return f.__generator(this,
function(d){switch(d.label){case 0:return[4,this.fetchIngressMessaging(b)];case 1:c=d.sent();if(!c||!c.tradeInIngressMessaging)return this.triggerFetchIngressMessagingResponse(x.ERROR,void 0,b),[2];this.triggerFetchIngressMessagingResponse(x.SUCCESS_STATE_UPDATED,c.tradeInIngressMessaging,c.requestId||b);return[2]}})})};a.prototype.handleIntentActionEvent=function(b,c,d){return f.__awaiter(this,void 0,void 0,function(){var e;return f.__generator(this,function(g){switch(g.label){case 0:return c?[4,
this.fetchIngressMessaging(d)]:(this.triggerIntentActionResponse(b,x.ERROR,void 0,d),[2]);case 1:e=g.sent();if(!e||!e.tradeInIngressMessaging)return this.triggerIntentActionResponse(b,x.ERROR,void 0,d),[2];this.triggerIntentActionResponse(b,x.SUCCESS_STATE_UPDATED,e.tradeInIngressMessaging,e.requestId||d);return[2]}})})};a.prototype.triggerSidesheetClosedEvent=function(b){w["default"].trigger("a:tradeIn:tanooki:v3:closeSidesheet",this.buildResponseObject(x.SUCCESS,void 0,b))};a.prototype.fetchIngressMessaging=
function(b){return f.__awaiter(this,void 0,void 0,function(){var c,d;return f.__generator(this,function(e){switch(e.label){case 0:c=t["default"].setup(),e.label=1;case 1:return e.trys.push([1,3,,4]),[4,c.getIngressMessaging(f.__assign({buyingOptionContextMap:this.buyingOptionContext.getBuyingOptionContextMap(),requestId:b},this.config))];case 2:return d=e.sent(),[2,{tradeInIngressMessaging:d.tradeInIngressMessaging,requestId:d.requestId}];case 3:return e.sent(),m.countMetric("error:ingressMessagingFetch"),
[2,null];case 4:return[2]}})})};a.prototype.buildResponseObject=function(b,c,d){return f.__assign(f.__assign({status:b},c&&{tradeInIngressMessaging:c}),d&&{requestId:d})};a.prototype.triggerIntentActionResponse=function(b,c,d,e){w["default"].trigger("a:tradeIn:tanooki:v3:intentAction:"+b+":response",this.buildResponseObject(c,d,e))};a.prototype.triggerFetchIngressMessagingResponse=function(b,c,d){w["default"].trigger("a:tradeIn:tanooki:v3:fetchIngressMessaging:response",this.buildResponseObject(b,
c,d))};return a}(),m,M,qb=function(){m=new mb;M=new pb(m.config);var a=H["default"].setup().define;a(ca.hideSidesheet,"click",function(){Z()});a(ca.redirectToLogin,"click",function(b){return f.__awaiter(void 0,void 0,void 0,function(){return f.__generator(this,function(c){J();return[2]})})});M.initializeIngressEventListeners()},ob=function(){Ca();m.isPageContainerEmpty()&&(m.countMetric("flowStarts"),m.renderFirstPage());p["default"].delay(function(){var a=k["default"].cardRoot.querySelector(".page-container");
a&&a.focus()},500)},Z=function(a){void 0===a&&(a=!0);a&&m.countMetric("stepDropoff:"+m.getCurrentPageType());Da();M.triggerSidesheetClosedEvent()};aa._operationNames="getRefinementPage getRefinementDropdown getQuestionnairePage getOfferPage getConditionOffers submitTradeIn isSignInRequired getIngressMessaging deleteIntent getErrorPage handleAddressValidation getAddressWidget updateConfigForIngressAsin".split(" ");aa.card=function(){return f.__awaiter(void 0,void 0,void 0,function(){return f.__generator(this,
function(a){qb();return[2]})})}});
