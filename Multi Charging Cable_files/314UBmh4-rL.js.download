'use strict';(function(f){var m=window.AmazonUIPageJS||window.P,v=m._namespace||m.attributeErrors,d=v?v("UdmRefreshAssets",""):m;d.guardFatal?d.guardFatal(f)(d,window):d.execute(function(){f(d,window)})})(function(f,m,v){f.when("A","udm-refresh-manager","quantity-dropdown-constants","udm-metrics-publisher","udm-amount-refresh").execute("quantity-dropdown-udm-refresh",function(d,b,a,q,c){function g(){p(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS).toArray().map(function(a){return k(a)}).forEach(function(a){return b.registerFeature(h,
{successHandler:l,failureHandler:n},a)})}function k(h){return h?Number(h.getAttribute(a.HTML_ATTRIBUTES.AUI_PAGE_STATE).match(a.REGEX.DELIVERY_BLOCK_AJAX_PARAMS)[1]):NaN}var p=d.$,h={featureName:a.FEATURE_REGISTRATION.NAME,featureAttribution:a.FEATURE_REGISTRATION.CTI,mandatoryParams:{quantity:"1"}},l=function(){q.logMetric(a.METRICS.QTY_REFRESH_SUCCESS)},n=function(){q.logMetric(a.METRICS.QTY_REFRESH_FAILURE)};d.on(a.EVENTS.PAGE_UPDATE,function(){g()});g();p(a.SELECTORS.QUANTITY_DROPDOWN).live("change",
function(h){try{if(!h.updateUdmOnQuantityChange){h.updateUdmOnQuantityChange=1;var l=p(this).val(),d={quantity:String(parseInt(l,10))},e;if(e=c.isEnabled){var g=this.closest("form")||this.closest("#buybox");if(g){var r=g.querySelector(a.SELECTORS.DIMENSION_INPUT);e=r&&r.value===a.DIMENSIONS.WEIGHT}else e=!1}e&&(d.amount=l,d.quantity="1");var y=p(this).closest(a.SELECTORS.ACCORDION_ROW),u=k(y.find(a.SELECTORS.DELIVERY_BLOCK_AJAX_PARAMS)[0]);isNaN(u)||b.refresh({featureName:a.FEATURE_REGISTRATION.NAME},
d,u)}}catch(z){f.log("Quantity Dropdown UDM Refresh Failed with ERROR: "+z,"ERROR","QuantityDropdown"),q.logMetric(a.METRICS.QTY_REFRESH_FAILURE)}})});"use strict";f.register("quantity-dropdown-constants",function(){return{FEATURE_REGISTRATION:{NAME:"QUANTITY",CTI:"Website/DEX Evaluation/Alternative Offer Eligibility Message"},EVENTS:{PAGE_UPDATE:"a:pageUpdate"},SELECTORS:{DELIVERY_BLOCK_AJAX_PARAMS:"script[data-a-state*\x3d'delivery-block-ajax-params']",ACCORDION_ROW:'\'[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]\'',
QUANTITY_DROPDOWN:"#selectQuantity [name\x3d'quantity'], #mobileQuantityDropDown",DIMENSION_INPUT:'input[name\x3d"items[0.base][unitOfMeasureQuantity][unitOfMeasure][dimension]"]'},REGEX:{DELIVERY_BLOCK_AJAX_PARAMS:/delivery-block-ajax-params-(\d+)/},HTML_ATTRIBUTES:{AUI_PAGE_STATE:"data-a-state"},DIMENSIONS:{WEIGHT:"WEIGHT"},METRICS:{QTY_REFRESH_SUCCESS:"UDM-REFRESH-QUANTITY-SUCCESS",QTY_REFRESH_FAILURE:"UDM-REFRESH-QUANTITY-FAILURE"}}});"use strict";f.when("A").register("udm-refresh-allowlisted-features",
function(d){var b={QUANTITY:{mandatoryParams:["quantity"],optionalParams:["amount"]},SERVICE_OPTIONS:{mandatoryParams:["vas"]}};return{get:function(){return Object.keys(b)},getMandatoryParamsForFeature:function(a){return b[a].mandatoryParams},getOptionalParamsForFeature:function(a){return b[a].optionalParams||[]},getMandatoryParamsForAllFeatures:function(){var a=[];d.each(b,function(b){a=a.concat(b.mandatoryParams)});return a}}});"use strict";f.when("A","udm-refresh-allowlisted-features","udm-metrics-publisher").register("udm-refresh-feature-registration",
function(d,b,a){function q(a){var h=!0;d.each(b.getMandatoryParamsForFeature(a.featureName),function(b){a.mandatoryParams.hasOwnProperty(b)||(f.log("FeatureData is missing the mandatoryParam "+b,"ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),h=!1)});return h}function c(a){return a.featureName+" (C/T/I: "+a.featureAttribution+")"}function g(h,b){a.logMetric(h);a.logMetricWithSuffix(h,b)}var k={},p=["featureName","featureAttribution","mandatoryParams"];return{registerFeature:function(a,
l,n){var e;a:{for(e=0;e<p.length;e++){var h=p[e];if(!a.hasOwnProperty(h)){f.log("UDM Refresh Manager: Feature Registration does not contain valid mandatory attribute: "+h,"ERROR",a);g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName);e=!1;break a}}e=!0}if(!e)return!1;if(0>n)return f.log("UDM Refresh Manager: BuyingOptionIndex can not be less than 0","ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),!1;-1===b.get().indexOf(a.featureName)?(f.log("UDM Refresh Manager: Feature name is not allowlisted",
"ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),e=!1):e=!0;if(!e||!q(a))return!1;e=k.hasOwnProperty(n)&&k[n].hasOwnProperty(a.featureName)?!0:!1;if(e)return!1;l.hasOwnProperty("successHandler")&&l.hasOwnProperty("failureHandler")?"function"!==typeof l.successHandler||"function"!==typeof l.failureHandler?(f.log("UDM Refresh Manager: Callbacks are not of type function","ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),e=!1):e=!0:(f.log("UDM Refresh Manager: Functions missing in callbacks passed",
"ERROR",c(a)),g("UDM-FEATURE-REGISTRATION-REQUEST-INVALID",a.featureName),e=!1);if(!e)return!1;e={};h=a.featureName;l={featureName:a.featureName,featureAttribution:a.featureAttribution,callbacks:l,mandatoryParams:a.mandatoryParams,optionalParams:a.optionalParams};h in e?Object.defineProperty(e,h,{value:l,enumerable:!0,configurable:!0,writable:!0}):e[h]=l;k.hasOwnProperty(n)||(k[n]={});d.extend(k[n],e);g("UDM-FEATURE-REGISTRATION-REQUEST-SUCCESS",a.featureName);return!0},getDataForFeature:function(a,
b){return k.hasOwnProperty(b)&&k[b].hasOwnProperty(a)?k[b][a]:null},getRegisteredFeatures:function(a){return Object.keys(k[a])}}});"use strict";f.when("A","udm-refresh-framework").register("udm-refresh-manager",function(d,b){return{refresh:function(a,d,c){return b.refresh(a,d,c)},registerFeature:function(a,d,c){return b.registerFeature(a,d,c)}}});"use strict";f.when("A","udm-refresh-feature-registration","udm-gxa-handler","udm-refresh-dom-accessor","udm-refresh-allowlisted-features","udm-metrics-publisher",
"udm-glow-cip-migration-weblab").register("udm-refresh-framework",function(d,b,a,q,c,g,k){function p(a,b,u){if(!a.hasOwnProperty("featureName"))return f.log("UDM Refresh Manager: Feature data passed to UDM refresh manager without featureName property","ERROR",u),g.logMetric("UDM-REFRESH-REQUEST-INVALID"),!1;if(0>u)return f.log("UDM Refresh Manager: buyingOptionIndex cannot be less than zero.","ERROR",a.featureName),t("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1;var r=!0;d.each(c.getMandatoryParamsForFeature(a.featureName),
function(c){b.hasOwnProperty(c)||(f.log("UDM Refresh Manager: mandatory param: "+c+" is not present in request data.","ERROR",a.featureName),t("UDM-REFRESH-REQUEST-INVALID",a.featureName),r=!1)});return r}function h(a,b){return null==b||"undefined"===typeof b.asin?(f.log("UDM Refresh Manager: Refresh triggered for a buybox type which does not have the page state","ERROR",a.featureName),t("UDM-REFRESH-REQUEST-INVALID",a.featureName),!1):!0}function l(a,b,c,e){b=m(a,b);a=n(a,c);c={asin:e.asin,merchantId:e.merchantId,
exclusiveMerchantId:e.merchantId};k.isEnabled&&(c.deviceType=e.deviceType);null!=e.offerListingId&&(c.offerListingId=e.offerListingId);null!=e.locale&&(c.language=e.locale);return{gxaParams:d.extend({},x,c,a,b),featureStateToPersist:b}}function n(a,c){var r={},f=w[c];d.each(b.getRegisteredFeatures(c),function(b){b!==a&&d.extend(r,e(f,b,c))});return r}function e(a,c,e){return a&&a.hasOwnProperty(c)?a[c]:b.getDataForFeature(c,e).mandatoryParams}function m(a,b){var e={},f=c.getMandatoryParamsForFeature(a);
d.each(f,function(a){e[a]=b[a]});a=c.getOptionalParamsForFeature(a);d.each(a,function(a){b[a]!==v&&(e[a]=b[a])});return e}function t(a,b){g.logMetric(a);g.logMetricWithSuffix(a,b)}var w={},x={clientId:"retailwebsite",deviceType:"web",showFeatures:"udmRefreshFeatures,deliveryBlock,priceBlockMs3Mir",ie:"UTF8",experienceId:"udmRefreshAjaxExperience"};return{registerFeature:function(a,c,e){return b.registerFeature(a,c,e)},refresh:function(c,e,d){if(!p(c,e,d))return!1;var f=q.getDeliveryBlockPageState(d);
if(!h(c,f))return!1;var g=l(c.featureName,e,d,f);a.fetchContentFromGxa(g.gxaParams).then(function(a){var e=g.featureStateToPersist;q.updatePage(d,a);w.hasOwnProperty(d)||(w[d]={});w[d][c.featureName]=e;t("UDM-REFRESH-REQUEST-SUCCESS",c.featureName);b.getDataForFeature(c.featureName,d).callbacks.successHandler()}).catch(function(a){t("UDM-REFRESH-REQUEST-FAILURE",c.featureName);b.getDataForFeature(c.featureName,d).callbacks.failureHandler()});return!0}}});"use strict";f.when("A").register("udm-refresh-dom-accessor",
function(d){var b=d.$;return{getDeliveryBlockPageState:function(a){a=b('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").text();return JSON.parse(a)},updatePage:function(a,d){var c=document.createElement("div");c.innerHTML=d;a=b('script[data-a-state\x3d\'{"key":"delivery-block-ajax-params-'+a+"\"}']").closest('[id$\x3d"AccordionRow"], #buybox, [id^\x3d"newAccordionRow"]');d=c.querySelector("#deliveryBlockSmallMessage");b(a).find("#deliveryBlockSmallMessage").replaceWith(d);
d=c.querySelector("#deliveryBlockMessage");b(a).find("#deliveryBlockMessage").replaceWith(d);c=c.querySelector("#primeBadge-ajax-feature");b(a).find("#priceBadging_feature_div").replaceWith(c);if(1===b("#buyBoxAccordion, #buybox").children().length||a.attr("id").match(/^newAccordionRow/))b("#price #priceblock_ourprice_row #ourprice_shippingmessage #priceBadging_feature_div").replaceWith(c),b("#newOfferShippingMessage_feature_div #ourPrice_availability #priceBadging_feature_div").replaceWith(c),b("#price #priceblock_saleprice_row #saleprice_shippingmessage #priceBadging_feature_div").replaceWith(c),
b("#price #priceblock_dealprice_row #dealprice_shippingmessage #priceBadging_feature_div").replaceWith(c)}}});"use strict";f.when("A").register("udm-metrics-publisher",function(d){function b(a,b){"undefined"!==typeof m.ue&&"undefined"!==typeof m.ue.count&&(null==b?m.ue.count(a,(ue.count(a)||0)+1):m.ue.count(a,b))}return{logMetric:b,logLatency:function(a,d,c){null==c&&(c=(new Date).getTime());b(a,c-d)},logMetricWithSuffix:function(a,d){b(a+"-"+d)}}});"use strict";f.when("A","3p-promise","udm-metrics-publisher").register("udm-gxa-handler",
function(d,b,a){function f(a){return"/gp/product/ajax/udmRefreshAjaxExperience?"+Object.keys(a).map(function(b){return b+"\x3d"+a[b]}).join("\x26")}return{fetchContentFromGxa:function(c){var g=f(c),k=(new Date).getTime();return new b(function(b,c){d.get(g,{timeout:"10000",contentType:"application/x-www-form-urlencoded;charset\x3dutf-8",dataType:"html",success:function(d){null==d||0===d.trim().length?(a.logLatency("UDM-GXA-NULL-RESPONSE-LATENCY",k),c(Error("EMPTY_RESPONSE_ERROR_MESSAGE"))):(a.logLatency("UDM-GXA-CALL-SUCCESS-LATENCY",
k),b(d.trim()))},error:function(b){a.logLatency("UDM-GXA-CALL-FAILURE-LATENCY",k);c(b)}})})}}});"use strict";f.register("udm-glow-cip-migration-weblab",function(){return{isEnabled:!1}});"use strict";f.register("udm-amount-refresh",function(){return{isEnabled:!0}})});