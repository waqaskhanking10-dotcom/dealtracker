(function(){"use strict";const D=e=>{console.debug(e)},u=(e,t)=>{console.error(e,JSON.stringify(t)),fe("ERROR",e,Ee(e,t))},ee=(e,t)=>{console.error(e,JSON.stringify(t)),fe("FATAL",e,Ee(e,t))},fe=(e,t,n)=>{var i;(i=window.ueLogError)==null||i.call(window,n,{logLevel:e,attribution:"APE-safeframe",message:t+" | "})},Ee=(e,t)=>t instanceof Error?t:t?new Error(t):new Error(e),te=(e,t,n)=>(...i)=>{try{e(...i)}catch(s){t==null||t(n||"Error in handler",s)}},vt=e=>Pt(e),It=/^([A-Za-z0-9+/]{4})*([A-Za-z0-9+/]{3}=|[A-Za-z0-9+/]{2}==)?$/,ve=e=>It.test(e),bt=e=>ve(e)?vt(e):e,Ie=e=>ve(e)?e:St(e),St=e=>btoa(unescape(encodeURIComponent(e))),Pt=e=>decodeURIComponent(escape(atob(e))),yt=e=>e&&e.split("&c=${AAX_PAYLOAD}").join(""),N=e=>{if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("setEntity",{adCreativeMetaData:e})}catch(t){u("Error with 'setEntity' CSA",t)}},g=(e,t,n=1)=>{if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e+":"+t.name+":"+t.id,metricValue:n},{ent:"all"})}catch(i){u("Error with 'logCsaEvent' CSA",i)}},B=(e,t=1)=>{if(window.csa)try{window.csa("Events",{producerId:"adplacements"})("log",{schemaId:"ApeSafeframe.csaEvent.1",metricName:e,metricValue:t},{ent:"all"})}catch(n){u("Error with 'incrementCounter' CSA",n)}},At=/(\/b|\/s|\/l).*(node=)(\d{1,12})/,ne=new Map,be=()=>{if(!ne.has(window.location.href)){const e=At.exec(window.location.href),t=e&&e[3]?e[3]:null;ne.set(window.location.href,t)}return ne.get(window.location.href)},Se=e=>{const t=be();if(!e||!t)return null;const n=e.split(":");return n.splice(n.length-1,0,t),n.join(":")},Pe=e=>{const t=be();return t?"".concat(e,":").concat(t):null},ie=e=>e.replace(/_/g,":"),l=(e,t,n=1)=>{if(!ye())return;const i=(s,r,o)=>{r&&Ae("".concat(Te(s),":").concat(r),o)};i(e,t.id,n),i(e,Pe(t.id),n),i(e,ie(t.name),n),i(e,Se(ie(t.name)),n)},m=(e,t=1)=>{ye()&&Ae(Te(e),t)},ye=()=>{var e;return typeof((e=window==null?void 0:window.ue)==null?void 0:e.count)=="function"},Ae=(e,t)=>{var n;return(n=window==null?void 0:window.ue)==null?void 0:n.count(e,t)},Ce="adplacements",Te=e=>e.startsWith(Ce)?e:"".concat(Ce,":").concat(e),Ct="adload:renderstart",Tt="adload:renderend",_t="adload:creativewritten",Nt="adload:start",Lt="adload:delayloadcallback",Mt="adload_renderstart",xt="adload_renderend",Rt="adload_creativewritten",Ot="adload_start",kt="adload_delayload",b=(e,t)=>{Bt()&&Vt(e+Ht(t))},Bt=()=>{var e;return typeof((e=window==null?void 0:window.ue)==null?void 0:e.tag)=="function"},Vt=e=>{var t;return(t=window==null?void 0:window.ue)==null?void 0:t.tag(e)},Ht=e=>e?":".concat(e):"",Ft=e=>{if(!(e!=null&&e.adCreativeMetaData)||!Object.keys(e.adCreativeMetaData).length){b("noadrender"),N({adrender:"false"});return}b("adrender"),b("adrender:safeframe"),Ut(e),Wt(e),$t(e),Yt(e)},Ut=e=>{const t=_e(e);b("adrender","creativetemplatename:"+t),N({adrender:"true",creativeTemplateName:t,isLightAds:"false"})},_e=e=>e.adCreativeMetaData.adCreativeTemplateName?e.adCreativeMetaData.adCreativeTemplateName.toLowerCase().replace(/[^0-9a-z]/g,""):"unknown",Wt=e=>{e.adCreativeMetaData.adCreativeId&&(b("adrender","creativeid:"+e.adCreativeMetaData.adCreativeId),N({creativeId:e.adCreativeMetaData.adCreativeId}))},$t=e=>{e.adCreativeMetaData.adProgramId&&(b("adrender","programid:"+e.adCreativeMetaData.adProgramId),N({adProgramId:e.adCreativeMetaData.adProgramId}))},Yt=e=>{e.isCardsFlow!==void 0&&N({isCardsFlow:e.isCardsFlow.toString()})},Jt="aUAZqFtiIp6VxqpW3coqZ2JdZnV3RN9S8yKMRIdJ",Gt="https://qdbx3pbnx6veby23pzgaowu3q40tmmrr.lambda-url.us-east-1.on.aws",se="APE_CW_METRICS",Kt=10;let Ne=!1;const Le=e=>{Ne||(window.addEventListener("beforeunload",()=>Xt()),Ne=!0);const t=Me();t.push(e),t.length>=Kt?xe(t):qt(t)},Me=()=>{const e=localStorage.getItem(se);if(!e)return[];try{return JSON.parse(e)}catch(t){return[]}},xe=e=>{navigator.sendBeacon(Gt,JSON.stringify(zt(e))),localStorage.removeItem(se)},zt=e=>({metrics:e,xApiKey:Jt}),qt=e=>{localStorage.setItem(se,JSON.stringify(e))},Xt=()=>{const e=Me();e.length>0&&xe(e)},S=(e,t)=>{const n=()=>{var i,s;return(s=(i=e==null?void 0:e.renderingWeblabs)==null?void 0:i[t])==null?void 0:s.toLowerCase()};return{isT1(){return n()==="t1"},isT2(){return n()==="t2"},getTreatment(){return n()}}},jt=()=>S(window,"ADPT_SF_LOW_RATE_METRIC_LOGGING_1256362"),Zt=()=>S(window,"ADPT_SF_SERVER_SIDE_SPONSORED_LABEL_998980"),Qt=()=>S(window,"APM_STORES_JPS_JRS_SAFEFRAME_VIEW_RATE_EXPERIMENT_1289633"),V=()=>S(window,"APM_STORES_JPS_JRS_CREATIVE_BOOKS_ADS_1277965"),Re=()=>S(window,"APM_STORES_JPS_JRS_SAFEFRAME_1318775"),Dt=()=>S(window,"APM_STORES_JPS_JRS_SAFEFRAME_NEW_VIEWABILITY_TRACKER_1354300"),en=e=>{var n,i;if(!window.APE_SF)return;const t=(i=(n=window.APE_SF).loggedMetricNames)!=null?i:n.loggedMetricNames=new Set;t.has(e.metricName)||(t.add(e.metricName),Le(e))},y=({metricName:e,adDetails:t,count:n=1,additionalDimensions:i={},once:s=!1})=>{jt().isT1()&&(s?en:Le)(tn(e,n,nn(t,i)))},tn=(e,t,n)=>({metricName:e,timestamp:new Date().getTime(),value:t,dimensions:n}),nn=(e,t)=>{var n,i;return{app:"SF",siteName:e.siteName,slotName:e.slotName,pageType:e.pageType,placementId:e.placementId,mediaType:e.mediaType,programId:(n=e.adCreativeMetaData)==null?void 0:n.adProgramId,creativeTemplateName:(i=e.adCreativeMetaData)==null?void 0:i.adCreativeTemplateName,deviceType:e.deviceType,...t}},sn={DESKTOP:16,MSHOP:10,MWEB:10},A=e=>(e==null?void 0:e.length)>1&&e.charAt(e.length-1)==="%",L=e=>A(e)?e:"".concat(parseInt(e),"px"),Oe=(e,t="MWEB")=>{if(A(e))return e;const n=parseFloat(e),i=sn[t];return!n||!i?"inherit":"".concat(n/i,"lh")},rn=(e,t)=>{const n=i=>A(i)?i:parseInt(i);y({metricName:"creative:size:changeSize",adDetails:e,additionalDimensions:{postSize:"".concat(n(t.width),"x").concat(n(t.height))}})},on=e=>{e.responsivePlacement&&y({metricName:"responsivePlacement",adDetails:e,additionalDimensions:{responsiveCreative:String(e.responsiveCreative),responsivePlacement:String(e.responsivePlacement)}})},ke="adplacements:retailClickTracking:failure",an="adplacements:retailClickTracking:clickSuccess",cn="adplacements:retailClickTracking:missingUrl",dn=async e=>{const t=document.getElementById(e);t==null||t.removeAttribute("onclick");const n=t==null?void 0:t.getAttribute("data-click-addr");if(!n){window.ue.count(cn,1);return}try{(await fetch(n,{keepalive:!0})).ok?window.ue.count(an,1):window.ue.count(ke,1)}catch(i){window.ue.count(ke,1)}},C=e=>{const{adUnitIframeId:t}=e,n=document.getElementById(t);if(!n){const{readyState:i}=document;m("getiframe:undefined"),y({metricName:"html:element:missing:iframe",adDetails:e,additionalDimensions:{readyState:i,adUnitIframeId:t}})}return n},ln=Array.from({length:100},(e,t)=>(t+1)/100),mn=(e,t)=>{const n=C(e);n&&new IntersectionObserver(i=>i.forEach(s=>hn(e,t,s)),{threshold:ln}).observe(n)},hn=(e,t,{target:n,intersectionRect:i,boundingClientRect:s,intersectionRatio:r})=>{const o=n,a=i.width/s.width,c=i.height/s.height;t.sendMessageToAd(e.arid,"populateSafeFrameExt",{geom:{self:{t:s.top,l:s.left,r:s.right,b:s.bottom,xiv:a,yiv:c,iv:r,z:1,w:o.offsetWidth,h:o.offsetHeight}},inViewPercentage:Math.round(r*100)})},un=(e,t)=>{const n=C(e);n&&setInterval(()=>{const i=n.getBoundingClientRect();t.sendMessageToAd(e.arid,"populateGeom",{geom:{self:{t:i.top,l:i.left,r:i.right,b:i.bottom,z:1,w:n.offsetWidth,h:n.offsetHeight}}})},250)},w=e=>{const t=document.getElementById(e.adUnitPlacementId);return t||(m("getplacement:undefined"),y({metricName:"html:element:missing:placement",adDetails:e})),t},gn="nav-ewc-persistent-hover",pn="div#nav-flyout-ewc",Be="nav-cart",wn="--nav-cart-full-width",fn="--nav-cart-half-width",En=e=>{const t=document.documentElement,n=w(e);Ve(t,n),new MutationObserver(i=>{for(const s of i)if(s.type==="attributes"&&s.attributeName==="class"){const r=s.target;Ve(r,n)}}).observe(t,{attributes:!0,attributeFilter:["class"]})},Ve=(e,t)=>{if(e.classList.contains(gn)){t.classList.add(Be);const n=vn();t.style.setProperty(wn,"".concat(n,"px")),t.style.setProperty(fn,"".concat(n/2,"px"))}else t.classList.remove(Be)},vn=()=>{const e=document.querySelector(pn);return e instanceof HTMLElement?e.offsetWidth:0},In=e=>({onSafeFrameReady(t){var n;v("eventsChannel:onSafeFrameReady",t),(n=performance==null?void 0:performance.mark)==null||n.call(performance,"SafeFrame:  safeFrameReady ".concat(t.slotName)),e.sendMessageToAd(t.arid,"setupComputedAdDetails",{aPageStart:window.aPageStart,adStartTime:new Date().getTime()}),window.addEventListener("resize",()=>{e.sendCustomMessageToAd(t.arid,"resize",{height:window.innerHeight,width:window.innerWidth})}),Ft(t),En(t),mn(t,e),un(t,e)},onPreCreativeWrite(t){v("eventsChannel:onPreCreativeWrite",t);const n={id:t.placementId,name:t.placementName};l(Ct,n),g(Mt,n)},onPostCreativeWrite(t){v("eventsChannel:onPostCreativeWrite",t);const n={id:t.placementId,name:t.placementName};l(Tt,n),g(xt,n)},onCreativeBeginToRender(t){v("eventsChannel:onCreativeBeginToRender",t)},onCreativeLoad(t){v("eventsChannel:onCreativeLoad",t);const n={id:t.placementId,name:t.placementName};l(_t,n),g(Rt,n),on(t)},onError(t){v("eventsChannel:onError",t)},onClick(t){v("eventsChannel:onClick",t),dn(t.adUnitPlacementId)}}),v=(e,t)=>{m(e),l(e,{id:t.placementId,name:t.placementName},performance.now())};function bn(e,t,n){e.addEventListener(t,i=>{n(i)})}const He="sfVideoContinuousPlaytimeSeconds",Sn=e=>{let t=0;return bn(e.div,He,n=>{t=n.detail.sfVideoContinuousPlaytimeSeconds}),{shouldFirePixel(){return t>=2}}},Pn=["fresh-desktop-detail-ilm","wfm-desktop-detail-ilm","alm-weis-desktop-detail-ilm","alm-save-desktop-detail-ilm","alm-lucky-desktop-detail-ilm","alm-bristol-desktop-detail-ilm","alm-rite-desktop-detail-ilm","alm-bartell-desktop-detail-ilm","alm-cardenas-desktop-detail-ilm","alm-petfoodexpress-desktop-detail-ilm","alm-allthebestpetcare-desktop-detail-ilm"],yn=(e,t,n)=>{if(window.csa)try{window.csa("Content",{element:e})("mark",t,n==null?void 0:n.getTime())}catch(i){u("Error with 'mark' CSA",i)}},Fe={wb:"ues",bb:"uet",af:"uet",cf:"uet",be:"uet",ld:"uex"},Ue=({latencyEvent:e,scope:t,placement:n,timestamp:i})=>{var s,r;An(e)&&(H(e,F(t),n.id,i),H(e,F(t),ie(n.name),i),H(e,F(t),(s=Se(n.name))!=null?s:void 0,i),H(e,F(t),(r=Pe(n.id))!=null?r:void 0,i))},An=e=>typeof window[Fe[e]]=="function",H=(e,t,n,i=new Date)=>{const s=Fe[e];!n||typeof window[s]!="function"||window[s](e,t+n,{wb:1},i)},F=e=>"adplacements:"+Cn(e),Cn=e=>e?"".concat(e,":"):"";class Tn{sendLatencyMetric({latencyMetricType:t,placementId:n,placementName:i,placementDivId:s,timestamp:r}){Ue({latencyEvent:t.csmKey,scope:t.csmMessage,placement:{id:n,name:i},timestamp:r}),yn(document.getElementById(s),t.csaKey,r)}}const T=()=>new Tn,_n=(e,t)=>{const n=Nn(t);let i=0;for(const[s,r]of n){if(!Ln(s,r))continue;const o=document.elementFromPoint(s,r);o&&Mn(o,e)&&i++}return i/n.length},Nn=e=>{const n=[];for(let i=0;i<10;i++)n.push([e.left+e.width/2,e.top+e.height*(i+.5)/10]);return n},Ln=(e,t)=>{const n=window.innerWidth||document.documentElement.clientWidth,i=window.innerHeight||document.documentElement.clientHeight;return e>=0&&e<=n&&t>=0&&t<=i},Mn=(e,t)=>{if(!(e instanceof HTMLElement)||e===t||t.contains(e))return!1;const n=window.getComputedStyle(e);if(n.display==="none"||n.visibility==="hidden"||n.pointerEvents==="none"||parseFloat(n.opacity)<.7)return!1;const i=n.backgroundColor;return!((i==="transparent"||/,0\)$/.test(i)||i==="")&&!n.backgroundImage.includes("url"))},xn=(e,t)=>{const n=Math.max(0,Math.min(e.right,t.right)-Math.max(e.left,t.left)),i=Math.max(0,Math.min(e.bottom,t.bottom)-Math.max(e.top,t.top));if(n===0||i===0)return 0;const s=n*i,r=e.width*e.height;return s/r},U=e=>{const{height:t,top:n,left:i=0,width:s=Rn()}=e;return{top:n,bottom:n+t,left:i,right:i+s,width:s,height:t}},Rn=()=>window.innerWidth||document.documentElement.clientWidth,re="mash",On=async e=>new Promise((t,n)=>{if(!P){n(new Error("mash:getobstructions:missing"));return}const i=setTimeout(()=>{n(new Error("mash:getobstructions:timeout"))},e),s=performance.now();P.when(re).execute(r=>{var o,a;if(!((a=(o=r==null?void 0:r.appCX)==null?void 0:o.uiOrchestrator)!=null&&a.getObstructions)){clearTimeout(i),n(new Error("mash:getobstructions:missing"));return}r.appCX.uiOrchestrator.getObstructions({successCallback:c=>{clearTimeout(i),t({boundingBoxes:(c.boundingBoxes||[]).map(U),isFullyObstructed:c.isFullyObstructed,latencyMs:performance.now()-s})},failCallback:()=>{clearTimeout(i),n(new Error("mash:getobstructions:failure"))}})})}),kn=e=>{if(!P){m("mash:missing",1);return}P.when(re).execute(t=>{t==null||t.addEventListener("obstructionsChanged",e)})},Bn=e=>{if(!P){m("mash:missing",1);return}P.when(re).execute(t=>{t==null||t.removeEventListener("obstructionsChanged",e)})},Vn=(e,t)=>{const n=t.getObstructingRectangles();return n.length===0?0:n.reduce((s,r)=>s+xn(e,r),0)},Hn=async e=>{try{e.setObstructingRectangles([]),e.listenerHandler||(e.listenerHandler=i=>Fn(i,e),kn(e.listenerHandler));const n=await On(950);e.setObstructingRectangles(Un(n,e))}catch(n){W(n.message,e)}},Fn=(e,t)=>{var n;t.setObstructingRectangles((((n=e==null?void 0:e.detail)==null?void 0:n.boundingBoxes)||[]).map(U))},Un=(e,t)=>e.isFullyObstructed?(W("viewPixel:iab:obstruction:native:fullviewport",t,1),[U({height:window.innerHeight,top:0})]):(Wn(e.boundingBoxes,t),e.boundingBoxes.map(U)),W=(e,t,n=1)=>{t.metricsLogged.has(e)||(m(e,n),B(e,n),t.metricsLogged.add(e))},Wn=(e,t)=>{for(const n of e)W("mash:getobstructions:response:height",t,n.height),W("mash:getobstructions:response:top",t,n.top)},$n=e=>{if(e.listenerHandler){try{Bn(e.listenerHandler)}catch(t){}e.listenerHandler=void 0}},oe=()=>{let e=[];const n={metricsLogged:new Set,listenerHandler:void 0,setObstructingRectangles:i=>{e=i},getObstructingRectangles:()=>e};return Hn(n),{getObstructionPercentage({element:i,elementDOMRectOverride:s=i.getBoundingClientRect()}){const r=_n(i,s),o=Vn(s,n);return Math.max(r,o)},cleanup(){$n(n)}}};class We{constructor(t,n,i,s,r){this.pixel=t,this.viewabilityStandard=n,this.visibilityChangeService=i,this.viewabilityService=s,this.videoPixelValidator=r,this.metricsLogged=new Set,this.wasObstructed=!1,this.emitObstructionRecoveryMetrics=o=>{this.wasObstructed&&this.logMetrics("viewpixel:iab:obstruction:recovered",1,o)},this.logMetrics=(o,a=1,c)=>{this.metricsLogged.has(o)||(m(o,a),B(o,a),c&&(l(o,c,a),g(o,c,a)),this.metricsLogged.add(o))}}postPixelFireCleanup(t,n){t.unobserve(n.div),clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection(),this.emitObstructionRecoveryMetrics(n),this.viewabilityService.cleanup()}postPlacementExitsViewportCleanup(){clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),clearInterval(this.shouldFirePixelIntervalId),this.visibilityChangeService.removeVisibilityChangeDetection()}fireInObserver(t,n){this.fire(n),this.postPixelFireCleanup(t,n)}startInViewTimer(t,n){this.viewTimerTimeoutId=setTimeout(()=>this.fireInObserver(t,n),this.viewabilityStandard.thresholdTimeVisibleMs),this.performContinuousObstructionCheck(t,n),this.visibilityChangeService.setupVisibilityChangeDetection(this.viewTimerTimeoutId,t,n)}performContinuousObstructionCheck(t,n){this.obstructionCheckIntervalId=setInterval(()=>{try{this.viewabilityService.isViewabilityObstructed(n,this.viewabilityStandard.thresholdPercentage)&&(this.wasObstructed=!0,clearTimeout(this.viewTimerTimeoutId),clearInterval(this.obstructionCheckIntervalId),this.startInViewTimer(t,n))}catch(s){ee(s==null?void 0:s.message,s),clearInterval(this.obstructionCheckIntervalId)}},100)}track(t){new IntersectionObserver((n,i)=>{n.forEach(s=>{s.isIntersecting?this.startInViewTimer(i,t):this.postPlacementExitsViewportCleanup()})},{threshold:this.viewabilityStandard.thresholdPercentage}).observe(t.div)}async fire(t){this.videoPixelValidator&&!this.videoPixelValidator.shouldFirePixel()&&await this.waitUntilShouldFirePixel(),this.pixel.fire(t)}waitUntilShouldFirePixel(){return new Promise(t=>{this.shouldFirePixelIntervalId=setInterval(()=>{this.videoPixelValidator&&this.videoPixelValidator.shouldFirePixel()&&(clearInterval(this.shouldFirePixelIntervalId),t())},100)})}}const $e={keepalive:!0,mode:"no-cors"};class M{constructor(t,n,i,s,r,o=[]){this.url=t,this.loggingContext=n,this.generatePixelUrl=i,this.pixelIdentifier=s,this.pixelLogger=r,this.urls3p=o,this.isFired=!1,this.pixel=a=>{const c=document.createElement("img");return c.id="".concat(this.pixelIdentifier.testId,"_").concat(a.name),c.style.display="none",c.setAttribute("pixel-url",this.generatePixelUrl(this.url,a)),c}}async fire(t){this.isFired||(await fetch(this.generatePixelUrl(this.url,t),$e),t.div.appendChild(this.pixel(t)),this.isFired=!0,this.pixelLogger(this.pixelIdentifier,this.loggingContext,t),this.urls3p.forEach(n=>fetch(n,$e)))}}const Yn={testId:"ape_btr_impression",csmLogId:"imp:btr"},Jn={testId:"ape_impression",csmLogId:"imp:cod"},Gn={testId:"ape_measurability",csmLogId:"imp:atf"},Kn={testId:"ape_impression",csmLogId:"imp:skan"},Ye={testId:"skan_view_pixel",csmLogId:"view:skan"},zn={testId:"ape_viewability_iab",csmLogId:"view:iab"},_=(e=m,t=l)=>(n,i,s)=>{var r;e("pixel:".concat(n.csmLogId)),t("pixel:".concat(n.csmLogId),s),e("pixel:".concat(n.csmLogId,":").concat(i.aaxProgramId)),e("pixel:".concat(n.csmLogId,":device:").concat((r=s.deviceType)==null?void 0:r.toLowerCase()))},Je={H1_DESKTOP_HEIGHT:240,H1_DESKTOP_WIDTH:940},qn=e=>{if(Xn(e)){const t={height:Je.H1_DESKTOP_HEIGHT,width:Je.H1_DESKTOP_WIDTH};return jn(e.div,t)}return e.div.getBoundingClientRect()},Xn=e=>e.name.toLowerCase()==="gateway_desktop-h1_desktop",jn=(e,t)=>{const n=e.getBoundingClientRect(),s=(n.left+n.right)/2-t.width/2;return new DOMRect(s,n.y,t.width,t.height)},Zn=e=>{const t=window.innerHeight||document.documentElement.clientHeight,n=window.innerWidth||document.documentElement.clientWidth,i={top:Math.max(0,e.top),left:Math.max(0,e.left),bottom:Math.min(t,e.bottom),right:Math.min(n,e.right)};if(e.top>=t||e.left>=n||e.bottom<=0||e.right<=0||e.width<=0||e.height<=0)return 0;const s=(i.right-i.left)*(i.bottom-i.top),r=e.width*e.height;return s/r},Qn=e=>{var n;const t=e.placement.div.getBoundingClientRect();return{v:{def:e.definition,p:e.thresholdPercentage,t:e.thresholdTimeVisibleMs,ib:e.isBtr},wh:window.innerHeight||document.documentElement.clientHeight,ww:window.innerWidth||document.documentElement.clientWidth,sx:window.scrollX,sy:window.scrollY,ah:t.height,aw:t.width,top:t.top,left:t.left,ptv:(new Date().getTime()-((n=window.aPageStart)!=null?n:0))/1e3,ttv:(new Date().getTime()-e.adStartTime)/1e3}},ae=e=>{const t=new Set,n=(s,r=1,o)=>{t.has(s)||(m(s,r),B(s,r),o&&(l(s,o,r),g(s,o,r)),t.add(s))},i=(s,r)=>{const o=qn(s),a=Zn(o),c=e.getObstructionPercentage({element:s.div,elementDOMRectOverride:o}),d=a-c<r;return d&&n("viewpixel:iab:obstruction",1,s),d};return{isViewabilityObstructed(s,r){return i(s,r)},cleanup(){e.cleanup()}}},Ge=()=>{const e=(t,n,i)=>{document.hidden?(clearTimeout(t),n.unobserve(i.div)):n.observe(i.div)};return{removeVisibilityChangeDetection(){this.activeVisChangeHandler&&(document.removeEventListener("visibilitychange",this.activeVisChangeHandler),this.activeVisChangeHandler=void 0)},setupVisibilityChangeDetection(t,n,i){this.removeVisibilityChangeDetection(),this.activeVisChangeHandler=()=>e(t,n,i),document.addEventListener("visibilitychange",this.activeVisChangeHandler)}}},Ke="AppAdsMshopIOSPlugin",Dn=e=>{var t;(t=window.P)==null||t.when(Ke).execute(n=>{n.startAttributeViewThroughAppAds({skAdNetwork:e})})},ei=e=>{var t;(t=window.P)==null||t.when(Ke).execute(n=>{n.endAttributeViewThroughAppAds({skAdNetwork:e})})};class ti{constructor(t,n,i,s){this.url=t,this.loggingContext=n,this.skAdNetwork=i,this.pixelLogger=s,this.isFired=!1}async fire(t){this.isFired||(Dn(this.skAdNetwork),this.isFired=!0,this.pixelLogger(Kn,this.loggingContext,t))}}const ni=()=>{throw new Error("PixelUrl should not be used for this pixel type")};class ii extends M{constructor(t,n,i,s){super(t,n,ni,Ye,i),this.skAdNetwork=s,this._loggingContext=n,this._pixelLogger=i}async fire(t){this.isFired||(ei(this.skAdNetwork),this.isFired=!0,this._pixelLogger(Ye,this._loggingContext,t))}}const si="btr_client",ze="cod_client",qe="atf",Xe="v",ri="pj",oi="c",$=/\${AAX_TYPE}/,je=/\${AAX_PAYLOAD}/,ai="{}",ci="",Ze=(e,t,n)=>{if(t===ci)throw new Error("Invalid queryParamKey input to addJSONQueryParamToURL: "+JSON.stringify({queryParamKey:t}));const i=new URL(e),s=i.searchParams.get(t),o=JSON.parse(s||ai),a=Object.assign(o,n);return i.searchParams.set(t,JSON.stringify(a)),i.toString()},di=e=>Ze(yt(e),oi,{measurementMethod:si}),li=e=>{const t=e.includes(".paets.");return Ze(e,ri,t?{}:{measurementMethod:ze})},Y=()=>window.innerHeight||document.documentElement.clientHeight,ce=()=>window.innerWidth||document.documentElement.clientWidth,mi=e=>e.getBoundingClientRect().top-Y(),hi=(e,t)=>({t:e.top,l:e.left,r:e.right,b:e.bottom,w:e.width,h:e.height,z:t}),de=e=>{const t=e.getBoundingClientRect();return hi(t,Number(window.getComputedStyle(e,null).zIndex))},ui=e=>{const t=pi(e);return t==null?"unknown":t>=.5},gi=e=>e.width===0&&e.height===0;function pi(e){const t=document.body.getBoundingClientRect();if(gi(t))return null;const n=de(e),i=Y(),s=ce(),r=Math.max(0,Math.min(t.left+s,n.r)-n.l),o=Math.max(0,Math.min(t.top+i,n.b)-n.t),a=r*o/(n.h*Math.min(n.w,s));return Number(Math.min(1,Math.max(0,a)).toFixed(2))}const wi=(e,t)=>{const n=de(e),i=de(t),s=ce(),r=Y();return n&&i&&(Math.abs(n.t-i.b)<r||Math.abs(n.b-i.t)<r)&&(Math.abs(n.l-i.r)<s||Math.abs(n.r-i.l)<s)},fi=(e,t)=>{const n={atf:ui(t.div)},i=encodeURIComponent(JSON.stringify(n));return $.test(e)?e.replace($,qe).replace(je,i):"".concat(e.replace(/\/$/,""),"/").concat(qe,"/").concat(i)},Qe={set:(e,t)=>{e.div.dataset.isBtr=String(t)},get:e=>e.div.dataset.isBtr===String(!0)},Ei=e=>{const t=new Date().getTime();return(n,i)=>{const s={placement:i,definition:e.definition,thresholdPercentage:e.thresholdPercentage,thresholdTimeVisibleMs:e.thresholdTimeVisibleMs,isBtr:Qe.get(i),adStartTime:t},r=encodeURIComponent(JSON.stringify(Qn(s)));return $.test(n)?n.replace($,Xe).replace(je,r):"".concat(n.replace(/\/+$/,""),"/").concat(Xe,"/").concat(r)}},J={IAB_VIDEO:{definition:"iab",thresholdPercentage:.5,thresholdTimeVisibleMs:2e3},IAB_LARGE_DISPLAY:{definition:"iab",thresholdPercentage:.3,thresholdTimeVisibleMs:1e3},IAB_DISPLAY:{definition:"iab",thresholdPercentage:.5,thresholdTimeVisibleMs:1e3},SKAN:{definition:"skan",thresholdPercentage:.5,thresholdTimeVisibleMs:2e3}},vi=({target:e,onIntersection:t,onExit:n,options:i})=>{const s=new IntersectionObserver((r,o)=>{r.forEach(a=>{a.isIntersecting?t(o,a):n(o,a)})},i);return s.observe(e),s},Ii=async(e,t)=>{let n,i;return new Promise(s=>{i=s,n=new IntersectionObserver(r=>{r.forEach(o=>{o.target===e&&o.isIntersecting&&(i(o),n.unobserve(e))})},t),n.observe(e)})},bi=(e,t,n,i)=>{const s=a=>{let c;const d={wasObstructed:!1};vi({target:a.div,onIntersection:h=>c=r(a,h,d),onExit:()=>c==null?void 0:c(),options:{threshold:t.thresholdPercentage}})},r=(a,c,d)=>{let h=performance.now(),p=!1;const O=setInterval(()=>{o(a)||Pi()?(d.wasObstructed=!0,p=!0):p?(h=performance.now(),p=!1):yi(h,t.thresholdTimeVisibleMs)&&Ai(i)&&(e.fire(a),k(d.wasObstructed),c.unobserve(a.div))},Si),k=(pe=!1)=>{pe&&Ci(a),clearInterval(O),n.cleanup()};return k},o=a=>{try{return n.isViewabilityObstructed(a,t.thresholdPercentage)}catch(c){return ee(c==null?void 0:c.message,c),!1}};return{track:s,viewabilityStandard:t}},Si=100,Pi=()=>document.hidden,yi=(e,t)=>performance.now()-e>=t,Ai=e=>e.every(t=>t.shouldFirePixel()),Ci=e=>{const t="viewpixel:iab:obstruction:recovered";m(t),B(t),l(t,e),g(t,e)},De=({btrPixelUrl:e,loggingContext:t})=>e?new M(e,t,di,Yn,_()):void 0,et=({aaxImpPixelUrl:e,imp3pUrls:t,loggingContext:n})=>new M(e,n,li,Jn,_(),t),tt=({aaxInstrPixelUrl:e,loggingContext:t})=>new M(e,t,fi,Gn,_()),Ti=(e,t,n,i,s)=>e==="V"?le(n,J.IAB_VIDEO,s()):_i(i)&&Ni(t)?le(n,J.IAB_LARGE_DISPLAY):le(n,J.IAB_DISPLAY),_i=e=>e==="DESKTOP",Ni=e=>Li(e)>=242500,Li=e=>e.getBoundingClientRect().height*e.getBoundingClientRect().width,le=(e,t,n)=>{const i=new M(e.aaxInstrPixelUrl,e.loggingContext,Ei(t),zn,_());return Dt().isT1()?bi(i,t,ae(oe()),n?[n]:[]):new We(i,t,Ge(),ae(oe()),n)},Mi=e=>{if(e.skAdNetwork)return new ti(e.aaxImpPixelUrl,e.loggingContext,e.skAdNetwork,_())},xi=e=>{if(e.skAdNetwork){const t=new ii(e.aaxInstrPixelUrl,e.loggingContext,_(),e.skAdNetwork);return new We(t,J.SKAN,Ge(),ae(oe()),void 0)}},nt=e=>e+"_Feedback",it=0,st=1;class Ri{constructor(t,n,i,s,r,o,a){this.parentHtmlId=t,this.feedbackStyle=n,this.labelText=i,this.labelStyle=s,this.position=r,this.urlPathAndParameter=o,this.hidden=a}async addSponsoredLabelWithFeedbackLink(t,n){t.appendChildTo(this.parentHtmlId,this);const i=await n.getSponsoredLabelAndFeedbackLink(this.urlPathAndParameter);if(!(i!=null&&i.isOk()))throw new Error("Result from the feedback service was not ok ".concat(this.urlPathAndParameter));t.updateElement(this.getHtmlId(),i)}getHtmlId(){return nt(this.parentHtmlId)}isHidden(){return this.hidden}exists(t){return t.exists(this.getHtmlId())}getFeedbackSpanElement(){return document.querySelector("#".concat(this.getHtmlId()," span"))}}class Oi{constructor(t){this.parentHtmlId=t}open(t){t.clickChildLink(this)}getHtmlId(){return nt(this.parentHtmlId)}}class ki{constructor(t,n){this.feedbackHtmlPort=t,this.feedbackApiPort=n}async createSponsoredLabelWithFeedbackLink(t,n){if(!t.exists(this.feedbackHtmlPort)){n.request();try{await t.addSponsoredLabelWithFeedbackLink(this.feedbackHtmlPort,this.feedbackApiPort),n.success(),t.isHidden()||n.labelRenderedHost()}catch(i){throw n.error(),i}}}openModal(t){t.open(this.feedbackHtmlPort)}labelRendered(t){t.labelRenderedCreative()}logTransparencyInfoMissing(t){t.transparencyInfoMissing()}}const me=e=>new Bi(e),x={REQUEST:"adfeedback_request",SUCCESS:"adfeedback_success",ERROR:"adfeedback_error",LABEL_RENDERED_CREATIVE:"adfeedback_sponsoredlabelrendered_creative",LABEL_RENDERED_HOST:"adfeedback_sponsoredlabelrendered_host"},f={REQUEST:"adfeedback:request",SUCCESS:"adfeedback:success",ERROR:"adfeedback:error",LABEL_RENDERED_CREATIVE:"adfeedback:sponsoredlabelrendered:creative",LABEL_RENDERED_HOST:"adfeedback:sponsoredlabelrendered:host",LABEL_RENDERED:"adfeedback:sponsoredlabelrendered",TRANSPARENCY_INFO_MISSING:"adfeedback:transparencyinfo:missing"};class Bi{constructor(t){this.placement=t}request(){l(f.REQUEST,this.placement),m(f.REQUEST),g(x.REQUEST,this.placement)}success(){l(f.SUCCESS,this.placement),m(f.SUCCESS),g(x.SUCCESS,this.placement)}error(){l(f.ERROR,this.placement),g(x.ERROR,this.placement)}labelRenderedCreative(){l(f.LABEL_RENDERED_CREATIVE,this.placement),m(f.LABEL_RENDERED),g(x.LABEL_RENDERED_CREATIVE,this.placement)}labelRenderedHost(){l(f.LABEL_RENDERED_HOST,this.placement),m(f.LABEL_RENDERED),g(x.LABEL_RENDERED_HOST,this.placement)}transparencyInfoMissing(){l(f.TRANSPARENCY_INFO_MISSING,this.placement),m(f.TRANSPARENCY_INFO_MISSING)}}class Vi{constructor(t,n,i){this.status=t,this.html=n,this.script=i}isOk(){return this.status==="ok"}}class Hi{constructor(t){this.windowRepo=t}async getSponsoredLabelAndFeedbackLink(t){const n=await window.fetch(this.windowRepo.origin()+t);if(n.ok){const i=await n.json();return new Vi(i.status,i.html,i.script)}throw Error("Could not fetch the feedback html/link/script/label")}}class Fi{appendChildTo(t,n){var s,r;n.position===st?(s=document.getElementById(t))==null||s.prepend(i(t,n)):n.position===it&&((r=document.getElementById(t))==null||r.append(i(t,n)));function i(o,a){const c=document.createElement("div");return c.setAttribute("id",a.getHtmlId()),c.classList.add("ape-feedback"),c.style.position="relative",c.style.height="auto",c.style.minHeight="20px",c.style.textAlign=c.id.includes("hero-quick-promo_Desktop_placement_Feedback")?"left":"right",c.style.padding="0",c.style.marginTop="2px",c.style.display=a.feedbackStyle.display,o.endsWith("_wrapper")&&(!o.includes("-ilm")&&(c.style.maxWidth="min(100vh, 100vw)"),c.style.marginLeft="auto",c.style.marginRight="auto",c.style.padding="0 5px"),c.append(d(a)),c;function d(h){const p=document.createElement("div");return p.innerHTML=h.labelText,Ui(p,h.labelStyle),p}}}updateElement(t,n){const i=document.getElementById(t);if(i){i.innerHTML=n.html,Wi(i,n);for(const s of i.children)s.tagName==="DIV"?s.removeAttribute("style"):s.tagName==="A"&&(s.style.removeProperty("position"),s.style.removeProperty("top"),s.style.removeProperty("right"),s.style.removeProperty("display"))}}clickChildLink(t){const n=document.getElementById(t.getHtmlId());for(const s of(n==null?void 0:n.children)||[])if(i(s)){s.click();return}function i(s){return s.tagName==="A"||s.tagName==="DIV"}}exists(t){return!!document.getElementById(t)}}const Ui=(e,t)=>{for(const n in t)e.style.setProperty(n,t[n])},Wi=(e,t)=>{const n=$i(e);n.innerHTML=t.script},$i=e=>{const t=document.createElement("script");return e.prepend(t),t},Yi={hostname:"www.amazon.com.be"},Ji={hostname:"www.amazon.fr"},Gi={hostname:"www.amazon.de"},Ki={hostname:"www.amazon.it"},zi={hostname:"www.amazon.nl"},qi={hostname:"www.amazon.pl"},Xi={hostname:"www.amazon.es"},ji={hostname:"www.amazon.se"},E=e=>location.hostname===e.hostname,Zi=()=>E(Yi)||E(Ji)||E(Gi)||E(Ki)||E(zi)||E(qi)||E(Xi)||E(ji),Qi=e=>!Zi()||Di(e),Di=e=>{var i,s,r,o,a,c;const t=[];he((r=(s=(i=e==null?void 0:e.url)==null?void 0:i.parameters)==null?void 0:s.adPlacementMetaData)==null?void 0:r.slotName)&&t.push("DSA Error: slotName missing");const n=(c=(a=(o=e==null?void 0:e.url)==null?void 0:o.parameters)==null?void 0:a.adCreativeMetaData)==null?void 0:c.adCreativeDetails;(!n||n.length<=0)&&t.push("DSA Error: transparency info missing"),n==null||n.every(d=>es(d,t));for(const d of t)u(d);return t.length<=0},es=(e,t)=>{var n,i,s,r,o;e.version||t.push("DSA Error: version missing"),he(e.advertiserIdNS)&&t.push("DSA Error: advertiserIdNS missing"),(((n=e.selectionSignals)==null?void 0:n.context)===void 0||((i=e.selectionSignals)==null?void 0:i.context)===null)&&t.push("DSA Error: selectionSignals.context missing"),(((s=e.selectionSignals)==null?void 0:s.location)===void 0||((r=e.selectionSignals)==null?void 0:r.location)===null)&&t.push("DSA Error: selectionSignals.location missing"),he((o=e.selectionSignals)==null?void 0:o.pastActivity)&&t.push("DSA Error: selectionSignals.pastActivity missing")},he=e=>!(e!=null&&e.trim()),ue=()=>{return new ts(e());function e(){return new ki(new Fi,new Hi({origin:()=>window.location.origin}))}};class ts{constructor(t){this.feedbackService=t}async addSponsoredLabel({parentHtmlId:t,placement:n,feedback:i}){return Qi(i)?(i.hidden&&(Object.assign(i.style,{display:"none"}),Object.assign(i.label.style,{display:"none"})),await this.feedbackService.createSponsoredLabelWithFeedbackLink(is(t,i),me(n)),!0):(this.feedbackService.logTransparencyInfoMissing(me(n)),u("Transparency Information missing"),!1)}openModal(t){this.feedbackService.openModal(new Oi(t))}labelRendered({placement:t}){this.feedbackService.labelRendered(me(t))}}const ns=e=>"/af/feedback-link?pl="+e,is=(e,t)=>{const n=JSON.parse(JSON.stringify(t.url.parameters));return n.adPlacementMetaData.pageUrl=Ie(n.adPlacementMetaData.pageUrl),new Ri(e,t.style,t.label.text,t.label.style,t.position==="TOP"?st:it,ns(encodeURIComponent(JSON.stringify(n))),t.hidden)},ss=e=>{ue().labelRendered({placement:{id:e.placementId,name:e.placementName}})},rs=e=>{var t;ue().openModal((t=e.adUnitWrapperId)!=null?t:e.adUnitPlacementId)},os=async e=>{if(!await ue().addSponsoredLabel(as(e)))throw new Error("Failed to create sponsored label and feedback link")},as=e=>{var i;const t=e.adPlacementMetaData,n=e.adFeedbackInfo;return{parentHtmlId:(i=e.adUnitWrapperId)!=null?i:e.adUnitPlacementId,placement:{id:e.placementId,name:e.placementName},feedback:{position:"BOTTOM",hidden:!n.boolFeedback,style:e.feedbackDivStyle,url:{parameters:{adPlacementMetaData:{adElementId:t.adElementId,pageType:t.pageType,pageUrl:Ie(t.pageUrl),slotName:t.slotName},adCreativeMetaData:e.adCreativeMetaData}},label:{text:bt(n.sponsoredText),style:e.advertisementStyle}}}};function rt(e,t,n){var i={},s=i.noTrailing,r=s===void 0?!1:s,o=i.noLeading,a=o===void 0?!1:o,c=i.debounceMode,d=c===void 0?void 0:c,h,p=!1,O=0;function k(){h&&clearTimeout(h)}function pe(j){var Z=j||{},I=Z.upcomingOnly,we=I===void 0?!1:I;k(),p=!we}function wt(){for(var j=arguments.length,Z=new Array(j),I=0;I<j;I++)Z[I]=arguments[I];var we=this,ft=Date.now()-O;if(p)return;function Q(){O=Date.now(),t.apply(we,Z)}function Et(){h=void 0}!a&&d&&!h&&Q(),k(),d===void 0&&ft>e?a?(O=Date.now(),r||(h=setTimeout(d?Et:Q,e))):Q():r!==!0&&(h=setTimeout(d?Et:Q,d===void 0?e-ft:e))}return wt.cancel=pe,wt}const cs="sfImpression",ot="viewablelatency",G=(e,t,n)=>({csaKey:e,csmKey:t,csmMessage:n}),ds=G("bodyBegin","bb"),ls=G("bodyBegin","bb",cs),ms=G("viewablelatency:bodyBegin","bb",ot),at=G("viewablelatency:loaded","ld",ot),K=async(e,t)=>{if(e!=null&&e.trim().match(/^\d{1,4}px$/g))return await hs(parseInt(e,10),t,(n,i)=>{const s=mi(n);return n&&s<=i})},hs=async(e,t,n)=>new Promise(i=>{const s=()=>{n(t,e)&&(i(),window.removeEventListener("scroll",r),window.removeEventListener("resize",r))},r=te(rt(20,()=>{s()}),u);window.addEventListener("scroll",r),window.addEventListener("resize",r),s()}),us=(e,t,n,i,s,r)=>{const o=e==null?void 0:e[t];o!=null&&o.valid&&(o.loaded=!0,o.viewed&&(T().sendLatencyMetric({latencyMetricType:at,placementId:i,placementName:n,placementDivId:s,timestamp:new Date(r)}),l("htmlviewed:loaded",{id:i,name:n})))},z=async e=>{const t=C(e),i={root:gs(t)?null:document.documentElement};await Ii(t,i)},gs=e=>{let t=e;for(;t;){if(window.getComputedStyle(t,null).getPropertyValue("position")==="fixed")return!0;t=t.parentElement}return!1},ps=async(e,t)=>{t.firePixelsAfter&&await K(t.firePixelsAfter,w(t)),await z(t),e.sendMessageToAd(t.arid,"fireImpression",{measurementMethod:ze,isNoInventory:!1})};class ws{constructor(t,n,i,s){this.id=t,this.name=n,this.wrapperDivId=i,this.divId=s}collapse(t,n){this.wrapperDiv&&(this.wrapperDiv.style.display="none"),this.div.style.display="none",y({metricName:"placement:collapse",adDetails:t,additionalDimensions:{code:n,isBlank:"".concat(fs(t)),creativeId:t.adCreativeMetaData.adCreativeId}}),m("safeframe:placement:collapse"),l("safeframe:placement:collapse",{id:this.id,name:this.name})}get wrapperDiv(){return this.wrapperDivId?document.getElementById(this.wrapperDivId):null}get div(){return document.getElementById(this.divId)}}const fs=e=>{const t=e.htmlContentEncoded.match(/<div id="ad">\s*(.*?)\s*<\/div>/s);return t?t[1].trim()==="":!1},ct=e=>new ws(e.placementId,e.placementName,e.adUnitWrapperId,e.adUnitPlacementId),Es=(e,t)=>{D("ChangeSize API has been deprecated"),bs(e)&&vs(e,t)&&rn(e,t)},vs=(e,t)=>{if(!Is(t))return u("Size w:'".concat(t.width,"', h:'").concat(t.height,"' is not allow-listed for '").concat(e.placementName,"'")),!1;const n=w(e);return Ss(e,t)&&(n.style.maxHeight=L(t.height)),A(t.height)||A(t.width)?(n.style.width=L(t.width),n.style.height=L(t.height)):(n.removeAttribute("style"),n.style.aspectRatio="".concat(parseInt(t.width)," / ").concat(parseInt(t.height))),!0},Is=e=>{const t=L(e.height),n=L(e.width);return[{width:"100%",height:"169px"},{width:"300px",height:"250px"}].some(s=>t===s.height&&n===s.width)},bs=e=>{var t,n;return e.slotName==="hero-quick-promo"&&(((t=e.adCreativeMetaData)==null?void 0:t.adCreativeTemplateName)==="Personalized Responsive eCommerce"||!((n=e.adCreativeMetaData)!=null&&n.adCreativeTemplateName))&&e.mediaType==="D"},Ss=(e,t)=>e.slotName==="hero-quick-promo"&&A(t.width),Ps=(e,t)=>g(t.metricName,{name:e.placementName,id:e.placementId}),ys=(e,t)=>{u(t.message+": "+e.placementName,t.error),u(t.message,t.error)},As=(e,t)=>{ee(t.message+": "+e.placementName,t.error)},q="btr:impression",dt=e=>e!==1004&&Qt().isT1(),Cs=(e,t,n)=>{new IntersectionObserver((i,s)=>{i.forEach(async r=>{var o;r.isIntersecting&&(await t.impressionPixel.fire(e),n&&((o=t.btrPixel)==null||o.fire(e)),t.measurabilityPixel.fire(e),s.disconnect())})},{threshold:0}).observe(e.div)},Ts=async e=>{var t;e.firePixelsAfter&&await K(e.firePixelsAfter,w(e)),await z(e),dt(Number(e.adCreativeMetaData.adProgramId))||((t=De(X(e)))==null||t.fire({id:e.placementId,name:e.placementName,div:w(e),deviceType:e.deviceType}),_s(e))},_s=e=>{l(q,{id:e.placementId,name:e.placementName},1),m(q,1);const t=e.adCreativeMetaData.adProgramId?e.adCreativeMetaData.adProgramId:"unknown";m(q+":program:"+t,1);const n=_e(e);m(q+":template:"+n,1)},Ns=async e=>{var i,s;const t=X(e),n={id:e.placementId,name:e.placementName,div:w(e),deviceType:e.deviceType};await((i=Mi(t))==null?void 0:i.fire(n)),(s=xi(t))==null||s.track(n)},Ls=async(e,t)=>{const n=w(e);await K(e.firePixelsAfter,n),await z(e);const i=X(e),s={id:e.placementId,name:e.placementName,div:n,deviceType:e.deviceType};dt(Number(e.adCreativeMetaData.adProgramId))?Cs(s,{impressionPixel:et(i),btrPixel:De(i),measurabilityPixel:tt(i)},t.isBtr):tt(i).fire(s),Ns(e);const r=Ms(i,e,s);Qe.set(s,t.isBtr),r.track(s)},Ms=(e,t,n)=>{const i=()=>Sn(n);return Ti(t.mediaType,n.div,e,t.deviceType,i)},lt="gw-video-orchestrator",xs=(e,t,n)=>{var i;(i=window.P)==null||i.when(lt).execute(s=>{try{s.subscribe(e,t,n)}catch(r){D("gw-video-orchestrator error: ".concat(JSON.stringify(r)))}})},Rs=e=>mt(e),Os=()=>mt(),mt=e=>{var t;(t=window.P)==null||t.when(lt).execute(n=>{n.elect(e)})};let R=null;const ks=(e,t,n)=>{const i=s=>n.sendCustomMessageToAd(e.arid,"videoAutoplayResponse",s);Hs(e.pageType)?xs(C(e),i,t):R===e.arid?i(!0):R===null&&Fs(C(e))?(R=e.arid,i(!0)):i(!1)},Bs=()=>{Os(),R=null},Vs=e=>{Rs(C(e)),R=e.arid},Hs=e=>(e==null?void 0:e.toLowerCase())==="gateway",Fs=e=>![...document.getElementsByTagName("video")].some(t=>!t.paused&&wi(e,t)),ht=new Set;class Us{constructor(t,n){this.hms=t,this.hc=n,this.expandInlineListeners=new Map,this.originalHeights=new Map,this.changeSize=Es,this.fireImpressionWithDelay=async i=>{await ps(this.hms,i)},this.logAPIInvocation=(i,s)=>{const r="messenger:".concat(s.apiName);m(r),l(r,{id:i.placementId,name:i.placementName})},this.logError=ys,this.logFatal=As,this.logCsaEvent=Ps,this.sendLatencyMetric=(i,s)=>Ws(i,s),this.fireViewableLatencyMetrics=async(i,s)=>{us(this.hc.viewableLatencyTrackers,i.arid,i.placementName,i.placementId,i.adUnitPlacementId,s.adLoadedTimestamp)},this.countMetric=(i,s)=>{s.isGlobal?m(s.metricMsg,s.value):l(s.metricMsg,{id:i.placementId,name:i.placementName},s.value)},this.requestVideoAutoplay=(i,s)=>{m("common:supported:command:requestVideoAutoplay"),ks(i,s,this.hms)},this.releaseVideoAutoplay=()=>{m("common:supported:command:releaseVideoAutoplay"),Bs()},this.haveVideoAutoplayPermission=i=>{m("common:supported:command:haveVideoAutoplayPermission"),Vs(i)},this.feedbackLabelRendered=i=>{ss(i)},this.feedbackOpenModal=i=>{rs(i)},this.collapseSlot=(i,s)=>{var r,o;if((r=window.APE_SF)!=null&&r.collapsedPlacements.has(i.adUnitPlacementId)){D("Slot already collapsed");return}ct(i).collapse(i,s),(o=window.APE_SF)==null||o.collapsedPlacements.add(i.adUnitPlacementId)},this.sendEventAddedCreative=async i=>{ht.has(i.placementId)||(i.firePixelsAfter&&await K(i.firePixelsAfter,w(i)),await z(i),et(X(i)).fire({id:i.placementId,name:i.placementName,div:w(i),deviceType:i.deviceType}),ht.add(i.placementId))},this.sendEventCreativeBeginToRender=Ts,this.sendEventCreativeLoaded=async(i,s)=>{await Ls(i,s)},this.resizeForImageOnlyTemplate=i=>w(i).classList.add("is-image-oo"),this.sendSfVideoContinuousPlaytimeSeconds=(i,s)=>{const r=w(i),o=new CustomEvent(He,{detail:s});r.dispatchEvent(o)},this.expandInline=i=>{if(!V().isT1()&&!V().isT2()&&!Re().isT1()){this.logError(i,{message:"expandInline called without weblab enabled"});return}const s=w(i);if(!s)return;const r=s.style.height||getComputedStyle(s).height;this.originalHeights.set(i.adUnitPlacementId,r);const o=this.expandInlineListeners.get(i.adUnitPlacementId);o&&o.forEach(({type:h,callback:p})=>{window.removeEventListener(h,p)});const a=ge(i.slotName)?"312px":"307px";s.style.transition="height 0.3s ease",s.style.setProperty("height",ge(i.slotName)?a:Oe(a),"important");const c=h=>{this.hms.sendMessageToAd(i.arid,"triggerEventInIframe",{eventType:h.type}),this.resetSlot(i)},d=["click","swipe","tap"].map(h=>({type:h,callback:c}));d.forEach(({type:h,callback:p})=>{window.addEventListener(h,p,{once:!0})}),this.expandInlineListeners.set(i.adUnitPlacementId,d)},this.resetSlot=i=>{if(!V().isT1()&&!V().isT2()&&!Re().isT1()){this.logError(i,{message:"resetSlot called without weblab enabled"});return}const s=w(i);if(!s)return;s.style.transition="height 0.3s ease";const r=this.originalHeights.get(i.adUnitPlacementId)||"55px";s.style.setProperty("height",ge(i.slotName)?r:Oe(r),"important"),this.originalHeights.delete(i.adUnitPlacementId)}}}const Ws=(e,{latencyMetricType:t,timestamp:n})=>{T().sendLatencyMetric({latencyMetricType:t,placementName:e.placementName,placementId:e.placementId,placementDivId:e.adUnitPlacementId,timestamp:n})},X=e=>{var t;return{aaxImpPixelUrl:e.aaxImpPixelUrl,aaxInstrPixelUrl:e.aaxInstrPixelUrl,abpAcceptable:e.abpAcceptable,abpStatus:(t=e.abpStatus)!=null?t:"-1",btrPixelUrl:e.btrPixelUrl,skAdNetwork:e.skAdNetwork,loggingContext:{aaxProgramId:Number(e.adCreativeMetaData.adProgramId)}}},$s=["desktop-detail-ilm","vindp-desktop-atf-ilm",...Pn],ge=e=>$s.includes(e);class Ys{constructor(t,n){this.supportedCommands=t,this.eventsChannel=n,this.receiveMessage=async({data:{command:i,adDetails:s,payload:r}})=>{try{const a={...this.eventsChannel,...this.supportedCommands}[i];a&&await a(s,r)}catch(o){const a="Problem with message: "+JSON.stringify(r);u(a,o)}}}}class Js{constructor(t){this.adMap=t,this.sendMessageToAd=(n,i,s)=>{const r=this.adMap[n].messagePort,o={command:i,data:s};r.postMessage(o)},this.sendCustomMessageToAd=(n,i,s)=>{const r={key:i,data:s};this.sendMessageToAd(n,"customMessage",r)}}}class Gs{constructor(t={},n={},i={}){this.adMap=t,this.ADS_HANDLERS=n,this.viewableLatencyTrackers=i}}const ut=/AdPlacementStyleAssets|apePlacements/,Ks=e=>{var i;const n=performance.getEntriesByType("resource").find(s=>{var r;return(r=s.name.match(ut))==null?void 0:r[0]});if(n){const s=(i=n.name.match(ut))==null?void 0:i[0];y({metricName:"asset:load:timing",adDetails:e,additionalDimensions:{...s&&{assetName:s},assetUrl:n.name,dns:String(n.domainLookupEnd-n.domainLookupStart),tcp:String(n.connectEnd-n.connectStart),ttfb:String(n.responseStart-n.requestStart),download:String(n.responseEnd-n.responseStart),total:String(n.responseEnd-n.startTime)},once:!0})}},zs=e=>{try{l("coordinate:x",e,e.div.getBoundingClientRect().x),l("coordinate:y",e,e.div.getBoundingClientRect().y)}catch(t){return}},qs=(e,t,n)=>{T().sendLatencyMetric({latencyMetricType:ls,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId}),n&&(T().sendLatencyMetric({latencyMetricType:ds,placementId:e.placementId,placementName:e.placementName,placementDivId:e.adUnitPlacementId,timestamp:n}),Ue({latencyEvent:"wb",placement:t,timestamp:n})),l(Nt,t),g(Ot,t),l(Lt,t),g(kt,t)},Xs=e=>{window.addEventListener("scroll",e),window.addEventListener("resize",e),document.addEventListener("visibilitychange",e)},js=e=>{window.removeEventListener("scroll",e),window.removeEventListener("resize",e),document.removeEventListener("visibilitychange",e)},gt=(e,t,n)=>e>0?n>e:t>0,pt=(e,t,n,i,s,r)=>{var a,c;const o=(c=(a=document==null?void 0:document.getElementById)==null?void 0:a.call(document,n))==null?void 0:c.getBoundingClientRect();if(o&&gt(o.top,o.bottom,Y())&&gt(o.left,o.right,ce())){if(T().sendLatencyMetric({latencyMetricType:ms,placementId:s,placementName:i,placementDivId:n,timestamp:new Date}),e[r].loaded){T().sendLatencyMetric({latencyMetricType:at,placementId:s,placementName:i,placementDivId:n,timestamp:new Date});const d={id:s,name:i};l("adplacements:htmlviewed:loaded:",d),l("adplacements:htmlviewed",d)}t.viewed=!0,js(t.tracker)}},Zs=(e,t)=>{if(!e[t.arid]){e[t.arid]={valid:!1};try{const n=e[t.arid];pt(e,n,t.adUnitPlacementId,t.placementName,t.placementId,t.arid);const i=te(rt(20,()=>{pt(e,n,t.adUnitPlacementId,t.placementName,t.placementId,t.arid)}),u);Xs(i),n.tracker=i,n.valid=!0}catch(n){throw u("Error initializing viewable latency instrumentation",n),n}}};class Qs{constructor(t,n){this.hc=t,this.hmr=n,this.collapsedPlacements=new Set,this.initializeAdMap=(i,s)=>{try{this.hc.adMap[i.arid]={messagePort:s}}catch(r){u("Error creating safeFrame ".concat(i.slotName),r)}},this.secondPhaseLoadAd=async(i,s,r,o)=>{await this.setupMessageChannel(r,s,o)},this.setupMessageChannel=async(i,s,r)=>{var c;(c=performance==null?void 0:performance.mark)==null||c.call(performance,"SafeFrame: Start setupMessagePort ".concat(s.adUnitPlacementId)),this.initializeAdMap(s,i);const o=this.hc;o.ADS_HANDLERS[s.arid]=o.ADS_HANDLERS[s.arid]||{};const a=ct(s);zs(a),qs(s,a,r),Ks(s),Zs(o.viewableLatencyTrackers,s);try{Zt().isT1()||await os(s),Ds(o,s,this.hmr)}catch(d){throw a.collapse(s,"HOSTSETUP"),d}}}}const Ds=(e,t,n)=>{e.adMap[t.arid].messagePort.onmessage=n.receiveMessage},er=()=>{const e=new Gs,t=new Js(e.adMap),n=In(t),i=new Ys(new Us(t,e),n);return new Qs(e,i)},tr=()=>{performance.mark("Safeframe: initSafeframeHostDesktop"),!window.APE_SF&&(performance.mark("Safeframe: initSafeframeHostDesktop init"),window.APE_SF=er())};te(()=>tr(),u,"Error initializing safeFrame")()})();
//# sourceMappingURL=DAsf-1.50.eaujymwi.js.map
