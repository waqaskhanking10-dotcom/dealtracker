(function(v){var k=window.AmazonUIPageJS||window.P,t=k._namespace||k.attributeErrors,E=t?t("VSEComponentAssets",""):k;E.guardFatal?E.guardFatal(v)(E,window):E.execute(function(){v(E,window)})})(function(v,k,t){(function(){function E(d){k.URLSearchParams&&"1"===(new k.URLSearchParams(k.location.search)).get("iveDebug")&&(k.DistributionMetricsDebugInfo?k.DistributionMetricsDebugInfo.push(d):k.DistributionMetricsDebugInfo=[d])}function L(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,
function(d){var c=16*Math.random()|0;return("x"==d?c:c&3|8).toString(16)})}k.vseFeatures=k.vseFeatures||{};var G=k.gatedP||{register:function(d,c,a,b,h){void 0===h&&(h=k.vseFeatures);v.now(d).execute(d+"-prereg",function(z){z||h[c]||(h[c]=!0,b.resolve(a(b)).then(function(){v.now(d).execute(d+"-reg",function(a){a||(v.log("Gated registration failed to register module!","ERROR",d),h[c]=!1)})}))})},declare:function(d,c,a,b){void 0===b&&(b=k.vseFeatures);v.now(d).execute(d+"-prereg",function(h){h||b[c]||
(b[c]=!0,v.declare(d,a))})}},m={count:function(d,c){var a=k.ue;a&&a.count("vse:csm:"+d,c)},emitNexusMetric:function(d,c,a,b){void 0===b&&(b=!1);k.ue&&k.ue.event&&d&&d.events&&d.events[0]&&d.events[0].data&&(k.ue.event(d.events[0].data,c,a),b&&E(d.events[0].data))},emitSushiMetric:function(d,c,a,b){var h=this;void 0===c&&(c=!1);a=a||"https://unagi-na.amazon.com/1/events/com.amazon.eel.vse.metricstest.nexus";b=b||0;if(!(3<=b)){var z=JSON.stringify(d).replace(/\\\\/g,""),e={params:z,paramsFormat:"json",
contentType:"application/json; charset\x3dutf-8",error:function(){h.emitSushiMetric(d,c,a,++b)}},g=navigator.userAgent.match(/iPhone/i),l=!1;v.now("mash").execute("vse-detect-mshop",function(){l=!0});var q=null!==g&&l;v.when("A").execute("Emit-VSE-Metrics",function(b){navigator&&navigator.sendBeacon&&!q?navigator.sendBeacon(a,z):b.post(a,e)});c&&E(d)}},logFatal:function(d,c,a){k.ueLogError&&k.ueLogError(a,{logLevel:"FATAL",attribution:d,message:c})},logError:function(d,c,a){k.ueLogError&&k.ueLogError(a,
{logLevel:"ERROR",attribution:d,message:c})}},H={makeApplicationSushiPayloadBuilder:function(d,c){return function(a){var b={eventSource:c.eventSource,requestId:c.requestId,sessionId:c.sessionId,placementContext:c.placementContext,creativeId:c.creativeId||"",marketplaceId:c.marketplaceId,weblabIds:c.weblabIds,clientId:c.clientId,isInternal:c.isInternal.toString(),isRobot:c.isRobot.toString(),pageAsin:c.pageAsin,customerId:c.customerId,sessionType:c.sessionType||1,refMarkers:c.refMarkers,eventId:L(),
timestamp:new Date,userAgentData:navigator.userAgent,titleSessionId:0,videoAsin:0,pageUrl:null!==k.location.href?k.location.href.substring(0,500):"",videoAsinList:c.videoAsinList||"",rankingStrategy:""};return{events:[{data:d.$.extend(b,a)}]}}},makeApplicationNexusPayloadBuilder:function(d,c){return function(a){var b={eventSource:c.eventSource,placementContext:c.placementContext,userAgentData:navigator.userAgent,videoAsin:c.videoAsin||"",pageAsin:c.pageAsin||"",videoAsinList:c.videoAsinList||"",titleSessionId:"0",
stringPayload:"",intPayload:1,rankingStrategy:"",creativeId:c.creativeId||"",clientId:c.clientId,pageUrl:null!==k.location.href?k.location.href.substring(0,500):"",customerId:c.customerId||""};return{events:[{data:d.$.extend(b,a)}]}}},makeClickstreamNexusPayloadBuilder:function(d,c){return function(a){return d.$.extend({timestamp:new Date,actionType:c.actionType,eventOwner:c.producerId,eventType:c.eventType,productId:c.productId},a)}},extendWithNewField:function(d,c,a){return d&&d.events&&d.events[0]&&
d.events[0].data?(d=d.events[0].data,d[c]=a,{events:[{data:d}]}):d}},D={fetchLatestPageState:function(d,c){d.state.replace(c,JSON.parse(d.$("script[type\x3d'a-state'][data-a-state*\x3d"+c+"]").html()));return d.state(c)},isDefined:function(d){return"undefined"!==typeof d&&null!==d}},w={updateReftagParam:function(d,c){return w.updateQueryStringParameter(d,"ref_?","ref",c)},updateQueryStringParameter:function(d,c,a,b){c=new RegExp("([?\x26/])"+c+"\x3d.*?(\x26|$)","i");var h=-1!==d.indexOf("?")?"\x26":
"?";return d.match(c)?d.replace(c,"$1"+a+"\x3d"+b+"$2"):d+h+a+"\x3d"+b},generateUUID:function(){for(var d="",c=0;13>c;c++)d+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(Math.floor(62*Math.random()));return d},decodeEntities:function(d){var c=document.createElement("textarea");c.innerHTML=d;return c.value},triggerShare:function(d,c,a,b){if(c){c=screen.width;var h=screen.height;a=a?a:.7*c;b=b?b:.7*h;k.open(d,"_blank","toolbar\x3d0,status\x3d0,width\x3d"+a+",height\x3d"+b+
",top\x3d"+(h/2-b/2)+",left\x3d"+(c/2-a/2))}else k.open(d,"_self")},getPageData:function(d){return"undefined"!==typeof d.pageLevelStateKey?A.state(d.pageLevelStateKey):d.pageLevelData},buildUrl:function(d,c){c=c||{};for(var a=k.navigator&&k.navigator.userAgent&&k.navigator.userAgent.match(/iPhone/i),b=Object.keys(c),h=0<b.length&&("sms:"!==d||!a)?"?":"",a=0;a<b.length;a++)"?"!==h&&(h+="\x26"),c[b[a]]&&(h+=b[a]+"\x3d"+encodeURIComponent(c[b[a]]));return d+h},generateReftags:function(d,c){var a,b;d=
w.getPageData(d);"undefined"!==typeof d&&(a=d.clientRef,b=d.deviceTypeRef);a=a?a:"un";b=b?b:"un";d=c?c:"un";c=w.generateUUID();d="cm_sw_"+d;a=a+"_"+b+"_"+c;return{returnReftag:d+"_r_"+a,clickReftag:d+"_c_"+a}},copyLinkToClipboard:function(d){var c=w.generateReftags(d,"cp"),c=w.updateReftagParam(d.url,c.returnReftag);k.isSecureContext&&navigator.clipboard&&navigator.clipboard.writeText(c).then(function(){var a=document.getElementById(d.socialShareId+"-copy");if(a){var b=a.getElementsByClassName("ive-copy-text")[0];
if(b){var h=b.textContent;b.textContent=d.shareCopyLinkSuccessText;setTimeout(function(){b&&(b.textContent=h)},1E3)}}}).catch(function(){m.count("iveSocialShareCopyLinkFailed",1)})}},pa={share:function(d,c){var a={facebook:{shareEndpoint:"https://www.facebook.com/dialog/share",params:function(a){return{href:w.decodeEntities(a.url),display:"popup",quote:a.quote?w.decodeEntities(a.quote):"",app_id:"465632727431967"}},ref:"fb",height:450,width:700,isWebShare:!0},pinterest:{shareEndpoint:"https://www.pinterest.com/pin/create/button",
params:function(a){return{url:w.decodeEntities(a.url),media:w.decodeEntities(a.image),description:w.decodeEntities(a.description)}},ref:"pi",height:620,width:700,isWebShare:!0},twitter:{shareEndpoint:"https://twitter.com/intent/tweet",params:function(a){var h=w.decodeEntities(a.title);a=w.decodeEntities(a.url);if(h){var c=a?Math.min(a.length,20):-1;200<h.length+c+1&&(h=h.substring(0,200-(c+1+3))+"...")}return{text:h,url:a}},ref:"tw",height:470,width:670,isWebShare:!0},email:{shareEndpoint:"mailto:",
params:function(a){return{subject:w.decodeEntities(a.title),body:w.decodeEntities(a.description)+"\n"+w.decodeEntities(a.url)}},ref:"em",height:470,width:670,isWebShare:!1},sms:{shareEndpoint:"sms:",params:function(a){return{body:w.decodeEntities(a.title)+" "+w.decodeEntities(a.url)}},ref:"sm",height:470,width:670,isWebShare:!1},whatsapp:{shareEndpoint:"https://api.whatsapp.com/send",params:function(a){return{text:w.decodeEntities(a.description)+"\n"+w.decodeEntities(a.url)}},ref:"wa",height:470,
width:670,isWebShare:!0}};"copy"===c?w.copyLinkToClipboard(d):(c=a[c],a=w.generateReftags(d,c.ref),d.url=w.updateReftagParam(d.url,a.returnReftag),d=w.buildUrl(c.shareEndpoint,c.params(d)),w.triggerShare(d,c.isWebShare,c.width,c.height))}},C={sendRequest:function(d,c,a,b,h){d.ajax(c,{params:a,paramsFormat:"json",crossDomain:!0,method:"POST",withCredentials:!0,contentType:"application/json",success:b,error:h})}},qa={sendRequest:function(d,c,a,b,h){d.ajax(c,{params:a,paramsFormat:"json",crossDomain:!0,
method:"POST",withCredentials:!0,contentType:"application/json",success:b,error:h})}},ra={getClosedCaptions:function(d,c){var a=[];if(!d.objectIsEmpty(c))for(d=c.split(","),c=0;c<d.length;c+=2)d[c+1]!==t&&a.push({locale:d[c],url:d[c+1]});return a}},K=function(){return function(d){this.message=d}}(),M=function(){function d(c,a){void 0===a&&(a={refTagRecorderEndPoint:"/gp/mobile/tag/?",retryLimit:3});this.A=c;this.config=a}d.prototype.emitRefTag=function(c,a){void 0===a&&(a=0);if(!(a>=this.config.retryLimit)){var b=
this;this.A.get(this.config.refTagRecorderEndPoint+"ref\x3d"+c,{error:function(){b.emitRefTag(c,++a)}})}};return d}(),sa=t&&t.__assign||Object.assign||function(d){for(var c,a=1,b=arguments.length;a<b;a++){c=arguments[a];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(d[h]=c[h])}return d},ta=function(){function d(c){var a=this;this.config=c;this.log=function(b){if(a.videoEvent){var h=a.$container.closest("[data-csa-c-id]");0<h.length?(a.basePayload.parentElementId=h.data("csa-c-id"),a.videoEvent("setEntity",
{video:sa({},a.basePayload,b)}),a.videoEvent("log",{schemaId:a.schemaId},{ent:"all"})):k.ue&&(k.ue.count(d.CANNOT_FIND_CSA_WIDGET,1),m.logError("ive-lucid-video-events","Cannot find CSA widget, container id: "+a.$container.attr("id")+", eventPayload: "+JSON.stringify(b),"Cannot find CSA widget, container id: "+a.$container.attr("id")+", eventPayload: "+JSON.stringify(b)))}else m.count("ive:csa:cannotCreateVideoEvent:noVideoEvent",1)};this.schemaId=c.schemaId;this.$container=c.$container;this.basePayload=
{player:"Brila",parentElementId:""};k.csa?this.videoEvent=k.csa("Events",{producerId:c.producerId,lob:k.ue_lob?k.ue_lob:""}):m.count("ive:csa:cannotCreateVideoEvent:noCsaAvailable",1)}d.CANNOT_FIND_CSA_WIDGET="ive-cannot-find-csa-widget";return d}(),U=function(){function d(c,a,b,h,z){var e=this;this.player=a;this.A=b;this.isIvx=h;this.clientPrefix=z;this.secondsFromLastEvent=this.lastLoggedEventInterval=this.loggingInterval=this.initialLoggingDelay=0;this.aciContentId="";this.emitCarouselClickEvent=
function(){e.logCSAEvent(e.secondsFromLastEvent,"ENDED");e.isAutoplay=!1};this.attachPlayerEventListeners=function(){e.player.on("playbackStart",e._playbackStartHandler);e.player.on("playbackComplete",e._playbackCompleteHandler);e.player.on("fullscreenchange",e._playerModeChangeHandler);e.player.on("pause",e._playbackPauseHandler);e.player.on("mute",e._playbackMuteHandler);e.player.on("unmute",e._playbackUnmuteHandler);e.player.on("enableClosedCaptions",e._playbackEnableClosedCaptionsHandler);e.player.on("disableClosedCaptions",
e._playbackDisableClosedCaptionsHandler);e.A.on("vse:"+e.clientPrefix+":player:continuous:play",function(){e.isAutoplay=!0});e.A.on("vse:"+e.clientPrefix+":page:lightBoxClosed",function(){e.isAutoplay=!1})};this._playbackStartHandler=function(){e.aciContentId=e.getCurrentACIContentId();e.logCSAEvent(e.secondsFromLastEvent,"PLAYING");m.count(e.clientPrefix+":csa:startPlaying",1);e.removeCSAEventHandler();e.addCSAEventHandler()};this._playbackCompleteHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,
"ENDED");e.removeCSAEventHandler()};this._playerModeChangeHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,"MODE_CHANGED",e.currentPlayerMode);e.removeCSAEventHandler();e.addCSAEventHandler()};this._playbackPauseHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,"STOPPED");e.removeCSAEventHandler()};this._playbackMuteHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,"MUTED");e.removeCSAEventHandler();e.addCSAEventHandler()};this._playbackUnmuteHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,
"UNMUTED");e.removeCSAEventHandler();e.addCSAEventHandler()};this._playbackEnableClosedCaptionsHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,"CAPTIONS_ON");e.removeCSAEventHandler();e.addCSAEventHandler()};this._playbackDisableClosedCaptionsHandler=function(){e.logCSAEvent(e.secondsFromLastEvent,"CAPTIONS_OFF");e.removeCSAEventHandler();e.addCSAEventHandler()};this.addCSAEventHandler=function(){e.lastLoggedEventInterval=e.A.interval(function(){e.secondsFromLastEvent++},d.TIMERS.TIME_FROM_LAST_EVENT_MS);
e.initialLoggingDelay=e.A.delay(function(){e.logCSAEvent(e.secondsFromLastEvent,"PLAYING");e.loggingInterval=e.A.interval(function(){e.logCSAEvent(e.secondsFromLastEvent,"NONE")},d.TIMERS.SUBSEQUENT_INTERVAL_MS)},d.TIMERS.INITIAL_DELAY_MS)};this.removeCSAEventHandler=function(){clearInterval(e.lastLoggedEventInterval);clearInterval(e.loggingInterval);clearTimeout(e.initialLoggingDelay);e.secondsFromLastEvent=0;e.loggingInterval=0;e.initialLoggingDelay=0};this.logCSAEvent=function(a,b,h){""!==e.aciContentId?
(e.currentPlayerMode=e.getCurrentPlayerMode(),a={contentId:e.aciContentId,viewDuration:a.toString(),playerMode:h||e.currentPlayerMode,isAutoPlayed:e.isAutoplay.toString(),isCaptionOn:e.player.isCaptionOn().toString(),isAudioOn:(!e.player.isMuted()).toString(),videoRequestId:e.player.getTitleSessionId().toString(),eventName:b},e.csa.log(a),e.secondsFromLastEvent=0):m.count(e.clientPrefix+":csa:noContentIdPresented",1)};this.csa=new ta(c);this.player=a;this.currentPlayerMode=this.getCurrentPlayerMode();
this.isAutoplay=this.player.isAutoplayed();this.attachPlayerEventListeners()}d.prototype.getCurrentPlayerMode=function(){return this.isIvx?"IMMERSIVE_VIEW":this.player.isFullscreen()?"FULL_SCREEN":"MODAL"};d.prototype.getCurrentACIContentId=function(){return this.player.getCurrent().aciContentId||""};d.TIMERS={INITIAL_DELAY_MS:2E3,SUBSEQUENT_INTERVAL_MS:3E4,TIME_FROM_LAST_EVENT_MS:1E3};return d}(),N=function(){return function(d){var c=this;this.A=d;this.buildTag=function(a){if(!a.href)return"";var b=
"tag\x3d"+a.vendorTrackingId,h=a.asin;c.A.objectIsEmpty(h)||(h="\x26creativeASIN\x3d"+h);var d="linkCode\x3d",d=c.A.objectIsEmpty(a.linkCode)?d+"vse":d+a.linkCode,e=a.aciContentId,g="";c.A.objectIsEmpty(a.aciContentId)||(g="\x26asc_contentid\x3d"+e);b=b+"\x26"+d+h+g;b=0>a.href.indexOf("?")?"?"+b:"\x26"+b;return a.href+b}}}(),V={queueComplete:!0},W=function(){function d(c,a,b){var h=this;this.player=c;this.frame=a;this.assets=[];this.currentIndex=0;this.eventEmitter=new b.EventEmitter;this.player.on("playbackComplete",
function(){h.currentIndex++;h.doPlay()})}d.prototype.play=function(c){c?this.player.play(c):this.player.play();return this};d.prototype.emitStartCountMetric=function(){this.player.emitStartCountMetric();return this};d.prototype.emitScrubberClick=function(){this.player.emitScrubberClick();return this};d.prototype.emitSkipForwardClick=function(){this.player.emitSkipForwardClick();return this};d.prototype.emitSkipBackwardClick=function(){this.player.emitSkipBackwardClick();return this};d.prototype.getCurrentTime=
function(){return this.player.getCurrentTime()};d.prototype.setCurrentTime=function(c){this.player.setCurrentTime(c);return this};d.prototype.getMediaDuration=function(){return this.player.getMediaDuration()};d.prototype.mute=function(c){this.player.mute(c);return this};d.prototype.unmute=function(){this.player.unmute();return this};d.prototype.isMuted=function(){return this.player.isMuted()};d.prototype.resume=function(c){this.player.resume(c);return this};d.prototype.pause=function(c){this.player.pause(c);
return this};d.prototype.next=function(){this.player.stop();this.currentIndex++;this.doPlay();return this};d.prototype.previous=function(){this.player.stop();this.currentIndex--;this.doPlay();return this};d.prototype.seek=function(c){this.player.seek(c);return this};d.prototype.enqueue=function(c,a){void 0===a&&(a=this.assets.length);c instanceof Array?(c=c.slice(),c.splice(0,0,this.assets),Array.prototype.splice.apply(this.assets,c)):this.assets.splice(a,0,c);return this};d.prototype.dequeue=function(c){var a=
this,b;if("number"===typeof c)b=[c];else if(c instanceof Array){var h=c.map(function(a){return a.contentId});b=this.assets.map(function(a){return h.indexOf(a.contentId)}).filter(function(a){-1!=a})}else b=[this.assets.map(function(a,b){return b}).filter(function(b){a.assets[b].contentId==c.contentId})[0]];for(var d=0,e=b.length;d<e;d++)this.assets.splice(b[d],1);return this};d.prototype.on=function(c,a){if(V.hasOwnProperty(c))this.eventEmitter.on(c,a);else this.player.on(c,a);return this};d.prototype.off=
function(c,a){V.hasOwnProperty(c)?this.eventEmitter.off(c,a):this.player.off(c,a);return this};d.prototype.ready=function(c){this.player.ready(c);return this};d.prototype.readyState=function(){return this.player.readyState()};d.prototype.load=function(){this.player.load();return this};d.prototype.getAssets=function(){return this.assets};d.prototype.getCurrentAssetIndex=function(){return this.currentIndex-1};d.prototype.getPosition=function(){return this.player.getPosition()};d.prototype.isPlaying=
function(){return this.player.isPlaying()};d.prototype.isPaused=function(){return this.player.isPaused()};d.prototype.getVersion=function(){return this.player.getVersion()};d.prototype.destroy=function(){this.player.destroy()};d.prototype.addChild=function(c,a){this.player.addChild(c,a);return this};d.prototype.removeChild=function(c){this.player.removeChild(c);return this};d.prototype.loadNextVideoPoster=function(c){this.player.loadNextVideoPoster(c);return this};d.prototype.blur=function(){this.player.blur();
return this};d.prototype.requestFullscreen=function(){this.player.requestFullscreen();return this};d.prototype.exitFullscreen=function(){this.player.exitFullscreen();return this};d.prototype.isFullscreen=function(){return this.player.isFullscreen()};d.prototype.fluid=function(c){this.player.fluid(c);return this};d.prototype.aspectRatio=function(c){this.player.aspectRatio(c);return this};d.prototype.enableCurrentTextTrack=function(c){void 0===c&&(c="en");this.player.enableCurrentTextTrack(c);return this};
d.prototype.disableCurrentTextTrack=function(c){void 0===c&&(c="en");this.player.disableCurrentTextTrack(c);return this};d.prototype.updateTextTrack=function(c){this.player.updateTextTrack(c);return this};d.prototype.removeCurrentTextTracks=function(){this.player.removeCurrentTextTracks();return this};d.prototype.setInitialData=function(c){var a=document.getElementsByClassName("vse-player-container");this.player.setInitialData(c);c&&c.aciContentId&&0<a.length&&(a[0].hasAttribute("data-csa-c-content-id")||
""===a[0].getAttribute("data-csa-c-content-id"))&&a[0].setAttribute("data-csa-c-content-id",c.aciContentId);return this};d.prototype.showPoster=function(c){this.player.showPoster(c);return this};d.prototype.getCurrent=function(){return this.player.getCurrent()};d.prototype.isCaptionOn=function(){return this.player.isCaptionOn()};d.prototype.isAutoplayed=function(){return this.player.isAutoplayed()};d.prototype.getTitleSessionId=function(){return this.player.getTitleSessionId()};d.prototype.requestPictureInPicture=
function(){this.player.requestPictureInPicture();return this};d.prototype.exitPictureInPicture=function(){this.player.exitPictureInPicture();return this};d.prototype.setPlayerMode=function(c){this.player.setPlayerMode(c);return this};d.prototype.doPlay=function(){var c=this.player.getCurrent();c&&this.assets[this.currentIndex]?this.assets[this.currentIndex].contentId==c.contentId?this.player.play():this.player.play(this.assets[this.currentIndex]):this.assets[this.currentIndex]&&this.player.play(this.assets[this.currentIndex])};
return d}(),ua=function(){function d(c,a){var b=this;this.isMshop=this.isReportWidgetClosed=this.mouseOverVideoPlayer=!1;this.DISCLOSURE_SELECTOR=".ive-video-disclosure-container-wrapper";this.INFLUENCER_DISCLOSURE_SELECTOR=".ive-aip-link";this.PUBLISHER_DISCLOSURE_SELECTOR=".ive-osp-link";this.HIDDEN_CSS_CLASS="aok-hidden";this.REPORT_COPYRIGHT_SELECTOR=".vse-fb-copyright";this.REPORT_SHOWN_METRIC="ive:player:report:shown";this.REPORT_SUBMITTED_METRIC="ive:player:report:submit";this.REPORT_HIDDEN_METRIC=
"ive:player:report:hidden";this.update=function(a){b.report&&b.report.setActiveVideoAndSource(a.contentId,a.vendorCode,a.aciContentId);if(!0===b.config.includeEarnsComissionDisclosure&&b.$disclosureContainer){var c=b.$disclosureContainer.find(b.INFLUENCER_DISCLOSURE_SELECTOR),d=b.$disclosureContainer.find(b.PUBLISHER_DISCLOSURE_SELECTOR),e="Influencer"===a.creatorType;a="3P"===a.creatorType;c.toggleClass(b.HIDDEN_CSS_CLASS,!e);d.toggleClass(b.HIDDEN_CSS_CLASS,e);b.$disclosureContainer.toggleClass(b.HIDDEN_CSS_CLASS,
!(e||a))}};this.destroy=function(){b.report&&b.$reportContainer.remove();b.$disclosureContainer&&b.$disclosureContainer.remove()};this.deRegisterReport=function(){b.A.off("vse:"+b.reportId+":feedback:shown");b.A.off("vse:"+b.reportId+":feedback:hidden");b.A.off("vse:"+b.reportId+":feedback:submitted:success")};this.addReportHandlers=function(){b.A.on("vse:"+b.reportId+":feedback:shown",function(){m.count(b.REPORT_SHOWN_METRIC,1);b.playerShim&&b.playerShim.isPlaying()&&b.playerShim.pause();b.isReportWidgetClosed=
!1;b.$reportContainer.find(b.REPORT_COPYRIGHT_SELECTOR).click(function(a){b.isMshop&&(a.preventDefault(),b.report.showInfringementNotSupport())})});b.A.on("vse:"+b.reportId+":feedback:hidden",function(){m.count(b.REPORT_HIDDEN_METRIC,1);b.isReportWidgetClosed=!0;b.mouseOverVideoPlayer||b.hideReportWidget();b.$reportContainer.find(b.REPORT_COPYRIGHT_SELECTOR).unbind("click")});b.A.on("vse:"+b.reportId+":feedback:submitted:success",function(){m.count(b.REPORT_SUBMITTED_METRIC,1)})};this.showReportWidget=
function(){b.$reportContainer.css({display:"inline-block"});b.toggleDimVideoPlayer(!0)};this.hideReportWidget=function(){b.$reportContainer.css({display:"none"});b.toggleDimVideoPlayer(!1)};this.toggleDimVideoPlayer=function(a){b.$playerContainer.find("video").toggleClass("dim-video-player",a)};this.mouseLeaveHandler=function(){b.isReportWidgetClosed&&b.hideReportWidget();b.mouseOverVideoPlayer=!1};this.config=c;this.playerShim=a}d.prototype.initialize=function(c){var a=this;v.when("A","a-button",
"ready").execute("IVECreateBasicComponentsForPlayer",function(b,h){a.A=b;a.isMshop=b.capabilities.mobile&&b.capabilities.isAmazonApp;a.$playerContainer=a.A.$("#"+a.config.parentId);a.deRegisterReport();var d=b.state(a.config.reportPageStateName);a.reportId=d.id;b=new a.config.feedbackFactory({A:b,buttonApi:h});a.report=b.create(a.reportId,a.config.reportPageStateName,!1);a.addReportHandlers();a.$disclosureContainer=a.$playerContainer.parent().find(a.DISCLOSURE_SELECTOR);a.$playerContainer.append(a.$disclosureContainer);
a.update(c);a.$reportContainer=a.$playerContainer.parent().find(".ive-"+a.config.clientPrefix+"-report-container");a.isReportWidgetClosed=!0;a.$reportContainer.removeClass(a.HIDDEN_CSS_CLASS);a.$playerContainer.append(a.$reportContainer);b="report-overlays-player-"+a.reportId;a.A.declarative.create(a.$playerContainer,b,{});a.A.declarative(b,"mouseenter touchstart focus",function(){a.isReportWidgetClosed&&a.showReportWidget();a.mouseOverVideoPlayer=!0;a.A.capabilities.touch&&a.A.delay(a.mouseLeaveHandler,
3E3)});a.A.declarative(b,"mouseleave",a.mouseLeaveHandler)})};return d}(),va=t&&t.__assign||Object.assign||function(d){for(var c,a=1,b=arguments.length;a<b;a++){c=arguments[a];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(d[h]=c[h])}return d},X=function(){function d(c,a,b,h){var d=this;this.config=a;this.libs=h;this.VSE_CC_KEY="vse_brila_cc_status";this.lastFrameTime=0;this.DRAW_DELAY_IN_MS=20;this.registerEventsForLazyBlur=function(a,b){if(b&&a)d.videoJS.on("timeupdate",function(){setTimeout(function(){d.draw(b.getContext("2d",
{alpha:!1}),a,d.getCurrentTime())},100)})};this.draw=function(a,b,h){void 0===h&&(h=0);var c=Math.abs(h-d.lastFrameTime);if(null===a||null===b||!d.isPlaying()||performance===t)return!1;var e=performance.now();e-d.lastFrameTime>=d.DRAW_DELAY_IN_MS&&(d.drawCover(a,b,c,h),d.lastFrameTime=e);k.requestAnimationFrame(function(){d.draw(a,b,h)})};this.drawCover=function(a,b,h,c){d.lastFrameTime=c;if(a){a.canvas.width=a.canvas.clientWidth;a.canvas.height=a.canvas.clientHeight;h=a.canvas.width;c=a.canvas.height;
var e=b.videoWidth,g=b.videoHeight,u=Math.max(h/e,c/g),e=e*u,g=g*u;a.imageSmoothingEnabled=!1;a.drawImage(b,(h-e)/2,(c-g)/2,e,g)}};this.encodeForHtml=function(a){return a.replace(/&/g,"\x26amp;").replace(/</g,"\x26lt;").replace(/>/g,"\x26gt;").replace(/"/g,"\x26quot;").replace(/'/g,"\x26#39;")};this.eventEmitter=new h.EventEmitter;this.currentAsset=b;this.localStorageEnabled=this.testLocalStorage();this.initHandlers();this.parentContainerId=a.parentId+"-element";this.altTextElement=this.createAltTextElement(a.parentId);
var e;!a.isReactFactory&&(e=document.getElementById(a.parentId))&&(this.videoElement=document.createElement("video"),this.videoElement.id=this.parentContainerId,this.videoElement.className=a.isVideoImmersivePlayer?"video-js brila-vip-vjs":"video-js brila-video-js",this.videoElement.setAttribute("playsinline","true"),this.videoElement.setAttribute("disablepictureinpicture","true"),a.shouldDisableControls||a.isChromelessPlayer||this.videoElement.setAttribute("controls","true"),!0===a.shouldAutoplay&&
this.videoElement.setAttribute("autoplay","true"),!0!==a.shouldStartMuted&&!0!==a.isChromelessPlayer||this.videoElement.setAttribute("muted","true"),a.shouldPreload||this.videoElement.setAttribute("preload","none"),!0===a.enableDynamicBlur&&(this.dynamicBlurWrapper=document.createElement("canvas"),this.dynamicBlurWrapper.classList.add("awa-blur-wrapper"),e.appendChild(this.dynamicBlurWrapper),e.classList.add("awa-blur-background")),e.appendChild(this.videoElement));b=this.getDefaultLanguageForPlayer();
h={player:{playsinline:!0,autoplay:a.shouldAutoplay,loop:a.shouldLoop,muted:a.shouldStartMuted||a.isChromelessPlayer,preload:a.shouldPreload?"auto":"none",techOrder:["html5"],textTrackSettings:!1,html5:{hls:{overrideNative:c.overrideNativePlayer()},nativeAudioTracks:!1,nativeVideoTracks:!1,nativeTextTracks:!1},controlBar:{pictureInPictureToggle:!1},language:b},hotkeys:{skipInitialFocus:a.skipInitialFocus,enableInactiveFocus:a.enableInactiveFocus}};a.languageLocalization&&(h.player.languages=(l={},
l[b]={Play:a.languageLocalization.play,"Play Video":a.languageLocalization.playVideo,Pause:a.languageLocalization.pause,Mute:a.languageLocalization.mute,Unmute:a.languageLocalization.unmute,VolumeSlider:a.languageLocalization.volumeSlider,"Volume Level":a.languageLocalization.volumeLevel,Fullscreen:a.languageLocalization.fullscreen,"Exit Fullscreen":a.languageLocalization.nonfullscreen,Captions:a.languageLocalization.captions,Subtitles:a.languageLocalization.subtitles,"Progress Bar":a.languageLocalization.scrubberBar},
l));!0===a.allowCrossOrigin&&(h.player.crossorigin="anonymous");a.closedCaptionsConfig&&(h.player.languages=h.player.languages||{},h.player.languages[b]=va({},h.player.languages[b],{"captions off":a.closedCaptionsConfig.captionsOffText,"subtitles off":a.closedCaptionsConfig.captionsOffText},a.closedCaptionsConfig.languageToLabelTexts));!0===a.isChromelessPlayer&&(h.player.children=["MediaLoader"],h.player.controls=!1);!0===a.isVideoImmersivePlayer?(h.player.bigPlayButton=!1,h.player.posterImage=a.posterSource,
h.player.controlBar={playToggle:!1,volumePanel:!1,currentTimeDisplay:!0,remainingTimeDisplay:!0,fullscreenToggle:!1}):!0===a.shouldDisableControls&&(h.player.controlBar={volumePanel:!1});this.videoJS=l=c.embed(this.parentContainerId,a,h);if(b=document.getElementById(this.parentContainerId)){b.setAttribute("style","width:100%; height:100%;");!1!==a.showPosterImage&&this.videoJS.poster(a.posterSource);this.currentAsset&&(this.currentAsset.altText||this.currentAsset.videoTitle)&&(h=this.currentAsset.altText||
this.currentAsset.videoTitle||"",h=this.getLocalizedString("Play Video")+", "+this.encodeForHtml(h),this.altTextElement.setAttribute("aria-label",h));b.insertBefore(this.altTextElement,b.firstChild);this.setAriaLabels(this.videoJS,b);if(h=b.querySelector(".vjs-big-play-button"))h.tabIndex=-1;a.shouldPreload&&this.videoJS.src({src:a.videoUrl,type:a.mimeType});this.vseMetrics=c.metrics(this.videoJS);this.vseMetrics.updateMuteMetrics(this.eventEmitter);if(c=b.querySelector(".vjs-progress-holder.vjs-slider.vjs-slider-horizontal"))c.onclick=
function(a){d.emitScrubberClick()};this.overrideActivityCheck();!0===a.isVideoImmersivePlayer?(this.videoJS.on("click",function(){d.eventEmitter.emit("playerClick")}),this.videoJS.on("touchstart",function(){d.eventEmitter.emit("playerClick")})):(this.videoJS.aspectRatio("16:9"),(c=b.querySelector(".vjs-remaining-time"))&&c.setAttribute("tabindex","0"))}this.videoJS.on("ended",function(){d.eventHandlers.onPlaybackComplete()});this.videoJS.on("playing",function(){d.eventHandlers.onPlaybackStart();d.config.useAutoplayFallback&&
(d.eventEmitter.emit("autoplaySucceeded"),d.config.useAutoplayFallback=!1)});this.videoJS.on("cancelContinuousPlay",function(){d.eventHandlers.onCancelContinuousPlay()});this.videoJS.on("playUpNext",function(){d.eventHandlers.onPlayUpNext()});var g=this;l.ready(function(){g.eventEmitter.emit("playerLoaded");e&&e.children[0]&&(e.children[0].removeAttribute("role"),e.children[0].removeAttribute("aria-label"))});if(a.feedbackFactory||!0===a.includeEarnsComissionDisclosure)this.basicComponents=new ua(a,
this),this.basicComponents.initialize(this.currentAsset);var l}d.prototype.play=function(c){var a=this,b=Date.now();this.vseMetrics.setPlayCommandInvokeTimestamp(b);if(this.isDPXDesktopFullScreenRequest(c))return this.vseMetrics.setPageLoadStartTimestamp(b),this.videoJS.play();this.setInitialData(c);this.dynamicBlurWrapper&&(c=document.getElementById(this.videoElement.id),this.registerEventsForLazyBlur(c,this.dynamicBlurWrapper));!0===this.config.useAutoplayFallback&&(c=this.videoJS.play())&&c.then(function(a){}).catch(function(b){a.eventEmitter.emit("autoplayFailed")});
return this.videoJS.play()};d.prototype.setInitialData=function(c){var a=this.getTextTrackMode("en");if(c&&c.rankingStrategy&&1===Object.keys(c).length)this.vseMetrics.setRankingStrategy(c.rankingStrategy);else if(c&&!(1===Object.keys(c).length&&"rankingStrategy"in c)&&(this.currentAsset&&c.contentId===this.currentAsset.contentId?this.config.shouldPreload||this.videoJS.src({src:c.videoUrl,type:c.mimeType}):(this.videoJS.poster(c.imageUrl),this.videoJS.posterImage.show(),this.vseMetrics.setContentId&&
this.vseMetrics.setContentId(c.contentId),this.vseMetrics.setAciContentId(c.aciContentId),this.vseMetrics.setRefTag&&this.vseMetrics.setRefTag(c.refTag?c.refTag:""),this.vseMetrics.setOspAttribution&&this.vseMetrics.setOspAttribution({ospTrackingLink:c.ospTrackingLink?c.ospTrackingLink:"",vendorTrackingId:c.vendorTrackingId?c.vendorTrackingId:"",videoReferenceId:c.videoReferenceId?c.videoReferenceId:"",productAsin:c.productAsin?c.productAsin:""}),this.videoJS.src({src:c.videoUrl,type:c.mimeType}),
this.currentAsset=c),this.setSeekTimeForInitialData(c),this.vseMetrics.setRankingStrategy(c.rankingStrategy),this.vseMetrics.setCreatorType&&this.vseMetrics.setCreatorType(c.creatorType),this.basicComponents!==t&&this.basicComponents.update(c),c&&(c.altText||c.title))){var b=c.altText||c.title||"",b=this.getLocalizedString("Play Video")+", "+this.encodeForHtml(b);this.altTextElement?this.altTextElement.setAttribute("aria-label",b):this.videoElement.setAttribute("aria-label",b)}this.removeCurrentTextTracks();
b=[];this.currentAsset&&this.currentAsset.closedCaptions&&(b=this.currentAsset.closedCaptions);c&&c.closedCaptions&&(b=c.closedCaptions);this.updateTextTrack(b);this.vseMetrics.updateTextTrackMetrics(this.eventEmitter);"showing"===a&&this.enableCurrentTextTrack();c=c&&c.eventTimestamp?c.eventTimestamp:Date.now();this.vseMetrics.setPageLoadStartTimestamp(c)};d.prototype.setSeekTimeForInitialData=function(c){c&&c.seekTime&&this.videoJS.currentTime(c.seekTime)};d.prototype.showPoster=function(c){this.videoJS.poster(c);
this.videoJS.posterImage.show();return this};d.prototype.updateTextTrack=function(c){for(var a=this,b=this.videoJS.textTracks(),h=0;h<c.length;h++){var d=c[h],e=!1;if(b)for(var g=0,l=b;g<l.length;g++){var q=l[g];"subtitles"===q.kind&&q.language===d.locale&&(e=!0)}e||this.videoJS.addRemoteTextTrack({src:d.url,kind:"subtitles",srclang:d.locale,label:this.config.closedCaptionsConfig.captionsOnTexts[d.locale.substring(0,2)],"default":!1},!1)}if(this.localStorageEnabled){c=this.videoJS.remoteTextTracks();
var f=localStorage.getItem(this.VSE_CC_KEY);f||localStorage.setItem(this.VSE_CC_KEY,"disabled");if(b)for(var q=function(b){"disabled"!==f&&"subtitles"===b.kind&&(b.mode="showing",x.eventEmitter.emit("texttrackenable",b));b.on("modechange",function(){localStorage.setItem(a.VSE_CC_KEY,"showing"===b.mode?"showing":"disabled")})},x=this,h=0;h<b.length;h++)q(b[h]);if(c)for(var b=function(b){"disabled"!==f&&"subtitles"===b.kind&&(b.mode="showing",p.eventEmitter.emit("texttrackenable",b));b.on("modechange",
function(){localStorage.setItem(a.VSE_CC_KEY,"showing"===b.mode?"showing":"disabled")})},p=this,h=0;h<c.length;h++)q=c[h],b(q)}return this};d.prototype.overrideActivityCheck=function(){var c=this;if(this.videoJS){var a=this.videoJS.userActive,b=0;this.videoJS.userActive=function(h){if(c.videoJS){var d=document.activeElement;return h!==t&&c.closestParent(d,"#"+c.parentContainerId)?(0===b&&(b=setTimeout(function(){b=0;c.videoJS&&(d=document.activeElement,c.closestParent(d,"#"+c.parentContainerId)?c.videoJS.userActive(a.call(c.videoJS)):
c.videoJS.userActive(!1))},2E3)),a.call(c.videoJS,!0)):a.call(c.videoJS,h)}b&&(clearTimeout(b),b=0)}}};d.prototype.closestParent=function(c,a){return c?c.closest(a):null};d.prototype.enableCurrentTextTrack=function(c){void 0===c&&(c="en");this.changeTextTrackMode(c,"showing");return this};d.prototype.disableCurrentTextTrack=function(c){void 0===c&&(c="en");this.changeTextTrackMode(c,"disabled");return this};d.prototype.muted=function(c){return this.videoJS.muted(c)};d.prototype.mute=function(c){this.videoJS.muted(!0,
c);return this};d.prototype.unmute=function(c){this.videoJS.muted(!1,c);return this};d.prototype.isMuted=function(){return this.videoJS.muted()};d.prototype.getCurrentTime=function(){return this.videoJS.currentTime()};d.prototype.setCurrentTime=function(c){this.videoJS.currentTime(c);return this};d.prototype.getMediaDuration=function(){return isNaN(this.videoJS.duration())?0:this.videoJS.duration()};d.prototype.pause=function(c){this.videoJS.pause(c);return this};d.prototype.resume=function(c){this.videoJS.play();
return this};d.prototype.seek=function(c){this.videoJS.currentTime(c);return this};d.prototype.stop=function(){this.videoJS.pause();this.currentAsset=t;return this};d.prototype.on=function(c,a){this.eventEmitter.on(c,a);this.videoJS.on(c,a);return this};d.prototype.off=function(c,a){return this};d.prototype.ready=function(c){this.videoJS.ready(c);return this};d.prototype.readyState=function(){return this.videoJS.readyState()};d.prototype.load=function(){this.videoJS.load();return this};d.prototype.getCurrent=
function(){return this.currentAsset};d.prototype.getPosition=function(){return this.videoJS.currentTime()};d.prototype.isPlaying=function(){return!this.videoJS.paused()};d.prototype.isPaused=function(){return this.videoJS.paused()};d.prototype.getVersion=function(){return"VJS"};d.prototype.destroy=function(){this.vseMetrics.publishBeforeDispose();this.videoJS.off("ended",this.eventHandlers.onPlaybackComplete);this.videoJS.dispose();this.videoJS=null;this.basicComponents!==t&&this.basicComponents.destroy()};
d.prototype.addChild=function(c,a){this.videoJS.addChild(c,a);return this};d.prototype.removeChild=function(c){this.videoJS.removeChild(c);return this};d.prototype.loadNextVideoPoster=function(c){this.videoJS.poster(c);this.videoJS.posterImage.show();return this};d.prototype.aspectRatio=function(c){this.videoJS.aspectRatio(c);return this};d.prototype.requestFullscreen=function(){this.videoJS.requestFullscreen();return this};d.prototype.exitFullscreen=function(){this.videoJS.exitFullscreen();return this};
d.prototype.isFullscreen=function(){return this.videoJS.isFullscreen()};d.prototype.fluid=function(c){this.videoJS.fluid(c);return this};d.prototype.blur=function(){this.videoJS.blur();return this};d.prototype.isCaptionOn=function(){var c=this.videoJS.remoteTextTracks();if(c)for(var a=0;a<c.length;a++)if("showing"===c[a].mode)return!0;if(c=this.videoJS.textTracks())for(a=0;a<c.length;a++)if("showing"===c[a].mode)return!0;return!1};d.prototype.isAutoplayed=function(){return this.videoJS.options()&&
this.videoJS.options().autoplay?this.videoJS.options().autoplay:!1};d.prototype.getTitleSessionId=function(){return this.vseMetrics.getTitleSessionId()};d.prototype.requestPictureInPicture=function(){this.videoJS.requestPictureInPicture();return this};d.prototype.exitPictureInPicture=function(){this.videoJS.exitPictureInPicture();return this};d.prototype.emitStartCountMetric=function(){this.vseMetrics.emitStartCountMetric();return this};d.prototype.emitScrubberClick=function(){this.vseMetrics.emitScrubberClick();
return this};d.prototype.emitSkipForwardClick=function(){this.vseMetrics.emitSkipForwardClick();return this};d.prototype.emitSkipBackwardClick=function(){this.vseMetrics.emitSkipBackwardClick();return this};d.prototype.setPlayerMode=function(c){this.vseMetrics.updatePlacementContext(c);return this};d.prototype.initHandlers=function(){var c=this;this.eventHandlers={onPlaybackComplete:function(){return c.player_onPlaybackComplete()},onPlaybackStart:function(){return c.player_onPlaybackStart()},onCancelContinuousPlay:function(){return c.player_onCancelContinuousPlay()},
onPlayUpNext:function(){return c.player_onPlayUpNext()}}};d.prototype.player_onPlaybackComplete=function(){var c=this.currentAsset;if(this.previousAsset=this.currentAsset)this.previousAsset.eventTimestamp=Date.now();this.eventEmitter.emit("playbackComplete",c)};d.prototype.player_onCancelContinuousPlay=function(){this.currentAsset=this.previousAsset;this.eventEmitter.emit("cancelContinuousPlay",this.previousAsset)};d.prototype.player_onPlayUpNext=function(){this.eventEmitter.emit("playUpNext",this.previousAsset)};
d.prototype.player_onPlaybackStart=function(){this.currentAsset&&(this.currentAsset.eventTimestamp=Date.now());this.eventEmitter.emit("playbackStart",this.currentAsset)};d.prototype.isDPXDesktopFullScreenRequest=function(c){return this.config.sushiMetricsConfig&&this.config.sushiMetricsConfig.placementContext&&-1!==this.config.sushiMetricsConfig.placementContext.indexOf("desktop_web.ImageBlock")&&c&&!c.hasOwnProperty("refTag")&&this.currentAsset&&c.contentId!==this.currentAsset.contentId};d.prototype.changeTextTrackMode=
function(c,a){var b=this.videoJS.remoteTextTracks();if(b)for(var h=0;h<b.length;h++){var d=b[h];"subtitles"===d.kind&&d.language===c&&(d.mode=a)}if(b=this.videoJS.textTracks())for(h=0;h<b.length;h++)d=b[h],"subtitles"===d.kind&&d.language===c&&(d.mode=a)};d.prototype.getTextTrackMode=function(c){var a=this.videoJS.remoteTextTracks();if(a)for(var b=0;b<a.length;b++){var h=a[b];if("subtitles"===h.kind&&h.language===c)return h.mode}if(a=this.videoJS.textTracks())for(b=0;b<a.length;b++)if(h=a[b],"subtitles"===
h.kind&&h.language===c)return h.mode;return"disabled"};d.prototype.removeCurrentTextTracks=function(){var c=this.videoJS.remoteTextTracks();if(c)for(var a=0;a<c.length;a++)this.videoJS.removeRemoteTextTrack(c[a])};d.prototype.getDefaultLanguageForPlayer=function(){return this.config.languageCode?this.config.languageCode.toString():"en"};d.prototype.setAriaLabels=function(c,a){var b=c.controlBar;if(b)for(c=0,b=b.children();c<b.length;c++){var h=b[c].el();if(h.classList.contains("vjs-progress-control")){var d=
h.querySelector(".vjs-slider");d.title=d.ariaLabel}else"button"===h.tagName.toLowerCase()?h.title&&h.setAttribute("aria-label",h.title):(d=h.querySelector("button"),h=h.querySelector(".vjs-control-text"),d&&h&&d.setAttribute("aria-label",h.innerText))}(a=a.querySelector(".vjs-volume-bar.vjs-slider-bar"))&&a.setAttribute("title",this.getLocalizedString("Volume Level"))};d.prototype.testLocalStorage=function(){try{return k.localStorage.setItem("foo","bar"),k.localStorage.removeItem("foo"),!0}catch(c){return!1}};
d.prototype.getLocalizedString=function(c){return this.videoJS.localize(c)};d.prototype.createAltTextElement=function(c){var a=this,b=document.createElement("div");b.id="altText-"+c;b.className="ive-alttext-container";b.setAttribute("tabindex","0");b.setAttribute("role","description");b.onclick=function(){a.videoJS.paused()?a.videoJS.play():a.videoJS.pause()};b.onkeydown=function(b){if("Enter"===b.key||" "===b.key)b.preventDefault(),a.videoJS.paused()?a.videoJS.play():a.videoJS.pause()};return b};
return d}(),Y=function(){function d(c,a){var b=this;this.libs=a;this.commands=[];c.then(function(a){b.playerInstance=a;b.executeCommands()})}d.prototype.executeCommands=function(){for(var c=0;c<this.commands.length;c++)if(this.playerInstance)this.commands[c](this.playerInstance)};d.prototype.play=function(c){var a=this;this.playerInstance?this._play(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._play(c,b[0])});return this};
d.prototype.mute=function(c){var a=this;this.playerInstance?this._mute(this.playerInstance,c):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._mute(b[0],c)});return this};d.prototype.unmute=function(){var c=this;this.playerInstance?this._unmute(this.playerInstance):this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c._unmute(a[0])});return this};d.prototype.isMuted=function(){var c=this;if(this.playerInstance)return this._isMuted(this.playerInstance);
this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c._isMuted(a[0])});return!0};d.prototype.emitStartCountMetric=function(){this.playerInstance&&this._emitStartCountMetric(this.playerInstance);return this};d.prototype.emitSkipForwardClick=function(){this.playerInstance&&this._emitSkipForwardClick(this.playerInstance);return this};d.prototype.emitSkipBackwardClick=function(){this.playerInstance&&this._emitSkipBackwardClick(this.playerInstance);return this};
d.prototype.emitScrubberClick=function(){this.playerInstance&&this._emitScrubberClick(this.playerInstance);return this};d.prototype.getCurrentTime=function(){var c=this;if(this.playerInstance)return this._getCurrentTime(this.playerInstance);this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c._getCurrentTime(a[0])});return 0};d.prototype.setCurrentTime=function(c){var a=this;this.playerInstance?this._setCurrentTime(c,this.playerInstance):this.commands.push(function(){for(var b=
[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._setCurrentTime(c,b[0])})};d.prototype.getMediaDuration=function(){var c=this;if(this.playerInstance)return this._getMediaDuration(this.playerInstance);this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c._getMediaDuration(a[0])});return 0};d.prototype.pause=function(c){var a=this;this.playerInstance?this._pause(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=
arguments[h];return a._pause(c,b[0])});return this};d.prototype.resume=function(c){var a=this;this.playerInstance?this._resume(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._resume(c,b[0])});return this};d.prototype.stop=function(){var c=this;this.playerInstance?this._stop(this.playerInstance):this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c._stop(a[0])});return this};d.prototype.seek=
function(c){var a=this;this.playerInstance?this._seek(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._seek(c,b[0])});return this};d.prototype.on=function(c,a){var b=this;this.playerInstance?this._on(c,a,this.playerInstance):this.commands.push(function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];return b._on(c,a,h[0])});return this};d.prototype.off=function(c,a){var b=this;this.playerInstance?this._off(c,a,this.playerInstance):
this.commands.push(function(){for(var h=[],d=0;d<arguments.length;d++)h[d]=arguments[d];return b._off(c,a,h[0])});return this};d.prototype.ready=function(c){var a=this;this.playerInstance?this._ready(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._ready(c,b[0])});return this};d.prototype.load=function(){var c=this;this.playerInstance?this._load(this.playerInstance):this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=
arguments[b];return c._load(a[0])});return this};d.prototype.readyState=function(){return this.playerInstance?this.playerInstance.readyState():0};d.prototype.aspectRatio=function(c){var a=this;this.playerInstance?this._aspectRatio(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._aspectRatio(c,b[0])});return this};d.prototype.getCurrent=function(){if(this.playerInstance)return this.playerInstance.getCurrent()};d.prototype.getPosition=
function(){return this.playerInstance?this.playerInstance.getPosition():0};d.prototype.isPlaying=function(){return this.playerInstance?this.playerInstance.isPlaying():!1};d.prototype.isPaused=function(){return this.playerInstance?this.playerInstance.isPaused():!1};d.prototype.getVersion=function(){return this.playerInstance?this.playerInstance.getVersion():""};d.prototype.destroy=function(){var c=this;this.playerInstance?this._destroy(this.playerInstance):this.commands.push(function(){for(var a=[],
b=0;b<arguments.length;b++)a[b]=arguments[b];return c._destroy(a[0])})};d.prototype.addChild=function(c,a){this.playerInstance&&this.playerInstance.addChild(c,a);return this};d.prototype.removeChild=function(c){this.playerInstance&&this.playerInstance.removeChild(c);return this};d.prototype.loadNextVideoPoster=function(c){this.playerInstance&&this.playerInstance.loadNextVideoPoster(c);return this};d.prototype.setInitialData=function(c){this.playerInstance&&this.playerInstance.setInitialData(c);return this};
d.prototype.updateTextTrack=function(c){this.playerInstance&&this.playerInstance.updateTextTrack(c);return this};d.prototype.removeCurrentTextTracks=function(){this.playerInstance&&this.playerInstance.removeCurrentTextTracks();return this};d.prototype.showPoster=function(c){this.playerInstance&&this.playerInstance.showPoster(c);return this};d.prototype.blur=function(){this.playerInstance&&this.playerInstance.blur();return this};d.prototype.requestFullscreen=function(){var c=this;this.playerInstance?
this._requestFullscreen(this.playerInstance):this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];return c._requestFullscreen(a[0])});return this};d.prototype.exitFullscreen=function(){this.playerInstance&&this.playerInstance.exitFullscreen();return this};d.prototype.isFullscreen=function(){return this.playerInstance?this.playerInstance.isFullscreen():!1};d.prototype.fluid=function(c){this.playerInstance&&this.playerInstance.fluid(c);return this};d.prototype.enableCurrentTextTrack=
function(c){void 0===c&&(c="en");this.playerInstance&&this.playerInstance.enableCurrentTextTrack(c)};d.prototype.disableCurrentTextTrack=function(c){void 0===c&&(c="en");this.playerInstance&&this.playerInstance.disableCurrentTextTrack(c)};d.prototype.isCaptionOn=function(){return this.playerInstance?this.playerInstance.isCaptionOn():!1};d.prototype.isAutoplayed=function(){return this.playerInstance?this.playerInstance.isAutoplayed():!1};d.prototype.getTitleSessionId=function(){return this.playerInstance?
this.playerInstance.getTitleSessionId():""};d.prototype.requestPictureInPicture=function(){var c=this;this.playerInstance?this._requestPictureInPicture(this.playerInstance):this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c._requestPictureInPicture(a[0])});return this};d.prototype.exitPictureInPicture=function(){var c=this;this.playerInstance?this._exitPictureInPicture(this.playerInstance):this.commands.push(function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=
arguments[b];c._exitPictureInPicture(a[0])});return this};d.prototype.setPlayerMode=function(c){var a=this;this.playerInstance?this._setPlayerMode(c,this.playerInstance):this.commands.push(function(){for(var b=[],h=0;h<arguments.length;h++)b[h]=arguments[h];return a._setPlayerMode(c,b[0])});return this};d.prototype._setPlayerMode=function(c,a){a.setPlayerMode(c)};d.prototype._play=function(c,a){c?a.play(c):a.play()};d.prototype._mute=function(c,a){c.mute(a)};d.prototype._unmute=function(c){c.unmute()};
d.prototype._emitStartCountMetric=function(c){c.emitStartCountMetric()};d.prototype._emitScrubberClick=function(c){c.emitScrubberClick()};d.prototype._emitSkipForwardClick=function(c){c.emitSkipForwardClick()};d.prototype._emitSkipBackwardClick=function(c){c.emitSkipBackwardClick()};d.prototype._isMuted=function(c){return c.isMuted()};d.prototype._getCurrentTime=function(c){return c.getCurrentTime()};d.prototype._setCurrentTime=function(c,a){a.setCurrentTime(c)};d.prototype._getMediaDuration=function(c){return c.getMediaDuration()};
d.prototype._pause=function(c,a){a.pause(c)};d.prototype._stop=function(c){c.stop()};d.prototype._requestFullscreen=function(c){c.requestFullscreen()};d.prototype._resume=function(c,a){a.resume(c)};d.prototype._seek=function(c,a){a.seek(c)};d.prototype._on=function(c,a,b){b.on(c,a)};d.prototype._off=function(c,a,b){b.off(c,a)};d.prototype._ready=function(c,a){a.ready(c)};d.prototype._load=function(c){c.load()};d.prototype._destroy=function(c){c.destroy();this.playerInstance=null};d.prototype._aspectRatio=
function(c,a){a.aspectRatio(c)};d.prototype._requestPictureInPicture=function(c){c.requestPictureInPicture()};d.prototype._exitPictureInPicture=function(c){c.exitPictureInPicture()};return d}(),wa=function(){function d(){}d.prototype.create=function(c,a,b){b=b?b:c.initialVideo;a={contentId:""+b.contentId,customerId:c.customerId,isForesterTrackingDisabled:c.sushiMetricsConfig.isRobot,foresterMetadataParams:{client:c.requestMetadata.clientId,marketplaceId:c.requestMetadata.marketplaceId,method:c.requestMetadata.method,
requestId:c.requestMetadata.requestId,session:c.requestMetadata.sessionId},videoUrl:b.videoUrl,posterSource:b.imageUrl,pageAsin:c.requestMetadata.pageAsin,parentId:a,vendorCode:b.vendorCode,videoTitle:b.videoTitle,shouldStartMuted:c.shouldStartMuted||!1,shouldAutoplay:c.shouldAutoplay||!1,shouldPreload:"undefined"===typeof c.shouldPreload?!0:c.shouldPreload,shouldOverrideBackground:c.shouldOverrideBackground||!1,useAutoplayFallback:c.useAutoplayFallback,shouldDisableControls:c.shouldDisableControls||
!1,useCarousel:c.useCarousel,useBuyBox:c.useBuyBox,languagePreferenceStrings:c.languagePreferenceStrings,metricsEmissionMethod:c.metricsEmissionMethod,enableClickBasedAttribution:c.enableClickBasedAttribution,sushiMetricsConfig:{eventSource:c.sushiMetricsConfig.eventSource,endpoint:c.sushiMetricsConfig.endpoint,requestId:c.sushiMetricsConfig.requestId,sessionId:c.sushiMetricsConfig.sessionId,customerId:c.sushiMetricsConfig.customerId,refMarkers:c.sushiMetricsConfig.refMarkers,sessionType:c.sushiMetricsConfig.sessionType,
placementContext:c.sushiMetricsConfig.placementContext,marketplaceId:c.sushiMetricsConfig.marketplaceId,weblabIds:c.sushiMetricsConfig.weblabIds,pageAsin:c.sushiMetricsConfig.pageAsin,isInternal:c.sushiMetricsConfig.isInternal,isRobot:c.sushiMetricsConfig.isRobot,clientId:c.sushiMetricsConfig.clientId,creativeId:c.sushiMetricsConfig.creativeId||""},refTag:c.refTag,ospData:{ospTrackingLink:b.ospTrackingLink,vendorTrackingId:b.vendorTrackingId,videoReferenceId:b.videoReferenceId,productAsin:b.productAsin},
useUpNextComponent:c.useUpNextComponent,isVideoImmersivePlayer:c.isVideoImmersivePlayer,ospLinkCode:c.ospLinkCode,clientPrefix:c.clientPrefix,languageCode:c.languageCode,isChromelessPlayer:c.isChromelessPlayer,enableDelphiAttribution:c.enableDelphiAttribution,aciContentId:b.aciContentId,mimeType:b.mimeType,isReactFactory:c.isReactFactory,version:c.version,shouldLoop:c.shouldLoop||!1,skipInitialFocus:c.skipInitialFocus||!1,enableInactiveFocus:!1!==c.enableInactiveFocus,closedCaptionsConfig:c.closedCaptionsConfig,
languageLocalization:c.languageLocalization,alwaysSetInitialVideo:c.alwaysSetInitialVideo,showPosterImage:c.showPosterImage,allowCrossOrigin:c.allowCrossOrigin,enableDynamicBlur:c.enableDynamicBlur};c.eventTimestamp&&(a.eventTimestamp=c.eventTimestamp);c.nexusMetricsConfig&&(a.nexusMetricsConfig={eventSource:c.nexusMetricsConfig.eventSource,isInternal:c.nexusMetricsConfig.isInternal,playerTSMMetricsSchemaId:c.nexusMetricsConfig.playerTSMMetricsSchemaId,widgetMetricsSchemaId:c.nexusMetricsConfig.widgetMetricsSchemaId,
producerId:c.nexusMetricsConfig.producerId,refMarkers:c.nexusMetricsConfig.refMarkers,placementContext:c.nexusMetricsConfig.placementContext,weblabIds:c.nexusMetricsConfig.weblabIds,pageAsin:c.nexusMetricsConfig.pageAsin,clientId:c.nexusMetricsConfig.clientId,creativeId:c.nexusMetricsConfig.creativeId,videoAsin:c.nexusMetricsConfig.videoAsin,videoAsinList:c.nexusMetricsConfig.videoAsinList});c.clickstreamNexusMetricsConfig&&(a.clickstreamNexusMetricsConfig={actionType:c.clickstreamNexusMetricsConfig.actionType,
eventOwner:c.clickstreamNexusMetricsConfig.eventOwner,eventType:c.clickstreamNexusMetricsConfig.eventType,productId:c.clickstreamNexusMetricsConfig.productId,producerId:c.clickstreamNexusMetricsConfig.producerId,schemaId:c.clickstreamNexusMetricsConfig.schemaId});c.feedbackFactory&&(a.feedbackFactory=c.feedbackFactory,a.reportPageStateName=c.reportPageStateName);c.includeEarnsComissionDisclosure&&(a.includeEarnsComissionDisclosure=c.includeEarnsComissionDisclosure);return a};return d}(),Z=function(){function d(c){this.deps=
c}d.prototype.create=function(c){var a=this,b=L(),h=new this.deps.promise(function(a,h){k[b]={resolve:a,reject:h}});v.when("brila").execute("construct-player",function(a){k[b].resolve(a)});var d=document.getElementById(c.containerId),e=c.containerId+"-container";d.innerHTML='\x3cdiv id\x3d"'+e+'" style\x3d"width:100%; height:100%"\x3e\x3c/div\x3e';d=(new this.deps.promise(function(b,d){h.then(function(h){var d=new X(h,(new wa).create(c,e),c.initialVideo,a.deps);d.on("playerLoaded",function(){b(d)})})})).then(function(a){return a});
return new W(new Y(d,this.deps),document.getElementById(e),this.deps)};return d}(),O=function(d,c){return c={exports:{}},d(c,c.exports),c.exports}(function(d){function c(){}function a(a,b,h){this.fn=a;this.context=b;this.once=h||!1}function b(){this._events=new c;this._eventsCount=0}var h=Object.prototype.hasOwnProperty,e="~";Object.create&&(c.prototype=Object.create(null),(new c).__proto__||(e=!1));b.prototype.eventNames=function(){var a=[],b,c;if(0===this._eventsCount)return a;for(c in b=this._events)h.call(b,
c)&&a.push(e?c.slice(1):c);return Object.getOwnPropertySymbols?a.concat(Object.getOwnPropertySymbols(b)):a};b.prototype.listeners=function(a,b){a=this._events[e?e+a:a];if(b)return!!a;if(!a)return[];if(a.fn)return[a.fn];b=0;for(var h=a.length,c=Array(h);b<h;b++)c[b]=a[b].fn;return c};b.prototype.emit=function(a,b,h,c,d,x){var p=e?e+a:a;if(!this._events[p])return!1;var p=this._events[p],F=arguments.length,m,k;if(p.fn){p.once&&this.removeListener(a,p.fn,t,!0);switch(F){case 1:return p.fn.call(p.context),
!0;case 2:return p.fn.call(p.context,b),!0;case 3:return p.fn.call(p.context,b,h),!0;case 4:return p.fn.call(p.context,b,h,c),!0;case 5:return p.fn.call(p.context,b,h,c,d),!0;case 6:return p.fn.call(p.context,b,h,c,d,x),!0}k=1;for(m=Array(F-1);k<F;k++)m[k-1]=arguments[k];p.fn.apply(p.context,m)}else{var n=p.length,r;for(k=0;k<n;k++)switch(p[k].once&&this.removeListener(a,p[k].fn,t,!0),F){case 1:p[k].fn.call(p[k].context);break;case 2:p[k].fn.call(p[k].context,b);break;case 3:p[k].fn.call(p[k].context,
b,h);break;case 4:p[k].fn.call(p[k].context,b,h,c);break;default:if(!m)for(r=1,m=Array(F-1);r<F;r++)m[r-1]=arguments[r];p[k].fn.apply(p[k].context,m)}}return!0};b.prototype.on=function(b,h,c){h=new a(h,c||this);b=e?e+b:b;this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],h]:this._events[b].push(h):(this._events[b]=h,this._eventsCount++);return this};b.prototype.once=function(b,h,c){h=new a(h,c||this,!0);b=e?e+b:b;this._events[b]?this._events[b].fn?this._events[b]=[this._events[b],
h]:this._events[b].push(h):(this._events[b]=h,this._eventsCount++);return this};b.prototype.removeListener=function(a,b,h,d){a=e?e+a:a;if(!this._events[a])return this;if(!b)return 0===--this._eventsCount?this._events=new c:delete this._events[a],this;var f=this._events[a];if(f.fn)f.fn!==b||d&&!f.once||h&&f.context!==h||(0===--this._eventsCount?this._events=new c:delete this._events[a]);else{for(var x=0,p=[],F=f.length;x<F;x++)(f[x].fn!==b||d&&!f[x].once||h&&f[x].context!==h)&&p.push(f[x]);p.length?
this._events[a]=1===p.length?p[0]:p:0===--this._eventsCount?this._events=new c:delete this._events[a]}return this};b.prototype.removeAllListeners=function(a){a?(a=e?e+a:a,this._events[a]&&(0===--this._eventsCount?this._events=new c:delete this._events[a])):(this._events=new c,this._eventsCount=0);return this};b.prototype.off=b.prototype.removeListener;b.prototype.addListener=b.prototype.on;b.prototype.setMaxListeners=function(){return this};b.prefixed=e;b.EventEmitter=b;"undefined"!==typeof d&&(d.exports=
b)}).EventEmitter,aa=t,ba=t;v.when("a-sheet").execute(function(d){aa=d});v.when("a-popover").execute(function(d){ba=d});var ca={getBottomSheet:function(){return aa},getPopoverFactory:function(){return ba}},xa=function(){function d(c,a){var b=this;this.config=c;this._showMoreMenuExperience=a;this.activeVideoSource=this.activeVideo="VIDEO_NOT_SELECTED";this.reportURL="";this.activeVideoACI="VIDEO_NOT_SELECTED";this.ivxReportCloseIconClass="ivx-report-close";this.ivxAmazonAppClass="ivx-amazon-app";this.reportCloseIconSelector=
".a-sheet-close";this.showMoreMenuExperience=this.registered=!1;this.getTokensSuccessCallback=function(a){a.slate&&(b.slateToken=a.slate);a.csrf&&(b.csrfToken=a.csrf);b.callFeedbackLambdaOrCastVoteReportAapi()};this.getTokensErrorCallback=function(a,c){(0===a.http.status||500<=a.http.status&&600>a.http.status)&&0<c?b.getTokensAndSubmit(c-1):b.callFeedbackLambdaOrCastVoteReportAapi()};this.getTokensAndSubmit=function(a){void 0===a&&(a=3);var c=b.shouldCallCastVoteReportAapi()?["csrf"]:["slate"];C.sendRequest(b.A,
d.GET_AUTH_TOKEN_ENDPOINT,c,b.getTokensSuccessCallback,function(c){return b.getTokensErrorCallback(c,a)})};this._submitErrorCallback=function(a){b.A.trigger("vse:"+b.id+":feedback:submitted:error")};this._submitSuccessCallback=function(a){b.A.trigger("vse:"+b.id+":feedback:submitted:success")};this.A=c.A;this.pageStateName=c.pageStateName;this.buttonApi=c.buttonApi;this.id=this.config.id;this.showMoreMenuExperience=this._showMoreMenuExperience;c=D.fetchLatestPageState(this.A,this.pageStateName);this.moreMenuSheet=
this.A.$("#"+this.id+"-more-menu");this.feedbackForm=this.A.$("#"+this.id+"-form");this.thankYouSection=this.A.$("#"+this.id+"-ty-container");this.InfringementNotSupportSection=this.A.$("#"+this.id+"-infringement-container");this.submitButton=this.buttonApi("#"+this.id+"-btn-submit");this.reportIllegalContentLinkSelector=this.A.$(".vse-fb-report-illegal-content");this.feedbackContainerSelector=this.A.$("#"+this.id);c&&this.validateFormElements()&&(this.isMobile=c.isMobile,this.endpoint=c.feedbackEndpoint,
this.marketplaceId=c.marketplaceId,this.pageAsin=c.pageAsin,this.customerId=c.customerId,this.slateToken=c.slateToken,this.bottomSheetFactory=ca.getBottomSheet(),this.popoverFactory=ca.getPopoverFactory(),this.aapiEndpoint=c.amazonApiEndpoint,this.language=c.language,this.registered||(this.A.declarative(this.id+"-btn-close","click",function(){return b.closeFeedbackForm()}),this.A.declarative(this.id+"-btn-submit","click",function(){return b.submitFeedback()}),this.showMoreMenuExperience&&this.A.declarative(this.id+
"-report-btn","click",function(){return b.moreMenuToFeedbackForm()}),this.A.on("a:sheet:afterShow:"+this.id+"-sheet",function(a){b.showFeedbackForm?(b.A.trigger("vse:"+b.id+":feedback:shown"),b.updateBottomSheetHeight(),b.A.capabilities.isAmazonApp&&b.isMobile&&a.sheet.$container.addClass(b.ivxAmazonAppClass),a.sheet.$contentContainer.siblings(b.reportCloseIconSelector).addClass(b.ivxReportCloseIconClass)):(b.showFeedbackForm(),b.updateBottomSheetHeight())}),this.A.on("a:sheet:afterHide:"+this.id+
"-sheet",function(a){b.showMoreMenuExperience?(b.feedbackForm.addClass("aok-hidden").fadeIn(10),b.hideThankYou(),b.hideInfringementNotSupport(),b.resetMoreMenuSheet(),b.showMoreMenuSheet()):(b.hideThankYou(),b.hideInfringementNotSupport());b.A.capabilities.isAmazonApp&&b.isMobile&&a.sheet.$container.removeClass(b.ivxAmazonAppClass);a.sheet.$contentContainer.siblings(b.reportCloseIconSelector).removeClass(b.ivxReportCloseIconClass);b.A.trigger("vse:"+b.id+":feedback:hidden")}),this.A.on("a:popover:afterShow:"+
this.id+"-popover",function(a){b.showFeedbackForm()}),this.A.on("a:popover:afterHide:"+this.id+"-popover",function(a){b.hideFeedbackForm()}),this.registered=!0))}d.prototype.resetMoreMenuSheet=function(){this.showMoreMenuExperience&&this.updateBottomSheetHeight(1)};d.prototype.moreMenuToFeedbackForm=function(){this.moreMenuSheet.addClass("aok-hidden").fadeOut(10);this.showFeedbackForm();this.updateBottomSheetHeight();return this};d.prototype.showMoreMenuSheet=function(){this.moreMenuSheet.removeClass("aok-hidden").fadeIn(400)};
d.prototype.showFeedbackForm=function(c){this.hideThankYou();this.showMoreMenuExperience&&this.feedbackForm.removeClass("aok-hidden").fadeIn(400);this.A.trigger("vse:"+this.id+":feedback:shown");return this};d.prototype.hideFeedbackForm=function(){this.isMobile?this.getAndSetBottomSheetInstance()&&(this.bottomSheetInstance.hide(),this.resetMoreMenuSheet()):this.getAndSetPopoverInstance()&&this.popoverInstance.hide();this.A.trigger("vse:"+this.id+":feedback:hidden");return this};d.prototype.setActiveVideoAndSource=
function(c,a,b,h){this.activeVideo=c;this.activeVideoSource=a;this.activeVideoACI="amzn1.vse.video."+c;h&&(this.reportURL=h)};d.prototype.submitFeedback=function(){this.getTokensAndSubmit();this.A.trigger("vse:"+this.id+":feedback:submitted");this.showThankYou();this.updateBottomSheetHeight(this.thankYouSection.scrollHeight+this.getFeedbackFormVerticalPadding())};d.prototype.shouldCallCastVoteReportAapi=function(){return!!this.reportURL&&0<this.reportURL.trim().length};d.prototype.callFeedbackLambdaOrCastVoteReportAapi=
function(){var c=this.shouldCallCastVoteReportAapi()?this.createCastVoteReportRequest():this.createLwisRequest();this.A.$.ajax(c)};d.prototype.getFeedbackFormVerticalPadding=function(){var c=parseInt(this.feedbackContainerSelector.css("padding-top"),10),a=parseInt(this.feedbackContainerSelector.css("padding-bottom"),10);return c+a};d.prototype.createLwisPayload=function(){return{videoId:this.activeVideo,customerId:this.customerId,marketplaceId:this.marketplaceId,slateToken:this.slateToken}};d.prototype.createCastVoteReportRequest=
function(){var c=document.querySelector('meta[name\x3d"encrypted-slate-token"]'),c=c instanceof HTMLMetaElement?c.content:"";return{url:this.aapiEndpoint+this.reportURL,data:JSON.stringify({}),type:"POST",crossDomain:!0,headers:{"Accept-Language":this.language,Accept:'application/vnd.com.amazon.api+json; type\x3d"sharedcontents.cast-vote/v1"',"x-api-csrf-token":this.csrfToken,"x-amzn-encrypted-slate-token":c,"Content-Type":'application/vnd.com.amazon.api+json; type\x3d"sharedcontents.cast-vote.request/v1"'},
xhrFields:{withCredentials:!0},error:this._submitErrorCallback,success:this._submitSuccessCallback}};d.prototype.createLwisRequest=function(){return{url:this.endpoint,data:JSON.stringify(this.createLwisPayload()),type:"POST",contentType:"application/json; charset\x3dutf-8",crossDomain:!0,headers:{Authorization:"allow","X-Amzn-Slate-Token":this.slateToken},error:this._submitErrorCallback,success:this._submitSuccessCallback}};d.prototype.closeFeedbackForm=function(){this.hideFeedbackForm();this.A.trigger("vse:"+
this.id+":feedback:closed")};d.prototype.updateReportIllegalContentLink=function(){var c=encodeURIComponent(""+k.location.origin+k.location.pathname);this.reportIllegalContentLinkSelector.attr("href",k.location.origin+"/manage-content/report/illegal?mediaAci\x3d"+this.activeVideoACI+"\x26referer\x3d"+c)};d.prototype.showInfringementNotSupport=function(){this.feedbackForm.fadeOut(200);this.InfringementNotSupportSection.removeClass("aok-hidden").fadeIn(400);this.updateBottomSheetHeight(this.InfringementNotSupportSection.height()+
this.getFeedbackFormVerticalPadding());return this};d.prototype.hideInfringementNotSupport=function(){this.feedbackForm.fadeIn(10);this.InfringementNotSupportSection.addClass("aok-hidden").fadeOut(10);return this};d.prototype.showThankYou=function(){var c=this;this.feedbackForm.fadeOut(200,function(){c.thankYouSection.removeClass("aok-hidden").fadeIn(400);c.A.trigger("vse:"+c.id+":thank-you:shown")});return this};d.prototype.hideThankYou=function(){this.feedbackForm.fadeIn(10);this.thankYouSection.addClass("aok-hidden").fadeOut(10);
this.A.trigger("vse:"+this.id+":thank-you:hidden");return this};d.prototype.validateFormElements=function(){return this.thankYouSection.length&&this.submitButton.size()&&this.feedbackForm.length};d.prototype.getAndSetBottomSheetInstance=function(){return this.bottomSheetFactory?this.bottomSheetInstance?this.bottomSheetInstance:this.bottomSheetInstance=this.bottomSheetFactory.get(this.id+"-sheet"):t};d.prototype.getAndSetPopoverInstance=function(){return this.popoverFactory?this.popoverInstance?this.popoverInstance:
this.popoverInstance=this.popoverFactory.get(this.id+"-popover"):t};d.prototype.updateBottomSheetHeight=function(c){c=c||this.feedbackContainerSelector.outerHeight();this.isMobile&&this.getAndSetBottomSheetInstance()&&this.bottomSheetInstance.changeHeight({height:c,duration:.1})};d.GET_AUTH_TOKEN_ENDPOINT="/vap/ew/auth/token/batch";return d}(),ya=function(){function d(c){this.config=c;this.feedbackWidgets={}}d.prototype.create=function(c,a,b){void 0===b&&(b=!1);a=this.feedbackWidgets[c]||new xa({id:c,
pageStateName:a,A:this.config.A,buttonApi:this.config.buttonApi},b);return this.feedbackWidgets[c]=a};d.prototype.get=function(c){return this.feedbackWidgets[c]};return d}(),n=function(){function d(){}d.POSITIVE_VOTE="positive";d.NEGATIVE_VOTE="negative";d.NONE_VOTE="none";d.VOTE_STATUS="status";d.EMPTY_STRING="";d.DEFAULT_MIN_GUTTER=24;d.DEFAULT_HEIGHT_ANIMATION_SPEED=200;d.CAROUSEL_PREV_BUTTON_CLASS=".a-carousel-goto-prevpage";d.CAROUSEL_NEXT_BUTTON_CLASS=".a-carousel-goto-nextpage";d.VSE_CAROUSEL_PAGINATION_DEACTIVATE_CLASSHIDDEN_CLASS=
"aok-hidden";d.VSE_CAROUSEL_PAGINATION_DEACTIVATE_CLASS="vse-carousel-goto-deactive-btn";d.ANIMATION_SPEED_400=400;d.ANIMATION_SPEED_100=100;d.BOUNCE_CAROUSEL_FACTOR=30;d.BOUNCE_SCROLL_BAR_FACTOR=6;d.SWING="swing";d.FIRST_PAGE="first-page";d.LAST_PAGE="last-page";d.$GROUP_1=".segment-title-G1";d.$GROUP_2=".segment-title-G2";d.$GROUP_3=".segment-title-G3";d.$GROUP_EXPVERNAC=".segment-title-EXPVERNAC";d.NO_GUTTER=0;d.TOLERANT=-.5;d.CURRENT_GUTTER="currentGutter";d.NUMBER_OF_CARDS_TO_LOAD_ADDITIONALLY=
1;d.VIP_CAROUSEL_CSS_CLASS="vse-vip-lb-carousel";return d}(),P=function(){function d(c,a){this.element=c;this.videoVoteConfig=a;this.countsFetched=!1;this.positiveVoteCount=0;this.showPositiveVotes=!1;this.negativeVoteCount=0;this.showNegativeVotes=!1;this.prompt=c.find(".vse-vote-helpful-text");this.positiveVoteText=c.find(".vse-vote-positive");this.positiveVoteIcon=c.find(".vse-vote-positive-icon");this.negativeVoteText=c.find(".vse-vote-negative");this.negativeVoteIcon=c.find(".vse-vote-negative-icon");
this.previousVote=n.EMPTY_STRING}d.prototype.getVoteCount=function(c){return c===n.POSITIVE_VOTE?this.positiveVoteCount:c===n.NEGATIVE_VOTE?this.negativeVoteCount:0};d.prototype.setVoteCount=function(c,a){0>a&&(a=0);c===n.POSITIVE_VOTE?(this.positiveVoteCount=a,this.positiveVoteText.html(String(a))):c===n.NEGATIVE_VOTE&&(this.negativeVoteCount=a,this.negativeVoteText.html(String(a)));this.element.addClass("updated")};d.prototype.getPreviousVote=function(){return this.previousVote};d.prototype.setPreviousVote=
function(c){var a=this;if(c===n.POSITIVE_VOTE)this.positiveVoteIcon.addClass("hasvoted"),this.negativeVoteIcon.removeClass("hasvoted"),0>=this.getVoteCount(n.POSITIVE_VOTE)&&this.setVoteCount(n.POSITIVE_VOTE,1),setTimeout(function(){a.positiveVoteIcon.attr("aria-label","Click to remove your vote. Total vote count: "+a.getVoteCount(n.POSITIVE_VOTE))},100);else if(c===n.NEGATIVE_VOTE)this.negativeVoteIcon.addClass("hasvoted"),this.positiveVoteIcon.removeClass("hasvoted"),0>=this.getVoteCount(n.NEGATIVE_VOTE)&&
this.setVoteCount(n.NEGATIVE_VOTE,1);else if(c===n.NONE_VOTE)this.negativeVoteIcon.removeClass("hasvoted"),this.positiveVoteIcon.removeClass("hasvoted"),setTimeout(function(){a.positiveVoteIcon.attr("aria-label","Click to vote positive. Total vote count: "+a.getVoteCount(n.POSITIVE_VOTE))},100);else return;this.previousVote=c};d.prototype.setContentId=function(c){this.contentId=c};d.prototype.getContentId=function(){return this.contentId};d.prototype.showOrHide=function(c,a,b,h){this.showPositiveVotes=
c;this.showNegativeVotes=a;this.showPrompt=b;c?(this.positiveVoteText.addClass("vse-show"),this.positiveVoteIcon.addClass("vse-show")):(this.positiveVoteText.removeClass("vse-show"),this.positiveVoteIcon.removeClass("vse-show"));a?(this.negativeVoteText.addClass("vse-show"),this.negativeVoteIcon.addClass("vse-show")):(this.negativeVoteText.removeClass("vse-show"),this.negativeVoteIcon.removeClass("vse-show"));b?this.prompt.addClass("vse-show"):this.prompt.removeClass("vse-show");h?this.element.addClass("vse-show"):
this.element.removeClass("vse-show")};d.prototype.updateWithNewVote=function(c){if(c===n.POSITIVE_VOTE||c===n.NEGATIVE_VOTE){var a=c==n.POSITIVE_VOTE?n.NEGATIVE_VOTE:n.POSITIVE_VOTE,b=this.getVoteCount(c),h=this.getVoteCount(a);c===this.getPreviousVote()?(this.setPreviousVote(n.NONE_VOTE),this.setVoteCount(c,b-1)):this.getPreviousVote()!==n.EMPTY_STRING&&this.getPreviousVote()!==n.NONE_VOTE?(this.setVoteCount(a,h-1),this.setVoteCount(c,b+1),this.setPreviousVote(c)):(this.setPreviousVote(c),this.setVoteCount(c,
b+1))}};return d}(),za=function(){return function(d,c,a){this.contentId=d;this.positiveVoteCount=c;this.negativeVoteCount=a}}(),Aa=function(){return function(d,c,a){this.contentId=d;this.positiveVoteCount=c;this.voteStatus=a}}(),Q=function(){function d(c,a){this.A=c;this.videoVoteConfig=a}d.prototype.createFromContent=function(c,a){c=this.A.$("#"+c).find('[.vse-video-votes][data-contentid\x3d"'+a+'"]');return new P(c,this.videoVoteConfig)};d.prototype.createFromSelector=function(c){var a=this.A.$(""+
c);if(!a)throw new K("VideoVoteContainerFactory can not find selector by the name of "+c+".");return new P(a,this.videoVoteConfig)};d.prototype.sendVoteToRemote=function(c,a,b){var h=this,d=this.getBasicPayload(this.videoVoteConfig),e=this.A.$.extend(d,{contentId:b,positive:c,negative:a});return new this.videoVoteConfig.dependencies.promise(function(a,b){qa.sendRequest(h.A,"/vap/ew/subcomponent/votes/writing",e,function(b,c,h){null!==h.http.responseURL&&h.http.responseURL!==t&&h.http.responseURL.includes("signin")&&
(c=h.http.responseURL,h=encodeURIComponent(k.location.href),c=c.replace(/return_to=.*?&/,"return_to\x3d"+h+"\x26"),k.location.href=c);a(b)},function(a){m.count("vse:votecast:failed",1);b(a)})})};d.prototype.fetchVoteCountAndStatus=function(c){var a=this,b=this.getVoteCountAndStatusBasicPayload(this.videoVoteConfig),h=this.A.$.extend(b,{contentId:c});return new this.videoVoteConfig.dependencies.promise(function(b,c){C.sendRequest(a.A,"/vap/ew/subcomponent/votes/countandstatus",h,function(h){h=a.convertPayloadToVoteCountAndStatusData(h);
null!=h&&b(h);c(h)},function(a){m.count("vse:votegetcountsandstatus:failed",1);c(a)})})};d.prototype.fetchVoteHistory=function(c){var a=this,b=this.getBasicPayload(this.videoVoteConfig),h=this.A.$.extend(b,{contentId:c});return new this.videoVoteConfig.dependencies.promise(function(b,c){C.sendRequest(a.A,"/vap/ew/subcomponent/votes/status",h,function(a){b(a)},function(a){m.count("vse:votehistory:failed",1);c(a)})})};d.prototype.convertPayloadToVoteData=function(c){var a=[],b;for(b in c)c.hasOwnProperty(b)&&
a.push(new za(b,c[b].positive,c[b].negative));return a};d.prototype.convertPayloadToVoteCountAndStatusData=function(c){var a=null;if(null===c||0===Object.keys(c).length)return null;var b=Object.keys(c)[0];c.hasOwnProperty(b)&&(a=new Aa(b,c[b].positive,c[b].status));return a};d.prototype.fetchVoteCounts=function(c){var a=this,b=this.getBasicPayload(this.videoVoteConfig),h=this.A.$.extend(b,{contentIds:c});return new this.videoVoteConfig.dependencies.promise(function(b,c){C.sendRequest(a.A,"/vap/ew/subcomponent/votes",
h,function(h){h=a.convertPayloadToVoteData(h);0<h.length&&b(h);c(h)},function(a){m.count("vse:votegetcounts:failed",1);c(a)})})};d.prototype.getBasicPayload=function(c){return{placement:c.placementContext,requestId:c.requestId,sessionId:c.sessionId,page:c.page,bypassLogin:c.forceTreatment||!1}};d.prototype.getVoteCountAndStatusBasicPayload=function(c){return{placement:c.placementContext,page:c.page}};return d}(),Ba=function(){return function(d){var c=this;this.config=d;this.getTabs=function(){return c.tabs};
this.updateSegmentTabForVideo=function(a){c.config.A.$(""+c.segmentTabCssClassSelectorName).removeClass("vse-tab-active vse-tab-no-border");for(var b=0;b<c.tabs.length&&a>=c.tabs[b].startIndex;++b);c.config.A.$(c.segmentTabCssClassSelectorName+".tab-"+(0<b?b-1:0)).addClass("vse-tab-active vse-tab-with-border")};this.updateSegmentTabOnClick=function(a){c.config.A.$(""+c.segmentTabCssClassSelectorName).removeClass("vse-tab-with-border").addClass("vse-tab-no-border");c.config.A.$(c.segmentTabCssClassSelectorName+
"."+a.cssClassName).addClass("vse-tab-with-border")};this.tabs=d.segmentTabs||[];this.segmentTabCssClassSelectorName=this.config.segmentTabCssClassSelectorName}}(),Ca=function(){function d(c,a,b,h,d,e){var g=this;this.carouselFramework=a;this.carouselConstants=b;this.A=h;this.contentCarouselConfig=d;this.deps=e;this.vseAssets=[];this.vseAssetIndex={};this.voteContainerIndex={};this.carouselPageSize=this.carouselTotalPages=0;this.carouselPageNumber=1;this.totalVideosLoaded={};this.showSeeMoreButton=
!1;this.loadImagesManually=function(a,b){for(var c=a.getAttr(g.carouselConstants.PAGE_SIZE),h=b=(b-1)*c+1;h<b+c+n.NUMBER_OF_CARDS_TO_LOAD_ADDITIONALLY;h++){var d=g.A.$(a.dom.$container.find(".vse-video-card:nth-child("+h+")"));d.addClass("vse-img-manually-loaded");g.A.loadDescendantImagesManually(d)}};this.getplaylist=function(){return g.vseAssets.slice()};this.getActiveAsset=function(){return g.activeAsset};this.scrollTo=function(){var a=g.A.$("#"+g.contentCarouselConfig.carouselName),b=a.find(".a-carousel");
0<b.length?(a=a.find(".vse-flex-carousel-header"),a=a[0]?a[0].clientHeight:0,b.animate({scrollTop:b.scrollTop()+g.activeCard.position().top-a})):g.A.$("#"+g.contentCarouselConfig.carouselName).animate({scrollTop:g.activeCard.offset().top-g.A.$("#"+g.contentCarouselConfig.carouselName).offset().top-g.additionalPaddingTop+g.A.$("#"+g.contentCarouselConfig.carouselName).scrollTop()})};this.rotateTo=function(a){g.useMultiCarousel?g.rotateToMultiCarousel(a):(g.markPlaying(a),g.contentCarouselConfig.isVerticalScroll&&
g.scrollTo(),0!==g.carouselPageSize&&(a=g.findIndex(a),-1!==a&&(a=Math.floor(a/g.carouselPageSize)+1,g.carouselPageNumber!=a&&("none"==g.auiCarousel.getAttr("transitionStrategy")?g.animateCarousel(a-1):g.auiCarousel.gotoPage(a)))))};this.rotateToMultiCarousel=function(a){g.markPlaying(a);0===g.carouselPageSize&&(g.carouselPageSize=1);a=g.findIndex(a);-1!==a&&(a=(a+1<g.vseAssets.length?a+1:a)+1,g.carouselPageNumber!=a&&("none"==g.auiCarousel.getAttr("transitionStrategy")?g.animateCarousel(a-1):g.auiCarousel.gotoPage(a)))};
this.markPlaying=function(a){g.activeAsset=a;g.activeCard.removeClass("active");g.vseAssetIndex[a.contentId]&&(g.activeCard=g.vseAssetIndex[a.contentId].$el.closest("li").addClass("active"))};this.findIndex=function(a){return g.vseAssets.indexOf(g.vseAssetIndex[a.contentId])};this.emitRefTag=function(a,b,c){0<g.listOffset&&(a=(a-g.listOffset+g.vseAssets.length)%g.vseAssets.length);g.refTagRecorder.emitRefTag(b+a+c)};this.destroy=function(){g.A.$("#"+g.contentCarouselConfig.carouselName+" .a-carousel-card.active").removeClass("active")};
this.updateVotingElements=function(a,b){g.A.each(a,function(a){var c=g.vseAssetIndex[a.contentId].videoVoteContainer;c.setVoteCount(n.POSITIVE_VOTE,a.positiveVoteCount);c.setVoteCount(n.NEGATIVE_VOTE,a.negativeVoteCount);c.countsFetched=!0;c.showOrHide(b,b,!1,b)})};this.updateVotingElementsForCountAndStatus=function(a,b){var c=g.vseAssetIndex[a.contentId].videoVoteContainer;c.setVoteCount(n.POSITIVE_VOTE,a.positiveVoteCount);c.countsFetched=!0;c.setPreviousVote(1===a.voteStatus?n.POSITIVE_VOTE:n.NONE_VOTE);
c.showOrHide(b,b,!1,b)};this.initializeSegmentTabs=function(a){g.segmentTabsModule=new Ba(a);g.segmentTabs=g.segmentTabsModule.getTabs();g.attachTabClickHandlers();g.attachTabChangeHandlerOnCarouselScroll();g.showCreatorProfiles(".vse-video-customer-profile",".vse-video-labels")};this.showCreatorProfiles=function(a,b){var c="#"+g.contentCarouselConfig.carouselName+"."+n.VIP_CAROUSEL_CSS_CLASS+" .vse-video-card";g.A.$(c).each(function(c,h){c=g.A.$(h).find(a);var d=g.A.$(h).find(b);0<c.length&&0<d.length&&
(d.html(c.removeClass("vse-hidden aok-hidden").detach().get(0).outerHTML),g.A.$(h).addClass("vse-video-card-has-profile"))});g.A.$(c+" .vse-profile").click(function(a){g.disableCreatorClicksOnMshop&&a.preventDefault();a.stopPropagation();a.stopImmediatePropagation()})};this.attachTabClickHandlers=function(){g.segmentTabs.forEach(function(a){var b=g.A.$(g.segmentTabsModule.segmentTabCssClassSelectorName+"."+a.cssClassName);b.click(function(){g.animateCarousel(a.startIndex);b.hasClass("vse-tab-active")||
g.segmentTabsModule.updateSegmentTabOnClick(a)})})};this.attachTabChangeHandlerOnCarouselScroll=function(){g.A.$("#"+g.contentCarouselConfig.carouselName+"."+n.VIP_CAROUSEL_CSS_CLASS+" .a-carousel-viewport").scroll(function(){g.A.$("#"+g.contentCarouselConfig.carouselName+"."+n.VIP_CAROUSEL_CSS_CLASS+" .vse-video-card").each(function(a,b){g.orientationConfig.getCardInViewOffset(g.A.$(b))<=g.orientationConfig.getOffsetPointForTabUpdate()&&g.segmentTabsModule.updateSegmentTabForVideo(a)})})};this.animateCarousel=
function(a){if(!g.A.objectIsEmpty(g.orientationConfig)){var b=g.orientationConfig.animatedCarouselDimensionValue();a*=g.shouldUseVerticalThumbnail&&b.verticalCarouselCardWidth?b.verticalCarouselCardWidth:b.carouselCardWidth;g.useMultiCarousel&&g.resizeCarousel(a);g.auiCarousel.dom.$viewport.animate(g.orientationConfig.getCarouselPropertyToAnimate(a),500)}};this.resizeCarousel=function(a){var b=g.auiCarousel.dom.$viewport[0].scrollWidth-g.auiCarousel.dom.$viewport[0].clientWidth;if(b<a){var c=g.auiCarousel.dom.$carousel.css("width").slice(0,
-2);g.auiCarousel.dom.$carousel.css("width",parseInt(c)+(a-b)+"px")}};this.scrollToActiveVideo=function(a){a=g.findIndex(a);g.animateCarousel(a)};this.updateSegmentTabForActiveVideo=function(a){a=g.findIndex(a);g.segmentTabsModule.updateSegmentTabForVideo(a)};this.setOrientationConfig=function(a){g.orientationConfig=a};this.getAssetSpec=function(a,b,c,h){var d=a.data(),f=a.find(".vse-video-image").data("img"),e=a.find("[data-redirect-url]").data("redirectUrl")||"",f=f.replace("SR160,90_BG0,0,0_PKvse-overlay-play2",
"").replace("SR320,180_BG0,0,0_PKvse-overlay-play2",""),z=[];if(d.closedCaptions)for(var u=d.closedCaptions.split(","),l=0;l<u.length-1;l+=2)z.push({locale:u[l],url:u[l+1]});a={index:b,contentId:a.attr("data-asin"),title:d.title,vendorName:d.vendorName,vendorCode:d.vendorCode,entityId:d.entityId,entityType:d.entityType,referenceUrl:d.referenceUrl,referenceLinkTitle:d.referenceTitle,videoUrl:d.videoUrl,$el:a,duration:d.duration,imageUrl:f,sponsored:d.sponsored,videoVoteContainer:g.voteContainerIndex[d.asin],
productAsin:d.productAsin,refTag:c+b+h,continuousPlayRefTag:c+b+h+"_auto_play",relatedProducts:d.relatedProducts,ospTrackingLink:d.ospTrackingLink,vendorTrackingId:d.vendorTrackingId,videoReferenceId:d.videoRefId,groupType:d.groupType,impressionRecorded:!1,closedCaptions:z,creatorType:d.creatorType,videoAge:d.videoAge,rankingStrategy:d.rankingStrategy,aciContentId:d.aciContentId,mimeType:d.mimeType,showHotspots:d.showHotspots,hasHotspots:d.hasHotspots,labelDetails:{},ccvDisclosure:d.ccvDisclosure,
segmentNumber:d.segmentNumber,altText:d.altText,disableVote:d.disableVote,mandatoryBadgeDisclosure:d.mandatoryBadgeDisclosure,redirectUrl:e,reportUrl:d.reportUrl,disableReportIllegalLink:d.disableReportIllegalLink,eligibleToTriggerCCWeblab:d.eligibleToTriggerCcWeblab};g.isUndefinedOrEmpty(d.labelName)||g.isUndefinedOrEmpty(d.labelType)||g.isUndefinedOrEmpty(d.labelWeblabName)||(a.labelDetails={labelName:d.labelName,labelType:d.labelType,labelWeblabName:d.labelWeblabName,showLabel:d.showLabel,tooltipSelector:d.labelTooltipSelector});
return a};this.isUndefinedOrEmpty=function(a){return g.A.objectIsEmpty(a)||""===a};this.displayOrHideCarouselButtons=function(a){var b=a.getAttr(g.carouselConstants.PAGE_NUMBER),c=a.getAttr(g.carouselConstants.TOTAL_PAGES),h=a.dom.$container.find(n.CAROUSEL_PREV_BUTTON_CLASS);a=a.dom.$container.find(n.CAROUSEL_NEXT_BUTTON_CLASS);h.toggleClass(n.VSE_CAROUSEL_PAGINATION_DEACTIVATE_CLASS,1===b||1===c);a.toggleClass(n.VSE_CAROUSEL_PAGINATION_DEACTIVATE_CLASS,b===c||1===c)};this.removeActive=function(){g.activeAsset=
t;g.activeCard.removeClass("active")};var l=h.$;this.activeCard=l([]);var q=this;this.auiCarousel=c;this.refTagRecorder=new M(h);this.showSeeMoreButton=d.seeMoreFunctionality.showSeeMoreButton;this.useMultiCarousel=d.useMultiCarousel;this.disableCreatorClicksOnMshop=d.disableCreatorClicksOnMshop;this.shouldUseVerticalThumbnail=d.shouldUseVerticalThumbnail;this.additionalPaddingTop=parseInt(l("#"+d.carouselName).css("paddingTop"));l("#"+d.carouselName).find(".a-carousel-heading").after(l("#"+d.carouselName).find(".vse-upload-link").removeClass("aok-hidden"));
l("#"+d.carouselName+" .vse-video-item").each(function(a){a=q.getAssetSpec(l(this),a,q.contentCarouselConfig.refTagPrefix,q.contentCarouselConfig.celQueryStringParam);q.vseAssets.push(a);q.vseAssetIndex[a.contentId]=a});d.showVideoVotes&&d.videoVoteConfig&&(this.videoVoteContainerFactory=new Q(h,d.videoVoteConfig),h.each(this.vseAssetIndex,function(a){a.disableVote||(g.voteContainerIndex[a.contentId]=g.videoVoteContainerFactory.createFromContent(g.contentCarouselConfig.carouselName,a.contentId),a.videoVoteContainer=
g.voteContainerIndex[a.contentId])}));l("#"+d.carouselName+" .vse-video-card").find(n.$GROUP_1).first().addClass("first-item");l("#"+d.carouselName+" .vse-video-card").find(n.$GROUP_2).first().addClass("first-item");l("#"+d.carouselName+" .vse-video-card").find(n.$GROUP_3).first().addClass("first-item");l("#"+d.carouselName+" .vse-video-card").find(n.$GROUP_EXPVERNAC).first().addClass("first-item");(c=d.useMShopVDPFallback&&h.capabilities.isAmazonApp&&h.capabilities.android&&0===h.capabilities.androidVersion.indexOf("8"))||
l("#"+d.carouselName).delegate(".a-carousel-card a","click",function(a){if(!(0<l(this).closest(".vse-sm-expander").length))if(l(this).closest("li").hasClass("active"))a.preventDefault();else{var b=q.vseAssetIndex[l(this).closest("li").find(".vse-video-item").data("asin")];q.markPlaying(b);b.eventTimestamp=Date.now();h.trigger("vse:contentCarousel:"+d.carouselName+":click",b);b=q.findIndex(b);q.emitRefTag(b,q.contentCarouselConfig.refTagPrefix,q.contentCarouselConfig.celQueryStringParam);d.isPreventDefault&&
a.preventDefault()}});var f=c?q.contentCarouselConfig.refTagPrefix+"_mshop_fallback":q.contentCarouselConfig.refTagPrefix;l("#"+d.carouselName+" .vse-carousel-item").each(function(a){var b=l(this);b.attr("href",b.data("redirect-url")+"?ref\x3d"+f+a+q.contentCarouselConfig.celQueryStringParam)});h.off("a:carousel:"+d.carouselName+":change:pageSize");h.off("a:carousel:"+d.carouselName+":change:pageNumber");h.on("a:carousel:"+d.carouselName+":change:pageSize",function(){g.carouselPageSize=g.auiCarousel.getAttr("pageSize");
g.activeAsset&&g.rotateTo(g.activeAsset)});h.trigger("a:carousel:"+d.carouselName+":change:pageSize");h.on("a:carousel:"+d.carouselName+":change:pageNumber",function(a){a.carousel.getAttr("totalPages");g.carouselPageNumber=g.auiCarousel.getAttr("pageNumber");h.trigger("a:carousel:"+d.carouselName+":scrollCarousel",g.carouselPageNumber,g.carouselPageSize)});h.trigger("a:carousel:"+d.carouselName+":updatePageIndex",this.carouselPageNumber,this.carouselPageSize);h.declarative(d.carouselName+"-sm-link",
"click touch",function(a){l("#"+d.carouselName+" .vse-video-item .vse-carousel-item").first().click()});d.showCreatorProfiles&&this.showCreatorProfiles(".vse-creator-profile",".vse-thumbn-cp-placeholder");this.showSeeMoreButton&&this.initializeTotalVideosLoaded();h.declarative(this.contentCarouselConfig.carouselName+"-seeMoreRelatedVideosButtonClick","click touch",function(a){g.handleSeeMoreClick(a)});this.carouselFramework.onInit(""+this.contentCarouselConfig.carouselName,function(a){g.contentCarouselConfig.useCustomButtons&&
(h.declarative.create(h.$("#"+d.carouselName),g.contentCarouselConfig.carouselName+"-declarative",{}),h.declarative(g.contentCarouselConfig.carouselName+"-declarative","mouseenter touchstart focus",function(){1!==a.getAttr(g.carouselConstants.TOTAL_PAGES)&&(h.$("#"+d.carouselName).addClass("vse-carousel-show-btn"),h.$("#"+d.carouselName+" .vse-carousel-button").stop(!0,!0).fadeIn({duration:300,queue:!1}))}),h.declarative(g.contentCarouselConfig.carouselName+"-declarative","mouseleave",function(){1!==
a.getAttr(g.carouselConstants.TOTAL_PAGES)&&(h.$("#"+d.carouselName).removeClass("vse-carousel-show-btn"),h.$("#"+d.carouselName+" .vse-carousel-button").stop(!0,!0).fadeOut({duration:300,queue:!1}))}),g.displayOrHideCarouselButtons(a));g.contentCarouselConfig.loadImagesManually&&g.loadImagesManually(a,1);h.on("a:carousel:"+g.contentCarouselConfig.carouselName+":change:pageNumber",function(a){g.contentCarouselConfig.loadImagesManually&&(g.displayOrHideCarouselButtons(a.carousel),g.loadImagesManually(a.carousel,
a.newValue))});h.on("a:carousel:"+g.contentCarouselConfig.carouselName+":change:pageSize",function(a){g.contentCarouselConfig.loadImagesManually&&(g.displayOrHideCarouselButtons(a.carousel),g.loadImagesManually(a.carousel,a.newValue))});g.useMultiCarousel&&g.activeAsset&&g.rotateToMultiCarousel(g.activeAsset)})}d.prototype.changeStartingCardTo=function(c){var a=this;this.listOffset=this.findIndex(c);var b=this;this.A.$("#"+this.contentCarouselConfig.carouselName+" .vse-carousel-item").each(function(a){var c=
b.A.$(this);a=(a-b.listOffset+b.vseAssets.length)%b.vseAssets.length;c.attr("href",c.data("redirect-url")+"?ref\x3d"+b.contentCarouselConfig.refTagPrefix+a)});this.contentCarouselConfig.isVerticalScroll||(this.carouselFramework.initializeAll(),this.carouselFramework.onInit(""+this.contentCarouselConfig.carouselName,function(){a.rotateTo(c)}))};d.prototype.initializeTotalVideosLoaded=function(){for(var c=this.contentCarouselConfig.seeMoreFunctionality.segmentTypeToCountMap,a=0,b=Object.keys(c);a<b.length;a++){var h=
b[a];this.totalVideosLoaded[h]=Math.min(this.contentCarouselConfig.seeMoreFunctionality.initialVisibleVideoCount,c[h])}};d.prototype.handleSeeMoreClick=function(c){c=c.$currentTarget.get()[0];c=this.A.$(c).find("[data-segment-id]").attr("data-segment-id");this.loadMoreVideos(c)};d.prototype.loadMoreVideos=function(c){var a=this.A.$("#"+this.contentCarouselConfig.carouselName+" #vse-sm-link-"+c);a.closest(".vse-video-card").outerHeight(!0);for(var b=this.contentCarouselConfig.seeMoreFunctionality.newVisibleVideoCount,
h=this.contentCarouselConfig.seeMoreFunctionality.segmentTypeToCountMap[c],d=this.getTotalVideosLoadedForSegment(c),b=Math.min(d+b,h),e=d;e<b;e++){var g=this.A.$("#"+this.contentCarouselConfig.carouselName+" #vse-video-element-"+c+"-"+e);g.closest("div.vse-hidden.vse-show-more").removeClass("vse-hidden vse-show-more");g.closest("li.vse-sm-no-padding").removeClass("vse-sm-no-padding")}this.setTotalVideosLoadedForSegment(c,b);b>=h&&a.addClass("vse-hidden vse-show-more");this.getSeeMoreIndex(c);this.A.$("#"+
this.contentCarouselConfig.carouselName+" #vse-video-element-"+c+"-"+(d-1)).closest(".vse-video-card").outerHeight(!0)};d.prototype.getSeeMoreIndex=function(c){c=c.replace(/.*_G(.)/,"$1");return parseInt(c)};d.prototype.getTotalVideosLoadedForSegment=function(c){return this.totalVideosLoaded[c]||0};d.prototype.setTotalVideosLoadedForSegment=function(c,a){this.totalVideosLoaded[c]=a};d.prototype.resetVideosStateOnLightboxReopen=function(){var c=this;if(this.showSeeMoreButton){var a=this.A.$("#"+this.contentCarouselConfig.carouselName+
" li.vse-video-card"),b=this.contentCarouselConfig.seeMoreFunctionality.segmentTypeToCountMap,h=0;a.each(function(a,d){a=c.getSegmentTypeFromElement(c.A.$(d));var e=b[a];h<Math.min(e,c.contentCarouselConfig.seeMoreFunctionality.initialVisibleVideoCount)?c.setTotalVideosLoadedForSegment(a,h+1):h<e&&(c.A.$(d).addClass("vse-sm-no-padding"),c.A.$(d).children(".vse-video-item").addClass("vse-hidden vse-show-more"));h+=1;h==e&&(h>c.contentCarouselConfig.seeMoreFunctionality.initialVisibleVideoCount&&c.A.$(d).find("#vse-sm-link-"+
a).removeClass("vse-hidden vse-show-more"),h=0)})}};d.prototype.getSegmentTypeFromElement=function(c){c=this.A.$(c).prevAll(".vse-flex-carousel-header").first();return 0<c.length&&(c=c.attr("class").match(/segment-title-(.+)/))&&c[1]?c[1].split(" ")[0]:n.EMPTY_STRING};return d}(),R=function(){function d(c,a,b,h){this.carouselFramework=c;this.carouselConstants=a;this.A=b;this.deps=h}d.prototype.create=function(c){var a=this.carouselFramework.getCarousel(this.A.$("#"+c.carouselName));if(!a)throw new K("Carousel framework can not find carousel by the name of "+
c.carouselName+".");return new Ca(a,this.carouselFramework,this.carouselConstants,this.A,c,this.deps)};return d}(),da=function(){function d(c,a){var b=this;this.A=c;this.constants=a;this.repaint=function(a){var c=a.getDimensions().viewport.width,d=a.dom.$carousel.children("li").get(0).getBoundingClientRect(),d=d.width?d.width:d.right-d.left,e=b.updateVisibleItems(a,c,d);b.updateCarouselDimensions(a,c,d);a.gotoIndex(e,{animationDuration:0,ignorePause:!0});a.triggerEvent("repaint")};this.resize=function(a,
c){c.viewport&&c.viewport.width!==t&&b.repaint(a)};this.init=function(a){var c=a.getAttr(b.constants.FIRST_VISIBLE_ITEM);a.setAttr(b.constants.MIN_GUTTER,n.NO_GUTTER);a.setAttr(n.CURRENT_GUTTER,n.NO_GUTTER);b.repaint(a);1<c&&(c=Math.ceil(c/a.getAttr(b.constants.PAGE_SIZE)),a.gotoPage(c));b.bindAttrChangeHandlers(a)}}d.prototype.determinePageSize=function(c,a,b){c=0;if(0<b)for(;a>n.TOLERANT;)c++,a-=b;0>a&&c--;return this.A.isFiniteNumber(c)&&0<c?c:1};d.prototype.bindAttrChangeHandlers=function(c){var a=
this;c.onChange(this.constants.PAGE_NUMBER,function(){c.getAttr(a.constants.HIDE_OFF_SCREEN)&&c.dom.$carousel.children("li").css("visibility","")});c.onChange(this.constants.ANIMATING,function(b){if(!b&&c.getAttr(a.constants.HIDE_OFF_SCREEN)){var h=c.getAttr(a.constants.FIRST_VISIBLE_ITEM)-1,d=h+c.getAttr(a.constants.PAGE_SIZE)-1;c.dom.$carousel.children("li").each(function(b,c){b=b>=h&&b<=d;a.A.$(c).css("visibility",b?"":"hidden")})}})};d.prototype.updateCarouselDimensions=function(c,a,b){var h;
h=c.dom.$carousel;var d=h.children("li");a=d.length;var e=d.first().outerWidth(!0),d=d.eq(1).outerWidth(!0),e=(a-1)*d+e;h.css("width",e+"px");e={carousel:{width:e,outerWidth:h.outerWidth()},items:[]};for(h=0;h<a;h++)e.items.push({width:b,outerWidth:d});c.updateDimensionsCache(e)};d.prototype.updateVisibleItems=function(c,a,b){var h=c.getAttr(this.constants.TOTAL_PAGES),d=c.getAttr(this.constants.PAGE_NUMBER),e=c.getAttr(this.constants.HIDE_OFF_SCREEN),g=c.dom.$carousel.children("li"),l=c.getAttr(this.constants.FIRST_VISIBLE_ITEM);
a=this.determinePageSize(c,a,b);var q=(d-1)*a+1;c.setAttr(this.constants.PAGE_SIZE,a);d>h?(l=(h-1)*a+1,c.setAttr(this.constants.PAGE_NUMBER,h),c.setAttr(this.constants.FIRST_VISIBLE_ITEM,l)):l!==q&&(h=Math.ceil(l/a),l=(h-1)*a+1,c.setAttr(this.constants.PAGE_NUMBER,h),c.setAttr(this.constants.FIRST_VISIBLE_ITEM,l));var f=l-1,x=f+a-1;g.each(function(a,c){c.style.visibility=!e||a>=f&&a<=x+n.NUMBER_OF_CARDS_TO_LOAD_ADDITIONALLY?"":"hidden";c.style.width=b+"px"});return l};return d}(),ea=function(){function d(c,
a,b){var h=this;this.A=c;this.constants=a;this.slideTransition=b;this.carouselLeft=0;this.token=!1;this.init=function(a){h.$scrollBar=a.dom.$container.find(".vse-carousel-scrollbar-thumb");h.carouselLeft=-1*parseInt(a.dom.$carousel.css("left"),10);h.slideTransition.init(a)};this.gotoNextPage=function(a,b){return h.slideTransition.gotoNextPage(a,b)};this.gotoPrevPage=function(a,b){return h.slideTransition.gotoPrevPage(a,b)};this.gotoPage=function(a,b,c){if(!h.locked()){h.lock();var d=b,e=a.getAttr(h.constants.TOTAL_PAGES),
f=a.getAttr(h.constants.PAGE_SIZE),x=a.getAttr(h.constants.SET_SIZE);0<b&&b<=e&&a.setAttr(h.constants.PAGE_NUMBER,b);1>b?b=1:b>e&&(b=e);var p=f*(b-1)+1;b===e&&(p=Math.min(p,x-f+1));1>d||d>e?(h.bounce(a.dom.$carousel,n.BOUNCE_CAROUSEL_FACTOR*(1>d?1:-1)),h.bounce(h.$scrollBar,1*n.BOUNCE_SCROLL_BAR_FACTOR)):h.gotoIndex(a,p,c)}};this.gotoIndex=function(a,b,c){var d=a.getDimensions();c=d.carousel.outerWidth;var d=d.viewport.outerWidth,e=c-d;b=Math.max(Math.min(a.getItemOffset(b),e),0);c=d/c;d=Math.min(c*
d,d);h.$scrollBar=a.dom.$container.find(".vse-carousel-scrollbar-thumb");h.$scrollBar.width(d);h.$scrollBar.animate({left:c*b},n.ANIMATION_SPEED_400,n.SWING);a.dom.$carousel.animate({left:-b},n.ANIMATION_SPEED_400,n.SWING,function(){h.carouselLeft=a.dom.$carousel.css("left");h.unlock()})};this.lock=function(){h.token=!0};this.unlock=function(){h.token=!1};this.locked=function(){return h.token};this.vseTransitionStrategy=c.copy(b);this.vseTransitionStrategy.init=function(a){return h.init(a)};this.vseTransitionStrategy.gotoPage=
function(a,b,c){return h.gotoPage(a,b,c)};this.vseTransitionStrategy.gotoIndex=function(a,b,c){return h.gotoIndex(a,b,c)}}d.prototype.get=function(){return this.vseTransitionStrategy};d.prototype.bounce=function(c,a){var b=this;c.each(function(c,d){var e=b.A.$(d);e.animate({marginLeft:a},n.ANIMATION_SPEED_400,n.SWING,function(){e.animate({marginLeft:0},n.ANIMATION_SPEED_100,n.SWING,b.unlock)})})};return d}(),r=function(){function d(){}d.IVE_CSS_CLASS_PREFIX="ive-";d.ATTRIBUTION_NAME="ive-inline-player";
d.PLAYER_WRAPPER_SELECTOR=".ive-video-player-wrapper";d.LB_PLAYER_PLACEHOLDER_SELECTOR=".ive-inline-lb-player-placeholder";d.CLOSE_BUTTON_SELECTOR=".ive-inline-player-close-button";d.AUDIO_TOGGLE_BUTTON_SELECTOR=".ive-inline-player-audio-toggle";d.PLAY_TOGGLE_BUTTON_SELECTOR=".ive-inline-player-play-toggle";d.EXPAND_BUTTON_SELECTOR=".ive-inline-player-expand";d.OSP_LINK_SELECTOR=".ive-inline-player-osp-link";d.REMAINING_TIME_SELECTOR=".ive-inline-player-remaining-time";d.PLAYER_CONTAINER_SELECTOR=
".vse-player-container";d.MUTE_CSS_CLASS="ive-inline-player-mute";d.UNMUTE_CSS_CLASS="ive-inline-player-unmute";d.PLAY_CSS_CLASS="play";d.REPLAY_CSS_CLASS="replay";d.PAUSE_CSS_CLASS="pause";d.INLINE_PLAYER_MODE="inline";d.IVX_PLAYER_MODE="ivx";d.BLUR_WRAPPER_SELECTOR=".awa-blur-wrapper";d.LB_PLAYER_MODE="lb";d.INLINE_PLAYER_EXPAND_BUTTON_CLICK="inline:expand:click";d.INLINE_PLAYER_CLOSE_BUTTON_CLICK="inline:close:click";d.ROTATE_TO_ORIENTATION_METRIC_NAME="rotateTo";d.MUTED_AUDIO_PREF="muted";d.UNMUTED_AUDIO_PREF=
"unmuted";return d}(),fa=function(){return function(d,c,a){var b=this;this.openLightbox=function(a,c,d,e){var l=b.vars.sharedUtils.getModalFactory();b.vars.callback=e;(e=l&&l.get(b.vars.A.$("#"+b.vars.popoverTriggerId)))?(b.vars.$ingressPlaceholder=a,b.setClickedVideo(c),e.show(),b.movePlayerToLightbox(a,c),d.preventDefault(),d.stopPropagation()):b.handleError("cannotOpenLightbox","Cannot find Lightbox popover for popoverTriggerId: "+b.vars.popoverTriggerId)};this.setClickedVideo=function(a){b.vars.clickedVideo&&
(b.vars.previouslyClickedVideo=a);b.vars.clickedVideo=a};this.movePlayerToLightbox=function(a,c){b.vars.ingressAssetSpec=c;var d=b.vars.A.$("#"+b.vars.sharedUtils.vars.templateId).find(r.LB_PLAYER_PLACEHOLDER_SELECTOR);if(0<a.length&&0<d.length){a.find(r.BLUR_WRAPPER_SELECTOR).hide();var e=function(){a.find(r.PLAYER_WRAPPER_SELECTOR).detach().appendTo(d)};b.vars.isMobile?setTimeout(e,500):e();b.changePlayerMode(b.vars.isMobile?r.IVX_PLAYER_MODE:r.LB_PLAYER_MODE);b.setClickedVideo(c);b.vars.previouslyClickedVideo&&
b.vars.clickedVideo.contentId!==b.vars.previouslyClickedVideo.contentId||b.player.emitStartCountMetric()}};this.movePlayerToIngress=function(a){b.setCurrentIngressPlaceholder(a);var c=b.vars.sharedUtils.dom.$wrapper.find(r.LB_PLAYER_PLACEHOLDER_SELECTOR);0<a.length&&0<c.length&&(c.find(r.PLAYER_WRAPPER_SELECTOR).detach().appendTo(a),b.changePlayerMode(r.INLINE_PLAYER_MODE),a.find(r.AUDIO_TOGGLE_BUTTON_SELECTOR).toggleClass(r.UNMUTE_CSS_CLASS,b.player.isMuted()).toggleClass(r.MUTE_CSS_CLASS,!b.player.isMuted()),
b.setAudioPreferences())};this.addPlayerLoadedHandler=function(){b.player.on("loadeddata",function(){if(!b.vars.sharedUtils.inlinePlayerInitialized){var a="."+b.vars.clientPrefix+".ive-inline-player-controls",c="."+b.vars.clientPrefix+" .ive-inline-player-time",d="."+b.vars.clientPrefix+" .ive-scrubber-bar-fill",e=0<b.vars.A.$(a).length,l=a+" .ive-inline-player-play-toggle",q=b.vars.shouldLoop;b.listenToMuteUnmuteEvents(b.player);b.player.on("timeupdate",function(a){b.vars.mediaEnded&&b.resetMediaEndedState(l);
e?(b.vars.sharedUtils.vars.vipVideoDuration=b.player.getMediaDuration(),b.vars.sharedUtils.updateProgressBarAndTimeDisplay(a,c,d)):b.updateTimeDisplay()});q||b.listenToMediaEndedEvent(b.player,l,d,c);e&&(b.listenToPlayPauseEvents(b.player,l),b.vars.sharedUtils.initializeProgressBarTouchEvents(a,".ive-scrubber-container",!0));b.vars.sharedUtils.inlinePlayerInitialized=!0}})};this.updateVideoCountForExpandButton=function(a,b){if(!isNaN(a)){var c=b.find(".ive-inline-player-expand"),d=b.find(".ive-video-count-text");
b=b.find(".ive-more-video-text");d.text(d.text().replace("{0}",String(a)));c.toggleClass("more-vid",!0);d.toggleClass("aok-hidden",!1);b.toggleClass("aok-hidden",!0)}};this.hideVideoCountForExpandButton=function(a){var b=a.find(".ive-inline-player-expand"),c=a.find(".ive-video-count-text");a=a.find(".ive-more-video-text");b.toggleClass("more-vid",!1);c.toggleClass("aok-hidden",!0);a.toggleClass("aok-hidden",!0)};this.showHideCloseButtonForInlinePlayer=function(a,b){a.find(".ive-inline-player-close-button").toggleClass("aok-hidden",
!b)};this.updateVideoInfoOverlay=function(a,c){b.isValidOverlayInput(a,c)&&(c=c.find(".ive-vid-info"),0===c.length?console.warn("Video info section not found in wrapper"):(b.updateTextContent(c,".ive-vid-ttl",a.title),b.updateTextContent(c,".ive-crtr-nm",a.vendorName),b.updateAccessibleLink(a,c),b.updateCommissionTagVisibility(a,c),c.toggleClass("aok-hidden",!1)))};this.resetMediaEndedState=function(a){b.vars.mediaEnded=!1;b.vars.A.$(a).removeClass(""+r.REPLAY_CSS_CLASS);b.player.player.playerInstance.videoJS.hasStarted(!0)};
this.listenToPlayPauseEvents=function(a,c){var d=b.vars.A.$(r.PLAYER_CONTAINER_SELECTOR).find(c);a.on("play",function(){d.removeClass(r.PLAY_CSS_CLASS+" "+r.REPLAY_CSS_CLASS)});a.on("pause",function(){d.addClass(""+r.PLAY_CSS_CLASS)})};this.listenToMuteUnmuteEvents=function(a){b.toggleMuteButtonBasedOnPlayerState(a);a.on("volumechange",function(){b.toggleMuteButtonBasedOnPlayerState(a)})};this.toggleMuteButtonBasedOnPlayerState=function(a){b.vars.A.$(r.PLAYER_CONTAINER_SELECTOR).find(r.AUDIO_TOGGLE_BUTTON_SELECTOR).toggleClass(r.UNMUTE_CSS_CLASS,
a.isMuted()).toggleClass(r.MUTE_CSS_CLASS,!a.isMuted())};this.listenToMediaEndedEvent=function(a,c,d,e){a.on("ended",function(){b.vars.A.$(c).addClass(""+r.REPLAY_CSS_CLASS);b.player.player.playerInstance.videoJS.hasStarted(!1);b.vars.A.$(d).width("100%");b.vars.A.$(e).text("-0:00");b.vars.mediaEnded=!0})};this.addLightboxAfterShowAndBeforeHideEvents=function(){b.vars.A.off("a:popover:afterShow:"+b.vars.popoverId);b.vars.A.on("a:popover:afterShow:"+b.vars.popoverId,function(a){try{var c=void 0;if(b.vars.lightboxOpenedFirstTime){var d=
b.vars.A.$(a.popover.$popover).find("[data-css-class]");d.length&&b.vars.A.$(a.popover.$popover).addClass(d.attr("data-css-class"));b.vars.lightboxOpenedFirstTime=!1;c=b.vars.clickedVideo.productAsin}else c=b.vars.clickedVideo.contentId!==b.vars.previouslyClickedVideo.contentId?b.vars.clickedVideo.productAsin:t;b.triggerLightboxOpenEvent(b.vars.clickedVideo,c)}catch(e){b.handleError("cannotOpenLightbox",e)}});b.vars.A.off("a:popover:beforeHide:"+b.vars.popoverId);b.vars.A.on("a:popover:beforeHide:"+
b.vars.popoverId,function(){b.closeLightbox()})};this.initializePlayerOverlayComponents=function(a){a.closest(r.PLAYER_CONTAINER_SELECTOR).delegate(r.CLOSE_BUTTON_SELECTOR,"click touchend",function(a){a.preventDefault();a.stopPropagation();b.player.pause("inline-pause");b.emitMetric(b.vars.clientPrefix+":"+r.INLINE_PLAYER_CLOSE_BUTTON_CLICK);b.vars.A.trigger("vse:ns:inlinePlayer:"+b.vars.clientPrefix+":closeButton:click");m.count("vse:ns:inlinePlayer:closeButton:click",1)});a.closest(r.PLAYER_CONTAINER_SELECTOR).delegate(r.AUDIO_TOGGLE_BUTTON_SELECTOR,
"click touchend",function(a){a.preventDefault();a.stopPropagation();a=a.hasOwnProperty("originalEvent")?t:"programmatic-trigger";b.player.isMuted()?b.player.unmute(a):b.player.mute(a);b.setAudioPreferences();b.vars.A.trigger("vse:ns:inlinePlayer:"+b.vars.clientPrefix+":audioToggle:click");m.count("vse:ns:inlinePlayer:audioToggle:click",1)});a.closest(r.PLAYER_CONTAINER_SELECTOR).delegate(r.PLAY_TOGGLE_BUTTON_SELECTOR,"click touchend",function(a){a.preventDefault();a.stopPropagation();b.player.isPaused()?
b.player.play():b.player.pause("inline-pause");b.vars.A.trigger("vse:ns:inlinePlayer:"+b.vars.clientPrefix+":playToggle:click");m.count("vse:ns:inlinePlayer:playToggle:click",1)});a.closest(r.PLAYER_CONTAINER_SELECTOR).delegate(r.EXPAND_BUTTON_SELECTOR,"click touchend",function(a){b.emitMetric(b.vars.clientPrefix+":"+r.INLINE_PLAYER_EXPAND_BUTTON_CLICK);b.vars.A.trigger("vse:ns:inlinePlayer:"+b.vars.clientPrefix+":expandButton:click");m.count("vse:ns:inlinePlayer:expandButton:click",1)})};this.startPlaying=
function(a,c,d){b.setCurrentIngressPlaceholder(c);b.changePlayerMode(r.INLINE_PLAYER_MODE);d&&b.player.setPlayerMode(d);b.vars.$ingressPlaceholder.find(r.OSP_LINK_SELECTOR).toggleClass("aok-hidden",!a||b.vars.A.objectIsEmpty(a.vendorTrackingId));b.vars.$ingressPlaceholder.find(r.REMAINING_TIME_SELECTOR).addClass("aok-hidden");b.player.play(a);setTimeout(function(){b.vars.$ingressPlaceholder.find(r.REMAINING_TIME_SELECTOR).removeClass("aok-hidden")},600);b.updateAudioToggle(c)};this.changePlayerMode=
function(a){b.player.setPlayerMode(a);b.vars.currentPlayerMode!==a&&b.vars.$ingressPlaceholder.find(r.PLAYER_WRAPPER_SELECTOR).removeClass(r.IVE_CSS_CLASS_PREFIX+b.vars.currentPlayerMode).addClass(r.IVE_CSS_CLASS_PREFIX+a);b.vars.isMobile&&(b.vars.sharedUtils.vars.isVideoImmersivePlayer=a===r.IVX_PLAYER_MODE);b.vars.sharedUtils.vars.currentPlayerMode=a;b.vars.currentPlayerMode=a};this.addOrientationChangeHandler=function(){b.vars.A.on.orientationchange(function(a){b.emitMetric(b.vars.clientPrefix+
":"+r.ROTATE_TO_ORIENTATION_METRIC_NAME+(90===Math.abs(a.orientation)?"Landscape":"Portrait"))})};this.isValidOverlayInput=function(a,b){return a&&b&&0!==b.length?!0:(console.error("Invalid parameters for updateVideoInfoOverlay"),!1)};this.updateTextContent=function(a,b,c){a=a.find(b);0!==a.length&&a.text(c||"")};this.updateAccessibleLink=function(a,b){b=b.find(".ive-accessible-link");if(0!==b.length){var c=a.title||"";a=a.vendorName||"";b.attr("aria-label",c&&a?c+", "+a:c||a||"")}};this.updateCommissionTagVisibility=
function(a,b){b=b.find(".ive-vid-osp-link");if(0!==b.length){var c=!1;a.mandatoryBadgeDisclosure&&(b.text(a.mandatoryBadgeDisclosure),c=!0);b.toggleClass("aok-hidden",!c)}};this.emitMetric=function(a){a={eventName:a,stringPayload:"",intPayload:1,titleSessionId:b.player.getTitleSessionId().toString()};b.vars.sharedUtils.emitMetricToNexus(a)};this.updateAudioToggle=function(a){var c=k.iveAudioPref;(c===r.MUTED_AUDIO_PREF&&!b.player.isMuted()||c===r.UNMUTED_AUDIO_PREF&&b.player.isMuted())&&a.find(r.AUDIO_TOGGLE_BUTTON_SELECTOR).click()};
this.setAudioPreferences=function(){k.iveAudioPref=b.player.isMuted()?r.MUTED_AUDIO_PREF:r.UNMUTED_AUDIO_PREF};this.setCurrentIngressPlaceholder=function(a){b.vars.$ingressPlaceholder=a};this.triggerLightboxOpenEvent=function(a,c){b.vars.A.trigger("vse:"+b.vars.clientPrefix+":page:lightBoxOpened",{lightBoxId:b.vars.popoverId,lazyLoadProductAsin:c,assetSpec:a})};this.closeLightbox=function(){b.vars.A.trigger("vse:"+b.vars.clientPrefix+":page:lightBoxClosed");setTimeout(function(){b.movePlayerToIngress(b.vars.$ingressPlaceholder);
b.player.play();b.vars.$ingressPlaceholder.find(r.BLUR_WRAPPER_SELECTOR).show()},50);b.vars.callback&&b.vars.callback()};this.updateTimeDisplay=function(){var a=b.vars.$ingressPlaceholder.find(r.REMAINING_TIME_SELECTOR);if(a.length){var c=b.player.getMediaDuration();if(!isNaN(c)){var d=Math.min(b.player.getCurrentTime(),c),e=c-d,c=Math.floor(e/3600),d=Math.floor(e/60%60),e=Math.floor(e%60);a.text((0<c?c+":":"")+(0<c&&10>d?"0"+d+":":d+":")+(10>e?"0"+e:e))}}};this.handleError=function(a,c){m.count("vse:ns:inlinePlayer:"+
b.vars.clientPrefix+":"+a,1);m.logError(r.ATTRIBUTION_NAME,"Fallback for inline player "+b.vars.clientPrefix,c);b.vars.A.trigger("vse:ns:inlinePlayer:"+b.vars.clientPrefix+":"+a)};this.vars={A:d,sharedUtils:c,clientPrefix:c.vars.clientPrefix,popoverTriggerId:a.popoverTriggerId,popoverId:a.popoverId,isMobile:c.vars.isMobile,lightboxOpenedFirstTime:!0,clickedVideo:null,previouslyClickedVideo:null,ingressAssetSpec:null,$ingressPlaceholder:null,mediaEnded:!1,callback:null};this.player=c.vars.player}}(),
J=function(){function d(c,a,b,h){var d=this;this.onIntersectionObserved=function(a,b){a.forEach(function(a){if(b){var c=a.target,h=d.getElementUniqueKey(c);if(a.isIntersecting)a=k.setTimeout(function(){var a=d.childElems.indexOf(c);d.callback(a,d.itemsToBeObserved[a]);delete d.viewTimeout[h]},1E3),d.viewTimeout[h]=a;else if(a=d.viewTimeout[h])k.clearTimeout(a),delete d.viewTimeout[h]}else a.isIntersecting&&(a=d.childElems.indexOf(a.target),d.callback(a,d.itemsToBeObserved[a]))})};this.disconnectObserver=
function(){d.intersectionObserver.disconnect()};c===t&&(c=null);this.callback=b;this.parentEle=c;if(this.itemsToBeObserved=a)this.childElems=Array.prototype.slice.call(a),this.options={root:this.parentEle,rootMargin:"0px",threshold:.5},this.viewTimeout={},this.intersectionObserver=new IntersectionObserver(function(a){return d.onIntersectionObserved(a,h)},this.options),this.childElems.forEach(function(a){d.intersectionObserver.observe(a)})}d.prototype.getElementUniqueKey=function(c){return c.id||c.outerHTML};
return d}(),e=function(){function d(){}d.PLAYER_INITIALIZED="vse-player-initialized";d.LB_OPENED="vse-lb-opened";d.PLAYER_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-player-failed-to-render-no-pagestate";d.LAZY_LOAD_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-lazyload-failed-to-render-no-pagestate";d.RV_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-rv-failed-to-render-no-pagestate";d.INGRESS_RV_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-ingress-failed-to-render-no-pagestate";d.FEEDBACK_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-feedback-failed-to-render-no-pagestate";
d.METADATA_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-metadata-failed-to-render-no-pagestate";d.SOCIAL_SHARE_STATE_NOT_FOUND_ERROR_KEY="vse-social-share-failed-to-render-no-pagestate";d.RELATED_PRODUCT_PAGE_STATE_NOT_FOUND_ERROR_KEY="vse-related-product-failed-to-render-no-pagestate";d.LB_POPOVER_NOT_FOUND_ERROR_KEY="vse-lb-failed-to-render-no-popover";d.VISIBLE_DIV_NARROW_PREFIX="vse-pc-visible-narrow-";d.PC_HIDDEN_CACHE_DIV_PREFIX="vse-pc-hidden-cache-";d.AJAX_MAX_RETRY_COUNT=3;d.CLICK_ATTRIBUTION_INITIAL_DELAY=
2;d.VAP_EW="/vap/ew/";d.RELATED_PRODUCTS_ENDPOINT="subcomponent/relatedproducts/";d.PUI_RELATED_PRODUCTS_ENDPOINT="subcomponent/puirelatedproducts/";d.WEBLAB_TRIGGER_ENDPOINT="weblabtrigger/batch/v2";d.EMPTY_STRING="";d.PORTRAIT="portrait";d.LANDSCAPE="landscape";d.SQUARE="square";d.PORTRAIT_ASPECT_RATIO="9:16";d.LANDSCAPE_ASPECT_RATIO="16:9";d.SQUARE_ASPECT_RATIO="1:1";d.IS_VIDEO_IMMERSIVE_PLAYER_KEY="isVideoImmersivePlayer";d.SHOW_CONTENT_CAROUSEL="showContentCarousel";d.COMMA=",";d.SEMICOLON=";";
d.INGRESS_CAROUSEL_SUFFIX="-vse-related-videos";d.ENGLISH="english";d.HINDI="hindi";d.VFTP_HERO_CARD="vftphero";d.COMPLEMENTARY_ASIN="complementaryAsin";d.LANDING_ASIN="landingAsin";d.SPONSORED_ASIN="sponsored";d.videoInformationContainer=".vse-lb-video-metadata";d.videoTitle=d.videoInformationContainer+" .vse-content-title";d.vendorName=d.videoInformationContainer+" .vse-video-author";d.videoAge=d.videoInformationContainer+" .ive-video-age";d.followButton=".vse-follow-button .amazon-follow-v3";d.vseFollowClass=
".vse-follow-button";d.ccvDisclosureMessage=".ive-cross-country-disclosure-message";d.creatorAndDisclosure=".vse-creator-name-and-disclosure";d.ibVideoOspDisclosure=d.videoInformationContainer+" .vse-oap-disclosure-container";d.ibVideoAiDisclosure=d.videoInformationContainer+" .vse-aip-disclosure-container";d.verifiedPurchaseLabel=".ive-verified-purchase-label";d.verifiedPurchaseLabelDivider=".ive-verified-label-name-divider";d.socialShareClickMetricName="vseSocialShareClickImageBlock";d.relatedEnglishVideosContainer=
"vse-related-english-videos-carousel-container";d.relatedHindiVideosContainer="vse-related-hindi-videos-carousel-container";d.vernacLanguageRadioBlockSelector=".vse-carousel-vernac-language-radio-button-container";d.RELATED_PRODUCTS_INNER_CONTAINER=".vse-rp-container";d.RELATED_PRODUCTS_INNER_CLASS_NAME="vse-rp-container";d.CACHE_RP_PAYLOAD_HIDDEN_DIV_CONTAINER=".vse-related-products-cache-hidden";d.HERO_WIDGET_CONTAINER=".vse-hero-widget";d.CACHE_RP_PAYLOAD_HIDDEN_DIV_CARDS_CONTAINER="vse-placeholder-related-products-config";
d.RELATED_PRODUCTS_CONTAINER_SELECTOR=".vse-related-products-narrow";d.HAS_PUI_SELECTOR=".has-pui";d.RELATED_PRODUCTS_CAROUSEL_ELEMENT=".vse-product-carousel-element";d.RELATED_PRODUCTS_ITEM_SELECTOR=".vse-product-item";d.ATTRIBUTION_NAME="vse-component-assets";d.LB_CAROUSEL_CONFIG='div[class^\x3d"div-"][class$\x3d"-vip-relatedvideos"]';d.LB_CLOSE_BUTTON_ON_PLAYER_CLASS_NAME="vse-close-button-on-player";d.TABLET_LIGHTBOX_CLASS_NAME="vse-tablet-popover";d.ATTR_ORIGINAL_HREF="data-og-href";d.ActionContainerSelector=
".vse-lb-actions-container";d.CRVInfoSelector=".vse-crv-info";d.MetadataWrapperSelector=".vse-active-metadata-wrapper";d.ActiveMetadataSelector=".vse-active-metadata";d.PUI_WRAPPER_ELEMENT=".pui-wrapper";d.reportDefaultMessageSelector=".vse-fb-description";d.reportIllegalMessageSelector=".vse-fb-description-eu";d.reportIllegalLinkSelector=".vse-fb-report-illegal-content";d.SHOP_THE_VIDEO_WEBLAB="ASV_SHOP_THE_VIDEO_1149841";d.HOTSPOTS_V2_WEBLAB="ASV_IVX_PLAYER_HOTSPOTS_V2_1170947";d.TRANSLATED_CC_WEBLAB=
"ASV_D_TRANSLATED_CC_1310292";d.AUI_POPOVER_INNER=".a-popover-inner";d.IVE_THEME=".ive-immersive-bounds";d.VIPSelector=".vse-vip";d.VIPLightboxSelector=".vse-vip-lightbox";d.LightboxWrapperSelector=".vse-lightbox-wrapper";d.PlayerContainerSelector=".vse-player-container";d.VIPOverlaySelector=".vse-vip-overlay";d.VIPActionOverlaySelector=".vse-vip-actions-overlay";d.VIPLbTabsAndCarouselOverlaySelector=".vse-vip-lb-tabs-carousel-container-overlay";d.VIPLbCarouselSelector=".vse-vip-lb-carousel-container";
d.VIPProductCarouselOverlaySelector=".vse-pc-container-overlay";d.VIPLbTabsAndCarouselContainerSelector=".vse-vip-lb-tabs-carousel-container";d.VIPProductCarouselOverlayContainerSelector=".vse-pc-container";d.VIPShopIconBlockSelector=".vse-vip-shop";d.VIPShopIconSelector=".vse-vip-shop-icon";d.VIPWatchIconSelector=".vse-vip-watch-icon";d.VIPWatchIconBlockSelector=".vse-vip-watch";d.VIPShareIconBlockSelector=".vse-vip-share";d.VIPShareIconSelector=".vse-vip-share-icon";d.VIPActionIconSelector=".vse-vip-action-icon";
d.VIPEmptyRelatedProductsContainerSelector=".vse-related-products-mobile-empty";d.VIPLbTabsContainerSelector=".vse-vip-lb-tabs";d.VIPLbCarouselViewportSelector=".vse-vip-lb-carousel .a-carousel-viewport";d.VerticalCarouselScrollableElement=".vse-lb-right";d.VIPSkipBackButtonSelector=".vse-vip-skip-backward-button";d.VIPSkipForwardButtonSelector=".vse-vip-skip-forward-button";d.VIPPlayPauseToggleSelector=".vse-vip-play-pause-toggle";d.VIPProgressBarSelector=".vse-vip-scrubber-bar";d.VIPProgressBarFillSelector=
".vse-vip-scrubber-bar-fill";d.VIPTimeRemainingSelector=".vse-vip-time-remaining-display";d.VIPProductCarouselViewportSelector=".vse-pc-container .a-carousel-viewport";d.VIPSeeMoreBlockSelector=".vse-vip-see-more";d.VIPSeeMoreLinkSelector=".vse-vip-see-more-link";d.VIPSeeMoreTextSelector=".vse-vip-see-more-text";d.VIPCloseButton=".vse-close-button";d.VIPPlayPauseContainerSelector=".vse-vip-play-pause-dummy-container";d.VIPSearchButtonSelector=".ive-search-button";d.VIPSearchButtonHideText="hide-text";
d.VisualSearchMetricPrefix="ive:visual:search:";d.VisualSearchOverlaySelector=".hotspots-overlay-container";d.VisualSearchPFOSheetSelector=".ive-bottom-sheet-pfo-grid";d.VisualSearchPFOArrowSelector=".ive-pfo-sheet-arrow-wrapper";d.VisualSearchPFOHandleSelector=".ive-pfo-sheet-handle";d.VisualSearchPFOFindingProductsText=".ive-pfo-bottom-sheet-finding-text";d.VisualSearchPFOFailureMessageSection=".ive-pfo-failure-section";d.VisualSearchPFONoMatchText=".ive-pfo-not-match-text";d.VisualSearchPFOSingleHotSpotFailureInstructionText=
".ive-pfo-single-hotspot-failure-instruction-text";d.VisualSearchPFOAllHotSpotsFailureInstructionText=".ive-pfo-all-hotspots-failure-instruction-text";d.VisualSearchPFOFoundProductsText=".ive-pfo-bottom-sheet-found-text";d.VisualSearchPFOFindProductsContent=".ive-bottom-sheet-content";d.VisualSearchPFOCloseSheetArrow=".ive-pfo-sheet-arrow";d.VisualSearchAmazonLensLogo=".ive-amazon-lens-logo-container";d.VisualSearchAmazonAILensLogo=".ive-amazon-lens-ai-logo-container";d.VisualSearchBackButton=".ive-vsearch-close-button";
d.VisualSearchGotItButton=".ive-search-gotit-button";d.VisualSearchTopBar=".ive-vsearch-top-bar";d.VisualSearchBBXCanvasSelector=".bbx-canvas";d.VisualSearchControlCanvasSelector=".hotspots-control-overlay";d.VisualSearchAnimationOverlaySelector=".hotspots-animation-overlay";d.VisualSearchTooltipText=".ive-search-tooltip-text";d.IVECustomerReviewVideosToolTipText=".ive-customer-tooltip-text";d.CUSTOMER_REVIEW_TOOLTIP_TEXT_ID="#ive-crv-tooltip";d.CUSTOMER_REVIEW_TOOLTIP_TEXT="ive_crv_timestamp";d.productAsinAttributeSelector=
"data-dib-asin";d.addToCartMetricSuffix="addToCart";d.seeMoreMetricSuffix="seeOptions";d.productAsinMetricSuffix="productAsin";d.addToCartClickSelector=".puis-atcb-add-container";d.seeOptionsClickSelector=".puis-see-details-content";d.productAsinClickSelector='span[data-csa-c-func-deps\x3d"aui-da-detail-page-link-tap"]';d.colorSwatchClickSelector='span[data-component-type\x3d"s-color-swatch"]';d.detailPageLinkJsonKey="detailPageLink";d.puiRelatedProductAsinSelector='span[data-csa-c-func-deps\x3d"aui-da-puis-card-container-declarative"]';
d.puiStarRatingSelector='i[data-cy\x3d"reviews-ratings-slot"]';d.pfoRelatedProductSelector="div[data-asin]";d.VIPCCButtonSelector=".vse-vip-custom-cc-button";d.VIPCCTooltipSelector=".vse-vip-cc-tooltip";d.VIPCCTooltipTextSelector=".vse-vip-cc-tooltip-text";d.VIPCCTextTrackSelector=".vjs-text-track-display";d.defaultPlayerCCButtonTitleSelector=".vjs-subs-caps-button.vjs-menu-button \x3e button";d.LabelNameSelector=".ive-player-label-name";d.LabelTooltipSelector=".ive-player-label-tooltip";d.CCVContainerSelector=
".ive-cross-country-disclosure";d.CCVCloseButton="ive-ccv-disclosure-sheet-close";d.CCVBottomSheetTrigger=".ive-ccv-bottom-sheet-trigger";d.AUISheetCloseButtonSelector=".a-sheet-close";d.VIPMuteUnmuteSelector=".ive-vip-custom-mute_unmute-button";d.VIPVideoTitleSelector=".vse-video-title-ellipsis-wrapper";d.VIPReviewsAuthorProfileImageSelector=".vse-reviews-author-profile-image";d.VIPReviewsAuthorStarBadgesSelector=".vse-reviews-author-star-badges";d.VIPReviewsExpandableContentSelector=".vse-reviews-content-expand-container";
d.VIPCRVTitle=".vse-crv-title";d.VIPReviewsMetadataSelectors=[d.VIPVideoTitleSelector,d.VIPReviewsAuthorProfileImageSelector,d.VIPReviewsAuthorStarBadgesSelector,d.VIPReviewsExpandableContentSelector,d.CRVInfoSelector,d.VIPCRVTitle];d.VIPFeedbackContainer=".vse-fb-trigger-container";d.VIPMultiCarouselWrapper=".vse-vip-lb-multi-carousel-container-wrapper";d.VIPMultiCarouselOverlay=".vse-vip-lb-multi-carousel-container-overlay";d.VIPMultiCarouselContainer=".ive-vip-lb-carousel-container";d.VIPMultiCarouselOneContainer=
".vse-vip-lb-first-carousel-container";d.VIPMultiCarouselTwoContainer=".vse-vip-lb-second-carousel-container";d.VIPMultiCarouselOneCarousel=".vse-vip-lb-first-carousel-container .a-carousel-viewport";d.VIPMultiCarouselTwoCarousel=".vse-vip-lb-second-carousel-container .a-carousel-viewport";d.VIPMultiCarouselExpandedClass="vse-vip-multi-carousel-expanded";d.G1="G1";d.G2="G2";d.VIPPlayIconClassName="vse-vip-play-icon";d.VIPPauseIconClassName="vse-vip-pause-icon";d.VIPLbOverlayShowCssClassName="vse-lb-tabs-overlay-show";
d.VIPOverlayShowClassName="vse-overlay-show";d.VIPActionOverlayShowClassName="vse-vip-ao-show";d.VIPActionOverlayBgShadowClassName="vse-carousel-bg-animation";d.VIPMetadataClassName="vse-lb-video-metadata";d.VIPVideoInfoClassName="vse-video-info";d.VIPVideoAgeClassName="ive-video-age";d.VIPVideoHelpfulVotesClassName="vse-helpful-votes";d.VIPVideoTitleWrapperClassName="video-title-ellipsis-wrapper";d.VIPPlayPauseClassName="vse-vip-play-pause-forward-previous-btns-container";d.VIPScrubberClassName=
"vse-vip-controls";d.UpNextClassName="vse-up-next";d.UpNextVideoTitleClassName="vse-up-next-video-title";d.UpNextAuthorClassName="vse-up-next-author";d.UpNextCancelClassName="vse-up-next-cancel";d.UpNextElementClassName="vse-upn-element";d.UpNextElementShownClassName="vse-upn-element-shown";d.CarouselHeader=".vse-vc-header";d.VIPMuteIconClassName="ive-mute";d.VIPUnmuteIconClassName="ive-unmute";d.ReviewTextExpandClassName="vse-reviews-expand-full-cr";d.CRVMetadataClassName="vse-crv-metadata-show";
d.VIPCCButtonUnpressedClassName="vse-cc-unpressed";d.VIPCCButtonPressedClassName="vse-cc-pressed";d.VIPVideoCarouselOpenedClassName="vse-vip-video-carousel-opened";d.VIPProductCarouselOpenedClassName="vse-vip-product-carousel-opened";d.VIPReviewsOverlayVisibleClassName="vse-vip-reviews-overlay-visible";d.VIPLandscapeVideoClassName="vse-vip-landscape-video";d.METRIC_WIDGET_CLICK=":widget:click";d.METRIC_LIGHTBOX_OPEN="ive-lightbox-opened";d.METRIC_VIP_CLOSE="vip:close";d.METRIC_VIP_CLOSE_WITHOUT_PLAY=
"vip:close:without:play";d.METRIC_PLAY="vip:play:icon:click";d.METRIC_PORTRAIT_MODE="vip:portrait:mode:render";d.METRIC_LANDSCAPE_MODE="vip:landscape:mode:render";d.METRIC_PAUSE="vip:pause:icon:click";d.METRIC_SKIP_FORWARD="vip:skip:forward:icon:click";d.METRIC_SKIP_BACK="vip:skip:back:icon:click";d.METRIC_SHOP_ICON_CLICK="vip:shop:icon:click";d.METRIC_SHOP_ICON_UNCLICK="vip:shop:icon:unclick";d.METRIC_WEBLAB_TRIGGER_SUCCESS="weblabtrigger:request:success";d.METRIC_WEBLAB_TRIGGER_FAILURE="weblabtrigger:request:failure";
d.METRIC_PFO_CLICK="shop:pfo:click";d.METRIC_PFO_RENDER="shop:pfo:render";d.METRIC_PFO_IMPRESSION="shop:pfo:impression";d.METRIC_PUI_CLICK_PREFIX="shop:pfo";d.METRIC_WATCH_ICON="vip:watch:icon:click";d.METRIC_WATCH_HANDLE_CLICK="vip:watch:handle:click";d.METRIC_WATCH_THUMBNAIL_CLICK="vip:watch:thumbnail:click";d.METRIC_WATCH_THUMBNAIL_RENDER="vip:watch:thumbnail:render";d.METRIC_WATCH_THUMBNAIL_IMPRESSION="vip:watch:thumbnail:impression";d.METRIC_UPNEXT_THUMBNAIL_IMPRESSION="vip:watch:upNextThumbnail:impression";
d.METRIC_SHARE_ICON="share:icon:click";d.METRIC_SHARE_SELECTION_CLICK="share:selection:click";d.AUTOPLAY_FALLBACK_EXECUTED="vse:autoplay:fallback";d.METRIC_HELPFUL_VOTES_IMPRESSION="videovote:icon:impression";d.METRIC_MORE_MENU_CLICK="moreMenu:icon:click";d.METRIC_MORE_MENU_IMPRESSION="moreMenu:icon:impression";d.METRIC_REPORT_CLICK="report:icon:click";d.METRIC_REPORT_SUBMIT="report:icon:submit";d.METRIC_OPEN_LIGHTBOX_EVENT_EXECUTION="vse:lightbox:open:duration";d.METRIC_LB_THUMBNAIL_CLICK="ive:lb:thumbnail:click";
d.METRIC_LB_THUMBNAIL_IMPRESSION="ive:lb:thumbnail:impression";d.SINGLE_VIDEO_LB_CSS_CLASS="vse-single-video-lb";d.METRIC_LB_SHOW_MORE_BUTTON_CLICK="ive:lb:showMoreButton:click";d.METRIC_LB_SHOW_MORE_BUTTON_IMPRESSION="ive:lb:showMoreButton:impression";d.AUDIO_UNAVAILABLE_OVERLAY="audio-unavailable-overlay";d.hideAfter=4E3;return d}(),ga=t&&t.__assign||Object.assign||function(d){for(var c,a=1,b=arguments.length;a<b;a++){c=arguments[a];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(d[h]=
c[h])}return d},S=t&&t.__awaiter||function(d,c,a,b){return new (a||(a=Promise))(function(h,e){function u(a){try{l(b.next(a))}catch(c){e(c)}}function g(a){try{l(b["throw"](a))}catch(c){e(c)}}function l(b){b.done?h(b.value):(new a(function(a){a(b.value)})).then(u,g)}l((b=b.apply(d,c||[])).next())})},T=t&&t.__generator||function(d,c){function a(a){return function(c){return b([a,c])}}function b(a){if(e)throw new TypeError("Generator is already executing.");for(;h;)try{if(e=1,u&&(g=u[a[0]&2?"return":a[0]?
"throw":"next"])&&!(g=g.call(u,a[1])).done)return g;if(u=0,g)a=[0,g.value];switch(a[0]){case 0:case 1:g=a;break;case 4:return h.label++,{value:a[1],done:!1};case 5:h.label++;u=a[1];a=[0];continue;case 7:a=h.ops.pop();h.trys.pop();continue;default:if(!(g=h.trys,g=0<g.length&&g[g.length-1])&&(6===a[0]||2===a[0])){h=0;continue}if(3===a[0]&&(!g||a[1]>g[0]&&a[1]<g[3]))h.label=a[1];else if(6===a[0]&&h.label<g[1])h.label=g[1],g=a;else if(g&&h.label<g[2])h.label=g[2],h.ops.push(a);else{g[2]&&h.ops.pop();
h.trys.pop();continue}}a=c.call(d,h)}catch(b){a=[6,b],u=0}finally{e=g=0}if(a[0]&5)throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}var h={label:0,sent:function(){if(g[0]&1)throw g[1];return g[1]},trys:[],ops:[]},e,u,g,l;return l={next:a(0),"throw":a(1),"return":a(2)},"function"===typeof Symbol&&(l[Symbol.iterator]=function(){return this}),l},ha=function(){function d(c,a){var b=this;this.config=a;this.currentBoundingBoxes=[];this.firstTimeInitialize=!0;this.isMshop=!1;this.BORDER_OFFSET_PX=4;this.LANDSCAPE_VIDEO_FRAME_PADDING_TOP_PX=
8;this.VIDEO_FRAME_VERTICAL_PADDING_PX=36;this.VIDEO_FRAME_HORIZONTAL_PADDING_PX=20;this.hideAfter=4E3;this.IVE_HOTSPOTS_COUNTER="ive_hotspots_counter";this.IVE_HOTSPOTS_TIMESTAMP="ive_hotspots_timestamp";this.SEARCH_BLINKING_STAR_ANIMATION=".ive-blinking-star-animation";this.SEARCH_TOOLTIP_TEXT_ID="#ive-search-tooltip-trigger";this.firstProductFaceoutCallForTheFrame=!0;this.handleSearchButtonInteractions=function(){try{b.$ivxWrapper=b.A.$("#"+b.templateId).closest(e.VIPSelector),b.config.A.$("#"+
b.templateId+" "+e.VIPSearchButtonSelector).unbind("click"),b.config.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).click(function(a){a.stopPropagation();a.stopImmediatePropagation();b.pauseVideoIfPlaying();b.enterVisualSearchMode();b.currentVideoContentId=b.player.getCurrent().contentId;b.enableHotspotsForPausedFrame(b.currentVideoContentId);b.emitMetric(e.VisualSearchMetricPrefix+"searchButton:click")}),b.config.A.$("#"+b.templateId+" "+e.VisualSearchBackButton).unbind("click"),b.config.A.$("#"+
b.templateId+" "+e.VisualSearchBackButton).click(function(a){a.stopPropagation();a.stopImmediatePropagation();b.isHotspotDisplay()||b.emitMetric(e.VisualSearchMetricPrefix+"visualsearch:exit:before:hotspot");b.exitVisualSearchMode();b.emitMetric(e.VisualSearchMetricPrefix+"backButton:click")}),b.canvas=document.createElement("canvas"),b.A.$("#"+b.templateId+" video").length&&b.A.$("#"+b.templateId+" video").insertBefore(b.canvas),b.$bbXCanvas=b.A.$("#"+b.templateId+" "+e.VisualSearchBBXCanvasSelector),
b.addOrientationChangeHandler(),b.updateIVXWrapperProperties(),b.setupPFOClickHandlers(),b.addSwipeUpDownHandler(),b.currentVideoContentId=b.player.getCurrent().contentId,b.emitMetric(e.VisualSearchMetricPrefix+"searchButton:rendered")}catch(a){m.logError(e.ATTRIBUTION_NAME,"Visual search has failed",a),b.emitMetric(e.VisualSearchMetricPrefix+"failure")}};this.isHotspotDisplay=function(){return 0<b.A.$("#"+b.templateId+" "+e.VisualSearchBBXCanvasSelector+' span[id^\x3d"bbx-"]').length};this.enableHotspotsForPausedFrame=
function(a){var c=D.fetchLatestPageState(b.A,b.clientPrefix+"-visual-search-ps");b.$blinkingStarAnimation=b.config.A.$("#"+b.templateId+" "+b.SEARCH_BLINKING_STAR_ANIMATION).detach();b.moveBlinkingStarAnimation("#"+b.templateId+" "+e.VisualSearchOverlaySelector);b.A.delay(function(){b.showElement(e.VisualSearchOverlaySelector+" "+b.SEARCH_BLINKING_STAR_ANIMATION)},100);b.firstProductFaceoutCallForTheFrame=!0;b.displayVideoDimensions=b.calculateVideoDimensions();var d=b.getCurrentTime(),g={contentId:a,
timestamp:Math.ceil(1E3*b.player.getCurrentTime()),marketplaceId:c.marketplaceId},l=function(a,c,h){m.logError(e.ATTRIBUTION_NAME,"/getHotspots request has failed",h);b.showPFOSheetErrorMessage(!1);b.$bbXCanvas.addClass("aok-hidden");b.removeBlinkingStarAnimation();b.emitMetric(e.VisualSearchMetricPrefix+"gethotspots:request:failure")},q=function(a){b.sendLatencyMetric(d,"gethotspots:request:latency");b.emitMetric(e.VisualSearchMetricPrefix+"gethotspots:request:success");null===a||null===a.results||
0===a.results.length?(b.$bbXCanvas.addClass("aok-hidden"),b.removeBlinkingStarAnimation(),b.emitMetric(e.VisualSearchMetricPrefix+"gethotspots:response:empty"),b.showPFOSheetErrorMessage(!1)):(b.currentBoundingBoxes=[],a.results.forEach(function(a){b.currentBoundingBoxes.push({blx:a.bounding_box.bottom_left_x,bly:a.bounding_box.bottom_left_y,brx:a.bounding_box.bottom_right_x,bry:a.bounding_box.bottom_right_y,imh:a.bounding_box.image_height,imw:a.bounding_box.image_width,tlx:a.bounding_box.top_left_x,
tly:a.bounding_box.top_left_y,trx:a.bounding_box.top_right_x,try:a.bounding_box.top_right_y,asins:a.asins,pfoHtml:a.pfoHtml,$bbX:a.$bbX})}),b.hidePFOSheetErrorMessage(),b.cleanupPreviousHotspots(),b.showHotspots())};c.isV2?(b.emitMetric(e.VisualSearchMetricPrefix+"v2:request"),b.captureBase64Img().then(function(a){g.base64Img=a;b.makeRequest(c,g,q,l);b.emitMetric(e.VisualSearchMetricPrefix+"v2:request:success:base64img")})):(b.emitMetric(e.VisualSearchMetricPrefix+"v1:request"),b.makeRequest(c,g,
q,l))};this.makeRequest=function(a,c,d,e){a={url:a.hotspotsEndpoint,data:JSON.stringify(c),type:"POST",contentType:"application/json; charset\x3dutf-8",crossDomain:!0,headers:{Authorization:"allow","x-api-key":a.hotspotsEndpointKey},error:e,success:d};b.A.$.ajax(a)};this.sendLatencyMetric=function(a,c){m.count(e.VisualSearchMetricPrefix+c,b.getCurrentTime()-a)};this.getCurrentTime=function(){return performance?performance.now():Date.now()};this.moveBlinkingStarAnimation=function(a){b.$blinkingStarAnimation&&
0<b.$blinkingStarAnimation.length&&b.$blinkingStarAnimation.appendTo(a)};this.removeBlinkingStarAnimation=function(){b.hideElement(e.VisualSearchOverlaySelector+" "+b.SEARCH_BLINKING_STAR_ANIMATION);b.moveBlinkingStarAnimation("#"+b.templateId+" "+e.VIPOverlaySelector)};this.showHotspots=function(){b.displayVideoDimensions=b.calculateVideoDimensions();if(b.getDeviceOrientation()==e.LANDSCAPE)b.$bbXCanvas.css({width:b.displayVideoDimensions.width+"px",height:b.displayVideoDimensions.height+"px",left:(b.A.$(k).width()-
b.displayVideoDimensions.width)/2+"px",top:b.LANDSCAPE_VIDEO_FRAME_PADDING_TOP_PX+"px",position:"absolute"});else{var a=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector+" video").get(0).getBoundingClientRect(),c=(a.height-b.displayVideoDimensions.height)/2,d=b.A.$("#"+b.templateId+" "+e.VisualSearchTopBar).outerHeight(!0),g=b.A.$("#"+b.templateId+" "+e.VisualSearchOverlaySelector).get(0).getBoundingClientRect().top;b.$bbXCanvas.css({width:b.displayVideoDimensions.width+"px",height:b.displayVideoDimensions.height+
"px",left:(b.A.$(k).width()-b.displayVideoDimensions.width)/2+"px",top:a.top+c-d-g+"px",position:"relative"})}b.captureVideoFrame().then(function(a){var c={height:b.displayVideoDimensions.height,width:b.displayVideoDimensions.width,ratio:1};b.getBoundingBoxCoordinates(c).map(function(h,d){var e=b.$bbXCanvas.find("#placeholder-bbx"),f=e.clone();f.attr("id","bbx-"+d);0===b.$bbXCanvas.find("#"+f.attr("id")).length&&(b.appendHotspotsToFrame(h,f),b.addHotspotClickHandler(h,f,c,a));b.currentBoundingBoxes[d].$bbX=
f;e.addClass("aok-hidden")});var h=b.$currentlyClickedbbX===t||null===b.$currentlyClickedbbX?0:b.currentBoundingBoxes.map(function(a){return a.$bbX.attr("id")}).indexOf(b.$currentlyClickedbbX.attr("id"));b.currentBoundingBoxes[h].$bbX.trigger("click",["forceClick"])})};this.showPFOSheet=function(){b.firstTimeInitialize&&(b.$pfoSheet=b.A.$("#"+b.templateId+" "+e.VisualSearchPFOSheetSelector),b.$ivxWrapper.append(b.$pfoSheet),b.$pfoSheetContainer=b.$ivxWrapper.find(e.VisualSearchPFOSheetSelector),b.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector+
".open","transitionend",function(){b.toggleFixedArrowClass(!0)}));b.$pfoSheet.addClass("loading");b.$pfoSheetContainer.find(e.VisualSearchPFOFindingProductsText).removeClass("aok-hidden");b.$pfoSheetContainer.find(e.VisualSearchPFOFoundProductsText).addClass("aok-hidden");b.$pfoSheetContainer.find(e.VisualSearchPFOFindProductsContent).addClass("aok-hidden");b.$pfoSheetContainer.removeClass("aok-hidden");b.firstTimeInitialize=!1};this.hidePFOSheet=function(){b.$pfoSheetContainer=b.$ivxWrapper.find(e.VisualSearchPFOSheetSelector);
b.$pfoSheetContainer.addClass("aok-hidden");b.$ivxWrapper.find(e.VisualSearchPFOHandleSelector).addClass("aok-hidden")};this.handlePFOClickMetric=function(a,c,d,g){void 0===g&&(g=!1);b.$ivxWrapper.delegate(a,"click",function(a){(a=b.getProductAsinForPUI(a,d))&&b.emitMetric(""+e.VisualSearchMetricPrefix+c+":click",a)})};this.setupPFOClickHandlers=function(){b.handlePFOClickMetric(e.addToCartClickSelector,e.addToCartMetricSuffix,e.productAsinAttributeSelector);b.handlePFOClickMetric(e.seeOptionsClickSelector,
e.seeMoreMetricSuffix,e.productAsinAttributeSelector);b.handlePFOClickMetric(e.productAsinClickSelector,e.productAsinMetricSuffix,e.productAsinAttributeSelector,!0);b.handlePFODetailPageRedirect()};this.handlePFODetailPageRedirect=function(){var a=[e.productAsinClickSelector,e.colorSwatchClickSelector,e.seeOptionsClickSelector].join(", ");b.$ivxWrapper.delegate(a,"click",function(a){b.isPfoSheetOpened()?b.isMshop||(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),(a=b.A.$(a.target).closest("a").attr("href"))&&
k.open(a,"_blank")):(b.openPfoSheet(),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation())})};this.findSimilarProducts=function(a){var c=b.getCurrentTime(),d=function(d){b.sendLatencyMetric(c,"getpuirelatedproducts:request:latency");b.findSimilarProductsSuccessCallback(a,d);!0===b.firstProductFaceoutCallForTheFrame&&b.removeBlinkingStarAnimation();b.firstProductFaceoutCallForTheFrame=!1},g={productList:a.asins,metadata:{layout:"grid"}},l=3,q=function(a){(0===a.http.status||500<=a.http.status&&
599>=a.http.status)&&0<l?(C.sendRequest(b.A,""+e.VAP_EW+e.PUI_RELATED_PRODUCTS_ENDPOINT,g,d,q),l--):(b.showPFOSheetErrorMessage(!0),b.removeBlinkingStarAnimation(),b.emitMetric(e.VisualSearchMetricPrefix+"getpuirelatedproducts:request:failure"))};b.showPFOSheet();C.sendRequest(b.A,""+e.VAP_EW+e.PUI_RELATED_PRODUCTS_ENDPOINT,g,d,q)};this.findSimilarProductsSuccessCallback=function(a,c){var d=b.$pfoSheetContainer.find(e.VisualSearchPFOFindProductsContent);d.toggleClass("aok-hidden",!1);d.animate({left:"-100%"},
300,function(){d.html(c);d.css({left:"100%"});d.animate({left:"0%"},300)});a.pfoHtml=c;a.$bbX&&(b.currentBoundingBoxes.filter(function(b){return b.$bbX[0].id==a.$bbX[0].id})[0].pfoHtml=c);b.hidePFOSheetErrorMessage();b.$pfoSheetContainer.find(e.VisualSearchPFOFindingProductsText).toggleClass("aok-hidden",!0);b.$pfoSheetContainer.find(e.VisualSearchPFOFoundProductsText).removeClass("aok-hidden");b.$pfoHandle=b.$pfoSheetContainer.find(e.VisualSearchPFOHandleSelector);b.$pfoHandle.length?b.$ivxWrapper.append(b.$pfoHandle):
b.$pfoHandle=b.$ivxWrapper.find(e.VisualSearchPFOHandleSelector);b.isInVisualSearchMode()?(b.$pfoHandle.removeClass("aok-hidden"),b.$pfoHandle.unbind("click"),b.$pfoSheet.removeClass("loading"),b.$pfoHandle.click(b.openPfoSheetIfClosed),b.$pfoSheet.unbind("click"),b.$pfoSheet.click(function(a){b.A.$(a.target).closest(e.productAsinClickSelector).length||b.openPfoSheetIfClosed()})):b.emitMetric(e.VisualSearchMetricPrefix+"visualsearch:exit:before:pfo")};this.openPfoSheetIfClosed=function(){b.isPfoSheetOpened()||
b.openPfoSheet()};this.isPfoSheetOpened=function(){return b.$pfoSheetContainer.hasClass("open")};this.addSwipeUpDownHandler=function(){b.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector,"touchend");b.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector,"touchstart",function(a){var c=a.originalEvent.touches[0].clientY;b.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector,"touchmove",function(a){a=c-a.originalEvent.touches[0].clientY;b.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector,"touchmove");
1<Math.abs(a)&&(0<a?b.openPfoSheetIfClosed():(a=b.A.$(e.VisualSearchPFOFindProductsContent).offset().top,b.isPfoSheetOpened()&&a>(b.isMshop?100:50)&&a<(b.isMshop?200:100)&&b.closePfoSheet()))});b.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector,"touchend",function(){b.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector,"touchmove touchend")})})};this.openPfoSheet=function(){b.$pfoHandle.length&&b.$pfoHandle.addClass("aok-hidden");b.$pfoSheetContainer.addClass("open");var a=b.$pfoSheetContainer.find(e.VisualSearchPFOCloseSheetArrow);
a.unbind("click");a.click(function(a){a.preventDefault();a.stopPropagation();b.closePfoSheet()});b.emitMetric(e.VisualSearchMetricPrefix+"pfoSheet:open")};this.closePfoSheet=function(){b.$pfoSheetContainer.removeClass("open");b.toggleFixedArrowClass(!1);b.$pfoHandle.removeClass("aok-hidden")};this.showPFOSheetErrorMessage=function(a){b.$pfoSheetContainer=b.$ivxWrapper.find(e.VisualSearchPFOSheetSelector);var c=b.$pfoSheetContainer.find(e.VisualSearchPFOFailureMessageSection),d=b.$pfoSheetContainer.find(e.VisualSearchPFOSingleHotSpotFailureInstructionText),
g=b.$pfoSheetContainer.find(e.VisualSearchPFOAllHotSpotsFailureInstructionText),l=b.$pfoSheetContainer.find(e.VisualSearchPFOFindingProductsText),q=b.$pfoSheetContainer.find(e.VisualSearchPFOFoundProductsText),f=b.$pfoSheetContainer.find(e.VisualSearchPFOFindProductsContent);c.toggleClass("aok-hidden",!1);l.toggleClass("aok-hidden",!0);a?(d.toggleClass("aok-hidden",!1),q.toggleClass("aok-hidden",!0),f.toggleClass("aok-hidden",!0)):(b.$pfoSheetContainer.toggleClass("loading",!1),b.$pfoSheetContainer.toggleClass("no-hotspot-error",
!0),g.toggleClass("aok-hidden",!1))};this.hidePFOSheetErrorMessage=function(){b.$pfoSheetContainer=b.$ivxWrapper.find(e.VisualSearchPFOSheetSelector);var a=b.$pfoSheetContainer.find(e.VisualSearchPFOFailureMessageSection),c=b.$pfoSheetContainer.find(e.VisualSearchPFOSingleHotSpotFailureInstructionText),d=b.$pfoSheetContainer.find(e.VisualSearchPFOAllHotSpotsFailureInstructionText);a.toggleClass("aok-hidden",!0);c.toggleClass("aok-hidden",!0);d.toggleClass("aok-hidden",!0);b.$pfoSheetContainer.toggleClass("no-hotspot-error",
!1)};this.cleanupPreviousHotspots=function(){if(b.$bbXCanvas){var a=b.$bbXCanvas.find('span[id^\x3d"bbx-"]');a.length&&a.remove()}};this.showCanvas=function(){b.$bbXCanvas.removeClass("aok-hidden")};this.pauseVideoIfPlaying=function(){b.player.isPlaying()&&b.config.A.$("#"+b.templateId+" "+e.VIPPlayPauseToggleSelector).click();b.config.A.$("#"+b.templateId+" ."+e.UpNextClassName).hasClass(""+e.UpNextElementShownClassName)&&b.config.A.$("#"+b.templateId+" ."+e.UpNextCancelClassName).click()};this.enterVisualSearchMode=
function(){b.A.$("#"+b.templateId+" "+e.VisualSearchBBXCanvasSelector).removeClass("aok-hidden");b.A.$(e.VisualSearchAnimationOverlaySelector).css("display","none");b.config.A.$("#"+b.templateId+" ."+e.VIPPlayPauseClassName).addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPOverlaySelector).addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPActionOverlaySelector).addClass("aok-hidden");b.A.$("#"+b.templateId).closest(".a-popover-inner").css({"background-color":"black"});b.A.$("#"+b.templateId+
" "+e.VIPSearchButtonSelector).addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VisualSearchControlCanvasSelector).addClass("aok-hidden");b.config.A.$("#"+b.templateId).closest(".vse-vip-lightbox").addClass("ive-visual-search");b.A.$("#"+b.templateId+" "+e.VIPCloseButton).addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VisualSearchTopBar).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPCCTextTrackSelector).toggleClass("aok-hidden",!0);b.A.$(""+e.IVE_THEME).addClass("aok-hidden");
b.$bbXCanvas.removeClass("aok-hidden");b.getDeviceOrientation()==e.PORTRAIT&&b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonLensLogo).removeClass("aok-hidden");b.showPFOSheet();b.shrinkVideoFrame()};this.exitVisualSearchMode=function(){b.A.$("#"+b.templateId+" "+e.VisualSearchBBXCanvasSelector).addClass("aok-hidden");b.config.A.$("#"+b.templateId).removeClass("ive-visual-search");b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonLensLogo).toggleClass("aok-hidden",!0);b.A.$("#"+b.templateId+" "+e.VisualSearchTopBar).addClass("aok-hidden");
b.config.A.$("#"+b.templateId+" ."+e.VIPPlayPauseClassName).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPOverlaySelector).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VisualSearchControlCanvasSelector).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPOverlaySelector).toggleClass(e.VIPOverlayShowClassName,!0);b.A.$("#"+b.templateId+" "+e.VIPActionOverlaySelector).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).removeClass("aok-hidden");
b.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).toggleClass(e.VIPSearchButtonHideText,!1);b.config.A.$("#"+b.templateId).closest(".vse-vip-lightbox").removeClass("ive-visual-search");b.A.$("#"+b.templateId+" "+e.VIPCloseButton).removeClass("aok-hidden");b.A.$(""+e.IVE_THEME).removeClass("aok-hidden");b.$bbXCanvas.addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPCCTextTrackSelector).toggleClass("aok-hidden",!1);b.hidePFOSheet();b.restoreVideoFrame();b.cleanupPreviousHotspots();b.$pfoSheetContainer.removeClass("open");
b.toggleFixedArrowClass(!1);b.removeBlinkingStarAnimation();b.$currentlyClickedbbX=null};this.shrinkVideoFrame=function(){var a=b.A.$("#"+b.templateId+" "+e.VisualSearchBackButton),c=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector),d=parseFloat(b.$pfoSheet.css("max-height"));if(b.getDeviceOrientation()==e.LANDSCAPE)c.css({"padding-top":b.LANDSCAPE_VIDEO_FRAME_PADDING_TOP_PX+"px","padding-bottom":d+b.VIDEO_FRAME_VERTICAL_PADDING_PX+"px","padding-left":0,"padding-right":0});else{var a=a.offset().top+
a.outerHeight(),g=b.A.$("#"+b.templateId+" .vse-vip-action-tray").outerHeight();c.css({"padding-top":a+b.VIDEO_FRAME_VERTICAL_PADDING_PX+"px","padding-bottom":d+b.VIDEO_FRAME_VERTICAL_PADDING_PX-g+"px","padding-left":b.VIDEO_FRAME_HORIZONTAL_PADDING_PX+"px","padding-right":b.VIDEO_FRAME_HORIZONTAL_PADDING_PX+"px"})}};this.restoreVideoFrame=function(){var a=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector);if(b.getDeviceOrientation()==e.LANDSCAPE){var c=b.A.$("#"+b.templateId+" "+e.VIPActionIconSelector).outerWidth();
a.css({"padding-top":0,"padding-bottom":0,"padding-left":0,"padding-right":c+"px"})}else a.css({padding:0})};this.appendHotspotsToFrame=function(a,c){c.removeClass("aok-hidden");b.$bbXCanvas.append(c);c.find(".bbx-dot").css({left:a.x+"px",top:a.y+"px",display:"inline-block"})};this.addHotspotClickHandler=function(a,c,d,g){c.click(function(l,q){b.$currentlyClickedbbX=c;"none"!==c.find(".bbx-dot").css("display")&&(b.currentBoundingBoxes.map(function(a){return a.$bbX}).forEach(function(a){a.find(".bbx-dot").show()}),
c.find(".bbx-dot").hide(),b.currentBoundingBoxes.map(function(a){return a.$bbX}).forEach(function(a){a.find(".bbx-canvas-image").addClass("aok-hidden");a.find(".bbx-canvas-image-border").addClass("aok-hidden")}),l=ga({},a,{top:a.top+b.BORDER_OFFSET_PX,bottom:a.bottom+b.BORDER_OFFSET_PX,left:a.left+b.BORDER_OFFSET_PX,right:a.right+b.BORDER_OFFSET_PX}),l=b.createClipStyle({bbx:l,imageDimensions:d,videoFrameUrl:g,borderRadiusPx:9}),b.applyClipPathProperties(c.find(".bbx-canvas-image"),l,!1),l=b.createClipStyle({bbx:a,
imageDimensions:d,videoFrameUrl:g,borderRadiusPx:12}),b.applyClipPathProperties(c.find(".bbx-canvas-image-border"),l,!0),a.pfoHtml===t||null===a.pfoHtml?b.findSimilarProducts(a):b.findSimilarProductsSuccessCallback(a,a.pfoHtml),q===t&&b.emitMetric(e.VisualSearchMetricPrefix+"hotspot:click"))})};this.applyClipPathProperties=function(a,b,c){a.removeClass("aok-hidden").css({left:b.left+"px",top:0,"clip-path":b.clipPath,"-webkit-clip-path":b.clipPath,height:b.height+"px",width:b.width+"px","transform-origin":b.transformOrigin,
"-webkit-transform-origin":b.transformOrigin,"background-image":c?"":b.backgroundImage,"background-color":"#FFFFFF"})};this.captureVideoFrame=function(){return S(b,void 0,void 0,function(){var a;return T(this,function(b){switch(b.label){case 0:return this.createCanvas(),[4,this.getImageUrl(this.canvas)];case 1:return a=b.sent(),[2,a]}})})};this.createCanvas=function(){b.canvas.width=b.displayVideoDimensions.width;b.canvas.height=b.displayVideoDimensions.height;var a=b.canvas.getContext("2d"),c=document.getElementById(b.A.$("#"+
b.templateId+" video").attr("id"));a.drawImage(c,0,0,b.displayVideoDimensions.width,b.displayVideoDimensions.height)};this.captureBase64Img=function(){return S(b,void 0,void 0,function(){return T(this,function(a){switch(a.label){case 0:return[4,this.getImageUrl(this.canvas,!0)];case 1:return[2,a.sent()]}})})};this.getImageUrl=function(a,c){void 0===c&&(c=!1);return S(b,void 0,void 0,function(){var b=this;return T(this,function(d){return[2,new Promise(function(d,g){try{if(c)try{b.createCanvas();var f=
a.toDataURL("image/png");d(f)}catch(x){b.emitMetric(e.VisualSearchMetricPrefix+"base64:capture:frame:failure"),a.toBlob(function(a){if(a){var b=new FileReader;b.onloadend=function(){d(b.result)};b.readAsDataURL(a)}else g("Cannot create base64 image from video frame")},"image/png")}else a.toBlob(function(a){a?(a=URL.createObjectURL(a),d(a)):(b.emitMetric(e.VisualSearchMetricPrefix+"capture:frame:failure"),g("Cannot create image url from video frame"))},"image/png")}catch(x){g(x.toString())}})]})})};
this.createClipStyle=function(a){var b=a.bbx,c=a.imageDimensions;return{left:0,top:0,clipPath:"inset("+b.top+"px "+b.right+"px "+b.bottom+"px "+b.left+"px round "+a.borderRadiusPx+"px)",height:c.height*c.ratio,width:c.width*c.ratio,backgroundImage:"url("+a.videoFrameUrl+")",transformOrigin:b.x+"px "+b.y+"px"}};this.getBoundingBoxCoordinates=function(a){var c=[],d=a.height,e=a.width,l=a.ratio;b.currentBoundingBoxes.forEach(function(a){var b=a.tlx/a.imw*e,h=a.trx/a.imw*e,p=a.tly/a.imh*d,m=a.bly/a.imh*
d;a={x:l*((h-b)/2+b),y:l*((m-p)/2+p),h:l*(m-p),w:l*(h-b),sX:k.innerWidth/2-l*e/2+l*b,sY:l*p,asins:a.asins,pfoHtml:a.pfoHtml,$bbX:a.$bbX};c.push(ga({},a,{top:a.sY,bottom:l*d-a.sY-a.h,left:l*b,right:l*e-l*b-a.w}))});return c};this.calculateVideoDimensions=function(){var a=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector),c=a.width(),a=a.height(),d=b.player.player.playerInstance.videoJS,g=d.videoWidth(),d=d.videoHeight(),g=g/d;c/a>g?c=g*a:a=c/g;return{width:c,height:a,ratio:1}};this.emitMetric=function(a,
c){m.count(a,1);a={eventName:b.clientPrefix+":"+a,stringPayload:c||e.EMPTY_STRING,intPayload:1,videoAsin:b.currentVideoContentId,timestamp:(new Date).toISOString()};b.emitMetricToNexus(a)};this.addOrientationChangeHandler=function(){b.A.on.orientationchange(function(a){if(b.isInVisualSearchMode()){b.cleanupPreviousHotspots();b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonLensLogo).toggleClass("aok-hidden",90===Math.abs(a.orientation));var c=function(){b.shrinkVideoFrame();b.showCanvas();b.showHotspots();
b.updateIVXWrapperProperties()},d=function(){clearTimeout(g);c();b.$pfoSheet.get(0).removeEventListener("transitionend",d)},g=setTimeout(function(){c()},300);b.$pfoSheet.get(0).addEventListener("transitionend",d)}else b.restoreVideoFrame()})};this.updateIVXWrapperProperties=function(){b.$ivxWrapper.css({"max-width":b.getDeviceOrientation()==e.LANDSCAPE?"unset":"100%",bottom:0})};this.executeTooltipForSearchButton=function(){v.now("a-tooltip").execute("ive-tooltip-registration",function(a){b.$trigger=
b.A.$("#"+b.templateId+" "+b.SEARCH_TOOLTIP_TEXT_ID);b.tooltip=a;var c={name:"ive-tooltip-search-button",inlineContent:b.A.$("#"+b.templateId+" "+e.VisualSearchTooltipText).text(),dataStrategy:"preload"};b.instance=a.create(b.$trigger,c);b.A.delay(function(){b.instance.show()},300);b.hideSearchTooltip(!1)})};this.hideSearchTooltip=function(a){b.instance&&(a?b.A.delay(function(){b.instance.hide();b.tooltip.remove(b.$trigger)},300):b.A.delay(function(){b.instance.hide();b.tooltip.remove(b.$trigger)},
b.hideAfter),b.A.on("a:popover:visible:ive-tooltip-search-button",function(a){b.config.A.$(".a-tooltip-inner").addClass("ive-search-button-tooltip")}),b.A.on("a:popover:invisible:ive-tooltip-search-button",function(a){b.config.A.$(".a-tooltip-inner").removeClass("ive-search-button-tooltip")}))};this.toggleFixedArrowClass=function(a){b.A.$(e.VisualSearchPFOArrowSelector+", "+e.VisualSearchPFOFoundProductsText).toggleClass("ive-fixed-arrow",a)};this.vipControlsShouldPause=c.vars.vipControlsShouldPause;
this.templateId=a.templateId;this.player=c.vars.player;this.A=a.A;this.emitMetricToNexus=c.emitMetricToNexus;this.clientPrefix=c.vars.clientPrefix;this.getDeviceOrientation=c.getDeviceOrientation;this.getProductAsinForPUI=c.getProductAsinForPUI;this.isMshop=c.vars.isMshop;this.isDifferenceGreaterThan24Hours=c.isDifferenceGreaterThan24Hours}d.prototype.addAnimationForHotspotsVideo=function(){var c=parseInt(localStorage.getItem(this.IVE_HOTSPOTS_COUNTER))||0,a=parseInt(localStorage.getItem(this.IVE_HOTSPOTS_TIMESTAMP))||
0;this.shouldShowTooltipForSearchButton(c,a)&&this.executeTooltipForSearchButton()};d.prototype.shouldShowTooltipForSearchButton=function(c,a){return 1===c||this.isDifferenceGreaterThan24Hours(Date.now(),a)&&5>=c};d.prototype.updateEducationalRules=function(){var c=localStorage.getItem(this.IVE_HOTSPOTS_COUNTER);if(null===c)localStorage.setItem(this.IVE_HOTSPOTS_COUNTER,"1"),localStorage.setItem(this.IVE_HOTSPOTS_TIMESTAMP,Date.now().toString()),this.executeTooltipForSearchButton();else if(5>=parseInt(c)){var a=
localStorage.getItem(this.IVE_HOTSPOTS_TIMESTAMP),b=Date.now();localStorage.setItem(this.IVE_HOTSPOTS_COUNTER,(parseInt(c)+1).toString());a&&this.isDifferenceGreaterThan24Hours(b,parseInt(a))&&this.executeTooltipForSearchButton()}};d.prototype.hideElement=function(c){(c=this.config.A.$("#"+this.templateId+" "+c))&&c.addClass("aok-hidden")};d.prototype.showElement=function(c){(c=this.config.A.$("#"+this.templateId+" "+c))&&c.removeClass("aok-hidden")};d.prototype.isInVisualSearchMode=function(){return this.config.A.$("#"+
this.templateId).closest(".vse-vip-lightbox").hasClass("ive-visual-search")};return d}(),ia=function(){function d(c,a){this.templateId=c;this.A=a;this.setupCanvas()}d.prototype.setupCanvas=function(){this.canvas=document.createElement("canvas");var c=this.A.$("#"+this.templateId+" video");c.length&&c.insertBefore(this.canvas)};d.prototype.setDisplayVideoDimensions=function(c){this.displayVideoDimensions=c};d.prototype.createCanvas=function(){this.canvas.width=this.displayVideoDimensions.width;this.canvas.height=
this.displayVideoDimensions.height;var c=this.canvas.getContext("2d"),a=this.A.$("#"+this.templateId+" video").get(0);c.drawImage(a,0,0,this.displayVideoDimensions.width,this.displayVideoDimensions.height)};d.prototype.captureVideoFrame=function(){this.createCanvas();return this.getJPEGImageUrl(this.canvas)};d.prototype.getJPEGImageUrl=function(c){var a={};if(!c||0===c.width||0===c.height)return a.error="Canvas has invalid dimensions",a;try{var b=c.toDataURL("image/jpeg",.8);if(!b||"data:,"===b||
30>b.length)return a.error="Generated invalid data URL",a;a.result=b}catch(h){a.error=h instanceof DOMException&&"SecurityError"===h.name?"CORS error: Canvas is tainted. Check video crossOrigin attribute.":"Canvas capture failed: "+h.toString()}return a};d.prototype.calculateVideoDimensions=function(c){var a=this.A.$("#"+this.templateId+" .vse-player-container, #"+this.templateId+" .brila-video-js"),b=a.width(),a=a.height(),h=c.player.playerInstance.videoJS;c=h.videoWidth();h=h.videoHeight();c/=h;
b/a>c?b=c*a:a=b/c;return{width:b,height:a,ratio:1}};d.prototype.getCanvas=function(){return this.canvas};d.prototype.getDisplayVideoDimensions=function(){return this.displayVideoDimensions};d.prototype.captureCroppedVideoFrame=function(c){this.createCanvas();var a=document.createElement("canvas");a.width=c.width;a.height=c.height;a.getContext("2d").drawImage(this.canvas,c.x,c.y,c.width,c.height,0,0,c.width,c.height);return this.getJPEGImageUrl(a)};return d}(),ja=t&&t.__assign||Object.assign||function(d){for(var c,
a=1,b=arguments.length;a<b;a++){c=arguments[a];for(var h in c)Object.prototype.hasOwnProperty.call(c,h)&&(d[h]=c[h])}return d},ka=function(){function d(c,a){var b=this;this.handles={};this.darkOverlays={};this.boxDragOffset={x:0,y:0};this.isDraggingBox=!1;this.draggingHandle=null;this.dragOffset={x:0,y:0};this.videoFrameBounds=this.emitTimeout=null;this.tapStartTime=0;this.tapStartPosition={x:0,y:0};this.TAP_THRESHOLD_MS=200;this.TAP_THRESHOLD_PX=10;this.HANDLE_SIZE=24;this.MIN_BOX_SIZE=64-this.HANDLE_SIZE;
this.lassoPoints=[];this.isLassoing=!1;this.onBoxDrag=function(a){if(b.isDraggingBox){var c=a.clientX-b.boxDragOffset.x,d=a.clientY-b.boxDragOffset.y;b.boxDragOffset={x:a.clientX,y:a.clientY};var e=b.getEffectiveBounds();a=b.getHandleCoords();var l=Math.min(a["top-left"].x,a["bottom-left"].x),q=Math.max(a["top-right"].x,a["bottom-right"].x)+b.HANDLE_SIZE,f=Math.min(a["top-left"].y,a["top-right"].y),x=Math.max(a["bottom-left"].y,a["bottom-right"].y)+b.HANDLE_SIZE;a=c;var p=d;l+c<e.left&&(a=e.left-
l);q+c>e.right&&(a=e.right-q);f+d<e.top&&(p=e.top-f);x+d>e.bottom&&(p=e.bottom-x);c=0;for(d=Object.keys(b.handles);c<d.length;c++)e=b.handles[d[c]],l=b.toFloat(e.style.left)+a,q=b.toFloat(e.style.top)+p,e.style.left=l+"px",e.style.top=q+"px";b.updateDarkRegions()}};this.endBoxDrag=function(){if(b.isDraggingBox){var a=b.getHandleCoords(),a={topLeft:a["top-left"],bottomRight:a["bottom-right"]},c=Date.now()-b.tapStartTime,d=b.toLocalPoint(b.boxDragOffset.x,b.boxDragOffset.y),d=Math.sqrt(Math.pow(d.x-
b.tapStartPosition.x,2)+Math.pow(d.y-b.tapStartPosition.y,2));if((c>b.TAP_THRESHOLD_MS||d>b.TAP_THRESHOLD_PX)&&b.onBoundingBoxEdit)b.onBoundingBoxEdit("drag",a)}b.scheduleEmitBoundingBox();b.isDraggingBox=!1;document.removeEventListener("mousemove",b.onBoxDrag);document.removeEventListener("mouseup",b.endBoxDrag)};this.onBoxTouchDrag=function(a){if(b.isDraggingBox){a.preventDefault();a=a.touches[0];var c=a.clientX-b.boxDragOffset.x,d=a.clientY-b.boxDragOffset.y;b.boxDragOffset={x:a.clientX,y:a.clientY};
var e=b.getEffectiveBounds();a=b.getHandleCoords();var l=Math.min(a["top-left"].x,a["bottom-left"].x),q=Math.max(a["top-right"].x,a["bottom-right"].x)+b.HANDLE_SIZE,f=Math.min(a["top-left"].y,a["top-right"].y),x=Math.max(a["bottom-left"].y,a["bottom-right"].y)+b.HANDLE_SIZE;a=c;var p=d;l+c<e.left&&(a=e.left-l);q+c>e.right&&(a=e.right-q);f+d<e.top&&(p=e.top-f);x+d>e.bottom&&(p=e.bottom-x);c=0;for(d=Object.keys(b.handles);c<d.length;c++)e=b.handles[d[c]],l=b.toFloat(e.style.left)+a,q=b.toFloat(e.style.top)+
p,e.style.left=l+"px",e.style.top=q+"px";b.updateDarkRegions()}};this.endBoxTouchDrag=function(){if(b.isDraggingBox){var a=b.getHandleCoords(),a={topLeft:a["top-left"],bottomRight:a["bottom-right"]};if(b.onBoundingBoxEdit)b.onBoundingBoxEdit("drag",a)}b.scheduleEmitBoundingBox();b.isDraggingBox=!1;document.removeEventListener("touchmove",b.onBoxTouchDrag);document.removeEventListener("touchend",b.endBoxTouchDrag)};this.ignoredElements=function(a){a=a.target;return a.closest(".bounding-box")||a.classList.contains("handle")||
a.classList.contains("corner-handle")||a.classList.contains("ive-back-button")||a.closest(".ive-back-button")||a.closest(".hotspot-dot-inner")};this.startLasso=function(a){b.ignoredElements(a)||(a.preventDefault(),b.isLassoing=!0,b.lassoPoints=[],b.lassoPath.setAttribute("d",""),a=b.toLocalPoint(a.clientX,a.clientY),b.lassoPoints.push(a))};this.updateLasso=function(a){b.isLassoing&&(a=b.toLocalPoint(a.clientX,a.clientY),b.lassoPoints.push(a),a=b.lassoPoints.map(function(a,b){return(0===b?"M":"L")+
" "+a.x+" "+a.y}).join(" "),b.lassoPath.setAttribute("d",a))};this.endLasso=function(a){if(b.isLassoing&&!(2>b.lassoPoints.length)){b.isLassoing=!1;a=b.lassoPoints.map(function(a,b){return(0===b?"M":"L")+" "+a.x+" "+a.y}).join(" ")+" Z";b.lassoPath.setAttribute("d",a);var c=b.lassoPoints.map(function(a){return a.x}),d=b.lassoPoints.map(function(a){return a.y});a=Math.min.apply(Math,c);var e=Math.min.apply(Math,d),c=Math.max.apply(Math,c),d=Math.max.apply(Math,d),c=c-b.HANDLE_SIZE,d=d-b.HANDLE_SIZE;
c-a<b.MIN_BOX_SIZE&&(a=Math.max(0,a-(b.MIN_BOX_SIZE-(c-a))/2),c=a+b.MIN_BOX_SIZE);d-e<b.MIN_BOX_SIZE&&(e=Math.max(0,e-(b.MIN_BOX_SIZE-(d-e))/2),d=e+b.MIN_BOX_SIZE);a={x:a,y:e};e={x:c,y:d};b.setBoxPosition(a,e);if(b.onLassoDraw)b.onLassoDraw({topLeft:a,bottomRight:e});setTimeout(function(){return b.lassoPath.setAttribute("d","")},200);b.scheduleEmitBoundingBox()}};this.startTouchLasso=function(a){b.ignoredElements(a)||(a.preventDefault(),b.isLassoing=!0,b.lassoPoints=[],b.lassoPath.setAttribute("d",
""),a=a.touches[0],a=b.toLocalPoint(a.clientX,a.clientY),b.lassoPoints.push(a))};this.updateTouchLasso=function(a){b.isLassoing&&(a.preventDefault(),a=a.touches[0],a=b.toLocalPoint(a.clientX,a.clientY),b.lassoPoints.push(a),a=b.lassoPoints.map(function(a,b){return(0===b?"M":"L")+" "+a.x+" "+a.y}).join(" "),b.lassoPath.setAttribute("d",a))};this.endTouchLasso=function(a){if(b.isLassoing&&!(2>b.lassoPoints.length)){b.isLassoing=!1;a=b.lassoPoints.map(function(a,b){return(0===b?"M":"L")+" "+a.x+" "+
a.y}).join(" ")+" Z";b.lassoPath.setAttribute("d",a);var c=b.lassoPoints.map(function(a){return a.x}),d=b.lassoPoints.map(function(a){return a.y});a=Math.min.apply(Math,c);var e=Math.min.apply(Math,d),c=Math.max.apply(Math,c),d=Math.max.apply(Math,d),c=c-b.HANDLE_SIZE,d=d-b.HANDLE_SIZE;c-a<b.MIN_BOX_SIZE&&(a=Math.max(0,a-(b.MIN_BOX_SIZE-(c-a))/2),c=a+b.MIN_BOX_SIZE);d-e<b.MIN_BOX_SIZE&&(e=Math.max(0,e-(b.MIN_BOX_SIZE-(d-e))/2),d=e+b.MIN_BOX_SIZE);a={x:a,y:e};e={x:c,y:d};b.setBoxPosition(a,e);if(b.onLassoDraw)b.onLassoDraw({topLeft:a,
bottomRight:e});setTimeout(function(){return b.lassoPath.setAttribute("d","")},200);b.scheduleEmitBoundingBox(100)}};this.onTapStart=function(a){b.isDraggingBox||b.draggingHandle||b.isLassoing||b.ignoredElements(a)||(b.tapStartTime=Date.now(),b.tapStartPosition=b.toLocalPoint(a.clientX,a.clientY))};this.onTapEnd=function(a){if(!(b.isDraggingBox||b.draggingHandle||b.isLassoing||b.ignoredElements(a))){var c=Date.now();a=b.toLocalPoint(a.clientX,a.clientY);var d=Math.sqrt(Math.pow(a.x-b.tapStartPosition.x,
2)+Math.pow(a.y-b.tapStartPosition.y,2));c-b.tapStartTime<=b.TAP_THRESHOLD_MS&&d<=b.TAP_THRESHOLD_PX&&b.handleTap(a)}};this.onTouchTapStart=function(a){b.isDraggingBox||b.draggingHandle||b.isLassoing||b.ignoredElements(a)||(a=a.touches[0],b.tapStartTime=Date.now(),b.tapStartPosition=b.toLocalPoint(a.clientX,a.clientY))};this.onTouchTapEnd=function(a){if(!(b.isDraggingBox||b.draggingHandle||b.isLassoing||b.ignoredElements(a))){var c=Date.now();a=a.changedTouches[0];a=b.toLocalPoint(a.clientX,a.clientY);
var d=Math.sqrt(Math.pow(a.x-b.tapStartPosition.x,2)+Math.pow(a.y-b.tapStartPosition.y,2));c-b.tapStartTime<=b.TAP_THRESHOLD_MS&&d<=b.TAP_THRESHOLD_PX&&b.handleTap(a)}};if(!c)throw Error("Element with ID 'hotspotoverlay' not found.");this.overlay=c;this.initHandles();this.initBoundingBox();this.initDarkRegions();this.initTapToSearch();a?this.setInitialPositionsFromCoords(a):this.setInitialPositions()}d.prototype.initHandles=function(){for(var c=this,a=function(a){var d=document.createElement("div");
d.classList.add("handle",a.position);d.style.position="absolute";d.style.width=b.HANDLE_SIZE+"px";d.style.height=b.HANDLE_SIZE+"px";d.style.zIndex="10";d.style.pointerEvents="auto";d.classList.add("corner-handle");d.dataset.position=a.position;d.addEventListener("mousedown",function(b){return c.startDrag(b,a.position)});d.addEventListener("touchstart",function(b){return c.startTouchDrag(b,a.position)},{passive:!1});document.addEventListener("mousemove",function(a){return c.onDrag(a)});document.addEventListener("mouseup",
function(a){return c.endDrag(a)});document.addEventListener("touchmove",function(a){return c.onTouchDrag(a)},{passive:!1});document.addEventListener("touchend",function(a){return c.endTouchDrag(a)},{passive:!1});b.overlay.appendChild(d);b.handles[a.position]=d},b=this,d=0,e=[{position:"top-left",color:"red"},{position:"top-right",color:"green"},{position:"bottom-left",color:"blue"},{position:"bottom-right",color:"yellow"}];d<e.length;d++)a(e[d]);this.setInitialPositions()};d.prototype.initBoundingBox=
function(){var c=this;this.boundingBox=document.createElement("div");this.boundingBox.classList.add("bounding-box");this.boundingBox.style.position="absolute";this.boundingBox.style.boxSizing="border-box";this.boundingBox.style.pointerEvents="auto";this.boundingBox.style.zIndex="6";this.overlay.appendChild(this.boundingBox);this.dragSurface=document.createElement("div");this.dragSurface.style.position="absolute";this.dragSurface.style.top="0";this.dragSurface.style.left="0";this.dragSurface.style.width=
"100%";this.dragSurface.style.height="100%";this.dragSurface.style.cursor="move";this.dragSurface.style.zIndex="7";this.dragSurface.addEventListener("mousedown",function(a){return c.startBoxDrag(a)},{passive:!1});this.dragSurface.addEventListener("touchstart",function(a){return c.startBoxTouchDrag(a)},{passive:!1});this.boundingBox.appendChild(this.dragSurface)};d.prototype.setInitialPositions=function(){var c=this.getEffectiveBounds(),a=c.left+(c.right-c.left)/2,b=c.top+(c.bottom-c.top)/2,c=a-50,
d=b-50,a=a+50,b=b+50;this.setHandlePosition("top-left",c,d);this.setHandlePosition("top-right",a,d);this.setHandlePosition("bottom-left",c,b);this.setHandlePosition("bottom-right",a,b)};d.prototype.setBoxPosition=function(c,a,b){void 0===b&&(b=!1);var d=this.getEffectiveBounds();c=ja({},c);a=ja({},a);c.x=Math.max(d.left,c.x);c.y=Math.max(d.top,c.y);a.x=Math.min(d.right-this.HANDLE_SIZE,a.x);a.y=Math.min(d.bottom-this.HANDLE_SIZE,a.y);var e=a.y-c.y;if(a.x-c.x<this.MIN_BOX_SIZE){var u=(c.x+a.x)/2;c.x=
u-this.MIN_BOX_SIZE/2;a.x=u+this.MIN_BOX_SIZE/2;c.x<d.left&&(c.x=d.left,a.x=d.left+this.MIN_BOX_SIZE);a.x>d.right-this.HANDLE_SIZE&&(a.x=d.right-this.HANDLE_SIZE,c.x=a.x-this.MIN_BOX_SIZE)}e<this.MIN_BOX_SIZE&&(e=(c.y+a.y)/2,c.y=e-this.MIN_BOX_SIZE/2,a.y=e+this.MIN_BOX_SIZE/2,c.y<d.top&&(c.y=d.top,a.y=d.top+this.MIN_BOX_SIZE),a.y>d.bottom-this.HANDLE_SIZE&&(a.y=d.bottom-this.HANDLE_SIZE,c.y=a.y-this.MIN_BOX_SIZE));this.setHandlePosition("top-left",c.x,c.y);this.setHandlePosition("top-right",a.x,c.y);
this.setHandlePosition("bottom-left",c.x,a.y);this.setHandlePosition("bottom-right",a.x,a.y);this.updateDarkRegions();b||this.scheduleEmitBoundingBox()};d.prototype.setInitialPositionsFromCoords=function(c){this.setHandlePosition("top-left",c.topLeft.x,c.topLeft.y);this.setHandlePosition("top-right",c.bottomRight.x,c.topLeft.y);this.setHandlePosition("bottom-left",c.topLeft.x,c.bottomRight.y);this.setHandlePosition("bottom-right",c.bottomRight.x,c.bottomRight.y)};d.prototype.setHandlePosition=function(c,
a,b){c=this.handles[c];c.style.left=a+"px";c.style.top=b+"px"};d.prototype.getHandleCoords=function(){return{"top-left":this.getCoords(this.handles["top-left"]),"top-right":this.getCoords(this.handles["top-right"]),"bottom-left":this.getCoords(this.handles["bottom-left"]),"bottom-right":this.getCoords(this.handles["bottom-right"])}};d.prototype.getCoords=function(c){return{x:this.toFloat(c.style.left),y:this.toFloat(c.style.top)}};d.prototype.startBoxDrag=function(c){this.draggingHandle||(c.preventDefault(),
this.tapStartTime=Date.now(),this.tapStartPosition=this.toLocalPoint(c.clientX,c.clientY),this.isDraggingBox=!0,this.boxDragOffset={x:c.clientX,y:c.clientY},document.addEventListener("mousemove",this.onBoxDrag),document.addEventListener("mouseup",this.endBoxDrag))};d.prototype.startDrag=function(c,a){c.preventDefault();this.draggingHandle=a;a=this.handles[a].getBoundingClientRect();this.dragOffset={x:c.clientX-a.left,y:c.clientY-a.top}};d.prototype.onDrag=function(c){if(this.draggingHandle){var a=
this.getHandleCoords(),b=this.overlay.getBoundingClientRect(),d=this.getEffectiveBounds(),e=Math.max(d.left,c.clientX-b.left-this.dragOffset.x);c=Math.max(d.top,c.clientY-b.top-this.dragOffset.y);e=Math.min(e,d.right-this.HANDLE_SIZE);c=Math.min(c,d.bottom-this.HANDLE_SIZE);var d=a["top-left"],b=a["top-right"],u=a["bottom-left"],a=a["bottom-right"];switch(this.draggingHandle){case "top-left":var g=b.x-this.MIN_BOX_SIZE,l=u.y-this.MIN_BOX_SIZE,e=Math.min(e,g);c=Math.min(c,l);this.setHandlePosition("top-left",
e,c);this.setHandlePosition("top-right",b.x,c);this.setHandlePosition("bottom-left",e,u.y);break;case "top-right":g=d.x+this.MIN_BOX_SIZE;l=a.y-this.MIN_BOX_SIZE;e=Math.max(e,g);c=Math.min(c,l);this.setHandlePosition("top-right",e,c);this.setHandlePosition("top-left",d.x,c);this.setHandlePosition("bottom-right",e,a.y);break;case "bottom-left":g=a.x-this.MIN_BOX_SIZE;l=d.y+this.MIN_BOX_SIZE;e=Math.min(e,g);c=Math.max(c,l);this.setHandlePosition("bottom-left",e,c);this.setHandlePosition("bottom-right",
a.x,c);this.setHandlePosition("top-left",e,d.y);break;case "bottom-right":g=u.x+this.MIN_BOX_SIZE,l=b.y+this.MIN_BOX_SIZE,e=Math.max(e,g),c=Math.max(c,l),this.setHandlePosition("bottom-right",e,c),this.setHandlePosition("bottom-left",u.x,c),this.setHandlePosition("top-right",e,b.y)}this.updateDarkRegions()}};d.prototype.endDrag=function(c){if(this.draggingHandle){c=this.getHandleCoords();c={topLeft:c["top-left"],bottomRight:c["bottom-right"]};if(this.onBoundingBoxEdit)this.onBoundingBoxEdit("resize",
c);this.scheduleEmitBoundingBox();this.draggingHandle=null}};d.prototype.startTouchDrag=function(c,a){c.preventDefault();this.draggingHandle=a;c=c.touches[0];a=this.handles[a].getBoundingClientRect();this.dragOffset={x:c.clientX-a.left,y:c.clientY-a.top}};d.prototype.onTouchDrag=function(c){if(this.draggingHandle){c.preventDefault();var a=c.touches[0],b=this.getHandleCoords(),d=this.overlay.getBoundingClientRect(),e=this.getEffectiveBounds();c=Math.max(e.left,a.clientX-d.left-this.dragOffset.x);a=
Math.max(e.top,a.clientY-d.top-this.dragOffset.y);c=Math.min(c,e.right-this.HANDLE_SIZE);var a=Math.min(a,e.bottom-this.HANDLE_SIZE),e=b["top-left"],d=b["top-right"],u=b["bottom-left"],b=b["bottom-right"];switch(this.draggingHandle){case "top-left":var g=d.x-this.MIN_BOX_SIZE,l=u.y-this.MIN_BOX_SIZE;c=Math.min(c,g);a=Math.min(a,l);this.setHandlePosition("top-left",c,a);this.setHandlePosition("top-right",d.x,a);this.setHandlePosition("bottom-left",c,u.y);break;case "top-right":g=e.x+this.MIN_BOX_SIZE;
l=b.y-this.MIN_BOX_SIZE;c=Math.max(c,g);a=Math.min(a,l);this.setHandlePosition("top-right",c,a);this.setHandlePosition("top-left",e.x,a);this.setHandlePosition("bottom-right",c,b.y);break;case "bottom-left":g=b.x-this.MIN_BOX_SIZE;l=e.y+this.MIN_BOX_SIZE;c=Math.min(c,g);a=Math.max(a,l);this.setHandlePosition("bottom-left",c,a);this.setHandlePosition("bottom-right",b.x,a);this.setHandlePosition("top-left",c,e.y);break;case "bottom-right":g=u.x+this.MIN_BOX_SIZE,l=d.y+this.MIN_BOX_SIZE,c=Math.max(c,
g),a=Math.max(a,l),this.setHandlePosition("bottom-right",c,a),this.setHandlePosition("bottom-left",u.x,a),this.setHandlePosition("top-right",c,d.y)}this.updateDarkRegions()}};d.prototype.endTouchDrag=function(c){if(this.draggingHandle){c=this.getHandleCoords();c={topLeft:c["top-left"],bottomRight:c["bottom-right"]};if(this.onBoundingBoxEdit)this.onBoundingBoxEdit("resize",c);this.scheduleEmitBoundingBox();this.draggingHandle=null}};d.prototype.startBoxTouchDrag=function(c){this.draggingHandle||(c.preventDefault(),
this.isDraggingBox=!0,c=c.touches[0],this.boxDragOffset={x:c.clientX,y:c.clientY},document.addEventListener("touchmove",this.onBoxTouchDrag,{passive:!1}),document.addEventListener("touchend",this.endBoxTouchDrag,{passive:!1}))};d.prototype.initDarkRegions=function(){var c=this,a=function(){var a=document.createElement("div");a.style.position="absolute";a.style.backgroundColor="rgba(0, 0, 0, 0.66)";a.style.zIndex="5";a.style.pointerEvents="auto";c.overlay.appendChild(a);return a};this.darkOverlays.top=
a();this.darkOverlays.bottom=a();this.darkOverlays.left=a();this.darkOverlays.right=a()};d.prototype.updateDarkRegions=function(){var c=this.getHandleCoords(),a=this.overlay.getBoundingClientRect(),b=Math.min(c["top-left"].x,c["bottom-left"].x),d=Math.max(c["top-right"].x+this.HANDLE_SIZE,c["bottom-right"].x+this.HANDLE_SIZE),e=Math.min(c["top-left"].y,c["top-right"].y),c=Math.max(c["bottom-left"].y+this.HANDLE_SIZE,c["bottom-right"].y+this.HANDLE_SIZE),u=a.width,a=a.height;this.boundingBox.style.left=
b+"px";this.boundingBox.style.top=e+"px";this.boundingBox.style.width=d-b+"px";this.boundingBox.style.height=c-e+"px";this.darkOverlays.top.style.top="0px";this.darkOverlays.top.style.left="0px";this.darkOverlays.top.style.width=u+"px";this.darkOverlays.top.style.height=e+"px";this.darkOverlays.bottom.style.top=c+"px";this.darkOverlays.bottom.style.left="0px";this.darkOverlays.bottom.style.width=u+"px";this.darkOverlays.bottom.style.height=a-c+"px";this.darkOverlays.left.style.top=e+"px";this.darkOverlays.left.style.left=
"0px";this.darkOverlays.left.style.width=b+"px";this.darkOverlays.left.style.height=c-e+"px";this.darkOverlays.right.style.top=e+"px";this.darkOverlays.right.style.left=d+"px";this.darkOverlays.right.style.width=u-d+"px";this.darkOverlays.right.style.height=c-e+"px"};d.prototype.scheduleEmitBoundingBox=function(c){var a=this;void 0===c&&(c=100);null!==this.emitTimeout&&clearTimeout(this.emitTimeout);this.emitTimeout=k.setTimeout(function(){var b=a.getHandleCoords(),b={topLeft:b["top-left"],bottomRight:b["bottom-right"]};
if(a.onBoundingBoxChange)a.onBoundingBoxChange(b)},c)};d.prototype.initLasso=function(){this.lassoSvg=document.createElementNS("http://www.w3.org/2000/svg","svg");this.lassoPath=document.createElementNS("http://www.w3.org/2000/svg","path");this.lassoSvg.style.position="absolute";this.lassoSvg.style.top="0";this.lassoSvg.style.left="0";this.lassoSvg.style.width="100%";this.lassoSvg.style.height="100%";this.lassoSvg.style.zIndex="40";this.lassoSvg.style.pointerEvents="none";this.lassoPath.setAttribute("stroke",
"#ebebeb");this.lassoPath.setAttribute("stroke-width","4");this.lassoPath.setAttribute("fill","none");this.lassoSvg.appendChild(this.lassoPath);this.overlay.appendChild(this.lassoSvg);this.overlay.addEventListener("mousedown",this.startLasso,{passive:!1});document.addEventListener("mousemove",this.updateLasso,{passive:!1});document.addEventListener("mouseup",this.endLasso,{passive:!1});this.overlay.addEventListener("touchstart",this.startTouchLasso,{passive:!1});document.addEventListener("touchmove",
this.updateTouchLasso,{passive:!1});document.addEventListener("touchend",this.endTouchLasso,{passive:!1})};d.prototype.toLocalPoint=function(c,a){var b=this.overlay.getBoundingClientRect();return{x:c-b.left,y:a-b.top}};d.prototype.toFloat=function(c){return parseFloat(c.replace("px","")||"0")};d.prototype.setVideoFrameBounds=function(c){this.videoFrameBounds=c};d.prototype.getEffectiveBounds=function(){if(this.videoFrameBounds)return this.videoFrameBounds;var c=this.overlay.getBoundingClientRect();
return{left:0,top:0,right:c.width,bottom:c.height}};d.prototype.initTapToSearch=function(){this.overlay.addEventListener("mousedown",this.onTapStart);this.overlay.addEventListener("mouseup",this.onTapEnd);this.overlay.addEventListener("touchstart",this.onTouchTapStart,{passive:!1});this.overlay.addEventListener("touchend",this.onTouchTapEnd,{passive:!1})};d.prototype.handleTap=function(c){var a=this.getEffectiveBounds(),b=this.MIN_BOX_SIZE/2,d=c.x;c=c.y;d=Math.max(a.left+b,d);d=Math.min(a.right-b-
this.HANDLE_SIZE,d);c=Math.max(a.top+b,c);c=Math.min(a.bottom-b-this.HANDLE_SIZE,c);this.setBoxPosition({x:d-b,y:c-b},{x:d+b,y:c+b},!0);this.scheduleEmitBoundingBox(100)};d.prototype.Reset=function(){this.setInitialPositions();this.updateDarkRegions()};return d}(),y=function(){function d(){}d.UI_CONSTANTS={BORDER_OFFSET_PX:4,LANDSCAPE_VIDEO_FRAME_PADDING_TOP_PX:8,VIDEO_FRAME_VERTICAL_PADDING_PX:36,VIDEO_FRAME_HORIZONTAL_PADDING_PX:20,TOOLTIP_HIDE_DELAY:4E3,ANIMATION_DELAY:100,TRANSITION_DELAY:300,
RETRY_COUNT:3,SWIPE_THRESHOLD:1,BORDER_RADIUS:{INNER:9,OUTER:12},MSHOP_OFFSET:{HIGH:200,LOW:100,REGULAR_HIGH:100,REGULAR_LOW:50}};d.STORAGE_KEYS={IVE_HOTSPOTS_COUNTER:"ive_hotspots_tutorial_counter",IVE_HOTSPOTS_TOOLTIP_COUNTER:"ive_hotspots_tooltip_counter",IVE_HOTSPOTS_TIMESTAMP:"ive_hotspots_timestamp",IVE_HOTSPOTS_TUTORIAL:"ive_hotspots_tutorial"};d.SELECTORS={BLINKING_STAR_ANIMATION:".ive-blinking-star-animation",TOOLTIP_TEXT_ID:"#ive-search-tooltip-trigger"};return d}(),Da=function(){function d(c,
a,b,d){this.templateId=c;this.A=a;this.config=b;this.twentyFourHourCheck=this.twentyFourHourCheck=d}d.prototype.updateEducationalRules=function(){var c=this.getHotspotsCounter();null===c?this.initializeFirstTimeUser():this.shouldShowTooltip(c)&&this.incrementHotspotsCounter(c)};d.prototype.getHotspotsCounter=function(){return localStorage.getItem(y.STORAGE_KEYS.IVE_HOTSPOTS_TOOLTIP_COUNTER)};d.prototype.initializeFirstTimeUser=function(){localStorage.setItem(y.STORAGE_KEYS.IVE_HOTSPOTS_TOOLTIP_COUNTER,
"1");localStorage.setItem(y.STORAGE_KEYS.IVE_HOTSPOTS_TIMESTAMP,Date.now().toString());this.executeTooltipForSearchButton()};d.prototype.shouldShowTooltip=function(c){return 5>=parseInt(c)&&this.twentyFourHourCheck(y.STORAGE_KEYS.IVE_HOTSPOTS_TIMESTAMP)};d.prototype.incrementHotspotsCounter=function(c){c=(parseInt(c)+1).toString();localStorage.setItem(y.STORAGE_KEYS.IVE_HOTSPOTS_TOOLTIP_COUNTER,c);this.executeTooltipForSearchButton()};d.prototype.executeTooltipForSearchButton=function(){var c=this;
v.now("a-tooltip").execute("ive-tooltip-registration",function(a){c.initializeTooltip(a);c.showTooltipWithDelay();c.hideSearchTooltip(!1)})};d.prototype.initializeTooltip=function(c){this.$trigger=this.A.$("#"+this.templateId+" "+y.SELECTORS.TOOLTIP_TEXT_ID);this.tooltip=c;var a=this.A.$("#"+this.templateId+" "+e.VisualSearchTooltipText).text();this.instance=c.create(this.$trigger,{name:"ive-tooltip-search-button",inlineContent:a,dataStrategy:"preload"})};d.prototype.showTooltipWithDelay=function(){var c=
this;this.A.delay(function(){return c.instance.show()},d.TOOLTIP_DELAY)};d.prototype.hideSearchTooltip=function(c){var a=this;this.instance&&(this.A.delay(function(){a.instance.hide();a.tooltip.remove(a.$trigger)},c?d.TOOLTIP_DELAY:d.TOOLTIP_DISPLAY_DURATION),this.setupTooltipEventListeners())};d.prototype.setupTooltipEventListeners=function(){var c=this;this.A.on("a:popover:visible:ive-tooltip-search-button",function(){c.config.A.$(".a-tooltip-inner").addClass("ive-search-button-tooltip")});this.A.on("a:popover:invisible:ive-tooltip-search-button",
function(){c.config.A.$(".a-tooltip-inner").removeClass("ive-search-button-tooltip")})};d.TOOLTIP_DELAY=300;d.TOOLTIP_DISPLAY_DURATION=4E3;return d}(),la=function(){function d(c,a,b,d,z,u){var g=this;this.setupPFOClickHandlers=function(){g.handlePFOClickMetric(e.addToCartClickSelector,e.addToCartMetricSuffix,e.productAsinAttributeSelector);g.handlePFOClickMetric(e.seeOptionsClickSelector,e.seeMoreMetricSuffix,e.productAsinAttributeSelector);g.handlePFOClickMetric(e.productAsinClickSelector,e.productAsinMetricSuffix,
e.productAsinAttributeSelector,!0);g.handlePFODetailPageRedirect()};this.handlePFOClickMetric=function(a,b,c,d){void 0===d&&(d=!1);g.$ivxWrapper.delegate(a,"click",function(a){(a=g.getProductAsinForPUI(a,c))&&g.emitMetric(b+":click",a)})};this.handlePFODetailPageRedirect=function(){var a=[e.productAsinClickSelector,e.colorSwatchClickSelector,e.seeOptionsClickSelector].join(", ");g.$ivxWrapper.delegate(a,"click",function(a){g.isPfoSheetOpened()?g.isMshop||(a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation(),
(a=g.A.$(a.target).closest("a").attr("href"))&&k.open(a,"_blank")):(g.openPfoSheet(),a.preventDefault(),a.stopPropagation(),a.stopImmediatePropagation())})};this.showPFOSheet=function(){g.$pfoSheet&&0!==g.$pfoSheet.length||(g.$pfoSheet=g.A.$("#"+g.templateId+" "+e.VisualSearchPFOSheetSelector),0<g.$pfoSheet.length&&g.$ivxWrapper.append(g.$pfoSheet));g.$pfoSheetContainer&&0!==g.$pfoSheetContainer.length||(g.$pfoSheetContainer=g.$ivxWrapper.find(e.VisualSearchPFOSheetSelector));g.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector+
".open","transitionend");g.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector+".open","transitionend",function(){g.toggleFixedArrowClass(!0)});g.failureMessageSection&&0!==g.failureMessageSection.length||(g.$pfoSheetContainer.find(e.VisualSearchPFOAllHotSpotsFailureInstructionText).toggleClass("aok-hidden",!0),g.failureMessageSection=g.$pfoSheetContainer.find(e.VisualSearchPFOFailureMessageSection),g.sorryNoResultsText=g.$pfoSheetContainer.find(e.VisualSearchPFONoMatchText),g.searchOtherProductText=
g.$pfoSheetContainer.find(e.VisualSearchPFOSingleHotSpotFailureInstructionText),g.findingProductsText=g.$pfoSheetContainer.find(e.VisualSearchPFOFindingProductsText),g.foundProductsText=g.$pfoSheetContainer.find(e.VisualSearchPFOFoundProductsText),g.productContent=g.$pfoSheetContainer.find(e.VisualSearchPFOFindProductsContent));g.$pfoSheet.addClass("loading");g.findingProductsText.removeClass("aok-hidden");g.failureMessageSection.addClass("aok-hidden");g.foundProductsText.addClass("aok-hidden");g.productContent.addClass("aok-hidden");
g.$pfoSheetContainer.removeClass("aok-hidden");g.getHandleContainer()};this.hidePFOSheet=function(){g.getSheetContainer().addClass("aok-hidden");g.getHandleContainer().addClass("aok-hidden")};this.findSimilarProductsByASIN=function(a){var b=3,c=g.getCurrentTime(),d={productList:a.slice(0,30),metadata:{layout:"grid"}},h=function(a){g.sendLatencyMetric(c,"getpuirelatedproducts:request:latency");g.findSimilarProductsSuccessCallback(null,a)},z=function(a){(0===a.http.status||500<=a.http.status&&599>=
a.http.status)&&0<b?(C.sendRequest(g.A,""+e.VAP_EW+e.PUI_RELATED_PRODUCTS_ENDPOINT,d,h,z),b--):(g.showPFOSheetErrorMessage(),g.emitMetric("getpuirelatedproducts:request:failure"))};C.sendRequest(g.A,""+e.VAP_EW+e.PUI_RELATED_PRODUCTS_ENDPOINT,d,h,z)};this.findSimilarProducts=function(a){if(a.pfoHtml===t||null===a.pfoHtml){var b=g.getCurrentTime(),c=function(c){g.sendLatencyMetric(b,"getpuirelatedproducts:request:latency");g.findSimilarProductsSuccessCallback(a,c)},d={productList:a.asins.slice(0,30),
metadata:{layout:"grid"}},h=3,z=function(a){(0===a.http.status||500<=a.http.status&&599>=a.http.status)&&0<h?(C.sendRequest(g.A,""+e.VAP_EW+e.PUI_RELATED_PRODUCTS_ENDPOINT,d,c,z),h--):(g.showPFOSheetErrorMessage(),g.emitMetric("getpuirelatedproducts:request:failure"))};g.showPFOSheet();C.sendRequest(g.A,""+e.VAP_EW+e.PUI_RELATED_PRODUCTS_ENDPOINT,d,c,z)}else g.findSimilarProductsSuccessCallback(a,a.pfoHtml)};this.findSimilarProductsSuccessCallback=function(a,b){var c=g.$pfoSheetContainer.find(e.VisualSearchPFOFindProductsContent);
c.toggleClass("aok-hidden",!1);c.animate({left:"-100%"},300,function(){c.html(b);c.css({left:"100%"});c.animate({left:"0%"},300)});a&&(a.pfoHtml=b);g.hidePFOSheetErrorMessage();g.findingProductsText.toggleClass("aok-hidden",!0);g.foundProductsText.removeClass("aok-hidden");g.$pfoHandle=g.getHandleContainer();g.$pfoHandle.length?g.$ivxWrapper.append(g.$pfoHandle):g.$pfoHandle=g.$ivxWrapper.find(e.VisualSearchPFOHandleSelector);g.A.$("#"+g.templateId).closest(".vse-vip-lightbox").hasClass("ive-visual-search")?
(g.$pfoHandle.removeClass("aok-hidden"),g.$pfoHandle.unbind("click"),g.$pfoSheet.removeClass("loading"),g.$pfoHandle.click(g.openPfoSheetIfClosed),g.$pfoSheet.unbind("click"),g.$pfoSheet.click(function(a){g.A.$(a.target).closest(e.productAsinClickSelector).length||g.openPfoSheetIfClosed()})):g.emitMetric("visualsearch:exit:before:pfo")};this.openPfoSheetIfClosed=function(){g.isPfoSheetOpened()||g.openPfoSheet()};this.isPfoSheetOpened=function(){return g.$pfoSheetContainer.hasClass("open")};this.addSwipeUpDownHandler=
function(){g.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector,"touchend");g.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector,"touchstart",function(a){var b=a.originalEvent.touches[0].clientY;g.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector,"touchmove",function(a){a=b-a.originalEvent.touches[0].clientY;g.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector,"touchmove");1<Math.abs(a)&&(0<a?g.openPfoSheetIfClosed():(a=g.A.$(e.VisualSearchPFOFindProductsContent).offset().top,g.isPfoSheetOpened()&&
a>(g.isMshop?100:50)&&a<(g.isMshop?200:100)&&g.closePfoSheet()))});g.$ivxWrapper.delegate(e.VisualSearchPFOSheetSelector,"touchend",function(){g.$ivxWrapper.undelegate(e.VisualSearchPFOSheetSelector,"touchmove touchend")})})};this.openPfoSheet=function(){g.getHandleContainer().addClass("aok-hidden");g.getSheetContainer().addClass("open");var a=g.$pfoSheetContainer.find(e.VisualSearchPFOCloseSheetArrow);a.unbind("click");a.click(function(a){a.preventDefault();a.stopPropagation();g.closePfoSheet()});
g.emitMetric("pfoSheet:open")};this.closePfoSheet=function(){g.$pfoSheetContainer.removeClass("open");g.toggleFixedArrowClass(!1);g.$pfoHandle.removeClass("aok-hidden")};this.showPFOSheetErrorMessage=function(){g.$pfoSheetContainer.toggleClass("loading",!1);g.failureMessageSection.toggleClass("aok-hidden",!1);g.sorryNoResultsText.toggleClass("aok-hidden",!1);g.searchOtherProductText.toggleClass("aok-hidden",!1);g.findingProductsText.toggleClass("aok-hidden",!0);g.foundProductsText.toggleClass("aok-hidden",
!0);g.productContent.toggleClass("aok-hidden",!0)};this.hidePFOSheetErrorMessage=function(){g.failureMessageSection.toggleClass("aok-hidden",!0);g.sorryNoResultsText.toggleClass("aok-hidden",!0);g.searchOtherProductText.toggleClass("aok-hidden",!0)};this.resetPFOSheet=function(){g.$pfoSheetContainer.removeClass("open");g.toggleFixedArrowClass(!1)};this.toggleFixedArrowClass=function(a){g.A.$(e.VisualSearchPFOArrowSelector+", "+e.VisualSearchPFOFoundProductsText).toggleClass("ive-fixed-arrow",a)};
this.sendLatencyMetric=function(a,b){m.count(e.VisualSearchMetricPrefix+b,g.getCurrentTime()-a)};this.getCurrentTime=function(){return performance?performance.now():Date.now()};this.templateId=c;this.A=a;this.isMshop=b;this.getProductAsinForPUI=d;this.emitMetric=z;this.$ivxWrapper=u}d.prototype.getSheetContainer=function(){this.$pfoSheetContainer&&0!==this.$pfoSheetContainer.length||(this.$pfoSheetContainer=this.$ivxWrapper.find(e.VisualSearchPFOSheetSelector));return this.$pfoSheetContainer};d.prototype.getHandleContainer=
function(){this.$pfoHandle&&0!==this.$pfoHandle.length||(this.$pfoHandle=this.$pfoSheetContainer.find(e.VisualSearchPFOHandleSelector),this.$pfoHandle.length?this.$ivxWrapper.append(this.$pfoHandle):this.$pfoHandle=this.$ivxWrapper.find(e.VisualSearchPFOHandleSelector));return this.$pfoHandle};return d}(),ma=function(){function d(c,a){var b=this;this.config=a;this.boundingBoxInfo=[];this.pendingItemTap=this.pendingLassoDraw=this.pendingBoundingBoxEdit=this.animationTimeoutId=null;this.handleSearchButtonInteractions=
function(){try{var a=function(){b.tutorialOn=!1;b.pfoManager.showPFOSheet();b.updateBoxManagerBounds();b.currentVideoContentId=b.player.getCurrent().contentId;b.enableHotspotsForPausedFrame(b.currentVideoContentId)};b.bindClickHandler(e.VIPSearchButtonSelector,function(c){b.videoIsReady()&&(b.stopEventPropagation(c),b.pauseVideoIfPlaying(),b.enterVisualSearchMode(),b.emitMetric("searchButton:click"),c=parseInt(localStorage.getItem(y.STORAGE_KEYS.IVE_HOTSPOTS_COUNTER)||"0"),2>c||b.tutorialOn?(b.A.$(e.VisualSearchAnimationOverlaySelector).removeClass("hidden"),
b.tutorialOn=!0,localStorage.setItem(y.STORAGE_KEYS.IVE_HOTSPOTS_TUTORIAL,Date.now().toString()),localStorage.setItem(y.STORAGE_KEYS.IVE_HOTSPOTS_COUNTER,(c+1).toString()),b.clearAnimationTimeout(),b.animationTimeoutId=k.setTimeout(function(){b.A.$(e.VisualSearchAnimationOverlaySelector).hasClass("hidden")||(b.A.$(e.VisualSearchAnimationOverlaySelector).addClass("hidden"),a());b.animationTimeoutId=null},2500)):a())});b.bindClickHandler(e.VisualSearchBackButton,function(a){b.stopEventPropagation(a);
b.emitMetric("backButton:click");b.isHotspotDisplay()||b.emitMetric("visualsearch:exit:before:hotspot");b.pendingBoundingBoxEdit&&(b.emitMetric("boundingbox:exit:before:load"),b.pendingBoundingBoxEdit=null);b.pendingLassoDraw&&(b.emitMetric("lasso:exit:before:load"),b.pendingLassoDraw=null);b.pendingItemTap&&(b.emitMetric("item:exit:before:load"),b.pendingItemTap=null);b.tutorialOn&&b.A.$(e.VisualSearchAnimationOverlaySelector).addClass("hidden");b.exitVisualSearchMode()});b.bindClickHandler(e.VisualSearchGotItButton,
function(c){b.stopEventPropagation(c);b.clearAnimationTimeout();b.A.$(e.VisualSearchAnimationOverlaySelector).addClass("hidden");a()});b.$ivxWrapper=b.A.$("#"+b.templateId).closest(e.VIPSelector);b.$controlOverlay=b.A.$(e.VisualSearchControlCanvasSelector);b.boxManager=new ka(b.$controlOverlay.get(0));b.tooltipManager=new Da(b.templateId,b.A,b.config,b.hasTwentyFourHoursPassed);b.boxManager.onBoundingBoxChange=function(a){b.handleBoundingBoxChange(a)};b.boxManager.onBoundingBoxEdit=function(a,c){b.handleBoundingBoxEdit(a,
c)};b.boxManager.onLassoDraw=function(a){b.handleLassoDraw(a)};b.addOrientationChangeHandler();b.updateIVXWrapperProperties();b.initializePFOManager();b.emitMetric("searchButton:rendered")}catch(c){m.logError(e.ATTRIBUTION_NAME,"Visual search has failed",c),b.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).hide(),b.emitMetric("failure")}};this.enableHotspotsForPausedFrame=function(a){var c=b.fetchPageState();b.$blinkingStarAnimation=b.config.A.$("#"+b.templateId+" "+y.SELECTORS.BLINKING_STAR_ANIMATION).detach();
b.moveBlinkingStarAnimation("#"+b.templateId+" "+e.VisualSearchOverlaySelector);b.A.delay(function(){b.showElement(e.VisualSearchOverlaySelector+" "+y.SELECTORS.BLINKING_STAR_ANIMATION)},y.UI_CONSTANTS.ANIMATION_DELAY);b.displayVideoDimensions=b.calculateVideoDimensions();b.videoFramePosition=b.calculateVideoFramePosition();var d=b.getCurrentTime();a={contentId:a,timestamp:Math.ceil(1E3*b.player.getCurrentTime()),marketplaceId:c.marketplaceId};var g=function(a,c){m.logError(e.ATTRIBUTION_NAME,"/getHotspots request has failed",
c);b.pfoManager.showPFOSheetErrorMessage();b.removeBlinkingStarAnimation();b.emitMetric("gethotspots:request:failure")},l=function(a){b.isInVisualSearchMode()?(b.sendLatencyMetric(d,"gethotspots:request:latency"),b.emitMetric("gethotspots:request:success"),null===a||null===a.results||0===a.results.length?(b.removeBlinkingStarAnimation(),b.emitMetric("gethotspots:response:empty"),b.pfoManager.showPFOSheetErrorMessage()):(b.boundingBoxInfo=[],a.results.forEach(function(a){var c=a.bounding_box.top_left_x/
a.bounding_box.image_width*b.displayVideoDimensions.width,d=a.bounding_box.top_right_x/a.bounding_box.image_width*b.displayVideoDimensions.width,h=a.bounding_box.top_left_y/a.bounding_box.image_height*b.displayVideoDimensions.height,e=a.bounding_box.bottom_left_y/a.bounding_box.image_height*b.displayVideoDimensions.height,f=a.bounding_box.bottom_right_x/a.bounding_box.image_width*b.displayVideoDimensions.width-a.bounding_box.bottom_left_x/a.bounding_box.image_width*b.displayVideoDimensions.width,
g=a.bounding_box.bottom_left_y/a.bounding_box.image_height*b.displayVideoDimensions.height-a.bounding_box.top_left_y/a.bounding_box.image_height*b.displayVideoDimensions.height,z=b.getVideoFramePositionRelativeToOverlay();b.boundingBoxInfo.push({x:(d-c)/2+c+z.left,y:(e-h)/2+h+z.top,w:f,h:g,sX:k.innerWidth/2-b.displayVideoDimensions.width/2+c,sY:h,asins:a.asins,pfoHtml:a.pfoHtml,$bbX:t})}),b.pfoManager.hidePFOSheetErrorMessage(),b.cleanupPreviousHotspots(),b.showHotspots())):b.emitMetric("gethotspots:request:abandoned")};
b.emitMetric("v2:request");var q=b.captureVideoFrame();q.result?(a.base64Img=q.result,b.makeRequest(c,a,l,g),b.emitMetric("v2:request:success:base64img")):(b.emitMetric("base64:capture:frame:failure"),g("error",q.error||"Failed to capture base64 image"))};this.makeRequest=function(a,c,d,e){b.pfoManager.showPFOSheet();a={url:a.hotspotsEndpoint,data:JSON.stringify(c),type:"POST",contentType:"application/json; charset\x3dutf-8",crossDomain:!0,headers:{Authorization:"allow","x-api-key":a.hotspotsEndpointKey},
error:e,success:d};b.A.$.ajax(a)};this.showHotspots=function(){b.displayVideoDimensions=b.calculateVideoDimensions();var a=b.captureVideoFrame();if(a.result){var c={height:b.displayVideoDimensions.height,width:b.displayVideoDimensions.width,ratio:1};b.removeBlinkingStarAnimation();b.boundingBoxInfo.forEach(function(d,e){var f=b.createHotspotElement(e);b.appendHotspotsToFrame(d,f);b.addHotspotClickHandler(d,f,c,a.result);b.boundingBoxInfo[e].$bbX=f});var d=b.$currentlyClickedbbX===t||null===b.$currentlyClickedbbX?
0:b.boundingBoxInfo.map(function(a){return a.$bbX.attr("id")}).indexOf(b.$currentlyClickedbbX.attr("id"));if(0<b.boundingBoxInfo.length){var g=b.convertBoxToCoordinates(b.boundingBoxInfo[d]);b.boxManager.setBoxPosition(g.topLeft,g.bottomRight,!0);b.boundingBoxInfo[d].$bbX.trigger("click",["forceClick"])}}else b.emitMetric("base64:capture:frameurl:failure"),m.logError(e.ATTRIBUTION_NAME,"/getHotspots request has failed",a.error)};this.cleanupPreviousHotspots=function(){if(b.$controlOverlay){var a=
b.$controlOverlay.find('span[id^\x3d"bbx-"]');a.length&&a.remove()}};this.pauseVideoIfPlaying=function(){b.player.isPlaying()&&b.config.A.$("#"+b.templateId+" "+e.VIPPlayPauseToggleSelector).click();b.config.A.$("#"+b.templateId+" ."+e.UpNextClassName).hasClass(""+e.UpNextElementShownClassName)&&b.config.A.$("#"+b.templateId+" ."+e.UpNextCancelClassName).click()};this.enterVisualSearchMode=function(){b.config.A.$("#"+b.templateId+" ."+e.VIPPlayPauseClassName).addClass("aok-hidden");b.config.A.$("#"+
b.templateId+" "+e.VisualSearchTopBar).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPOverlaySelector).addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPActionOverlaySelector).addClass("aok-hidden");b.A.$("#"+b.templateId).closest(".a-popover-inner").css({"background-color":"black"});b.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).addClass("aok-hidden");b.config.A.$("#"+b.templateId).closest(".vse-vip-lightbox").addClass("ive-visual-search");b.A.$("#"+b.templateId+" "+e.VIPCloseButton).addClass("aok-hidden");
b.A.$("#"+b.templateId+" "+e.VisualSearchBackButton).removeClass("aok-hidden");b.A.$("#"+b.templateId+" .ive-loading-bar").removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPCCTextTrackSelector).toggleClass("aok-hidden",!0);b.A.$(""+e.IVE_THEME).addClass("aok-hidden");b.$controlOverlay.removeClass("hidden");b.centerBoxOnScreen();b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonAILensLogo).toggleClass("aok-hidden",b.getDeviceOrientation()!==e.PORTRAIT);b.swapLogos();b.shrinkVideoFrame();b.togglePageZoom(!1)};
this.exitVisualSearchMode=function(){b.clearAnimationTimeout();b.config.A.$("#"+b.templateId).removeClass("ive-visual-search");b.config.A.$("#"+b.templateId+" "+e.VisualSearchTopBar).addClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonLensLogo).toggleClass("aok-hidden",!0);b.A.$("#"+b.templateId+" "+e.VisualSearchBackButton).addClass("aok-hidden");b.config.A.$("#"+b.templateId+" ."+e.VIPPlayPauseClassName).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPOverlaySelector).removeClass("aok-hidden");
b.A.$("#"+b.templateId+" "+e.VIPOverlaySelector).toggleClass(e.VIPOverlayShowClassName,!0);b.A.$("#"+b.templateId+" "+e.VIPActionOverlaySelector).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).removeClass("aok-hidden");b.A.$("#"+b.templateId+" "+e.VIPSearchButtonSelector).toggleClass(e.VIPSearchButtonHideText,!1);b.config.A.$("#"+b.templateId).closest(".vse-vip-lightbox").removeClass("ive-visual-search");b.A.$("#"+b.templateId+" "+e.VIPCloseButton).removeClass("aok-hidden");
b.A.$("#"+b.templateId+" .ive-loading-bar").addClass("aok-hidden");b.A.$(""+e.IVE_THEME).removeClass("aok-hidden");b.$controlOverlay.addClass("hidden");b.boxManager.Reset();b.A.$("#"+b.templateId+" "+e.VIPCCTextTrackSelector).toggleClass("aok-hidden",!1);b.pfoManager.hidePFOSheet();b.restoreVideoFrame();b.cleanupPreviousHotspots();b.pfoManager.resetPFOSheet();b.removeBlinkingStarAnimation();b.$currentlyClickedbbX=null;b.togglePageZoom(!0)};this.shrinkVideoFrame=function(){var a=b.A.$("#"+b.templateId+
" "+e.VisualSearchBackButton),c=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector),d=b.getDeviceOrientation()==e.LANDSCAPE?72:206;if(b.getDeviceOrientation()==e.LANDSCAPE)c.css({"padding-top":y.UI_CONSTANTS.LANDSCAPE_VIDEO_FRAME_PADDING_TOP_PX+"px","padding-bottom":d+y.UI_CONSTANTS.VIDEO_FRAME_VERTICAL_PADDING_PX+"px","padding-left":0,"padding-right":0});else{var a=a.offset().top+a.outerHeight(),g=b.A.$("#"+b.templateId+" .vse-vip-action-tray").outerHeight();c.css({"padding-top":a+y.UI_CONSTANTS.VIDEO_FRAME_VERTICAL_PADDING_PX+
"px","padding-bottom":d+y.UI_CONSTANTS.VIDEO_FRAME_VERTICAL_PADDING_PX-g+"px","padding-left":y.UI_CONSTANTS.VIDEO_FRAME_HORIZONTAL_PADDING_PX+"px","padding-right":y.UI_CONSTANTS.VIDEO_FRAME_HORIZONTAL_PADDING_PX+"px"})}};this.restoreVideoFrame=function(){var a=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector);if(b.getDeviceOrientation()==e.LANDSCAPE){var c=b.A.$("#"+b.templateId+" "+e.VIPActionIconSelector).outerWidth();a.css({"padding-top":0,"padding-bottom":0,"padding-left":0,"padding-right":c+
"px"})}else a.css({padding:0})};this.createHotspotElement=function(a){a="bbx-"+a;a=b.A.$("\x3cspan\x3e\x3c/span\x3e").attr("id",a).addClass("hotspot-dot");var c=b.A.$("\x3cdiv\x3e\x3c/div\x3e").addClass("hotspot-dot-inner").css({display:"none"}),d=b.A.$("\x3cdiv\x3e\x3c/div\x3e").addClass("bbx-canvas-image aok-hidden").css({position:"absolute","pointer-events":"none","z-index":"8"}),e=b.A.$("\x3cdiv\x3e\x3c/div\x3e").addClass("bbx-canvas-image-border aok-hidden").css({position:"absolute","pointer-events":"none",
"z-index":"7"});a.append(c);a.append(d);a.append(e);return a};this.appendHotspotsToFrame=function(a,c){b.$controlOverlay.append(c);c.find(".hotspot-dot-inner").css({left:a.x+"px",top:a.y+"px",display:"inline-block"})};this.addHotspotClickHandler=function(a,c,d,e){c.click(function(d,e){b.$currentlyClickedbbX=c;"none"!==c.find(".hotspot-dot-inner").css("display")&&(b.boundingBoxInfo.map(function(a){return a.$bbX}).forEach(function(a){a.find(".hotspot-dot-inner").show()}),c.find(".hotspot-dot-inner").hide(),
b.boundingBoxInfo.map(function(a){return a.$bbX}).forEach(function(a){a.find(".bbx-canvas-image").addClass("aok-hidden");a.find(".bbx-canvas-image-border").addClass("aok-hidden")}),d=b.convertBoxToCoordinates(a),b.boxManager.setBoxPosition(d.topLeft,d.bottomRight,!0),b.pfoManager.findSimilarProducts(a),e===t&&(b.emitMetric("hotspot:click"),b.handleItemTap(),b.pendingItemTap=null))})};this.captureVideoFrame=function(){b.canvasImageManager.setDisplayVideoDimensions(b.displayVideoDimensions);return b.canvasImageManager.captureVideoFrame()};
this.calculateVideoDimensions=function(){var a=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector),c=a.width(),a=a.height(),d=b.player.player.playerInstance.videoJS,g=d.videoWidth(),d=d.videoHeight(),g=g/d;c/a>g?c=g*a:a=c/g;return{width:c,height:a,ratio:1}};this.emitMetric=function(a,c){a=e.VisualSearchMetricPrefix+a;m.count(a,1);c={eventName:b.clientPrefix+":"+a,stringPayload:c||e.EMPTY_STRING,intPayload:1,videoAsin:b.currentVideoContentId,timestamp:(new Date).toISOString()};b.emitMetricToNexus(c)};
this.addOrientationChangeHandler=function(){b.A.on.orientationchange(function(a){if(b.isInVisualSearchMode()){b.cleanupPreviousHotspots();b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonLensLogo).toggleClass("aok-hidden",90===Math.abs(a.orientation));var c=function(){b.A.$("#"+b.templateId+" "+e.VisualSearchAmazonAILensLogo).toggleClass("aok-hidden",b.getDeviceOrientation()!==e.PORTRAIT);b.shrinkVideoFrame();b.updateBoxManagerBounds();b.centerBoxOnScreen();b.updateIVXWrapperProperties();b.emitMetric("orientation:changed")},
d=function(){clearTimeout(g);c();l.get(0).removeEventListener("transitionend",d)},g=setTimeout(function(){c()},300),l=b.$ivxWrapper.find(e.VisualSearchPFOSheetSelector);l.get(0).addEventListener("transitionend",d)}else b.restoreVideoFrame()})};this.calculateVideoFramePosition=function(){var a=b.A.$("#"+b.templateId+" "+e.PlayerContainerSelector+" video").get(0),c=a.videoWidth/a.videoHeight,a=a.getBoundingClientRect(),d,g;a.width/a.height>c?(g=a.height,g=a.left+(a.width-g*c)/2,c=a.top):(d=a.width,
g=a.left,c=a.top+(a.height-d/c)/2);return{left:g,top:c}};this.convertBoxToCoordinates=function(a){var c=b.boxManager.HANDLE_SIZE/2;return{topLeft:{x:a.x-a.w/2-c,y:a.y-a.h/2-c},bottomRight:{x:a.x+a.w/2-c,y:a.y+a.h/2-c}}};this.handleBoundingBoxEdit=function(a,c){c=Math.ceil(1E3*b.player.getCurrentTime());var d=b.currentVideoContentId;b.emitMetric("boundingbox:edit");c="vs_bbox_edits_"+d+":"+c;d=JSON.parse(sessionStorage.getItem(c)||'{"totalEdits": 0, "resizeEdits": 0, "dragEdits": 0}');d.totalEdits++;
"resize"===a?d.resizeEdits++:"drag"===a&&d.dragEdits++;sessionStorage.setItem(c,JSON.stringify(d));b.emitMetric("boundingbox:edit:"+a,("resize"===a?d.resizeEdits:d.dragEdits).toString())};this.handleLassoDraw=function(a){a=Math.ceil(1E3*b.player.getCurrentTime());var c=b.currentVideoContentId;b.emitMetric("lasso:draw:"+c+":"+a);var d="vs_lasso_draws_"+c+":"+a,e=JSON.parse(sessionStorage.getItem(d)||'{"totalDraws": 0}');e.totalDraws++;sessionStorage.setItem(d,JSON.stringify(e));b.pendingLassoDraw=
{contentId:c,frame:a,timestamp:Date.now()}};this.handleItemTap=function(){var a=Math.ceil(1E3*b.player.getCurrentTime()),c=b.currentVideoContentId;b.emitMetric("item:tap");var d="vs_item_taps_"+c+":"+a,e=JSON.parse(sessionStorage.getItem(d)||'{"totalTaps": 0}');e.totalTaps++;sessionStorage.setItem(d,JSON.stringify(e));b.pendingItemTap={contentId:c,frame:a,timestamp:Date.now()}};this.handleBoundingBoxChange=function(a){var c=b.$controlOverlay.get(0).getBoundingClientRect(),c={x:a.topLeft.x-(b.videoFramePosition.left-
c.left),y:a.topLeft.y-(b.videoFramePosition.top-c.top),width:a.bottomRight.x-a.topLeft.x+b.boxManager.HANDLE_SIZE,height:a.bottomRight.y-a.topLeft.y+b.boxManager.HANDLE_SIZE},d=b.calculateBoundingBoxOverlap(c).adjustedCoordinates;if(d.x!==c.x||d.y!==c.y||d.width!==c.width||d.height!==c.height){var g=b.getVideoFramePositionRelativeToOverlay();b.boxManager.setBoxPosition({x:d.x+g.left,y:d.y+g.top},{x:d.x+(a.bottomRight.x-a.topLeft.x)+g.left,y:d.y+(a.bottomRight.y-a.topLeft.y)+g.top},!0);b.emitMetric("boundingbox:coordinates_adjusted")}c.x=
d.x;c.y=d.y;c.width=d.width;c.height=d.height;b.canvasImageManager.setDisplayVideoDimensions(b.displayVideoDimensions);c=b.canvasImageManager.captureCroppedVideoFrame(c);if(c.result){a=b.fetchPageState();var l=b.getCurrentTime(),c={contentId:b.currentVideoContentId,timestamp:Math.ceil(1E3*b.player.getCurrentTime()),marketplaceId:a.marketplaceId,base64Img:c.result};b.pendingBoundingBoxEdit={contentId:b.currentVideoContentId,frame:Math.ceil(1E3*b.player.getCurrentTime()),timestamp:Date.now()};b.makeRequest(a,
c,function(a){b.sendLatencyMetric(l,"boundingbox:search:request:latency");b.emitMetric("boundingbox:search:request:success");b.pendingBoundingBoxEdit=null;b.pendingLassoDraw=null;null===a||null===a.results||0===a.results.length?(b.emitMetric("boundingbox:search:response:empty"),b.pfoManager.showPFOSheetErrorMessage()):(b.pfoManager.findSimilarProductsByASIN(a.results[0].asins),b.pfoManager.hidePFOSheetErrorMessage())},function(a,c){m.logError(e.ATTRIBUTION_NAME,"/getHotspots boundingbox request has failed",
c);b.pfoManager.showPFOSheetErrorMessage();b.emitMetric("boundingbox:search:request:failure")});b.emitMetric("boundingbox:changed");b.emitMetric("boundingbox:search:request:initiated")}else b.emitMetric("boundingbox:crop:failure"),m.logError(e.ATTRIBUTION_NAME,"Failed to crop image for bounding box search",c.error||"Unknown error")};this.sendLatencyMetric=function(a,c){m.count(e.VisualSearchMetricPrefix+c,b.getCurrentTime()-a)};this.getCurrentTime=function(){return performance?performance.now():Date.now()};
this.calculateBoundingBoxOverlap=function(a){var c=b.displayVideoDimensions.width,d=b.displayVideoDimensions.height,e=Math.max(0,Math.min(c,a.x+a.width)-Math.max(0,a.x)),l=Math.max(0,Math.min(d,a.y+a.height)-Math.max(0,a.y)),k=a.width*a.height;a={x:Math.max(0,Math.min(a.x,c-1)),y:Math.max(0,Math.min(a.y,d-1)),width:Math.min(a.width,c-Math.max(0,a.x)),height:Math.min(a.height,d-Math.max(0,a.y))};32>a.width&&(a.width=Math.min(32,c-a.x));32>a.height&&(a.height=Math.min(32,d-a.y));a.x+a.width>c&&(a.x=
Math.max(0,c-a.width));a.y+a.height>d&&(a.y=Math.max(0,d-a.height));return{overlapPercentage:0<k?e*l/k:0,adjustedCoordinates:a}};this.moveBlinkingStarAnimation=function(a){b.$blinkingStarAnimation&&0<b.$blinkingStarAnimation.length&&b.$blinkingStarAnimation.appendTo(a)};this.removeBlinkingStarAnimation=function(){b.hideElement(e.VisualSearchOverlaySelector+" "+y.SELECTORS.BLINKING_STAR_ANIMATION);b.moveBlinkingStarAnimation("#"+b.templateId+" "+e.VIPOverlaySelector)};this.isHotspotDisplay=function(){return 0<
b.A.$("#"+b.templateId+" "+e.VisualSearchControlCanvasSelector+' span[id^\x3d"bbx-"]').length};this.updateIVXWrapperProperties=function(){b.$ivxWrapper.css({"max-width":b.getDeviceOrientation()==e.LANDSCAPE?"unset":"100%","max-height":"100vh"})};this.updateBoxManagerBounds=function(){if(b.boxManager){b.displayVideoDimensions=b.calculateVideoDimensions();b.videoFramePosition=b.calculateVideoFramePosition();var a=b.$controlOverlay.get(0).getBoundingClientRect();b.boxManager.setVideoFrameBounds({left:b.videoFramePosition.left-
a.left,top:b.videoFramePosition.top-a.top,right:b.videoFramePosition.left-a.left+b.displayVideoDimensions.width,bottom:b.videoFramePosition.top-a.top+b.displayVideoDimensions.height})}};this.A=a.A;this.templateId=a.templateId;this.player=c.vars.player;this.emitMetricToNexus=c.emitMetricToNexus;this.clientPrefix=c.vars.clientPrefix;this.getDeviceOrientation=c.getDeviceOrientation;this.getProductAsinForPUI=c.getProductAsinForPUI;this.isMshop=c.vars.isMshop;this.canvasImageManager=new ia(this.templateId,
this.A)}d.prototype.initializePFOManager=function(){this.pfoManager=new la(this.templateId,this.A,this.isMshop,this.getProductAsinForPUI,this.emitMetric,this.$ivxWrapper);this.pfoManager.setupPFOClickHandlers();this.pfoManager.addSwipeUpDownHandler();this.emitMetric("pfomanager:initialized")};d.prototype.hasTwentyFourHoursPassed=function(c){c=parseInt(localStorage.getItem(c))||0;var a=Date.now();return 864E5<Math.abs(a-c)};d.prototype.isInVisualSearchMode=function(){return this.config.A.$("#"+this.templateId).closest(".vse-vip-lightbox").hasClass("ive-visual-search")};
d.prototype.stopEventPropagation=function(c){c.stopPropagation();c.stopImmediatePropagation()};d.prototype.bindClickHandler=function(c,a){this.A.$(c).unbind("click").click(a)};d.prototype.hideElement=function(c){(c=this.config.A.$("#"+this.templateId+" "+c))&&c.addClass("aok-hidden")};d.prototype.showElement=function(c){(c=this.config.A.$("#"+this.templateId+" "+c))&&c.removeClass("aok-hidden")};d.prototype.getVideoFramePositionRelativeToOverlay=function(){var c=this.$controlOverlay.get(0).getBoundingClientRect();
return{left:this.videoFramePosition.left-c.left,top:this.videoFramePosition.top-c.top}};d.prototype.fetchPageState=function(){return D.fetchLatestPageState(this.A,this.clientPrefix+"-visual-search-ps")};d.prototype.swapLogos=function(){this.A.$(".ive-amazon-lens-logo-container").css({display:"none"});this.A.$(".ive-amazon-lens-ai-logo-container").css({display:"block"})};d.prototype.updateEducationalRules=function(){this.tooltipManager.updateEducationalRules()};d.prototype.clearAnimationTimeout=function(){null!==
this.animationTimeoutId&&(k.clearTimeout(this.animationTimeoutId),this.animationTimeoutId=null)};d.prototype.centerBoxOnScreen=function(){if(this.boxManager){this.updateBoxManagerBounds();var c=this.boxManager.getEffectiveBounds(),a=c.left+(c.right-c.left)/2,c=c.top+(c.bottom-c.top)/2,b=this.boxManager.MIN_BOX_SIZE/2;this.boxManager.setBoxPosition({x:a-b,y:c-b},{x:a+b,y:c+b},!0)}};d.prototype.videoIsReady=function(){try{return 3<this.player.player.playerInstance.videoJS.readyState()}catch(c){return!1}};
d.prototype.togglePageZoom=function(c){if(this.A.capabilities.ios){var a=this.A.$('meta[name\x3d"viewport"]'),b=a.attr("content");b&&(c=b.replace(/maximum-scale=\d+(\.\d+)?/,"maximum-scale\x3d"+(c?2:1)),a.attr("content",c))}};return d}(),Ea=function(){function d(){}d.createBoxStyles=function(c){var a=c.bbx,b=c.imageDimensions,d=c.videoFrameUrl;return{left:0,top:0,clipPath:this.generateClipPath(a,c.borderRadiusPx),height:this.calculateHeight(b),width:this.calculateWidth(b),backgroundImage:d?"url("+
d+")":t,transformOrigin:a.x+"px "+a.y+"px",backgroundColor:this.DEFAULT_BACKGROUND_COLOR}};d.drawBox=function(c,a,b){c.removeClass("aok-hidden").css({left:a.left+"px",top:a.top,"clip-path":a.clipPath,"-webkit-clip-path":a.clipPath,height:a.height+"px",width:a.width+"px","transform-origin":a.transformOrigin,"-webkit-transform-origin":a.transformOrigin,"background-image":b?"":a.backgroundImage,"background-color":a.backgroundColor})};d.generateClipPath=function(c,a){return"inset("+c.top+"px "+c.right+
"px "+c.bottom+"px "+c.left+"px round "+a+"px)"};d.calculateHeight=function(c){return c.height*c.ratio};d.calculateWidth=function(c){return c.width*c.ratio};d.DEFAULT_BACKGROUND_COLOR="#FFFFFF";return d}(),Fa={BrilaFactory:Z,VSEPlayer:W,BrilaShim:X,PlayerPromiseShim:Y,GatedP:G,PostMetric:m,AuiUtils:D,EventEmitter:O,VideoVoteContainer:P,VideoVoteContainerFactory:Q,ContentCarouselFactory:R,InvalidArgumentsException:K,guid:L,RefTagRecorder:M,VSEDisplayStrategy:da,VSETransitionStrategy:ea,OnSiteAttributionMetrics:U,
DelphiAttribution:N,MetricUtils:H,InlinePlayerComponent:fa,VideoItemIntersectionObserver:J,VisualSearchComponent:ha,ajaxRequestUtil:C,VisualSearchComponentNX:ma,BoxDrawer:Ea,BoxManager:ka,CanvasImageManager:ia,VisualSearchPFOManager:la},Ga=function(){return function(d){var c=this;this.config=d;this.setOrientationConfig=function(a){c.orientationConfig=a};this.updateActiveVideoContentId=function(a){c.activeVideoContentId=a};this.triggerWatchIconInteractionOpen=function(){c.config.A.$("#"+c.templateId+
" "+e.VIPWatchIconSelector+".vse-unpressed").click()};this.triggerShopIconInteractionOpen=function(){c.config.A.$("#"+c.templateId+" "+e.VIPShopIconSelector+".vse-unpressed").click()};this.handleWatchIconInteractions=function(){c.config.A.$("#"+c.templateId+" "+e.VIPWatchIconSelector+".vse-unpressed").click(function(a){a.stopPropagation();a.stopImmediatePropagation();c.config.A.trigger("vse:"+c.templateId+":vip:vat:component:open");a=function(){c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlaySelector).hide();
c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlayContainerSelector).addClass(e.VIPActionOverlayBgShadowClassName);c.toggleIconsState(!0,e.VIPWatchIconSelector);c.toggleIconsState(!1,e.VIPShopIconSelector);k.innerWidth>k.innerHeight&&c.config.A.$("#"+c.templateId+" "+e.VIPLbCarouselViewportSelector).height(k.innerHeight-c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsContainerSelector).outerHeight(!0));c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsAndCarouselOverlaySelector).addClass(e.VIPLbOverlayShowCssClassName);
c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsAndCarouselContainerSelector).removeClass(e.VIPActionOverlayBgShadowClassName);c.config.A.fadeIn(c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsContainerSelector),300,"linear");c.config.A.$("#"+c.templateId+" "+e.VIPLbCarouselSelector).animate(c.orientationConfig.carouselAnimationType,300,function(){c.lightboxCarousel.scrollToActiveVideo(c.lightboxCarousel.getActiveAsset())});c.config.A.$("#"+c.templateId+" .vjs-text-track-display").addClass(e.VIPVideoCarouselOpenedClassName)};
c.isDisplayed(e.RELATED_PRODUCTS_CONTAINER_SELECTOR)?c.closeProductCarousel(a):a()})};this.handleMoreVideosIconInteractions=function(){c.config.A.$("#"+c.templateId+" "+e.VIPWatchIconSelector+".vse-unpressed").click(function(a){a.stopPropagation();a.stopImmediatePropagation();c.config.A.trigger("vse:"+c.templateId+":vip:vat:component:open");a=function(){c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlaySelector).hide();c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlayContainerSelector).addClass(e.VIPActionOverlayBgShadowClassName);
c.toggleIconsState(!0,e.VIPWatchIconSelector);c.toggleIconsState(!1,e.VIPShopIconSelector);c.config.A.$("#"+c.templateId+" "+e.VIPOverlaySelector).addClass(e.VIPOverlayShowClassName);c.config.A.trigger("vse:ns:partialcomponents:"+c.config.clientPrefix+":ivx:overlay:show")};c.isDisplayed(e.RELATED_PRODUCTS_CONTAINER_SELECTOR)?c.closeProductCarousel(a):a()})};this.handleShopIconInteractions=function(a){void 0===a&&(a=function(){});c.config.A.$("#"+c.templateId+" "+e.VIPShopIconSelector+".vse-unpressed").unbind("click");
c.config.A.$("#"+c.templateId+" "+e.VIPShopIconSelector+".vse-unpressed").click(function(b){b.stopPropagation();b.stopImmediatePropagation();c.config.A.trigger("vse:"+c.templateId+":vip:vat:component:open");c.config.A.trigger("vse:"+c.templateId+":vip:shop:click");b=function(){c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsAndCarouselOverlaySelector).removeClass(e.VIPLbOverlayShowCssClassName);c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsAndCarouselContainerSelector).addClass(e.VIPActionOverlayBgShadowClassName);
c.toggleIconsState(!0,e.VIPShopIconSelector);c.toggleIconsState(!1,e.VIPWatchIconSelector);c.config.A.$("#"+c.templateId+" "+e.RELATED_PRODUCTS_CONTAINER_SELECTOR).removeClass("aok-hidden");c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlaySelector).show();c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlayContainerSelector).removeClass(e.VIPActionOverlayBgShadowClassName);c.isDisplayed(e.RELATED_PRODUCTS_CONTAINER_SELECTOR)||c.config.A.$("#"+c.templateId+" "+e.RELATED_PRODUCTS_CONTAINER_SELECTOR).animate(c.orientationConfig.carouselAnimationType,
300,a);c.config.A.$("#"+c.templateId+" .vjs-text-track-display").addClass(e.VIPProductCarouselOpenedClassName)};c.isDisplayed(e.VIPLbCarouselSelector)?c.closeVideoCarousel(b):c.throttleActionIcon||(c.throttleActionIcon=!0,b(),setTimeout(function(){return c.throttleActionIcon=!1},600))})};this.toggleIconsState=function(a,b){a?(c.config.A.$("#"+c.templateId+" "+b+".vse-unpressed").addClass("aok-hidden"),c.config.A.$("#"+c.templateId+" "+b+".vse-pressed").removeClass("aok-hidden")):(c.config.A.$("#"+
c.templateId+" "+b+".vse-unpressed").removeClass("aok-hidden"),c.config.A.$("#"+c.templateId+" "+b+".vse-pressed").addClass("aok-hidden"))};this.handleVIPCarouselClose=function(){[e.VIPLbCarouselSelector,e.VIPLbTabsContainerSelector,e.RELATED_PRODUCTS_CONTAINER_SELECTOR].forEach(function(a){c.config.A.$(c.config.A.$("#"+c.templateId+" "+a)).click(function(a){c.config.A.$(a.target).closest(e.RELATED_PRODUCTS_ITEM_SELECTOR).length||(a.stopPropagation(),a.stopImmediatePropagation())})});c.config.A.$("#"+
c.templateId+" "+e.VIPActionOverlaySelector).unbind("click");c.config.A.$("#"+c.templateId+" "+e.VIPActionOverlaySelector).click(function(){c.reset();c.config.A.trigger("vse:"+c.templateId+":vip:vat:component:close")})};this.handleShareIconInteractions=function(){c.config.A.off("a:sheet:beforeShow:"+c.socialShareId+"-sheet");c.config.A.off("a:sheet:afterHide:"+c.socialShareId+"-sheet");c.config.A.on("a:sheet:beforeShow:"+c.socialShareId+"-sheet",function(){c.config.A.trigger("vse:"+c.templateId+":vip:vat:component:open");
c.toggleIconsState(!0,e.VIPShareIconSelector)});c.config.A.on("a:sheet:afterHide:"+c.socialShareId+"-sheet",function(){c.config.A.trigger("vse:"+c.templateId+":vip:vat:component:close");c.toggleIconsState(!1,e.VIPShareIconSelector)})};this.reset=function(){c.throttleActionIcon||(c.throttleActionIcon=!0,setTimeout(function(){return c.throttleActionIcon=!1},600),c.unpressAllActionIcons(),c.isDisplayed(e.VIPLbCarouselSelector)&&c.closeVideoCarousel(function(){c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsAndCarouselContainerSelector).addClass(e.VIPActionOverlayBgShadowClassName);
c.config.A.delay(function(){c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsAndCarouselOverlaySelector).removeClass(e.VIPLbOverlayShowCssClassName)},310)}),c.isDisplayed(e.RELATED_PRODUCTS_CONTAINER_SELECTOR)&&c.closeProductCarousel(function(){c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlayContainerSelector).addClass(e.VIPActionOverlayBgShadowClassName);c.config.A.delay(function(){c.config.A.$("#"+c.templateId+" "+e.VIPProductCarouselOverlaySelector).hide()},310)}))};this.unpressAllActionIcons=
function(){c.config.A.$("#"+c.templateId+" "+e.VIPActionIconSelector+" .vse-pressed").addClass("aok-hidden");c.config.A.$("#"+c.templateId+" "+e.VIPActionIconSelector+" .vse-unpressed").removeClass("aok-hidden")};this.closeProductCarousel=function(a){c.config.A.$("#"+c.templateId+" "+e.RELATED_PRODUCTS_CONTAINER_SELECTOR).animate(c.orientationConfig.carouselAnimationType,300,a);c.config.A.$("#"+c.templateId+" .vjs-text-track-display").removeClass(e.VIPProductCarouselOpenedClassName)};this.closeVideoCarousel=
function(a){c.config.A.fadeOut(c.config.A.$("#"+c.templateId+" "+e.VIPLbTabsContainerSelector),300,"linear");c.config.A.$("#"+c.templateId+" "+e.VIPLbCarouselSelector).animate(c.orientationConfig.carouselAnimationType,300,a);c.config.A.$("#"+c.templateId+" .vjs-text-track-display").removeClass(e.VIPVideoCarouselOpenedClassName)};this.isDisplayed=function(a){return"block"==c.config.A.$("#"+c.templateId+" "+a).css("display")};this.lightboxCarousel=d.contentCarousel;this.socialShareId=d.socialShareId;
this.templateId=d.templateId}}(),na=function(){function d(c){var a=this;this.A=c;this.makeApplicationNexusPayloadBuilder=function(a,c){return H.makeApplicationNexusPayloadBuilder(a,c)};this.detachExceptSkeleton=function(){return a.dom.$relatedProductContainer&&a.dom.$relatedProductContainer.children().not('[class*\x3d"skeletalPFO"], link').detach()};this.getCurrentlyPlayingVideoInCarousel=function(b){return-1===b?a.vars.currentAssetSpec:a.getCombinedPlaylist()[b]};this.getCurrentlyPlayingVideoInCarouselMarkAsPlaying=
function(b){b=a.getCurrentlyPlayingVideoInCarousel(b);a.markPlaying(b);return b};this.startPlaying=function(b){a.vars.isContinuousPlayFinished=!1;a.vars.player&&(b?a.vars.player.play(b):a.vars.player.play())};this.toggleVideoMetadataVisibilityForCRV=function(b){a.vars.isVideoImmersivePlayer?(a.dom.$lbContainer.find(""+e.ActiveMetadataSelector).toggleClass("aok-hidden",b),a.dom.$lbContainer.find("."+e.VIPVideoInfoClassName).toggleClass(e.CRVMetadataClassName,b)):a.dom.$lbLeftColumn.find(""+e.ActiveMetadataSelector).toggleClass("aok-hidden",
b)};this.updateMediaInfo=function(b){var c=a.dom.$lbVideoCarousel&&a.dom.$lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+'"]').find(".vse-lb-crv-metadata");if(c){if(0<c.length){a.toggleVideoMetadataVisibilityForCRV(!0);a.dom.$activeCrvMetadataContainer.html(c.clone().removeClass("aok-hidden").html());a.vars.includeVideoInformationOverPlayer||a.dom.$activeCrvMetadataContainer.removeClass("aok-hidden");a.dom.$activeCrvMetadataContainer.find(".vse-crv-link").removeClass("aok-hidden");a.vars.showVotes&&
a.relatedVideosCarouselNotEmpty()?(a.updateActiveVideoVoteContainer(b),a.vars.activeVideoVoteContainer.showOrHide(!0,!0,!0,!0)):a.vars.activeVideoVoteContainer&&a.vars.activeVideoVoteContainer.showOrHide(!1,!1,!1,!1);a.vars.showUploadDate&&a.dom.$wrapper.find(e.videoAge).html(b.videoAge);a.vars.updateCRText=!0;a.vars.isVideoImmersivePlayer&&a.updateCRTextIfRequired();return}a.dom.$activeCrvMetadataContainer.addClass("aok-hidden").html("");a.toggleVideoMetadataVisibilityForCRV(!1)}a.updateBasicMediaInfo(b);
a.isCustomerReviewVideo(b)?(a.dom.$activeVideoTitlePrefix.removeClass("aok-hidden"),a.dom.$activeVideoCRLink.removeClass("aok-hidden"),a.dom.$activeVideoCRLinkWrapper.removeClass("aok-hidden")):(a.dom.$activeVideoTitlePrefix.addClass("aok-hidden"),a.dom.$activeVideoCRLink.addClass("aok-hidden"),a.dom.$activeVideoCRLinkWrapper.addClass("aok-hidden"));a.dom.$activeVideoCRLink.attr("href",b.referenceUrl||"");a.relatedVideosCarouselNotEmpty()&&(a.vars.showVotes=a.shouldShowVotes(b),a.vars.showVotes?(a.updateActiveVideoVoteContainer(b),
a.vars.activeVideoVoteContainer.showOrHide(!0,!0,!0,!0)):a.vars.activeVideoVoteContainer&&a.vars.activeVideoVoteContainer.showOrHide(!1,!1,!1,!1));(c=document.querySelector('[data-element-id\x3d"vse-ib-disclosure"]'))&&b.mandatoryBadgeDisclosure&&(c.textContent=b.mandatoryBadgeDisclosure);(c=document.querySelector('[data-element-id\x3d"ib-oap-disclosure"]'))&&b.mandatoryBadgeDisclosure&&(c.textContent=b.mandatoryBadgeDisclosure);a.isInfluencerVideo(b)?a.isOspEnabled(b)&&(a.dom.$wrapper.find(e.ibVideoOspDisclosure).addClass("aok-hidden"),
a.dom.$wrapper.find(e.ibVideoAiDisclosure).removeClass("aok-hidden")):(a.isOspEnabled(b)?a.dom.$wrapper.find(e.ibVideoOspDisclosure).removeClass("aok-hidden"):a.dom.$wrapper.find(e.ibVideoOspDisclosure).addClass("aok-hidden"),a.dom.$wrapper.find(e.ibVideoAiDisclosure).addClass("aok-hidden"));a.vars.shouldShowProfiles&&(a.isInfluencerVideo(b)?a.updateInfluencerProfile(b):a.updateCustomerProfile(b))};this.updateCustomerProfile=function(b){var c=-1==a.vars.currentIndex?a.vars.$(".vse-vdp-video-profile"):
a.dom.$lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+'"]').find(".vse-video-customer-profile");0<c.length?(a.dom.$activeVideoCustomerProfile.html(c.clone().removeClass("vse-hidden").html()),a.dom.$videoAuthorBlock.addClass("vse-hidden"),a.dom.$customerProfileContainer.removeClass("vse-no-cp"),b.entityId?(a.dom.$vseOapDivider.addClass("vse-hidden"),a.dom.$creatorNameAndDisclosure.removeClass("vse-hidden")):(a.dom.$vseOapDivider.removeClass("vse-hidden"),a.dom.$creatorNameAndDisclosure.addClass("vse-hidden"))):
(a.dom.$activeVideoCustomerProfile.html(""),a.dom.$customerProfileContainer.addClass("vse-no-cp"),a.dom.$wrapper.find(e.ibVideoOspDisclosure).find(e.creatorAndDisclosure).html(b.vendorName),b.entityId?(a.dom.$videoAuthorBlock.addClass("vse-hidden"),a.dom.$vseOapDivider.addClass("vse-hidden"),a.dom.$creatorNameAndDisclosure.removeClass("vse-hidden")):(a.dom.$videoAuthorBlock.removeClass("vse-hidden"),a.dom.$vseOapDivider.removeClass("vse-hidden"),a.dom.$creatorNameAndDisclosure.addClass("vse-hidden")))};
this.updateExpandWidgetOverlayText=function(b,c){try{var d=a.vars.auiTruncate.get(b),u=a.dom.$lbContainer.find(""+e.CRVInfoSelector);d&&d.getFullText()&&!u.hasClass("aok-hidden")&&(d.update(),d.getTruncatedText()===d.getFullText()?a.dom.$activeCrvMetadataContainer.find(c).hide():a.dom.$activeCrvMetadataContainer.find(c).show())}catch(g){m.logError(e.ATTRIBUTION_NAME,"Cannot update CRV Text OverPlayer: "+a.vars.currentAssetSpec.contentId+", productAsin: "+a.vars.productAsin,g)}};this.setupExpandCollapseTextWidget=
function(b){a.vars.truncateWidgetId="#"+a.vars.clientPrefix+"-truncate-widget";a.vars.expandButtonSelector="#"+a.vars.clientPrefix+"-ive-expand-button";a.vars.A.declarative(b,"click",function(){a.expandOrCollapseText(a.vars.auiTruncate.get(a.vars.truncateWidgetId))})};this.expandOrCollapseText=function(b){try{b._$cut.is(":visible")?(a.expandTruncatedText(b),a.vars.$(a.vars.playerContainer).addClass("review-expanded"),a.pauseVideoIfNeeded()):(a.collapseToTruncateText(a.vars.auiTruncate.get(a.vars.truncateWidgetId)),
a.vars.$(a.vars.playerContainer).removeClass("review-expanded"),a.vars.vipControlsShouldPause&&a.resumeVideoIfNeeded())}catch(c){m.logError(e.ATTRIBUTION_NAME,"Cannot expand/collapse: "+a.vars.currentAssetSpec.contentId+", productAsin: "+a.vars.productAsin,c)}};this.expandTruncatedText=function(b){try{b&&(a.showHideCRVTextExpandedView(!0),b._$cut.hide(),b._$full.removeClass("a-offscreen"),b._$full.show(),b._$element.css("max-height","none"),b._$full.css("max-height",a.getMaxCRContainerHeight()+"px"),
a.dom.$activeCrvMetadataContainer.find(".ive-txt-expander-btn").addClass("expanded"))}catch(c){m.logError(e.ATTRIBUTION_NAME,"Cannot expand: "+a.vars.currentAssetSpec.contentId+", productAsin: "+a.vars.productAsin,c)}};this.collapseToTruncateText=function(b){try{b&&(a.showHideCRVTextExpandedView(!1),b._$cut.show(),b._$full.hide(),b._$element.css("max-height",b._$cut.height+"px"),a.dom.$activeCrvMetadataContainer.find(".ive-txt-expander-btn").removeClass("expanded"))}catch(c){m.logError(e.ATTRIBUTION_NAME,
"Cannot collapse: "+a.vars.currentAssetSpec.contentId+", productAsin: "+a.vars.productAsin,c)}};this.showHideCRVTextExpandedView=function(b){a.vars.isVideoImmersivePlayer&&(a.dom.$lbContainer.find(""+e.VIPOverlaySelector).toggleClass(e.ReviewTextExpandClassName,b),a.dom.$lbContainer.find(""+e.MetadataWrapperSelector).toggleClass("aok-hidden",b),a.dom.$lbContainer.find("."+e.UpNextClassName).toggleClass("aok-hidden",b),a.dom.$lbContainer.find(""+e.ActionContainerSelector).toggleClass("aok-hidden",
b),a.dom.$lbContainer.find("."+e.VIPScrubberClassName).toggleClass("aok-hidden",b),a.dom.$lbContainer.find(""+e.VIPCCTextTrackSelector).toggleClass("aok-hidden",b),a.dom.$lbContainer.find(""+e.VIPPlayPauseContainerSelector).toggleClass("aok-hidden",b),a.dom.$lbContainer.find(""+e.VIPMultiCarouselWrapper).toggleClass("aok-hidden",b))};this.getMaxCRContainerHeight=function(){var b=document.getElementById(a.vars.clientPrefix+"-truncate-widget");if(!b)return 0;b=b.getBoundingClientRect();if(a.vars.isVideoImmersivePlayer){var c=
a.A.$("#"+a.vars.templateId+" "+e.VIPMultiCarouselWrapper),d=a.dom.$lbContainer[0].getBoundingClientRect(),c=c?c[0].getBoundingClientRect().height:0;return d.height-(b.top-d.top)-c-a.vars.CRV_TEXT_VERTICAL_PADDING_PX}if(d=document.getElementById(a.vars.containerId+"-container"))return d=d.getBoundingClientRect(),d.height-(b.top-d.top)-50};this.updateInfluencerProfile=function(b){var c=-1==a.vars.currentIndex?a.vars.$(".vse-vdp-video-profile"):a.dom.$lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+
'"]').find(".vse-video-influencer-profile");0<c.length&&(c=c.clone(),a.dom.$activeVideoCustomerProfile.html(c.removeClass("vse-hidden").html()),a.dom.$activeVideoCustomerProfile.addClass("vse-active-profile-container"),a.dom.$videoAuthorBlock.addClass("vse-hidden"),a.dom.$wrapper.find(e.ibVideoOspDisclosure).addClass("aok-hidden"),a.dom.$wrapper.find(e.ibVideoAiDisclosure).removeClass("aok-hidden"),b.entityId&&a.dom.$customerProfileContainer.append(a.dom.$vseFollowClassSelector),b.vendorName?(c=a.dom.$wrapper.find(e.ibVideoAiDisclosure),
c.find(e.creatorAndDisclosure).html(b.vendorName),b=a.dom.$activeVideoCustomerProfile.find(".vse-profile").attr("href"),c.find(e.creatorAndDisclosure).attr("href",b),a.dom.$vseOapDivider.addClass("vse-hidden"),a.dom.$creatorNameAndDisclosure.removeClass("vse-hidden")):(a.dom.$vseOapDivider.removeClass("vse-hidden"),a.dom.$creatorNameAndDisclosure.addClass("vse-hidden")),a.dom.$customerProfileContainer.removeClass("vse-no-cp"),a.handleInfluencerProfileNameClick(),a.handleInfluencerAvatarClick())};
this.removeAudioOverlay=function(){var b=a.vars.$("#"+a.vars.popoverId);b.length&&(b=b.find("."+e.AUDIO_UNAVAILABLE_OVERLAY),b.length&&b.remove())};this.createAudioOverlay=function(b){var c=a.vars.$("#"+a.vars.popoverId);if(c.length){var d=a.vars.isMobile?c.find(".vse-vip-controls"):c.find(".brila-video-js").find(".vjs-control-bar");c.find("."+e.AUDIO_UNAVAILABLE_OVERLAY).remove();b=a.vars.$("\x3cdiv\x3e",{class:""+e.AUDIO_UNAVAILABLE_OVERLAY,text:b.audioNote});d.length&&d.first().before(b)}};this.needToUpdateVideoInfoLater=
function(){return a.isImageBlockVIP()&&!a.vars.A.objectIsEmpty(a.vars.currentAssetSpec)&&a.vars.A.objectIsEmpty(a.vars.currentAssetSpec.title)};this.updateVideoMetadataIfNeeded=function(b){a.needToUpdateVideoInfoLater()&&(a.updateBasicMediaInfo(b),a.resetUserActivityTimer(),a.showVideoImmersivePlayerOverlay(),!a.vars.A.objectIsEmpty(b.closedCaptions)&&0<b.closedCaptions.length&&(a.vars.player.removeCurrentTextTracks(),a.vars.player.updateTextTrack(b.closedCaptions)))};this.clearCurrentVideoInfo=function(){a.updateBasicMediaInfo({title:"",
vendorName:"",entityId:"",entityType:""})};this.updateCCVDisclosure=function(b){b=b.ccvDisclosure?b.ccvDisclosure:"";0<b.length?(a.dom.$wrapper.find(e.ccvDisclosureMessage).html(b),a.dom.$wrapper.find(e.CCVContainerSelector).toggleClass("aok-hidden",!1)):a.dom.$wrapper.find(e.CCVContainerSelector).toggleClass("aok-hidden",!0)};this.updateBasicMediaInfo=function(b){a.dom.$wrapper.find(e.videoTitle).html(b.title);a.dom.$wrapper.find(e.vendorName).html(b.vendorName);a.vars.showUploadDate&&a.dom.$wrapper.find(e.videoAge).html(b.videoAge);
a.updateFollowCreatorButton(b);a.updateCCVDisclosure(b)};this.setUpSingleLBOverlayIfRequired=function(){a.vars.showSingleLBOverlay&&(a.moveMetadataOverPlayer(a.dom.$activeCrvMetadataContainer),a.moveMetadataOverPlayer(a.dom.$activeMetadataContainer),a.setupPlayerHoverHandler(),a.showPlayerOverlayFeaturesForAFewMS(3E3),a.setupExpandCollapseTextWidget(a.vars.clientPrefix+"-toggle-full-text"))};this.updateFollowCreatorButton=function(b){try{a.dom.$followButtonSelector.length?a.isValidEntityToFollow(b)?
(a.updateFollowButtonAttributes(b),a.handleFollowButtonInitialization()):a.hideFollowElements():a.hideFollowEligibleCreator()}catch(c){a.logFollowButtonError(b,c)}};this.isImageBlockVIP=function(){return a.vars.isVideoImmersivePlayer&&-1!==a.vars.clientPrefix.indexOf("imageblock")};this.createContinuousPlayPlaylist=function(b){a.vars.playlist=a.getCombinedPlaylist();for(var c=0;c<a.vars.playlist.length&&a.vars.playlist[0].contentId!==b.contentId;c++)a.vars.playlist.push(a.vars.playlist.shift())};
this.updateFeedback=function(b){a.vars.A.objectIsEmpty(a.vars.feedback)||a.vars.A.objectIsEmpty(b)||(a.vars.feedback.setActiveVideoAndSource(b.contentId,b.vendorCode,b.aciContentId,b.reportUrl),a.handleReportIllegalContentUpdate(null!=b.disableReportIllegalLink?b.disableReportIllegalLink:!1))};this.handleReportIllegalContentUpdate=function(b){0<a.vars.A.$(""+e.reportIllegalLinkSelector).length&&(a.vars.A.$(""+e.reportIllegalMessageSelector).toggleClass("aok-hidden",b),a.vars.A.$(""+e.reportIllegalLinkSelector).toggleClass("aok-hidden",
b),a.vars.A.$(""+e.reportDefaultMessageSelector).toggleClass("aok-hidden",!b),b||a.vars.feedback.updateReportIllegalContentLink())};this.initializeHelpfulVotes=function(){if(a.vars.showVotes){var b=a.getActiveAsset();a.updateActiveVideoVoteContainer(b);a.vars.A.on(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-hide-votes",function(){a.vars.activeVideoVoteContainer.showOrHide(!1,!1,!1,!1);a.vars.videoVoteFailure=!0});a.vars.A.off("a:declarative:"+(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+
"-vote-positive")+":click");a.vars.A.declarative(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-positive","click",function(){a.castVote(n.POSITIVE_VOTE)});a.vars.A.off(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast");a.vars.A.on(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast",function(b){var c=b===n.POSITIVE_VOTE?n.NEGATIVE_VOTE:n.POSITIVE_VOTE,d=a.getActiveAsset(),g=n.EMPTY_STRING;d&&d.videoVoteContainer&&(g=d.videoVoteContainer.getPreviousVote()===
b?"cancel:"+b:d.videoVoteContainer.getPreviousVote()===n.POSITIVE_VOTE||d.videoVoteContainer.getPreviousVote()===n.NEGATIVE_VOTE?"switch-"+c+"-to-"+b:b,d.videoVoteContainer.updateWithNewVote(b));a.emitMetricToNexus({eventName:a.vars.clientPrefix+"ibiv.videovote.castvote:"+g,stringPayload:e.EMPTY_STRING,intPayload:1,videoAsin:d.contentId})})}};this.emitMetricToNexus=function(b){a.vars.emitMetricsToNexus&&(b.customerId=a.vars.customerId||"",b=a.vars.buildNexusPayload(b),m.emitNexusMetric(b,a.vars.nexusMetricsConfig.producerId,
a.vars.nexusMetricsConfig.widgetMetricsSchemaId,a.vars.nexusMetricsConfig.isInternal))};this.shouldShowVotes=function(b){return a.vars.videoVoteContainerFactory&&a.vars.videoVoteContainerFactory.videoVoteConfig&&b&&b.videoVoteContainer&&!a.vars.A.objectIsEmpty(b.videoVoteContainer)&&!a.vars.videoVoteFailure&&!a.vars.showHeroExperience};this.show=function(b){a.updateMediaInfo(b);a.updateFeedback(b);a.vars.includeVideoInformationOverPlayer&&a.showPlayerOverlayFeaturesForAFewMS(3E3,b);a.vars.skipRelatedVideosWait&&
a.showRelatedProducts(b);a.refreshSocialSharePageState(b);a.showLabel(b);a.rotateTo(b);a.updateClosedCaptions(b);a.vars.isVideoImmersivePlayer&&a.showOrHideSearchButton(b)};this.triggerAUIResize=function(){a.vars.A.trigger("resize",{},{width:screen.width,height:k.innerHeight})};this.showPlayerOverlayFeaturesForAFewMS=function(b,c){setTimeout(function(){a.showPlayerOverlayFeatures(c);a.vars.showActiveMetadataTimeoutId=setTimeout(function(){a.hidePlayerOverlayFeatures()},b)},500)};this.hasHiddenAndShowMoreClasses=
function(b){if(!a.dom.$lbVideoCarousel)return!1;b=a.dom.$lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+'"]');return b.hasClass("vse-hidden")&&b.hasClass("vse-show-more")};this.showOrHideSearchButton=function(b){b.hasHotspots&&!a.vars.isHotspotsWeblabTriggered&&(a.triggerWeblab(e.HOTSPOTS_V2_WEBLAB),a.vars.isHotspotsWeblabTriggered=!0);var c=a.vars.$("#"+a.vars.templateId).closest(e.VIPSelector),d=b.hasHotspots&&a.vars.useHotspotsNX;if(0<c.length&&(b.showHotspots||a.vars.useHotspotsNX)&&!d){a.vars.showHotspots=
!0;if(null==a.vars.visualSearchComponent){try{var u=a.initializeVisualSearchComponent();a.vars.visualSearchComponent=a.vars.useHotspotsNX?new ma(a,u):new ha(a,u)}catch(g){m.logError(e.ATTRIBUTION_NAME,"Failed to load VisualSearch",g)}a.vars.visualSearchComponent.handleSearchButtonInteractions()}a.vars.visualSearchComponent.updateEducationalRules();a.vars.A.$("#"+a.vars.templateId+" "+e.VIPSearchButtonSelector).show();a.vars.visualSearchComponent.emitMetric(e.VisualSearchMetricPrefix+"searchButton:shown")}else a.vars.showHotspots=
!1,a.vars.A.$("#"+a.vars.templateId+" "+e.VIPSearchButtonSelector).hide();!a.vars.A.objectIsEmpty(a.vars.visualSearchComponent)&&a.vars.visualSearchComponent.isInVisualSearchMode()&&a.vars.visualSearchComponent.exitVisualSearchMode()};this.showLabel=function(b){if(b.labelDetails&&b.labelDetails.showLabel){if("videoType"===b.labelDetails.labelType){a.vars.isVideoTypeLabelPresent=!0;a.vars.isTimeoutComplete=!1;var c=a.vars.A.$("#"+a.vars.templateId+" "+e.LabelNameSelector);c.text(b.labelDetails.labelName);
c.removeClass("aok-hidden");setTimeout(function(){c.addClass("aok-hidden");a.vars.isTimeoutComplete=!0;a.vars.cursorOnVideoPlayerDiv&&c.removeClass("aok-hidden")},3E3);c.removeAttr("title");a.vars.A.off("a:popover:afterShow:ive-"+a.vars.clientPrefix+"-label-type-tooltip");a.vars.A.on("a:popover:afterShow:ive-"+a.vars.clientPrefix+"-label-type-tooltip",function(b){b.popover.$popover.bind("mouseenter touchstart focus",function(){a.vars.isFeedbackClosed&&a.showFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer)})});
a.vars.A.off("a:popover:show:ive-"+a.vars.clientPrefix+"-label-type-tooltip");a.vars.A.on("a:popover:show:ive-"+a.vars.clientPrefix+"-label-type-tooltip",function(a){var c=a.popover.$popover;a=c.find(""+e.LabelTooltipSelector);c=c.find(""+b.labelDetails.tooltipSelector);a.addClass("aok-hidden");c.removeClass("aok-hidden")})}"verifiedType"===b.labelDetails.labelType&&(a.vars.isVideoTypeLabelPresent=!1,a.dom.$wrapper.find(e.verifiedPurchaseLabel).removeClass("aok-hidden"),a.dom.$wrapper.find(e.verifiedPurchaseLabelDivider).removeClass("aok-hidden"))}else a.vars.isVideoTypeLabelPresent=
!1,a.vars.A.$("#"+a.vars.templateId+" "+e.LabelNameSelector).addClass("aok-hidden"),a.dom.$wrapper.find(e.verifiedPurchaseLabel).addClass("aok-hidden"),a.dom.$wrapper.find(e.verifiedPurchaseLabelDivider).addClass("aok-hidden")};this.getSegmentTypeIfMoreVideosToExpand=function(b){b=a.dom.$lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+'"]');return a.vars.relatedVideosCarousel.getSegmentTypeFromElement(b)};this.getDefaultLangFromClosedCaptions=function(a){return a&&0<a.length?a[0].locale:null};
this.updateClosedCaptions=function(b){b.eligibleToTriggerCCWeblab&&!a.vars.isCCWeblabTriggered&&(a.triggerWeblab(e.TRANSLATED_CC_WEBLAB),a.vars.isCCWeblabTriggered=!0);a.vars.isVideoImmersivePlayer&&(a.vars.currentClosedCaptionsLang=a.getDefaultLangFromClosedCaptions(b.closedCaptions),a.showOrHideClosedCaptions(b),a.vars.shouldHandleCCForLandscapeVideo=b.videoWidth!==t&&b.videoHeight!==t?b.videoWidth>b.videoHeight:!1)};this.showOrHideClosedCaptions=function(b){b.closedCaptions&&0<b.closedCaptions.length?
a.vars.A.$("#"+a.vars.templateId+" "+e.VIPCCButtonSelector).show():a.vars.A.$("#"+a.vars.templateId+" "+e.VIPCCButtonSelector).hide()};this.updateActiveVideoVoteContainer=function(b){a.emitButtonImpressionMetric(a.vars.clientPrefix+"."+e.METRIC_HELPFUL_VOTES_IMPRESSION);a.vars.activeVideoVoteContainer.setPreviousVote(n.NONE_VOTE);a.vars.activeVideoVoteContainer.setContentId(b.contentId);b.videoVoteContainer&&(a.vars.activeVideoVoteContainer.setVoteCount(n.POSITIVE_VOTE,b.videoVoteContainer.getVoteCount(n.POSITIVE_VOTE)),
a.vars.activeVideoVoteContainer.setVoteCount(n.NEGATIVE_VOTE,b.videoVoteContainer.getVoteCount(n.NEGATIVE_VOTE)));a.fetchAndUpdateVoteCountAndStatus(b)};this.castVote=function(b){if(a.vars.videoVoteContainerFactory&&a.vars.videoVoteContainerFactory.videoVoteConfig){var c=a.vars.activeVideoVoteContainer.getPreviousVote(),d=b===n.POSITIVE_VOTE&&c!=n.POSITIVE_VOTE,c=b===n.NEGATIVE_VOTE&&c!=n.NEGATIVE_VOTE;a.vars.activeVideoVoteContainer.updateWithNewVote(b);a.vars.videoVoteContainerFactory.sendVoteToRemote(d,
c,a.vars.activeVideoVoteContainer.getContentId()).then(function(c){a.vars.videoVoteContainerFactory&&a.vars.videoVoteContainerFactory.videoVoteConfig&&a.vars.A.trigger(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-vote-cast",b)},function(c){m.count(a.vars.clientPrefix+".videovote.votecastfailure",1);a.vars.activeVideoVoteContainer.updateWithNewVote(b)})}};this.fetchAndUpdateVoteCountAndStatus=function(b){b.videoVoteContainer&&b.videoVoteContainer.getPreviousVote()!==n.EMPTY_STRING&&
a.vars.activeVideoVoteContainer.setPreviousVote(b.videoVoteContainer.getPreviousVote());b.videoVoteContainer&&!b.videoVoteContainer.countsFetched&&a.vars.videoVoteContainerFactory.fetchVoteCountAndStatus(b.contentId).then(function(c){a.relatedVideosCarouselNotEmpty()&&-1!=a.vars.currentIndex&&a.updateVotingElementsForCountAndStatus(b,c,!1);b.videoVoteContainer.setVoteCount(n.POSITIVE_VOTE,c.positiveVoteCount);b.videoVoteContainer.countsFetched=!0;a.vars.activeVideoVoteContainer.setVoteCount(n.POSITIVE_VOTE,
c.positiveVoteCount);a.vars.activeVideoVoteContainer.countsFetched=!0;c=1===c.voteStatus?n.POSITIVE_VOTE:n.NONE_VOTE;a.vars.activeVideoVoteContainer.setPreviousVote(c);b.videoVoteContainer.setPreviousVote(c);a.vars.activeVideoVoteContainer.showOrHide(!0,!0,!0,!0)},function(b){m.count(a.vars.clientPrefix+".videovote.votecountandstatusfailure",1);a.vars.A.trigger(a.vars.videoVoteContainerFactory.videoVoteConfig.actionPrefix+"-hide-votes")})};this.showRelatedProducts=function(b){a.fadeOutRelatedProductsContainer();
var c=a.setRelatedProducts(b),d=b.productAsin;a.setRelatedProductsContainer();if(c!==t||b.relatedProductsWithSubstitute)a.vars.showLightboxV2Experience?a.vars.$(e.RELATED_PRODUCTS_CONTAINER_SELECTOR).css({visibility:""}):a.vars.A.show(a.vars.$(e.RELATED_PRODUCTS_CONTAINER_SELECTOR)),a.detachCurrentCarousel(b.contentId),a.attachCachedCarousel(b.contentId)?(a.hideCurrentlyVisibleProductContainer(),a.showRelatedProductCarousel(b.contentId,d),a.fadeInRelatedProductsContainer(b.contentId,d),setTimeout(a.resizeLB,
500)):a.getRelatedProducts(1,c,b)};this.setRelatedProductsContainer=function(){a.vars.showHeroExperience?(a.vars.$relatedProductsParentEl=a.vars.$("#"+a.vars.templateId),a.vars.relatedProductsContainer=e.HERO_WIDGET_CONTAINER+" #"+e.CACHE_RP_PAYLOAD_HIDDEN_DIV_CARDS_CONTAINER,a.dom.$relatedProductContainer=a.vars.$(""+a.vars.relatedProductsContainer)):(a.vars.$relatedProductsParentEl=a.vars.$(a.dom.$wrapper),a.vars.relatedProductsContainer="#"+a.vars.popoverId+" "+e.RELATED_PRODUCTS_CONTAINER_SELECTOR)};
this.setRelatedProducts=function(b){var c;c=a.vars.A.objectIsEmpty(a.vars.firstRelatedProductOverride)?b.relatedProducts&&""!==b.relatedProducts?b.relatedProducts:b.productAsin:a.vars.A.objectIsEmpty(b.relatedProducts)?a.vars.firstRelatedProductOverride:a.vars.firstRelatedProductOverride+","+b.relatedProducts;b=a.vars.complementaryAsins[b.contentId]||[];0<b.length&&c&&(c+=","+b.join(","));return c};this.handleClickPFOEvent=function(b){b.preventDefault();b.stopPropagation();b.stopImmediatePropagation();
var c=a.vars.$(b.target).closest("li").find(e.RELATED_PRODUCTS_ITEM_SELECTOR),d=c.attr("data-asin"),c=c.hasClass("vse-sponsor-product").toString();a.emitPFOClickMetric(e.METRIC_PFO_CLICK,d,c);d=a.vars.$(b.target).closest("li").find(".vse-carousel-item").attr("href");a.vars.enableClickBasedAttribution&&a.vars.player.getCurrentTime()>=e.CLICK_ATTRIBUTION_INITIAL_DELAY&&a.isOspEnabled(a.vars.currentAssetSpec)?m.count("pfo:osp:tag:emitted:success:"+a.vars.linkCode,1):d=a.vars.$(b.target).closest("li").find(e.RELATED_PRODUCTS_ITEM_SELECTOR+
" a").attr(e.ATTR_ORIGINAL_HREF)||d;a.vars.isMshop||k.open(d,"_blank");a.openExternalLinkFromLightBox(d)};this.preserveCssLink=function(){var b=a.dom.$relatedProductContainer.find('link[rel\x3d"stylesheet"]').first();b.length&&a.dom.$relatedProductContainer.append(b.clone())};this.detachCurrentCarousel=function(b){a.preserveCssLink();var c=a.detachExceptSkeleton();c&&c.length&&a.vars.currentCarouselContentId&&(a.vars.detachedCarousels[a.vars.currentCarouselContentId]=c);a.vars.currentCarouselContentId=
b};this.attachCachedCarousel=function(b){return(b=a.vars.detachedCarousels[b])?(a.dom.$relatedProductContainer.append(b),!0):!1};this.getRelatedProducts=function(b,c,d){var u=!0;0<a.vars.relatedProductsNilgiriRequestCount&&(u=!1);var g=D.fetchLatestPageState(a.vars.A,a.vars.clientPrefix+"-related-products-request-ps");if(g){var l=g.componentConfiguration,k=g.pageContext;a.vars.showPFOOnOverlay=g.showPFOOnOverlay;a.vars.showPFOOnOverlay&&(a.A.$("#"+a.vars.templateId+" "+e.VIPProductCarouselOverlaySelector).hide(),
a.A.$("#"+a.vars.templateId+" "+e.RELATED_PRODUCTS_CONTAINER_SELECTOR).hide());a.vars.cacheOnProductAsin=g.cacheOnProductAsin;l&&k&&l.features&&l.features.features&&(k.metadata?k.metadata.relatedProductsAsins=c:k.metadata={relatedProductsAsins:c},a.vars.productAsin=a.vars.A.objectIsEmpty(a.vars.productAsin)?a.vars.A.objectIsEmpty(d.productAsin)?a.vars.A.objectIsEmpty(k.product)?"":k.product.contentID:d.productAsin:a.vars.productAsin,d.relatedProductsWithSubstitute&&(k.metadata.relatedProductsWithSubstitute=
d.relatedProductsWithSubstitute),d.refTag&&(k.metadata.refTag=d.refTag),u={pageContext:{page:k.page,placement:k.placement,marketplaceID:k.marketplaceID,locale:k.locale,customerId:k.customerId,requestId:k.requestId,product:{contentID:a.vars.productAsin,contentIDType:"ASIN"},metadata:k.metadata,device:k.device,clientPrefix:k.clientPrefix},configuration:{id:l.id,type:l.type,binder:l.binder,assets:u?["ProductCarousel"]:[],features:{features:l.features.features}}},a.vars.relatedProductsRequest=u,a.vars.relatedProductsCarouselName=
l.features.features.carouselName,a.vars.keepProductCarouselOpenOnClick=null!=l.features.features.keepProductCarouselOpenOnClick?l.features.features.keepProductCarouselOpenOnClick:!1,a.vars.showHeroExperience&&a.showSkeletalLoaderClassForHeroWidget(),C.sendRequest(a.vars.A,""+e.VAP_EW+e.RELATED_PRODUCTS_ENDPOINT,u,function(b){a.vars.showHeroExperience&&(a.dropSkeletalLoaderClassForHeroWidget(),setTimeout(a.triggerAUIResize,500));if(-1!==b.indexOf(e.RELATED_PRODUCTS_INNER_CLASS_NAME)){a.dom.$relatedProductContainer.append(b);
a.handleGetRelatedProductsSuccess(d.contentId,d.productAsin);a.vars.$relatedProductsParentEl.delegate(e.RELATED_PRODUCTS_ITEM_SELECTOR+" a","click",function(b){a.handleClickPFOEvent(b)});b=D.fetchLatestPageState(a.vars.A,a.vars.clientPrefix+"-related-products-ps");var c=document.querySelectorAll("#"+a.vars.popoverId+" "+e.HAS_PUI_SELECTOR+" "+e.RELATED_PRODUCTS_CAROUSEL_ELEMENT);0<c.length&&(a.addTagForSponsoredElements(c),a.appendUrParamsForProductAsins(c,b.getUrlParamsForAsins),b=a.vars.$(a.dom.$wrapper).find("[id^\x3d"+
a.vars.relatedProductsCarouselName+"]:visible").attr("id"),a.emitClickMetricForPUI(e.addToCartClickSelector,e.addToCartMetricSuffix,b),a.emitClickMetricForPUI(e.puiRelatedProductAsinSelector+" a",e.EMPTY_STRING,b),a.navigateToNewPageOnPuiClick(b),a.vars.$("#"+b+" "+e.puiRelatedProductAsinSelector+" "+e.puiStarRatingSelector).closest("span.a-declarative").removeClass("a-declarative"));a.vars.enableClickBasedAttribution&&(b=a.vars.$(a.dom.$wrapper).find(""+e.RELATED_PRODUCTS_ITEM_SELECTOR),a.disableRightClickOnPFOUntilRefParamsAreBound(b));
a.vars.isVideoImmersivePlayer&&a.vars.showPFOOnOverlay&&(a.A.$("#"+a.vars.templateId+" "+e.VIPProductCarouselOverlaySelector).fadeIn(1E3),a.A.$("#"+a.vars.templateId+" "+e.RELATED_PRODUCTS_CONTAINER_SELECTOR).fadeIn(1E3),a.handleCCStylesOnCarouselVisibility(!0));a.vars.A.objectIsEmpty(a.vars.A.$(e.LB_CAROUSEL_CONFIG).attr("data-configuration"))&&a.emitPFORenderMetric(e.METRIC_PFO_RENDER);m.count(a.vars.clientPrefix+":relatedproducts:load:success",1);a.vars.A.trigger(a.vars.clientPrefix+":relatedproducts:load:success");
a.vars.relatedProductsNilgiriRequestCount+=1}else a.handleGetRelatedProductsFailure()},function(f){(!f.http.status||500<=f.http.status&&600>f.http.status)&&b<e.AJAX_MAX_RETRY_COUNT?(b+=1,a.getRelatedProducts(b,c,d)):a.handleGetRelatedProductsFailure()}))}else m.count(e.RELATED_PRODUCT_PAGE_STATE_NOT_FOUND_ERROR_KEY,1)};this.disableRightClickOnPFOUntilRefParamsAreBound=function(b){if(!b)return!1;a.vars.$(b).bind("contextmenu",function(b){return a.vars.player.getCurrentTime()<e.CLICK_ATTRIBUTION_INITIAL_DELAY?
(b.preventDefault(),!1):!0})};this.appendUrParamsForProductAsins=function(b,c){Array.prototype.forEach.call(b,function(b){if(b=b.querySelector(".pui-wrapper")){var d=b.getAttribute("data-dib-asin");d&&c[d]&&(b=b.querySelectorAll("a"),Array.prototype.forEach.call(b,function(b){b.href&&(b.href=a.appendOSPAttributionToPFOLinkIfRequired(c[d],d),b.setAttribute(e.ATTR_ORIGINAL_HREF,c[d]))}))}})};this.addTagForSponsoredElements=function(a){Array.prototype.forEach.call(a,function(a){var b=a.querySelector(".pui-wrapper .vse-product-sponsored-disclosure");
a=a.querySelector('[data-cy\x3d"title-recipe"]');b&&a&&(b.remove(),a.firstChild?a.insertBefore(b,a.firstChild):a.appendChild(b))})};this.bindClickAttributionToPFOs=function(b){return a.isOspEnabled(a.vars.currentAssetSpec)?b&&0<b.length?(b.each(function(c){c=a.A.$(b[c]);var d=c.closest(e.pfoRelatedProductSelector).attr("data-asin"),k=c.attr("href");c.attr(e.ATTR_ORIGINAL_HREF,k);d={href:k,asin:d||a.vars.currentAssetSpec.productAsin||a.vars.productAsin,linkCode:a.vars.linkCode,aciContentId:a.vars.currentAssetSpec.aciContentId||
a.vars.aciContentId||a.getAciContentIdFromPlayerInstance(),vendorTrackingId:a.vars.currentAssetSpec.vendorTrackingId};d=(new N(a.vars.A)).buildTag(d);c.attr("href",d)}),!0):!1:!1};this.appendOSPAttributionToPFOLinkIfRequired=function(b,c){return a.isOspEnabled(a.vars.currentAssetSpec)?(b={href:b,asin:c,linkCode:a.vars.linkCode,aciContentId:a.vars.currentAssetSpec.aciContentId||a.vars.aciContentId||a.getAciContentIdFromPlayerInstance(),vendorTrackingId:a.vars.currentAssetSpec.vendorTrackingId},(new N(a.vars.A)).buildTag(b)):
b};this.getVideoToRelatedProductsDivId=function(b,c,d){b=a.vars.popoverId+"-"+d+a.sanitizeForCssSelector(b);a.vars.cacheOnProductAsin&&!a.vars.A.objectIsEmpty(c)&&(b+="-"+c);return b};this.sanitizeForCssSelector=function(a){return a.split(".").join("")};this.dropSkeletalLoaderClassForHeroWidget=function(){var b=a.vars.$(""+a.vars.relatedProductsContainer).children().first();b.length&&b.addClass("aok-hidden")};this.showSkeletalLoaderClassForHeroWidget=function(){var b=a.vars.$(""+a.vars.relatedProductsContainer).children().first();
b.length&&b.removeClass("aok-hidden")};this.handleGetRelatedProductsSuccess=function(b,c){a.hideCurrentlyVisibleProductContainer();var d=a.getVideoToRelatedProductsDivId(b,c,e.VISIBLE_DIV_NARROW_PREFIX),u=a.detachExceptSkeleton();a.vars.$(a.vars.relatedProductsContainer).append('\x3cdiv class\x3d"vse-pc-visible'+(a.vars.showHeroExperience?" vse-hero-rp-container":"")+" aok-hidden\" id\x3d'"+d+"'\x3e\x3c/div\x3e");a.vars.$("#"+d).append(u);a.vars.$(a.vars.relatedProductsContainer+" #"+d+" .a-carousel-left").attr("data-element-id",
a.vars.clientPrefix+"-pc-left-button");a.vars.$(a.vars.relatedProductsContainer+" #"+d+" .a-carousel-right").attr("data-element-id",a.vars.clientPrefix+"-pc-right-button");a.showRelatedProductCarousel(b,c);a.fadeInRelatedProductsContainer(b,c);a.vars.enableClickBasedAttribution&&(b=a.vars.$("#"+d).find(e.RELATED_PRODUCTS_ITEM_SELECTOR+" a"),a.bindClickAttributionToPFOs(b));d=document.querySelectorAll(a.vars.relatedProductsContainer+" #"+d+" "+e.RELATED_PRODUCTS_ITEM_SELECTOR);b=a.vars.$(a.dom.$wrapper).find("[id^\x3d"+
a.vars.relatedProductsCarouselName+"]:visible "+e.RELATED_PRODUCTS_CAROUSEL_ELEMENT);(d=0<d.length?d:b)&&k.IntersectionObserver&&new J(null,d,a.onProductItemIntersectionObserved,a.vars.enableWidgetMetricsAfterOneSecond);a.setupKeyPressEventHandlerForRelatedProductsCarousel();setTimeout(a.resizeLB,500)};this.hideCurrentlyVisibleProductContainer=function(){a.vars.$(""+a.vars.relatedProductsContainer).find(".vse-pc-visible").addClass("aok-hidden");a.hideVIPProductCarouselEmptyViewContainer()};this.hideVIPProductCarouselEmptyViewContainer=
function(){a.vars.isVideoImmersivePlayer&&a.vars.A.$(e.VIPEmptyRelatedProductsContainerSelector).addClass("aok-hidden")};this.showVIPProductCarouselEmptyViewContainer=function(){a.vars.isVideoImmersivePlayer&&a.vars.A.$(e.VIPEmptyRelatedProductsContainerSelector).removeClass("aok-hidden")};this.showRelatedProductCarousel=function(b,c){a.vars.A.show(a.vars.$(""+a.vars.relatedProductsContainer));b=a.getVideoToRelatedProductsDivId(b,c,e.VISIBLE_DIV_NARROW_PREFIX);a.vars.$("#"+b).removeClass("aok-hidden")};
this.handleGetRelatedProductsFailure=function(){m.count(a.vars.clientPrefix+":relatedproducts:load:failed",1);a.vars.showLightboxV2Experience?a.vars.$(e.RELATED_PRODUCTS_CONTAINER_SELECTOR).css({visibility:"hidden"}):a.vars.A.hide(a.vars.$(e.RELATED_PRODUCTS_CONTAINER_SELECTOR));a.vars.isVideoImmersivePlayer&&(a.hideCurrentlyVisibleProductContainer(),a.showVIPProductCarouselEmptyViewContainer());setTimeout(a.resizeLB,500)};this.fadeOutRelatedProductsContainer=function(){a.vars.$(e.RELATED_PRODUCTS_CONTAINER_SELECTOR+
" "+e.RELATED_PRODUCTS_INNER_CONTAINER).fadeOut(0)};this.fadeInRelatedProductsContainer=function(b,c){b=a.getVideoToRelatedProductsDivId(b,c,e.VISIBLE_DIV_NARROW_PREFIX);a.vars.$("#"+b+" "+e.RELATED_PRODUCTS_INNER_CONTAINER).animate({opacity:1},0);a.vars.$(a.vars.relatedProductsContainer+" "+e.RELATED_PRODUCTS_INNER_CONTAINER).fadeIn(200)};this.showFeedbackLink=function(b,c){a.vars.includeVideoInformationOverPlayer?a.vars.$(b).fadeIn(500):a.vars.$(b).css({display:"inline-block"});b=a.vars.A.$("#"+
a.vars.templateId+" "+e.LabelNameSelector);b.length&&a.vars.isVideoTypeLabelPresent&&b.removeClass("aok-hidden");a.vars.includeVideoInformationOverPlayer||a.toggleDimVideoPlayer(c,!0)};this.showActiveMetadataOverPlayer=function(b){b=b||(a.vars.showSingleLBOverlay?a.vars.currentAssetSpec:a.getCurrentlyPlayingVideoInCarousel(a.vars.currentIndex));clearTimeout(a.vars.showActiveMetadataTimeoutId);a.vars.includeVideoInformationOverPlayer&&b&&!a.shouldDisablePlayerOverlayInteractions()&&(a.toggleDimVideoPlayer(a.vars.playerContainer,
!0),a.isCustomerReviewVideo(b)&&a.dom.$activeCrvMetadataContainer&&0<a.dom.$activeCrvMetadataContainer.length?(a.dom.$activeMetadataContainer&&a.dom.$activeMetadataContainer.hide(),a.fadeInContainer(a.dom.$activeCrvMetadataContainer),a.updateCRTextIfRequired()):(a.dom.$activeCrvMetadataContainer&&a.dom.$activeCrvMetadataContainer.hide(),a.fadeInContainer(a.dom.$activeMetadataContainer)))};this.fadeInContainer=function(a){a&&0!==a.length&&(a.removeClass("aok-hidden"),a.fadeIn(500))};this.fadeOutContainer=
function(a){a.fadeOut(500)};this.hideActiveMetadataOverPlayer=function(){if(a.vars.includeVideoInformationOverPlayer&&a.vars.currentAssetSpec&&!a.shouldDisablePlayerOverlayInteractions())if(a.toggleDimVideoPlayer(a.vars.playerContainer,!1),a.isCustomerReviewVideo(a.vars.currentAssetSpec)&&a.dom.$activeCrvMetadataContainer&&0<a.dom.$activeCrvMetadataContainer.length){var b=a.vars.auiTruncate&&a.vars.auiTruncate.get(a.vars.truncateWidgetId);a.collapseToTruncateText(b);a.fadeOutContainer(a.dom.$activeCrvMetadataContainer)}else a.fadeOutContainer(a.dom.$activeMetadataContainer)};
this.shouldDisablePlayerOverlayInteractions=function(){return a.vars.player&&!a.vars.player.isPlaying()};this.setupPlayerHoverHandler=function(){var b=!0;a.vars.A.declarative.create(a.vars.$(a.vars.playerContainer),"player-overlay-features",{});a.vars.A.declarative("player-overlay-features","mouseenter touchstart focus",function(){b&&(setTimeout(function(){b=!0},700),a.showPlayerOverlayFeatures(),a.vars.cursorOnVideoPlayerDiv=!0,a.vars.A.capabilities.touch&&a.vars.A.delay(a.hidePlayerOverlayFeatures(),
3E3),b=!1)});a.vars.A.declarative("player-overlay-features","mouseleave",a.hidePlayerOverlayFeatures)};this.executeTooltip=function(b){v.now("a-tooltip").execute("ive-tooltip-registration",function(c){a.$trigger=a.A.$("#"+a.vars.templateId+" "+b.triggerSelector);a.tooltip=c;var d=a.A.$("#"+a.vars.templateId+" "+b.tooltipTextSelector).text();a.instance=c.create(a.$trigger,{name:b.tooltipName,inlineContent:d,dataStrategy:"preload"});a.A.delay(function(){a.instance.show()},300);a.hideCustomerTooltip(!1)})};
this.hideCustomerTooltip=function(b){a.instance&&(b?a.A.delay(function(){a.instance.hide();a.tooltip.remove(a.$trigger)},300):a.A.delay(function(){a.instance.hide();a.tooltip.remove(a.$trigger)},e.hideAfter-500))};this.handleTooltipDisplayToShowCustomerReview=function(){if(null===a.getLocalStorage(e.CUSTOMER_REVIEW_TOOLTIP_TEXT))a.setLocalStorage(e.CUSTOMER_REVIEW_TOOLTIP_TEXT,Date.now().toString()),a.executeTooltip({triggerSelector:e.CUSTOMER_REVIEW_TOOLTIP_TEXT_ID,tooltipTextSelector:e.IVECustomerReviewVideosToolTipText,
tooltipName:"ive-tooltip-customer-review"});else{var b=a.getLocalStorage(e.CUSTOMER_REVIEW_TOOLTIP_TEXT),c=Date.now();b&&a.isDifferenceGreaterThan24Hours(c,parseInt(b))&&(a.setLocalStorage(e.CUSTOMER_REVIEW_TOOLTIP_TEXT,Date.now().toString()),a.executeTooltip({triggerSelector:e.CUSTOMER_REVIEW_TOOLTIP_TEXT_ID,tooltipTextSelector:e.IVECustomerReviewVideosToolTipText,tooltipName:"ive-tooltip-customer-review"}))}};this.hideFeedbackLink=function(b,c){a.hideFeedbackLinkWithoutDimmingThePlayer(b,c);a.toggleDimVideoPlayer(c,
!1)};this.hideFeedbackLinkWithoutDimmingThePlayer=function(b,c){a.vars.includeVideoInformationOverPlayer?a.vars.$(b).fadeOut(500):a.vars.$(b).css({display:"none"});b=a.vars.A.$("#"+a.vars.templateId+" "+e.LabelNameSelector);b.length&&a.vars.isVideoTypeLabelPresent&&a.vars.isTimeoutComplete&&b.addClass("aok-hidden")};this.toggleDimVideoPlayer=function(b,c){a.vars.includeVideoInformationOverPlayer?(a.vars.$(b).toggleClass("player-overlay-gradient",c),a.vars.$(b).removeClass("review-expanded"),a.vars.$(b+
" video").removeClass("dim-video-player")):a.vars.$(b+" video").toggleClass("dim-video-player",c)};this.deRegisterFeedback=function(b){a.vars.A.off("vse:"+b+":feedback:shown");a.vars.A.off("vse:"+b+":feedback:hidden");a.vars.A.off("vse:ns:feedback:"+b+":init:client")};this.setVideoDetails=function(b,c){a.vars.initialVideo={index:0,segmentNumber:0,title:c.videoTitle,altText:c.altText,vendorName:c.vendorName,contentId:b,vendorCode:c.vendorCode,videoUrl:c.videoUrl,imageUrl:c.imageUrl,productAsin:c.productAsin,
videoReferenceId:c.videoReferenceId,videoWidth:c.videoWidth,videoHeight:c.videoHeight,seekTime:c.seekTime,aciContentId:c.aciContentId,showHotspots:c.showHotspots,labelDetails:c.labelDetails,ccvDisclosure:c.ccvDisclosure,reportUrl:c.reportUrl,eligibleToTriggerCCWeblab:c.eligibleToTriggerCCWeblab,disableReportIllegalLink:c.disableReportIllegalLink}};this.setFollowEntities=function(b,c){a.vars.A.objectIsEmpty(a.vars.initialVideo)||(a.vars.initialVideo.entityId=b,a.vars.initialVideo.entityType=c)};this.attachPlayerEventListeners=
function(){a.vars.player&&(a.vars.player.on("playbackComplete",a._playbackCompleteHandler),a.vars.player.on("playbackStart",a._firstFrameHandler))};this.attachReviewsPlayerEventListeners=function(){if(a.vars.player)a.vars.player.on("playbackComplete",a._reviewsPlaybackCompleteHandler)};this.removeUpNextComponent=function(){a.vars.upNextTimeoutHandle&&clearTimeout(a.vars.upNextTimeoutHandle);a.vars.intervalUserActivityHandlerId=a.userActivityCountDown();a.vars.A.show(a.vars.$("#"+a.vars.templateId+
" "+e.videoInformationContainer));a.dom.$wrapper.find("."+e.UpNextElementClassName).addClass("vse-hidden");a.dom.$wrapper.find("."+e.UpNextClassName).removeClass(""+e.UpNextElementShownClassName);a.dom.$wrapper.find(e.VIPSkipBackButtonSelector).removeClass("aok-hidden");a.dom.$wrapper.find(e.VIPSkipForwardButtonSelector).removeClass("aok-hidden");a.vars.$("#"+a.vars.templateId+" ."+e.UpNextCancelClassName).unbind("click");a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,a.vars.vipControlsShouldPause);
a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,!a.vars.vipControlsShouldPause);a.vars.isUpNextComponentActive=!1};this._playUpNextHandler=function(){if(a.relatedVideosCarouselNotEmpty()){var b=a.getActiveAsset(),c=a._getNextAsset(b);c&&(a.vars.vipControlsShouldPause=!1,a.vars.lightBoxPausedVideo=!1,a.removeUpNextComponent(),b.eventTimestamp&&(c.eventTimestamp=b.eventTimestamp),a.vars.player.play(c),a.emitThumbnailMetric(e.METRIC_UPNEXT_THUMBNAIL_IMPRESSION,c,a.vars.currentIndex),a.show(c),
a.vars.currentAssetSpec=c,-1===a.vars.currentIndex&&(a.vars.currentIndex=0))}};this._cancelContinuousPlayHandler=function(){if(a.relatedVideosCarouselNotEmpty()){var b=a.getActiveAsset();a.vars.player.loadNextVideoPoster(b.imageUrl);a.vars.vipControlsShouldPause=!0;a.removeUpNextComponent();a.vars.vipControlsShouldPause=!1;a.vars.lightBoxPausedVideo=!0}};this.continuousPlay=function(b,c){b.eventTimestamp&&(c.eventTimestamp=b.eventTimestamp);a.refTagRecorder.emitRefTag(c.continuousPlayRefTag);null!=
a.vars.onSiteAttributionMetrics&&a.vars.A.trigger("vse:"+a.vars.clientPrefix+":player:continuous:play");a.vars.currentIndex=a.findIndex(c);a.vars.player.play(c);a.vars.isVideoImmersivePlayer&&a.emitThumbnailMetric(e.METRIC_UPNEXT_THUMBNAIL_IMPRESSION,c,a.vars.currentIndex);!a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)&&a.hasHiddenAndShowMoreClasses(c)&&a.vars.relatedVideosCarousel.loadMoreVideos(a.getSegmentTypeIfMoreVideosToExpand(c));a.show(c)};this._playbackCompleteHandler=function(){if(a.relatedVideosCarouselNotEmpty()&&
"inline"!=a.vars.currentPlayerMode){var b=a.getActiveAsset(),c=a._getNextAsset(b);c?a.vars.useUpNextComponent?(a.vars.isUpNextComponentActive=!0,a.vars.vipControlsShouldPause=!0,a.vars.lightBoxPausedVideo=!0,a.clearIntervalUserActivityHandler(),a.dom.$wrapper.find(e.VIPSkipBackButtonSelector).addClass("aok-hidden"),a.dom.$wrapper.find(e.VIPSkipForwardButtonSelector).addClass("aok-hidden"),a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,a.vars.vipControlsShouldPause),a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,
!a.vars.vipControlsShouldPause),a.vars.A.hide(a.vars.$("#"+a.vars.templateId+" "+e.videoInformationContainer)),a.vars.vipControlsShouldPause=!1,a.vars.lightBoxPausedVideo=!1,a.vars.player.loadNextVideoPoster(c.imageUrl),a.dom.$wrapper.find("."+e.UpNextVideoTitleClassName).html(c.title),a.dom.$wrapper.find("."+e.UpNextAuthorClassName).html(c.vendorName),a.dom.$wrapper.find("."+e.UpNextElementClassName).removeClass("vse-hidden"),a.dom.$wrapper.find("."+e.UpNextClassName).addClass(""+e.UpNextElementShownClassName),
a.vars.$("#"+a.vars.templateId+" ."+e.UpNextCancelClassName).click(a._cancelContinuousPlayHandler),a.showVideoImmersivePlayerOverlay(),a.resetUserActivityTimer(-2),a.vars.upNextTimeoutHandle=a.vars.A.delay(function(){a.removeUpNextComponent();a.continuousPlay(b,c);a.vars.currentAssetSpec=c;-1===a.vars.currentIndex&&(a.vars.currentIndex=0)},5E3)):a.continuousPlay(b,c):a.noNextVideoHandler()}else a.noNextVideoHandler()};this._reviewsPlaybackCompleteHandler=function(){a.dom.$wrapper.find(e.VIPTimeRemainingSelector).text("-0:00")};
this._firstFrameHandler=function(){!a.vars.showMoreMenuExperience&&a.vars.isMobile&&a.hideFeedbackLink("#vse-"+a.vars.clientPrefix+"-feedback-container","#"+a.vars.containerId+"-container");a.vars.isVideoImmersivePlayer&&(a.vars.player.getMediaDuration()!==a.vars.vipVideoDuration&&(a.vars.vipVideoDuration=a.vars.player.getMediaDuration()),a.vars.vipControlsShouldPause=!0,a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,a.vars.vipControlsShouldPause),a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,
!a.vars.vipControlsShouldPause))};this._getNextAsset=function(b){for(var c=0;c<a.vars.playlist.length&&a.vars.playlist[c].contentId!=b.contentId;c++);if(c!=a.vars.playlist.length)return a.vars.playlist[c+1];if(-1===a.vars.currentIndex)return a.vars.playlist[0]};this._playerFailedAutoplayHandler=function(){a.vars.vipControlsShouldPause=!1;a.toggleVipPlayPauseClass();a.vars.vipVideoDuration=a.vars.player.getMediaDuration();a.updateProgressBarAndTimeDisplay();a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&
(a.handleUserActivity(),a.handleCCStylesOnReviewsOverlayVisibility(!0));m.count(e.AUTOPLAY_FALLBACK_EXECUTED,1)};this._playerSucceededAutoplayHandler=function(){a.clearIntervalUserActivityHandler();a.vars.intervalUserActivityHandlerId=a.userActivityCountDown();a.vars.vipPlayIconClicked=!0;a.vars.useAutoplayFallback=!1;a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&a.handleCCStylesOnReviewsOverlayVisibility(!0)};this.handleCCStylesOnCarouselVisibility=function(b){a.A.$("#"+
a.vars.templateId+" .vjs-text-track-display").toggleClass(e.VIPProductCarouselOpenedClassName,b)};this.handleCCStylesOnReviewsOverlayVisibility=function(b){a.A.$("#"+a.vars.templateId+" .vjs-text-track-display").toggleClass(e.VIPReviewsOverlayVisibleClassName,b)};this.onPlayerTapHandler=function(){"inline"!==a.vars.currentPlayerMode&&(a.vars.showPFOOnOverlay&&a.handleCCStylesOnCarouselVisibility(!0),a.showVideoImmersivePlayerOverlay(),a.resetUserActivityTimer())};this.pauseVideoIfNeeded=function(b){void 0===
b&&(b=!1);a.vars.player&&a.vars.player.isPlaying()&&(a.vars.player.pause(a.vars.isVideoImmersivePlayer&&!b?"ivx-pause":t),a.vars.lightBoxPausedVideo=!0,a.vars.isVideoImmersivePlayer&&a.vars.isVIPOverlayTimerSet&&a.clearIntervalUserActivityHandler())};this.muteUnMuteVideo=function(){a.vars.player&&!a.vars.player.isMuted()?a.vars.player.mute():a.vars.player.unmute();a.updateAudioToggleStatus()};this.updateAudioToggleStatus=function(){a.vars.player&&a.vars.vipMuteUnmuteToggle&&(a.vars.vipMuteUnmuteToggle.toggleClass(e.VIPMuteIconClassName,
a.vars.player.isMuted()),a.vars.vipMuteUnmuteToggle.toggleClass(e.VIPUnmuteIconClassName,!a.vars.player.isMuted()))};this.resumeVideoIfNeeded=function(b,c){if(!a.vars.lightboxOpened&&!0!==b)return!1;a.vars.player&&a.vars.player.isPlaying()&&(a.vars.player.pause(a.vars.isVideoImmersivePlayer&&!c?"ivx-pause":t),a.vars.lightBoxPausedVideo=!0);a.vars.player&&!a.vars.player.isPlaying()&&!a.vars.isContinuousPlayFinished&&a.vars.lightBoxPausedVideo?(a.vars.player.resume(Date.now()),a.vars.isVideoImmersivePlayer&&
!a.vars.isVIPOverlayTimerSet&&(a.resetUserActivityTimer(),a.showVideoImmersivePlayerOverlay(),a.vars.intervalUserActivityHandlerId=a.userActivityCountDown())):a.vars.useAutoplayFallback&&(a.startPlaying(a.vars.currentAssetSpec),a.vars.intervalUserActivityHandlerId=a.userActivityCountDown(),a.vars.vipPlayIconClicked=!0,a.vars.isClosedCaptionEnabled&&a.vars.player.enableCurrentTextTrack(a.vars.currentClosedCaptionsLang),a.vars.useAutoplayFallback=!1);a.vars.isVideoImmersivePlayer&&a.vars.isContinuousPlayFinished&&
(a.relatedVideosCarouselNotEmpty()&&a.vars.initialVideo?(a.startPlaying(a.vars.initialVideo),a.show(a.vars.initialVideo)):a.vars.currentAssetSpec&&(a.startPlaying(a.vars.currentAssetSpec),a.resetUserActivityTimer(),a.showVideoImmersivePlayerOverlay(),a.vars.intervalUserActivityHandlerId=a.userActivityCountDown()));a.vars.lightBoxPausedVideo=!1};this.noNextVideoHandler=function(){a.vars.isVideoImmersivePlayer&&(a.clearIntervalUserActivityHandler(),a.vars.lightBoxPausedVideo=!0,a.vars.vipControlsShouldPause=
!1,a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,a.vars.vipControlsShouldPause),a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,!a.vars.vipControlsShouldPause),a.showVideoImmersivePlayerOverlay());a.vars.isContinuousPlayFinished=!0};this.initializeVisualSearchComponent=function(){return{A:a.A,templateId:a.vars.templateId}};this.setInitialClosedCaptions=function(b,c){c=ra.getClosedCaptions(a.vars.A,c);b.closedCaptions=c;a.vars.initialVideo.closedCaptions=c;a.vars.currentClosedCaptionsLang=
a.getDefaultLangFromClosedCaptions(c)};this.setupVIPClosedCaptions=function(b,c){if("inline"!==a.vars.currentPlayerMode){a.vars.closedCaptionsConfig=b;var d="#"+a.vars.templateId+" "+e.VIPCCButtonSelector;a.vars.A.$(d+"."+e.VIPCCButtonUnpressedClassName).live("click",function(){a.vars.isClosedCaptionEnabled=!0;a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&a.A.$("#"+a.vars.templateId+" .vjs-text-track-display").toggleClass(e.VIPLandscapeVideoClassName,a.vars.shouldHandleCCForLandscapeVideo);
a.vars.A.$(""+d).removeClass(e.VIPCCButtonUnpressedClassName).addClass(e.VIPCCButtonPressedClassName);a.vars.player.enableCurrentTextTrack(a.vars.currentClosedCaptionsLang);a.showTempCCPopup(a.getCurrentCaptionsOnText())});a.vars.A.$(d+"."+e.VIPCCButtonPressedClassName).live("click",function(){a.vars.isClosedCaptionEnabled=!1;a.vars.A.$(""+d).removeClass(e.VIPCCButtonPressedClassName).addClass(e.VIPCCButtonUnpressedClassName);a.vars.player.disableCurrentTextTrack(a.vars.currentClosedCaptionsLang);
a.showTempCCPopup(b.captionsOffText)});a.vars.A.objectIsEmpty(c)&&a.vars.A.$(""+d).hide()}};this.getCurrentCaptionsOnText=function(){var b=a.vars.closedCaptionsConfig.captionsOnTexts,c=a.vars.currentClosedCaptionsLang;return a.vars.A.objectIsEmpty(b)||a.vars.A.objectIsEmpty(b[c])?e.EMPTY_STRING:b[c]};this.showTempCCPopup=function(b){a.vars.A.$("#"+a.vars.templateId+" "+e.VIPCCTooltipTextSelector).text(b);a.vars.A.$("#"+a.vars.templateId+" "+e.VIPCCTooltipSelector).removeClass("aok-hidden");clearTimeout(a.vars.closedCaptionsTooltipTimerId);
a.vars.closedCaptionsTooltipTimerId=setTimeout(function(){return a.vars.A.$("#"+a.vars.templateId+" "+e.VIPCCTooltipSelector).addClass("aok-hidden")},3E3)};this.setupDefaultClosedCaptions=function(){a.vars.A.$("#"+a.vars.templateId+" "+e.defaultPlayerCCButtonTitleSelector).removeAttr("title")};this.onTextTrackEnable=function(b){if("inline"!==a.vars.currentPlayerMode){var c="#"+a.vars.templateId+" "+e.VIPCCButtonSelector;"showing"===b.mode&&a.vars.A.$(""+c).hasClass(e.VIPCCButtonUnpressedClassName)&&
(a.vars.isClosedCaptionEnabled=!0,a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&a.A.$("#"+a.vars.templateId+" .vjs-text-track-display").toggleClass(e.VIPLandscapeVideoClassName,a.vars.shouldHandleCCForLandscapeVideo),a.vars.A.$(""+c).removeClass(e.VIPCCButtonUnpressedClassName).addClass(e.VIPCCButtonPressedClassName))}};this.getDomain=function(){return a.vars.A.objectIsEmpty(k.location.origin)?"https://www.amazon.com":k.location.origin};this.buildShareUrl=
function(b){return b.redirectUrl?a.getDomain()+b.redirectUrl:a.getDomain()+"/vdp/"+b.contentId};this.refreshSocialSharePageState=function(b){var c=a.buildShareUrl(b);a.vars.A.objectIsEmpty(a.vars.productAsin)||(c+="?product\x3d"+a.vars.productAsin);a.vars.A.state.replace(a.vars.socialSharePageState,{pageLevelData:{clientRef:"ib",deviceTypeRef:a.vars.isMobile?"mb":"dt"},url:c,image:b.imageUrl,title:b.title,description:b.title,shareCopyLinkSuccessText:a.vars.shareCopyLinkSuccessText,socialShareId:a.vars.socialShareId})};
this.getMshopShareParams=function(b){var c=a.buildShareUrl(b)+"?ref\x3dive_share_mshop_"+a.vars.clientPrefix;b=b.title+" "+c;var d="\x3cdiv\x3e \x3cp\x3e"+b+"\x3c/p\x3e \x3c/div\x3e";return{subject:b,messagePlain160:b.substring(0,160),messagePlain140:b.substring(0,140),messageHTML:d,messagePlain:b,url:c}};this.getDomElements=function(b,c){a.dom.$wrapper=a.vars.$(b===c?"#"+c:"#"+b+" #"+c);a.dom.$lbContainer=a.dom.$wrapper.find(".vse-lb-container");a.dom.$lbLeftColumn=a.dom.$wrapper.find(".vse-lb-left");
a.dom.$lbLeftColumnPlaceholder=a.vars.$("#"+b).find('div[class*\x3d"vsePlaceholder"] .a-col-left');a.dom.$lbRightColumn=a.dom.$wrapper.find(".vse-lb-right");a.dom.$lbCCHeader=a.dom.$wrapper.find(".vse-cc-header");a.dom.$lbTabContainer=a.dom.$wrapper.find(".vse-lightbox-tab");a.dom.$videoAuthor=a.dom.$wrapper.find(".vse-video-author span");a.dom.$mobileFixedContainer=a.dom.$wrapper.find(".vse-common-mobile-fixed-container");a.dom.$mobileMovableContainer=a.dom.$wrapper.find(".vse-vb-movable-container");
a.dom.$relatedProductContainer=a.dom.$wrapper.find(".vse-related-products-narrow");a.dom.$activeVideoOspLink=a.dom.$wrapper.find(".vse-oap-link");a.dom.$activeVideoTitlePrefix=a.dom.$wrapper.find(".vse-title-prefix");a.dom.$activeVideoCRLink=a.dom.$wrapper.find(".vse-cr-link");a.dom.$activeVideoCRLinkWrapper=a.dom.$wrapper.find(".video-title-container-right");a.dom.$followButtonSelector=a.dom.$wrapper.find(e.followButton);a.dom.$vseFollowClassSelector=a.dom.$wrapper.find(e.vseFollowClass);a.dom.$followEligibleCreator=
a.dom.$wrapper.find(e.creatorAndDisclosure);a.dom.$activeMetadataContainer=a.dom.$wrapper.find(".vse-active-metadata")};this.getCustomerProfileDomElements=function(){a.dom.$lbVideoCarousel=a.vars.isVideoImmersivePlayer?a.dom.$wrapper.find(".vse-vip-lb-carousel"):a.dom.$wrapper.find(".vse-related-videos-container");a.dom.$activeVideoCustomerProfile=a.dom.$wrapper.find("#vse-active-video-customer-profile");a.dom.$activeCrvMetadataContainer=a.dom.$wrapper.find(".vse-active-crv-metadata");a.dom.$videoAuthorBlock=
a.dom.$wrapper.find(".vse-video-author");a.dom.$customerProfileContainer=a.dom.$wrapper.find(".vse-cp-container");a.dom.$profileLinkSelector=a.dom.$wrapper.find(".vse-profile");a.dom.$vseOapDivider=a.dom.$wrapper.find(".vse-oap-divider");a.dom.$creatorNameAndDisclosure=a.dom.$wrapper.find(".vse-creator-name-and-disclosure")};this.initializeCustomerProfile=function(b){a.getCustomerProfileDomElements();a.isCustomerReviewVideo(b)&&a.updateCustomerProfile(b);a.isInfluencerVideo(b)&&a.updateInfluencerProfile(b);
a.dom.$activeVideoCustomerProfile.undelegate(".vse-profile","click");a.dom.$activeVideoCustomerProfile.delegate(".vse-profile","click",function(b){a.handleExternalLinkClick(b,"."+e.VIPVideoInfoClassName,".vse-profile",!0)});a.dom.$activeCrvMetadataContainer.undelegate(".vse-profile","click");a.dom.$activeCrvMetadataContainer.delegate(".vse-profile","click",function(b){a.handleExternalLinkClick(b,""+e.CRVInfoSelector,".vse-profile-link",!0)});a.dom.$activeVideoCustomerProfile.undelegate(".vse-link",
"click");a.dom.$activeVideoCustomerProfile.delegate(".vse-link","click",function(b){a.handleExternalLinkClick(b,"."+e.VIPVideoInfoClassName,".vse-link",!1)});a.vars.A.trigger("resize",{},{width:k.innerWidth,height:k.innerHeight})};this.handleExternalLinkClick=function(b,c,d,e){void 0===e&&(e=!1);e&&a.vars.disableCreatorClicksOnMshop?a.preventExternalLinkClick(b):(b=a.vars.$(b.target).closest(c).find(d).attr("href"))&&a.openExternalLinkFromLightBox(b)};this.shouldSetProductCarouselWidth=function(b){var c=
a.dom.$wrapper.find(".vse-lb-right .vse-related-videos-container .a-carousel-row").height();return a.vars.A.isFiniteNumber(c)?c<b?!0:!1:!1};this.resizeDesktopLB=function(){if(a.vars.showLightboxV2Experience){var b=a.dom.$lbLeftColumn.outerHeight(!0),c=a.dom.$lbRightColumn.outerHeight(!0);c?a.isDesktopVerticalLightBox()?c!==b&&(a.toggleLightboxCloseButton(!1),a.hideFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer),a.dom.$lbRightColumn.css({height:b}),a.vars.$("#"+a.vars.popoverId).css({height:2*
b}),a.vars.$("#"+a.vars.popoverId).css("overflow","").get(0).style.setProperty("overflow","hidden","important")):(a.toggleLightboxCloseButton(!0),a.dom.$lbRightColumn.css({height:"100%"}),a.dom.$lbLeftColumnPlaceholder.length&&(b=a.dom.$lbLeftColumnPlaceholder.outerHeight(!0)),a.vars.$("#"+a.vars.popoverId).css({height:b})):a.toggleLightboxCloseButton(!0)}!a.vars.A.capabilities.mobile&&a.vars.A.capabilities.touch&&(b=a.dom.$wrapper.closest(e.LightboxWrapperSelector),b.hasClass(e.TABLET_LIGHTBOX_CLASS_NAME)||
(a.toggleLightboxCloseButton(!0),b.addClass(e.TABLET_LIGHTBOX_CLASS_NAME),b.find(e.AUI_POPOVER_INNER).addClass(e.TABLET_LIGHTBOX_CLASS_NAME)))};this.resizeMobileLB=function(){a.dom.$lbContainer.height(k.innerHeight);var b=a.vars.$(a.dom.$mobileFixedContainer).outerHeight(!0),b=a.vars.$(k).height()-b;a.vars.$(a.dom.$mobileMovableContainer).animate({"max-height":b})};this.resizeLB=function(){a.vars.isMobile?a.resizeMobileLB():a.resizeDesktopLB()};this.resetCarouselWithSeeMore=function(){a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)||
a.vars.relatedVideosCarousel.resetVideosStateOnLightboxReopen()};this.isOspEnabled=function(b){return!a.vars.A.objectIsEmpty(b.vendorTrackingId)&&""!==b.vendorTrackingId||!a.vars.A.objectIsEmpty(b.ospTrackingLink)&&""!==b.ospTrackingLink};this.showVideoImmersivePlayerOverlay=function(){a.dom.$wrapper.find(e.VIPOverlaySelector).addClass(e.VIPOverlayShowClassName);a.dom.$wrapper.find(e.VIPSearchButtonSelector).removeClass(e.VIPSearchButtonHideText);a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&
a.handleCCStylesOnReviewsOverlayVisibility(!0)};this.hideVideoImmersivePlayerOverlay=function(){a.vars.useMultiCarousel&&a.vars.multiCarouselExpanded&&a.openCloseMultiCarousel();a.vars.showPFOOnOverlay&&a.handleCCStylesOnCarouselVisibility(!1);a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&a.handleCCStylesOnReviewsOverlayVisibility(!1);a.dom.$wrapper.find(e.VIPSearchButtonSelector).addClass(e.VIPSearchButtonHideText);a.dom.$wrapper.find(e.VIPOverlaySelector).removeClass(e.VIPOverlayShowClassName)};
this.enableIVXOverlayOnTab=function(){document.addEventListener("keydown",a.handleIVXOverlayOnTab)};this.disableIVXOverlayOnTab=function(){document.removeEventListener("keydown",a.handleIVXOverlayOnTab)};this.handleIVXOverlayOnTab=function(b){if(9==b.keyCode){a.resetUserActivityTimer();a.showVideoImmersivePlayerOverlay();var c=document.querySelector("#"+a.vars.popoverId+" "+e.VIPMultiCarouselWrapper);setTimeout(function(){return a.openCloseMultiCarouselOnFocus(c)},250)}};this.openCloseMultiCarouselOnFocus=
function(b){b&&b.contains(document.activeElement)?a.vars.useMultiCarousel&&!a.vars.multiCarouselExpanded&&a.openCloseMultiCarousel():a.vars.useMultiCarousel&&a.vars.multiCarouselExpanded&&a.openCloseMultiCarousel()};this.setUserActivityTimer=function(b){a.vars.$(b.target).hasClass(e.VIPOverlayShowClassName)||a.vars.$(b.target).hasClass(e.UpNextClassName)||a.vars.$(b.target).hasClass(e.VIPMetadataClassName)||a.vars.$(b.target).hasClass(e.VIPVideoInfoClassName)||a.vars.$(b.target).hasClass(e.VIPVideoAgeClassName)||
a.vars.$(b.target).hasClass(e.VIPVideoTitleWrapperClassName)||a.vars.$(b.target).hasClass(e.VIPVideoHelpfulVotesClassName)||a.vars.$(b.target).hasClass(e.VIPPlayPauseClassName)||a.vars.$(b.target).hasClass(e.VIPScrubberClassName)||a.isTargetReviewsMetadataWhenCarouselExpand(b)?(a.hideVideoImmersivePlayerOverlay(),a.vars.isMultiCarouselClosedForFirstTime&&a.vars.showHotspots&&a.vars.visualSearchComponent.addAnimationForHotspotsVideo()):a.resetUserActivityTimer()};this.isTargetReviewsMetadataWhenCarouselExpand=
function(b){return a.vars.multiCarouselExpanded&&!a.isTargetOutsideExpandedReviewsMetadata(b)};this.resetUserActivityTimer=function(b){void 0===b&&(b=0);a.vars.useAllIVXComponents&&(a.vars.secondsFromLastActivity=b)};this.handleUserActivityForReviewsUsecase=function(b){a.isReviewTextExpanded()?a.isTargetOutsideExpandedReviewsMetadata(b)&&(a.A.$(e.VIPOverlaySelector).removeClass("vse-reviews-expand-full-cr"),a.A.$(".vse-reviews-content-ellipsis-wrapper").scrollTop(0),a.resetReviewTextStyle(),a.A.animationFrameDelay(function(){a.compactReviewIfNeeded();
a.updateReviewsExpandButtonVisibility()}),a.vars.vipControlsShouldPause&&a.resumeVideoIfNeeded()):a.vars.useAutoplayFallback||a.vars.vipControlsShouldPause&&a.setUserActivityTimer(b)};this.handleUserActivityForMultiChannelReviewIVX=function(b){a.isReviewTextExpanded()&&a.isTargetOutsideExpandedReviewsMetadata(b)?a.expandOrCollapseText(a.vars.auiTruncate.get(a.vars.truncateWidgetId)):a.setUserActivityTimer(b)};this.handleUserActivity=function(){!a.vars.isVIPOverlayOnTapEventRegistered&&a.vars.$(""+
a.vars.popoverId)&&(a.dom.$lbContainer.click(function(b){a.vars.useChannelCarousel&&a.isCustomerReviewVideo(a.vars.currentAssetSpec)?a.handleUserActivityForMultiChannelReviewIVX(b):a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata?a.handleUserActivityForReviewsUsecase(b):a.setUserActivityTimer(b)}),a.vars.isVIPOverlayOnTapEventRegistered=!0)};this.userActivityCountDown=function(){if(a.vars.useAllIVXComponents)return a.vars.intervalUserActivityHandlerId=a.vars.A.interval(function(){a.vars.multiCarouselExpanded||
(a.vars.secondsFromLastActivity++,3<a.vars.secondsFromLastActivity&&a.hideVideoImmersivePlayerOverlay())},1E3),a.vars.isVIPOverlayTimerSet=!0,a.handleUserActivity(),a.vars.intervalUserActivityHandlerId};this.clearIntervalUserActivityHandler=function(){a.vars.isVIPOverlayTimerSet=!1;clearInterval(a.vars.intervalUserActivityHandlerId)};this.emitMetric=function(b){a.emitMetricToNexus({eventName:b,stringPayload:e.EMPTY_STRING,intPayload:1})};this.emitClickMetric=function(b,c){void 0===c&&(c="");b={eventName:b,
stringPayload:e.EMPTY_STRING,intPayload:1,videoAsin:a.getVideoAsin(),rankingStrategy:a.getRankingStrategy(),groupType:""!==c?c:a.getGroupType(),channel:a.getChannelNumber()};a.emitMetricToNexus(b)};this.emitEventDurationMetric=function(b,c){b={eventName:b,stringPayload:e.EMPTY_STRING,intPayload:c,videoAsin:a.getVideoAsin(),rankingStrategy:a.getRankingStrategy()};a.emitMetricToNexus(b)};this.emitRelatedVideosRenderMetric=function(b,c,d){a.vars.A.objectIsEmpty(c)||(b={eventName:b,stringPayload:e.EMPTY_STRING,
intPayload:1,channel:a.getChannelNumber(d),videoAsinList:c.getplaylist().map(function(a){return a.contentId+e.COMMA+a.groupType}).join(e.SEMICOLON),rankingStrategy:c.getplaylist().map(function(a){return a.rankingStrategy}).join(e.SEMICOLON)},a.emitMetricToNexus(b))};this.emitPFOClickMetric=function(b,c,d){a.vars.emitMetricsToNexus&&(b=a.vars.buildNexusPayload({eventName:b,stringPayload:d,intPayload:1,productAsin:c,videoAsin:a.getVideoAsin(),rankingStrategy:a.getRankingStrategy(),customerId:a.vars.customerId||
""}),m.emitNexusMetric(b,a.vars.nexusMetricsConfig.producerId,a.vars.nexusMetricsConfig.widgetMetricsSchemaId,a.vars.nexusMetricsConfig.isInternal))};this.emitPFORenderMetric=function(b){a.A.off(" "+a.vars.clientPrefix+":relatedproducts:load:success");a.A.on(" "+a.vars.clientPrefix+":relatedproducts:load:success",function(){for(var c=a.A.$("#"+a.vars.templateId+" .vse-pc-visible").not(".aok-hidden").find(".vse-product-item"),d="",k=a.getVideoAsin(),g=[],l=0;l<c.length;l++)g.push([c[l].getAttribute("data-asin"),
c[l].classList.contains("vse-sponsor-product").toString(),!1]),d+=c[l].getAttribute("data-asin")+","+c[l].classList.contains("vse-sponsor-product").toString(),l!==c.length-1&&(d+=e.SEMICOLON);a.vars.contentIdProductAsinMap[k]=g;a.vars.emitMetricsToNexus&&(c={eventName:b,stringPayload:d.toString(),intPayload:1,videoAsin:k,rankingStrategy:a.getRankingStrategy(),groupType:a.getGroupType()},a.emitMetricToNexus(c))})};this.getVideoAsin=function(){return a.vars.currentAssetSpec&&a.vars.currentAssetSpec.contentId?
a.vars.currentAssetSpec.contentId:a.relatedVideosCarouselNotEmpty()?a.getCurrentlyPlayingVideoInCarousel(a.vars.currentIndex).contentId:e.EMPTY_STRING};this.getRankingStrategy=function(){return a.vars.currentAssetSpec&&a.vars.currentAssetSpec.rankingStrategy?a.vars.currentAssetSpec.rankingStrategy:a.relatedVideosCarouselNotEmpty()?a.getCurrentlyPlayingVideoInCarousel(a.vars.currentIndex).rankingStrategy:a.vars.rankingStrategy};this.getGroupType=function(){return a.vars.currentAssetSpec&&a.vars.currentAssetSpec.groupType?
a.vars.currentAssetSpec.groupType:a.relatedVideosCarouselNotEmpty()?a.getCurrentlyPlayingVideoInCarousel(a.vars.currentIndex).groupType:e.EMPTY_STRING};this.getChannelNumber=function(b){return a.vars.useChannelCarousel?null!=b?b+"":a.vars.currentAssetSpec&&a.vars.currentAssetSpec.segmentNumber?a.vars.currentAssetSpec.segmentNumber+"":a.relatedVideosCarouselNotEmpty()?a.getCurrentlyPlayingVideoInCarousel(a.vars.currentIndex).segmentNumber+"":e.EMPTY_STRING:e.EMPTY_STRING};this.emitPFOImpressionMetric=
function(b,c,d,e){a.vars.emitMetricsToNexus&&(b={eventName:b,stringPayload:d.toString(),intPayload:e,productAsin:c,videoAsin:a.getVideoAsin(),rankingStrategy:a.getRankingStrategy()},a.emitMetricToNexus(b))};this.emitThumbnailMetric=function(b,c,d){void 0===d&&(d=1);a.vars.emitMetricsToNexus&&(c=a.vars.buildNexusPayload({eventName:b,stringPayload:e.EMPTY_STRING,intPayload:d,productAsin:c.productAsin,videoAsin:c.contentId,rankingStrategy:c.rankingStrategy,groupType:c.groupType,customerId:a.vars.customerId||
"",channel:a.getChannelNumber(c.segmentNumber)}),m.emitNexusMetric(c,a.vars.nexusMetricsConfig.producerId,a.vars.nexusMetricsConfig.widgetMetricsSchemaId,a.vars.nexusMetricsConfig.isInternal),m.count(a.vars.clientPrefix+":"+b,1))};this.emitButtonImpressionMetric=function(b,c,d){void 0===c&&(c=e.EMPTY_STRING);void 0===d&&(d=1);a.vars.emitMetricsToNexus&&(b=a.vars.buildNexusPayload({eventName:b,stringPayload:e.EMPTY_STRING,intPayload:d,rankingStrategy:a.getRankingStrategy(),groupType:c,customerId:a.vars.customerId||
"",videoAsin:a.getVideoAsin()}),m.emitNexusMetric(b,a.vars.nexusMetricsConfig.producerId,a.vars.nexusMetricsConfig.widgetMetricsSchemaId,a.vars.nexusMetricsConfig.isInternal))};this.emitPFOImpressionMetricHandler=function(b,c,d){var e=a.getVideoAsin(),g=a.vars.contentIdProductAsinMap[e];if(g){for(;b<Math.min(c,g.length);b++)g[b][2]||(a.emitPFOImpressionMetric(d,g[b][0],g[b][1],b),g[b][2]=!0);a.vars.contentIdProductAsinMap[e]=g}};this.emitPFOImpressionMetricVIPHandler=function(){var b=a.A.$("#"+a.vars.templateId+
" .vse-pc-visible .a-carousel-viewport").not(".aok-hidden"),c=b.find(".vse-product-item").first(),b=k.innerWidth>k.innerHeight?Math.floor((b.scrollTop()+k.innerHeight)/c.height()):Math.floor((b.scrollLeft()+k.innerWidth)/c.width());a.emitPFOImpressionMetricHandler(0,b,e.METRIC_PFO_IMPRESSION)};this.emitPFOImpressionMetricDefaultHandler=function(b){var c=b.carousel.getAttr("pageNumber");b=b.carousel.getAttr("pageSize");a.emitPFOImpressionMetricHandler((c-1)*b,c*b,e.METRIC_PFO_IMPRESSION)};this.emitPFOImpressionMetricInitHandler=
function(b){a.vars.A.off("a:carousel:"+a.vars.relatedProductsCarouselName+":change:pageNumber",a.emitPFOImpressionMetricDefaultHandler);a.vars.A.on("a:carousel:"+a.vars.relatedProductsCarouselName+":change:pageNumber",a.emitPFOImpressionMetricDefaultHandler);a.emitPFOImpressionMetricDefaultHandler(b)};this.handleWatchIconMetric=function(){var b=function(b){a.vars.manualTriggerWatchIcon||a.emitClickMetric(e.METRIC_WATCH_ICON);a.vars.useMultiCarousel&&!a.vars.multiCarouselExpanded&&(a.resetUserActivityTimer(-2),
setTimeout(function(){return a.openCloseMultiCarousel()},750))};a.A.$("#"+a.vars.templateId+" "+e.VIPWatchIconSelector+".vse-unpressed").click(b);a.A.$("#"+a.vars.templateId+" "+e.VIPWatchIconSelector+".vse-pressed").click(b)};this.handleShopIconMetric=function(){a.A.on("vse:"+a.vars.templateId+":vip:shop:click",function(){a.emitClickMetric(e.METRIC_SHOP_ICON_CLICK)});var b=function(b){a.vars.manualTriggerShopIcon||a.emitClickMetric(e.METRIC_SHOP_ICON_UNCLICK)};a.A.$("#"+a.vars.templateId+" "+e.VIPShopIconSelector+
".vse-unpressed").click(b);a.A.$("#"+a.vars.templateId+" "+e.VIPShopIconSelector+".vse-pressed").click(b)};this.handleShareIconMetric=function(){a.A.on("a:sheet:beforeShow:"+a.vars.socialShareId+"-sheet",function(){a.emitClickMetric(e.METRIC_SHARE_ICON)})};this.handleMoreMenuMetric=function(){a.emitButtonImpressionMetric(e.METRIC_MORE_MENU_IMPRESSION);a.A.on("a:sheet:beforeShow:"+a.vars.feedbackId+"-sheet",function(){a.emitClickMetric(e.METRIC_MORE_MENU_CLICK)})};this.handleInfluencerProfileNameClick=
function(){a.dom.$activeVideoCustomerProfile.find(".a-profile-name").unbind("click");a.dom.$activeVideoCustomerProfile.find(".a-profile-name").click(function(){m.count(a.vars.clientPrefix+".influencerProfileNameClickCount",1)})};this.handleInfluencerAvatarClick=function(){a.dom.$activeVideoCustomerProfile.find(".a-profile-avatar").unbind("click");a.dom.$activeVideoCustomerProfile.find(".a-profile-avatar").click(function(){m.count(a.vars.clientPrefix+".influencerAvatarClick",1)})};this.getDeviceOrientation=
function(){return k.innerHeight>k.innerWidth?e.PORTRAIT:k.innerWidth>k.innerHeight?e.LANDSCAPE:e.SQUARE};this.getAspectRatio=function(a){if(a===e.PORTRAIT)return e.PORTRAIT_ASPECT_RATIO;if(a===e.LANDSCAPE)return e.LANDSCAPE_ASPECT_RATIO;if(a===e.SQUARE)return e.SQUARE_ASPECT_RATIO};this.isDesktopVerticalLightBox=function(){return!a.vars.isMobile&&k.innerWidth<a.vars.verticalLightBoxMaxWidth};this.initializeVideoActionTray=function(b){a.vars.videoActionTrayComponents=new Ga({A:a.A,contentCarousel:a.vars.relatedVideosCarousel,
socialShareId:a.vars.socialShareId,templateId:a.vars.templateId,clientPrefix:a.vars.clientPrefix});a.handleShopIconMetric();a.vars.videoActionTrayComponents.handleShopIconInteractions();a.vars.videoActionTrayComponents.handleShareIconInteractions();a.handleShareIconMetric();a.handleWatchIconMetric();a.vars.videoActionTrayComponents.handleVIPCarouselClose();a.initializeWatchComponents(b);a.A.on("vse:"+a.vars.templateId+":vip:vat:component:open",function(){a.A.$("#"+a.vars.templateId+" "+e.VIPActionOverlaySelector).addClass(e.VIPActionOverlayShowClassName)});
a.A.on("vse:"+a.vars.templateId+":vip:vat:component:close",function(){a.A.$("#"+a.vars.templateId+" "+e.VIPActionOverlaySelector).removeClass(e.VIPActionOverlayShowClassName)})};this.updateProgressBarAndTimeDisplay=function(b,c,d){if(0===a.vars.vipVideoDuration)a.vars.vipVideoDuration=a.vars.player.getMediaDuration();else{b=a.vars.A.$(c);d=a.vars.A.$(d);c=0<d.length?d:a.dom.$wrapper.find(e.VIPProgressBarFillSelector);d=0<b.length?b:a.dom.$wrapper.find(e.VIPTimeRemainingSelector);var k=Math.min(a.vars.player.getCurrentTime(),
a.vars.vipVideoDuration);c.width(k/a.vars.vipVideoDuration*100+"%");var g;b=0;c=!1;3600<=a.vars.vipVideoDuration&&(b=Math.floor(k/3600),c=!0);var l=a.vars.vipVideoDuration-k,k=Math.floor(l%60);g=Math.floor(l/60%60);c&&(b=Math.floor(l/3600));d.text("-"+(c?b+":":"")+(c&&10>g?"0"+g+":":g+":")+(10>k?"0"+k:k))}};this.initializeVIPControls=function(){var b=a.dom.$wrapper.find(e.VIPSkipBackButtonSelector);b.unbind("click");b.click(function(b){b.stopPropagation();b=a.vars.player.getCurrentTime();a.vars.player.setCurrentTime(b-
10);a.resetUserActivityTimer(2);a.vars.isContinuousPlayFinished=!1;a.emitClickMetric(e.METRIC_SKIP_BACK);a.vars.player.emitSkipBackwardClick()});b=a.dom.$wrapper.find(e.VIPSkipForwardButtonSelector);b.unbind("click");b.click(function(b){b.stopPropagation();0===a.vars.vipVideoDuration&&(a.vars.vipVideoDuration=a.vars.player.getMediaDuration());b=a.vars.player.getCurrentTime();a.vars.player.setCurrentTime(Math.min(b+10,a.vars.vipVideoDuration-1));a.resetUserActivityTimer(2);a.emitClickMetric(e.METRIC_SKIP_FORWARD);
a.vars.player.emitSkipForwardClick()});a.initializeMuteButton();a.vars.vipPlayPauseToggle=a.dom.$wrapper.find(e.VIPPlayPauseToggleSelector);a.vars.vipPlayPauseToggle.unbind("click");a.vars.vipPlayPauseToggle.click(function(b){b.stopPropagation();a.vars.vipControlsShouldPause?(a.pauseVideoIfNeeded(),a.vars.vipControlsShouldPause=!1,a.emitClickMetric(e.METRIC_PAUSE)):(a.vars.useUpNextComponent&&a.vars.isUpNextComponentActive?a._playUpNextHandler():a.resumeVideoIfNeeded(),a.resetUserActivityTimer(2),
a.vars.vipControlsShouldPause=!0,a.emitClickMetric(e.METRIC_PLAY));a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,a.vars.vipControlsShouldPause);a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,!a.vars.vipControlsShouldPause)});a.vars.player.on("timeupdate",a.updateProgressBarAndTimeDisplay);a.initializeProgressBarTouchEvents();a.initializeCrossCountryDisclosureBottomSheet()};this.initializeProgressBarTouchEvents=function(b,c,d){b=0<a.vars.A.$(b).length?a.vars.A.$(b):a.dom.$wrapper;
c=c||e.VIPProgressBarSelector;var k=b.find(c);b.undelegate(c,"touchstart touchmove touchend click");b.delegate(c,"touchstart",function(b){b.stopPropagation();a.vars.isScrubbing=!0;a.pauseVideoIfNeeded(!0)});b.delegate(c,"touchmove",function(b){if(a.vars.isScrubbing){b.stopPropagation();a.resetUserActivityTimer();var c=k.width(),d=k.get(0)&&(k.get(0).getBoundingClientRect().x||k.get(0).getBoundingClientRect().left)||0;b=Math.max(0,Math.min(1,(b.originalEvent.touches[0].clientX-d)/c));c=a.vars.vipVideoDuration*
b;1===b&&(c-=.1);a.vars.player.setCurrentTime(c)}});b.delegate(c,"touchend",function(b){b.stopPropagation();a.vars.isScrubbing=!1;a.vars.isContinuousPlayFinished=!1;a.vars.vipControlsShouldPause&&a.resumeVideoIfNeeded(d,!0)});b.delegate(c,"click",function(b){b.stopPropagation();a.vars.isContinuousPlayFinished=!1;a.resetUserActivityTimer();var c=k.width();b=Math.max(0,Math.min(1,b.offsetX/c));c=a.vars.vipVideoDuration*b;1===b&&(c-=.1);a.vars.player.setCurrentTime(c);a.vars.player.emitScrubberClick()})};
this.initializeCrossCountryDisclosureBottomSheet=function(){var b=a.A.$("#"+a.vars.templateId+" "+e.CCVBottomSheetTrigger);b.length&&(b.unbind("click"),b.click(function(b){a.pauseVideoIfNeeded()}));a.vars.ccvDisclosureConfig&&a.vars.ccvDisclosureConfig.id&&(b=a.vars.ccvDisclosureConfig.id+"-sheet",a.A.off("a:sheet:beforeShow:"+b),a.A.on("a:sheet:beforeShow:"+b,function(a){a=a.sheet.$contentContainer.siblings(e.AUISheetCloseButtonSelector);a.length&&a.addClass(e.CCVCloseButton)}),a.A.off("a:sheet:afterHide:"+
b),a.A.on("a:sheet:afterHide:"+b,function(b){b=b.sheet.$contentContainer.siblings(e.AUISheetCloseButtonSelector);b.length&&b.removeClass(e.CCVCloseButton);a.vars.vipControlsShouldPause&&a.resumeVideoIfNeeded()}))};this.initializeMuteButton=function(){a.vars.vipMuteUnmuteToggle=a.dom.$wrapper.find(e.VIPMuteUnmuteSelector);a.vars.vipMuteUnmuteToggle.unbind("click");a.vars.vipMuteUnmuteToggle.click(function(b){b.stopPropagation();a.muteUnMuteVideo()})};this.updateSegmentTab=function(b){a.vars.relatedVideosCarousel&&
a.vars.relatedVideosCarousel.updateSegmentTabForActiveVideo(b)};this.vseCsmWidgetLoadedMetrics=function(){var b=a.vars.A.$("#"+a.vars.clientPrefix+"-vse-related-videos");a.vars.isMetricRecorded||a.vars.A.objectIsEmpty(b.offset())?a.vars.A.off("scroll",a.vseCsmWidgetLoadedMetrics):a.vars.A.onScreen(b)&&(a.postWidgetInitializationMetrics(),a.vars.isMetricRecorded=!0)};this.triggerWeblabOnObjectImpressed=function(b,c,d,e){b&&k.IntersectionObserver&&(a.vars.objectIntersectionObserver=new J(null,b,function(b,
l){a.handleWeblabTriggerIntersection(b,l,c,d,e)},a.vars.enableWidgetMetricsAfterOneSecond))};this.handleWeblabTriggerIntersection=function(b,c,d,k,g){if(c&&c.dataset&&!a.vars.isWeblabTriggeredMap[d])try{if(k=a.triggerWeblab(d))a.vars.isWeblabTriggeredMap[d]=!0,g&&g(!0),a.vars.objectIntersectionObserver&&a.vars.objectIntersectionObserver.disconnectObserver()}catch(l){m.logError(e.ATTRIBUTION_NAME,"Failed to trigger weblab: "+d,l)}};this.isClickInExcludedContainer=function(b){return 0<a.vars.$(b.target).closest(".puis-atcb-container").length||
0<a.vars.$(b.target).closest(".s-energy-efficiency-container").length};this.navigateToNewPageOnPuiClick=function(b){a.vars.$(a.dom.$wrapper).delegate("#"+b+" "+e.puiRelatedProductAsinSelector,"click",function(b){if(!a.isClickInExcludedContainer(b)){var c=a.vars.$(b.target).closest("a"),d=c.attr("href");d&&(b.preventDefault(),b.stopPropagation(),b.stopImmediatePropagation(),a.pauseVideoIfNeeded(),a.vars.enableClickBasedAttribution&&a.vars.player.getCurrentTime()>=e.CLICK_ATTRIBUTION_INITIAL_DELAY&&
a.isOspEnabled(a.vars.currentAssetSpec)?m.count("pfo:osp:tag:emitted:success:"+a.vars.linkCode,1):d=c.attr(e.ATTR_ORIGINAL_HREF),k.open(d,"_blank"))}})};this.emitClickMetricForPUI=function(b,c,d){a.vars.$(a.dom.$wrapper).find("#"+d).delegate(e.RELATED_PRODUCTS_CAROUSEL_ELEMENT+" "+b,"click",function(d){if(b!==e.puiRelatedProductAsinSelector||!a.isClickInExcludedContainer(d)){var g=a.getProductAsinForPUI(d,e.productAsinAttributeSelector);d=0!==a.vars.$(d.target).closest(".vse-product-carousel-element").find(".vse-product-sponsored-disclosure").length;
if(g){var l=a.vars.productAsin===g?e.LANDING_ASIN:e.COMPLEMENTARY_ASIN;d?l+=" "+e.SPONSORED_ASIN:"";a.emitPFOClickMetric(""+e.METRIC_PUI_CLICK_PREFIX+c+":click",g,l)}}})};this.getProductAsinForPUI=function(b,c){return a.vars.$(b.target).closest("["+c+"]").attr(c)||null};this.postWidgetInitializationMetrics=function(){var b=a.vars.A.now()-a.vars.widgetStartTime;a.vars.A.$("#vse-spinner").hasClass("aok-hidden")?(m.count(a.vars.clientPrefix+".widgetViewedAndLoadedCount",1),m.count(a.vars.clientPrefix+
".widgetViewedAndLoadedDuration",b)):(m.count(a.vars.clientPrefix+".widgetViewedNotLoadedCount",1),m.count(a.vars.clientPrefix+".widgetViewedNotLoadedDuration",b));m.count(a.vars.clientPrefix+".pageLoadToWidgetViewedDuration",b)};this.emitMultipleThumbnailImpressionMetricHandler=function(b){try{if(b===t||null===b)return!1;var c=a.vars.isVideoImmersivePlayer?a.getCombinedPlaylist():a.vars.playlist;a.emitThumbnailMetric(a.vars.isVideoImmersivePlayer?e.METRIC_WATCH_THUMBNAIL_IMPRESSION:e.METRIC_LB_THUMBNAIL_IMPRESSION,
c[b],c[b].index)}catch(d){m.logError(e.ATTRIBUTION_NAME,"Failed to emit thumbnail impression",d)}};this.emitButtonImpressionMetricHandler=function(b,c){try{if(c===t||null===c)return!1;var d=a.A.$(c).attr("data-segment-id");a.emitButtonImpressionMetric(e.METRIC_LB_SHOW_MORE_BUTTON_IMPRESSION,d,b)}catch(k){m.logError(e.ATTRIBUTION_NAME,"Failed to emit show more button impression",k)}};this.triggerWeblabHandler=function(b){try{var c=a.vars.isVideoImmersivePlayer?a.getCombinedPlaylist():a.vars.playlist,
d=c[b].labelDetails?c[b].labelDetails.labelWeblabName:"";d&&!a.vars.hasWeblabTriggered&&(a.vars.hasWeblabTriggered=a.triggerWeblab(d))}catch(k){m.logError(e.ATTRIBUTION_NAME,"Failed to trigger weblab",k)}};this.triggerWeblab=function(b){if(!b||a.vars.isWeblabTriggeredMap[b])return!1;C.sendRequest(a.vars.A,""+e.VAP_EW+e.WEBLAB_TRIGGER_ENDPOINT,{weblabNames:[b],requestId:k.ue?k.ue.id:""},function(c){a.vars.isWeblabTriggeredMap[b]=!0;m.count(e.METRIC_WEBLAB_TRIGGER_SUCCESS,1);a.emitMetric(b+e.METRIC_WEBLAB_TRIGGER_SUCCESS)},
function(c){m.count(e.METRIC_WEBLAB_TRIGGER_FAILURE,1);a.emitMetric(b+e.METRIC_WEBLAB_TRIGGER_FAILURE)});return!0};this.onIntersectionObserved=function(b){a.emitMultipleThumbnailImpressionMetricHandler(b);a.triggerWeblabHandler(b)};this.onIntersectionObservedForShowMoreButton=function(b,c){a.emitButtonImpressionMetricHandler(b,c)};this.onProductItemIntersectionObserved=function(b,c){if(c&&c.dataset){var d=c.dataset.asin||(c.querySelector(".pui-wrapper")?c.querySelector(".pui-wrapper").getAttribute("data-dib-asin"):
null);c=[c.dataset.isSponsored||null!==c.querySelector(".puis-card-container .vse-product-sponsored-disclosure")||!1,a.vars.productAsin===d?e.LANDING_ASIN:e.COMPLEMENTARY_ASIN].join(" ");a.emitPFOImpressionMetric(e.METRIC_PFO_IMPRESSION,d,c,b)}};this.getEligibleIndicesForEmission=function(a,c){return c=a=a.filter(function(a){return 0>c.indexOf(a)}).slice()};this.getModalFactory=function(){var b=null;a.vars.isMobile?v.now("a-secondary-view").execute("vw-dp-secondary-view",function(a){b=a}):v.now("a-modal").execute("vw-dp-modal",
function(a){b=a});return b};this.resetVIPControls=function(){a.vars.vipControlsShouldPause||(a.vars.vipControlsShouldPause=!0,a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,!a.vars.vipControlsShouldPause),a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,a.vars.vipControlsShouldPause))};this.setMshopPageOrientation=function(b){a.vars.A.capabilities.ios&&"function"===typeof a.vars.mShopFactory.setPageOrientation&&a.vars.mShopFactory.setPageOrientation({behavior:b})};this.requestMshopFullscreen=
function(){a.vars.isVideoImmersivePlayer&&!a.vars.A.objectIsEmpty(a.vars.mShopFactory)&&(a.vars.A.capabilities.ios&&a.vars.viewportMetaTag.attr("content",a.vars.viewportMetaTagContent+",  viewport-fit\x3dcover"),a.vars.mShopFactory.requestFullscreen({successCallback:function(){document.addEventListener("touchmove",a.mShopScrollLock,!0);document.addEventListener("touch",a.mShopScrollLock,!0);a.vars.A.delay(function(){a.vars.A.trigger("resize",{},{width:screen.width,height:document.documentElement.clientHeight});
a.dom.$lbContainer&&a.dom.$lbContainer.height(document.documentElement.clientHeight)},200);a.setMshopPageOrientation(a.vars.mShopFactory.AUTO_ROTATE_ENABLED)},failCallback:function(){a.vars.A.trigger("resize",{},{width:screen.width,height:document.documentElement.clientHeight});a.dom.$lbContainer&&a.dom.$lbContainer.height(document.documentElement.clientHeight)}}))};this.cancelMshopFullscreen=function(b){void 0===b&&(b=function(){});a.vars.isVideoImmersivePlayer&&!a.vars.A.objectIsEmpty(a.vars.mShopFactory)&&
(a.vars.A.capabilities.ios&&a.vars.viewportMetaTag.attr("content",a.vars.viewportMetaTagContent),a.vars.mShopFactory.cancelFullscreen({successCallback:function(){document.removeEventListener("touchmove",a.mShopScrollLock,!0);document.removeEventListener("touch",a.mShopScrollLock,!0);b();a.setMshopPageOrientation(a.vars.mShopFactory.AUTO_ROTATE_DISABLED)},failCallback:function(){a.requestMshopFullscreen()}}))};this.cancelMshopFullscreenAndNavigate=function(b){var c;"string"===typeof b?c=function(){a.vars.A.delay(function(){a.closeIVXComponents();
a.vars.mShopFactory.navigate({url:b,transition:"slide"})},600)}:(b&&b.preventDefault(),c=function(){if(b.target){var c=b.target.getAttribute("href");a.closeIVXComponents();a.vars.mShopFactory.navigate({url:c,transition:"slide"})}});a.vars.disableFullScreenOnMshop?c():a.cancelMshopFullscreen(c)};this.openExternalLinkFromLightBox=function(b){a.pauseVideoIfNeeded();a.vars.isVideoImmersivePlayer&&(a.setIVXPauseState(),a.vars.isMshop&&a.cancelMshopFullscreenAndNavigate(b))};this.setIVXPauseState=function(){a.vars.vipControlsShouldPause=
!1;a.toggleVipPlayPauseClass()};this.closeIVXComponents=function(){a.vars.$(".vse-close-button").click();a.A.trigger("vse:ns:partialcomponents:"+a.vars.clientPrefix+":ivx:close")};this.closeIXVAndTriggerDisclosureEvent=function(b){a.vars.isVideoImmersivePlayer&&b&&(a.preventExternalLinkClick(b),b.srcElement&&(b=b.srcElement.getAttribute("href"),a.closeIVXComponents(),a.vars.A.trigger(a.vars.clientPrefix+":vse:disclosure:click",b)))};this.preventExternalLinkClick=function(a){a&&a.preventDefault()};
this.mShopScrollLock=function(b){0<a.vars.$(b.target).closest(e.VIPActionOverlaySelector).length||0<a.vars.$(b.target).closest(".vse-profile").length||0<a.vars.$(b.target).closest(".vse-fb-sheet").length||a.vars.$(b.target).hasClass("vse-fb-copyright")||a.vars.$(b.target).hasClass("vse-oap-link")||a.vars.$(b.target).hasClass("vse-profile")||a.vars.$(b.target).hasClass("vse-cr-link")||a.vars.$(b.target).hasClass("vse-fb-report-illegal-content")?b.stopPropagation():b.preventDefault()};this.initializeWatchComponents=
function(b){b={A:a.A,segmentTabs:b,segmentTabCssClassSelectorName:"#"+a.vars.popoverId+" "+e.VIPLbTabsContainerSelector+" .vse-vip-lb-tab"};a.vars.useMultiCarousel||a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)?a.vars.useMultiCarousel&&!a.vars.hideWatchIcon&&a.vars.videoActionTrayComponents.handleMoreVideosIconInteractions():(a.vars.relatedVideosCarousel.initializeSegmentTabs(b),a.vars.videoActionTrayComponents.handleWatchIconInteractions())};this.setVIPOrientationProperties=function(b){var c=
{carouselAnimationType:{width:"toggle"},getCardInViewOffset:function(a){return a.offset().left},getOffsetPointForTabUpdate:function(){return k.innerWidth/2},animatedCarouselDimensionValue:function(){return b},getCarouselPropertyToAnimate:function(a){return{scrollLeft:a}}},d={carouselAnimationType:{height:"toggle"},getCardInViewOffset:function(a){return a.offset().top},getOffsetPointForTabUpdate:function(){return a.A.$("#"+a.vars.templateId+" "+e.VIPLbTabsContainerSelector).outerHeight(!0)+parseInt(a.A.$("#"+
a.vars.templateId+" "+e.VIPLbCarouselSelector+" .vse-video-card:first").css("margin-top"))},animatedCarouselDimensionValue:function(){return{carouselCardWidth:a.A.$("#"+a.vars.templateId+" "+e.VIPLbCarouselSelector+" .vse-video-card:last").outerHeight(!0)+3}},getCarouselPropertyToAnimate:function(a){return{scrollTop:a}}},m={carouselAnimationType:{height:"toggle"},getCardInViewOffset:function(a){return a.offset().top},getOffsetPointForTabUpdate:function(){return a.A.$("#"+a.vars.templateId+" "+e.VIPLbTabsContainerSelector).outerHeight(!0)+
parseInt(a.A.$("#"+a.vars.templateId+" "+e.VIPLbCarouselSelector+" .vse-video-card:first").css("margin-top"))},animatedCarouselDimensionValue:function(){return b},getCarouselPropertyToAnimate:function(a){return{scrollLeft:a}}};k.innerHeight>k.innerWidth&&a.setOrintationConfig(c);k.innerWidth>k.innerHeight&&(a.vars.useMultiCarousel?a.setOrintationConfig(m):a.setOrintationConfig(d),a.updateLbViewportHeight());a.orientationChangeHandler&&a.A.off("orientationchange",a.orientationChangeHandler);a.orientationChangeHandler=
function(b){0===b.orientation?(a.setOrintationConfig(c),a.resetLbViewportHeight(),a.emitMetric(e.METRIC_PORTRAIT_MODE)):(a.vars.useMultiCarousel?a.setOrintationConfig(m):a.setOrintationConfig(d),a.updateLbViewportHeight(),a.emitMetric(e.METRIC_LANDSCAPE_MODE))};a.A.on("orientationchange",a.orientationChangeHandler)};this.setOrintationConfig=function(b){a.vars.videoActionTrayComponents.setOrientationConfig(b);a.setOrientationConfig(b)};this.resetLbViewportHeight=function(){a.A.$("#"+a.vars.templateId+
" "+e.VIPLbCarouselViewportSelector).css("height","initial")};this.updateLbViewportHeight=function(){a.A.$("#"+a.vars.templateId+" "+e.VIPLbCarouselViewportSelector).height(k.innerHeight-a.A.$("#"+a.vars.templateId+" "+e.VIPLbTabsContainerSelector).outerHeight(!0))};this.isReviewTextOverflow=function(){var b=a.A.$("#"+a.vars.templateId+" .vse-reviews-content-ellipsis-wrapper").prop("scrollHeight"),c=a.A.$("#"+a.vars.templateId+" .vse-reviews-content-ellipsis-wrapper").prop("clientHeight");return b>
c};this.isReviewTextExpanded=function(){return a.A.$("#"+a.vars.templateId+" "+e.VIPOverlaySelector).hasClass("vse-reviews-expand-full-cr")};this.updateReviewsExpandButtonVisibility=function(){a.A.$("#"+a.vars.templateId+" .vse-reviews-expand-container").toggleClass("vse-reviews-expand-show-toggle",a.isReviewTextOverflow())};this.styleExpandedReviewText=function(){var b=a.A.$("#"+a.vars.templateId+" .vse-reviews-content-expand-container"),c=a.isReviewTextOverflow()?"vse-reviews-content-expand-container-long":
"vse-reviews-content-expand-container-short";b.addClass(c)};this.resetReviewTextStyle=function(){a.A.$("#"+a.vars.templateId+" .vse-reviews-content-expand-container").removeClass("vse-reviews-content-expand-container-short vse-reviews-content-expand-container-long")};this.compactReviewIfNeeded=function(){var b=a.A.$("#"+a.vars.templateId+" .vse-reviews-content-ellipsis-wrapper"),c=a.A.$("#"+a.vars.templateId+" .vse-vip-play-pause-forward-previous-btns-container"),d=b.hasClass("vse-reviews-content-ellipsis-single-line"),
d=b.height()*(d?2:1),c=b.offset().top+d>c.offset().top-10;b.toggleClass("vse-reviews-content-ellipsis-single-line",c)};this.handleReviewsOnResize=function(){a.vars.customerReviewsConfig&&a.vars.customerReviewsConfig.showCustomerReviewMetadata&&a.vars.lightboxOpened&&(a.isReviewTextExpanded()?(a.resetReviewTextStyle(),a.styleExpandedReviewText()):(a.compactReviewIfNeeded(),a.updateReviewsExpandButtonVisibility()))};this.isLandscapeView=function(){return a.getDeviceOrientation()==e.LANDSCAPE};this.handleMultiChannelReviewIVXOnResize=
function(){if(a.vars.currentAssetSpec&&a.isCustomerReviewVideo(a.vars.currentAssetSpec))if(a.vars.updateCRText=!0,a.resetCRVInfo(a.vars.currentAssetSpec),a.updateCRTextIfRequired(),a.isReviewTextExpanded())a.resetCRVTextExpandView();else if(a.vars.multiCarouselExpanded){var b=a.isLandscapeView();a.dom.$lbContainer.find(""+e.CRVInfoSelector).toggleClass("aok-hidden",b)}};this.resetCRVInfo=function(b){(b=a.dom.$lbVideoCarousel&&a.dom.$lbVideoCarousel.find('[data-asin\x3d"'+b.contentId+'"]').find(".vse-lb-crv-metadata .vse-crv-info"))&&
0<b.length&&a.dom.$activeCrvMetadataContainer.find(".vse-crv-info").html(b.clone().html())};this.resetCRVTextExpandView=function(){var b=a.vars.auiTruncate&&a.vars.auiTruncate.get(a.vars.truncateWidgetId);b&&(b.getTruncatedText()!==b.getFullText()?a.expandTruncatedText(b):(a.collapseToTruncateText(b),a.setIVXPauseState()))};this.isTargetOutsideExpandedReviewsMetadata=function(b){return e.VIPReviewsMetadataSelectors.every(function(c){return 0===a.A.$(b.target).closest(c).length})};this.toggleVipPlayPauseClass=
function(){a.vars.vipPlayPauseToggle.toggleClass(e.VIPPauseIconClassName,a.vars.vipControlsShouldPause);a.vars.vipPlayPauseToggle.toggleClass(e.VIPPlayIconClassName,!a.vars.vipControlsShouldPause)};this.handleKeepVideoCarouselOpen=function(){a.vars.lightboxOpened&&a.vars.keepCarouselOpenOnLinkClick&&(a.handleIVXOverlay(),a.vars.manualTriggerWatchIcon=!0,a.vars.videoActionTrayComponents.triggerWatchIconInteractionOpen(),a.vars.watchAllClicked=!1,a.vars.manualTriggerWatchIcon=!1)};this.handleKeepProductCarouselOpen=
function(){a.vars.lightboxOpened&&a.vars.keepProductCarouselOpenOnClick&&(a.handleIVXOverlay(),a.vars.manualTriggerShopIcon=!0,a.vars.videoActionTrayComponents&&a.vars.videoActionTrayComponents.triggerShopIconInteractionOpen(),a.vars.manualTriggerShopIcon=!1)};this.handleIVXOverlay=function(){a.vars.useAutoplayFallback||!a.vars.lightboxOpenedFirstTime?a.showVideoImmersivePlayerOverlay():a.hideVideoImmersivePlayerOverlay()};this.showPoster=function(b){a.vars.player.showPoster(b)};this.addPlayerHoverHandler=
function(){var b=a.vars.A.$("#"+a.vars.containerId),c=a.vars.A.$("#"+a.vars.templateId),d=a.vars.$("#"+a.vars.templateId+"-close-button");if(d){d=d.clone();d.removeClass("vse-close-button").addClass(e.LB_CLOSE_BUTTON_ON_PLAYER_CLASS_NAME);b.append(d);var k=function(){!a.isDesktopVerticalLightBox()&&!a.isSingleVideoLightbox()||a.shouldDisablePlayerOverlayInteractions()||a.toggleLightboxCloseButton(!0)};a.vars.playerUnHoverHandler=function(){!a.isDesktopVerticalLightBox()&&!a.isSingleVideoLightbox()||
a.shouldDisablePlayerOverlayInteractions()||a.toggleLightboxCloseButton(!1)};b.hover(function(){return k()},function(){return a.vars.playerUnHoverHandler()});a.dom.$wrapper.find("."+e.LB_CLOSE_BUTTON_ON_PLAYER_CLASS_NAME).hover(function(){k();a.vars.isFeedbackClosed&&a.showFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer)});b.keyup(function(b){clearTimeout(void 0);if(9==b.keyCode||16==b.keyCode)a.vars.includeVideoInformationOverPlayer?a.showPlayerOverlayFeatures():null!==a.vars.feedbackContainer&&
a.showFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer),a.toggleLightboxCloseButton(!0)});c.keyup(function(b){9!=b.keyCode&&16!=b.keyCode||b.target.closest("#"+a.vars.containerId)||(a.vars.includeVideoInformationOverPlayer?a.hidePlayerOverlayFeatures():a.hideFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer),(a.isDesktopVerticalLightBox()||a.isSingleVideoLightbox())&&a.toggleLightboxCloseButton(!1))})}};this.showPlayerOverlayFeatures=function(b){a.showActiveMetadataOverPlayer(b);
a.showFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer)};this.hidePlayerOverlayFeatures=function(){a.hideActiveMetadataOverPlayer();a.shouldDisablePlayerOverlayInteractions()||a.hideFeedbackLinkWithoutDimmingThePlayer(a.vars.feedbackContainer,a.vars.playerContainer)};this.setupKeyPressEventHandlerForRelatedProductsCarousel=function(){a.dom.$relatedProductContainer.keyup(function(b){9===b.keyCode&&(a.dom.$relatedProductContainer.find(".a-carousel-col").css("display","block"),a.dom.$relatedProductContainer.mouseout(function(){a.dom.$relatedProductContainer.find(".a-carousel-col").css("display",
"")}))})};this.toggleLightboxCloseButton=function(b){0<a.dom.$wrapper.find("."+e.LB_CLOSE_BUTTON_ON_PLAYER_CLASS_NAME).length&&a.dom.$wrapper.find("."+e.LB_CLOSE_BUTTON_ON_PLAYER_CLASS_NAME).toggleClass("vse-show",b)};this.feedBackMouseLeaveHandler=function(){a.vars.isFeedbackClosed?a.vars.includeVideoInformationOverPlayer?a.hidePlayerOverlayFeatures():a.hideFeedbackLink(a.vars.feedbackContainer,a.vars.playerContainer):a.toggleLightboxCloseButton(!0);a.vars.cursorOnVideoPlayerDiv=!1};this.isSingleVideoLightbox=
function(){return 0<a.vars.A.$("#"+a.vars.popoverName+"-wrapper").length?0<=a.vars.A.$("#"+a.vars.popoverName+"-wrapper").attr("data-css-class").indexOf("vse-single-video-lb"):!1};this.showHideElementsForMultiCarousel=function(){setTimeout(function(){a.toggleElementsForMultiCarouselIfRequired(a.vars.multiCarouselExpanded)},a.vars.multiCarouselExpanded?250:0)};this.toggleElementsForMultiCarouselIfRequired=function(b){a.A.$("#"+a.vars.templateId+" ."+e.VIPScrubberClassName).toggleClass("aok-hidden",
b);a.A.$("#"+a.vars.templateId+" ."+e.VIPPlayPauseClassName).toggleClass("aok-hidden",b);a.A.$("#"+a.vars.templateId+" "+e.VIPFeedbackContainer).toggleClass("aok-hidden",b);a.A.$("#"+a.vars.templateId+" ."+e.VIPVideoHelpfulVotesClassName).toggleClass("aok-hidden",b);a.showHideCRVMetadataForChannelCarousel(b)};this.showHideCRVMetadataForChannelCarousel=function(b){a.vars.useChannelCarousel&&a.isCustomerReviewVideo(a.vars.currentAssetSpec)&&(a.A.$("#"+a.vars.templateId+" "+a.vars.expandButtonSelector).toggleClass("hideExpandButton",
b),a.isLandscapeView()&&(a.A.$("#"+a.vars.templateId+" "+e.CRVInfoSelector).toggleClass("aok-hidden",b),a.vars.updateCRText=!b,a.updateCRTextIfRequired()))};this.openCloseMultiCarousel=function(){a.vars.multiCarouselExpanded?(a.vars.hideWatchIcon||a.vars.videoActionTrayComponents.reset(),a.A.$("#"+a.vars.templateId+" "+e.VIPMultiCarouselWrapper).removeClass(e.VIPMultiCarouselExpandedClass),a.showHideElementsForMultiCarousel(),a.A.$("#"+a.vars.templateId+" "+e.VIPSearchButtonSelector).removeClass("aok-hidden"),
a.resetUserActivityTimer(),a.vars.multiCarouselExpanded=!1,a.vars.keepMultiCarouselOpen=!1):(a.resetUserActivityTimer(-2),a.A.$("#"+a.vars.templateId+" "+e.VIPMultiCarouselWrapper).addClass(e.VIPMultiCarouselExpandedClass),a.showHideElementsForMultiCarousel(),a.A.$("#"+a.vars.templateId+" "+e.VIPSearchButtonSelector).addClass("aok-hidden"),a.vars.multiCarouselExpanded=!0)};this.removeAriaHiddenFromCarouselCards=function(){var b=document.querySelectorAll("#"+a.vars.popoverId+" li.vse-video-card"),
c=Array.prototype.slice.call(b);c&&a.vars.A.delay(function(){c.forEach(function(a){a.setAttribute("aria-hidden","false")})},300)};this.isGroupOne=function(b){if(b.groupType)return-1!==b.groupType.indexOf(e.G1);if(!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1))for(var c=a.vars.multiCarouselS1.getplaylist(),d=0;d<c.length;d++)if(c[d].contentId===b.contentId)return!0;return!1};this.isGroupTwo=function(b){if(b.groupType)return-1!==b.groupType.indexOf(e.G2);if(!a.vars.A.objectIsEmpty(a.vars.multiCarouselS2))for(var c=
a.vars.multiCarouselS2.getplaylist(),d=0;d<c.length;d++)if(c[d].contentId===b.contentId)return!0;return!1};this.isInPlayList=function(b){if(!a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)&&b)for(var c=a.vars.relatedVideosCarousel.getplaylist(),d=0;d<c.length;d++)if(c[d].contentId===b.contentId)return!0;return!1};this.getActiveAsset=function(){var b=a.vars.currentAssetSpec;if(a.vars.useChannelCarousel)return null==b.segmentNumber||a.vars.A.objectIsEmpty(a.vars.channelCarousels[b.segmentNumber])||
(b=a.vars.channelCarousels[b.segmentNumber].getActiveAsset()),b;if(a.vars.useMultiCarousel){var c=a.isGroupOne(b),d=a.isGroupTwo(b),c=a.vars.A.objectIsEmpty(a.vars.currentAssetSpec)?!1:c,d=a.vars.A.objectIsEmpty(a.vars.currentAssetSpec)?!1:d;c&&!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)?b=a.vars.multiCarouselS1.getActiveAsset():d&&!a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)&&(b=a.vars.multiCarouselS2.getActiveAsset());return b}return a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)?a.vars.currentAssetSpec:
a.vars.relatedVideosCarousel.getActiveAsset()!==t?a.vars.relatedVideosCarousel.getActiveAsset():a.vars.currentAssetSpec};this.getCombinedPlaylist=function(){var b=[];if(a.vars.useChannelCarousel){if(!a.vars.A.objectIsEmpty(a.vars.channelCarousels))for(var c=0,d=a.vars.channelCarousels;c<d.length;c++)b=b.concat(d[c].getplaylist());return b}return a.vars.useMultiCarousel?(a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)||(b=b.concat(a.vars.multiCarouselS1.getplaylist())),a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||
(b=b.concat(a.vars.multiCarouselS2.getplaylist())),b):a.vars.showSingleLBOverlay?[a.vars.currentAssetSpec]:a.vars.relatedVideosCarousel.getplaylist()};this.setOrientationConfig=function(b){if(a.vars.useChannelCarousel){if(!a.vars.A.objectIsEmpty(a.vars.channelCarousels))for(var c=0,d=a.vars.channelCarousels;c<d.length;c++)d[c].setOrientationConfig(b)}else a.vars.useMultiCarousel?(a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)||a.vars.multiCarouselS1.setOrientationConfig(b),a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||
a.vars.multiCarouselS2.setOrientationConfig(b)):a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)||a.vars.relatedVideosCarousel.setOrientationConfig(b)};this.findIndex=function(b){var c=0;if(a.vars.useChannelCarousel){for(var d=0,e=a.vars.channelCarousels;d<e.length;d++){var g=e[d],k=g.findIndex(b);if(-1!=k)return c+k;c+=g.getplaylist().length}return-1}if(a.vars.useMultiCarousel){c=a.isGroupOne(b);d=a.isGroupTwo(b);if(!c&&!d)return-1;if(!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)&&c)return a.vars.multiCarouselS1.findIndex(b);
if(!a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)&&!c)return c=a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)?0:a.vars.multiCarouselS1.getplaylist().length,c+a.vars.multiCarouselS2.findIndex(b)}else return a.isInPlayList(b)?a.vars.relatedVideosCarousel.findIndex(b):-1};this.markPlaying=function(b){if(b!==t)if(a.vars.useChannelCarousel)null==b.segmentNumber||a.vars.A.objectIsEmpty(a.vars.channelCarousels[b.segmentNumber])||(a.dom.$wrapper.find(e.VIPMultiCarouselContainer).find(".vse-video-card").removeClass("active"),
a.vars.channelCarousels[b.segmentNumber].markPlaying(b));else if(a.vars.useMultiCarousel){var c=a.isGroupOne(b),d=a.isGroupTwo(b),k=a.vars.A.objectIsEmpty(a.vars.currentAssetSpec)?!1:c;!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)&&c?(a.vars.multiCarouselS1.markPlaying(b),a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||k||a.dom.$wrapper.find(e.VIPMultiCarouselTwoContainer).find(".vse-video-card").removeClass("active")):!a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)&&d&&(a.vars.multiCarouselS2.markPlaying(b),
!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)&&k&&a.dom.$wrapper.find(e.VIPMultiCarouselOneContainer).find(".vse-video-card").removeClass("active"))}else a.isInPlayList(b)&&a.vars.relatedVideosCarousel.markPlaying(b)};this.rotateTo=function(b){if(a.vars.useChannelCarousel){for(var c=0,d=a.vars.channelCarousels;c<d.length;c++){var e=d[c];a.vars.A.objectIsEmpty(e)||e.removeActive()}null==b.segmentNumber||a.vars.A.objectIsEmpty(a.vars.channelCarousels[b.segmentNumber])||a.vars.channelCarousels[b.segmentNumber].rotateTo(b)}a.vars.useMultiCarousel?
(a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)||a.vars.multiCarouselS1.removeActive(),a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||a.vars.multiCarouselS2.removeActive(),c=a.isGroupOne(b),!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)&&c?a.vars.multiCarouselS1.rotateTo(b):a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||a.vars.multiCarouselS2.rotateTo(b)):a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)||a.vars.relatedVideosCarousel.rotateTo(b)};this.updateVotingElements=function(b,c,d){a.vars.useChannelCarousel?
null==b.segmentNumber||a.vars.A.objectIsEmpty(a.vars.channelCarousels[b.segmentNumber])||a.vars.channelCarousels[b.segmentNumber].updateVotingElements(c,d):a.vars.useMultiCarousel?(b=a.isGroupOne(b),!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)&&b?a.vars.multiCarouselS1.updateVotingElements(c,d):a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||a.vars.multiCarouselS2.updateVotingElements(c,d)):a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)||a.vars.relatedVideosCarousel.updateVotingElements(c,
d)};this.updateVotingElementsForCountAndStatus=function(b,c,d){a.vars.useChannelCarousel?null==b.segmentNumber||a.vars.A.objectIsEmpty(a.vars.channelCarousels[b.segmentNumber])||a.vars.channelCarousels[b.segmentNumber].updateVotingElementsForCountAndStatus(c,d):a.vars.useMultiCarousel?(b=a.isGroupOne(b),!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)&&b?a.vars.multiCarouselS1.updateVotingElementsForCountAndStatus(c,d):a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)||a.vars.multiCarouselS2.updateVotingElementsForCountAndStatus(c,
d)):a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)||a.vars.relatedVideosCarousel.updateVotingElementsForCountAndStatus(c,d)};this.initializeMultiCarousel=function(b,c,d){a.emitRelatedVideosRenderMetric(e.METRIC_WATCH_THUMBNAIL_RENDER,c,d);b=a.vars.useChannelCarousel&&null!==d?e.VIPMultiCarouselContainer+"-"+d:b?e.VIPMultiCarouselOneContainer:e.VIPMultiCarouselTwoContainer;a.dom.$wrapper.delegate(b,"touchstart",function(b){a.vars.multiCarouselExpanded&&(a.vars.keepMultiCarouselOpen=!0,a.resetUserActivityTimer(-2),
b.stopPropagation())});a.dom.$wrapper.delegate(b,"touchend",function(b){a.vars.multiCarouselExpanded&&(a.vars.keepMultiCarouselOpen=!1,a.resetUserActivityTimer(-2),b.stopPropagation())})};this.relatedVideosCarouselNotEmpty=function(){return!a.vars.A.objectIsEmpty(a.vars.relatedVideosCarousel)||!a.vars.A.objectIsEmpty(a.vars.channelCarousels)||!a.vars.A.objectIsEmpty(a.vars.multiCarouselS1)||!a.vars.A.objectIsEmpty(a.vars.multiCarouselS2)};this.toggleSingleLbCssClass=function(b){!a.vars.isMobile&&
a.dom.$wrapper&&a.dom.$wrapper.closest(e.LightboxWrapperSelector)&&a.dom.$wrapper.closest(e.LightboxWrapperSelector).toggleClass(e.SINGLE_VIDEO_LB_CSS_CLASS,b)&&setTimeout(function(){return a.vars.A.trigger("resize",{},{width:k.innerWidth,height:k.innerHeight})},200)};this.multiCarouselHandler=function(){a.vars.handleMultiCarousel&&(a.dom.$wrapper.delegate(e.VIPMultiCarouselWrapper,"click touchstart",function(b){if(a.vars.$(b.target).closest("a").length)return!0;if(!a.vars.keepMultiCarouselOpen){if(a.vars.multiCarouselExpanded&&
a.vars.$(e.vernacLanguageRadioBlockSelector).length)return!0;b.stopPropagation();b.preventDefault();a.vars.multiCarouselExpanded||a.emitClickMetric(e.METRIC_WATCH_HANDLE_CLICK);a.openCloseMultiCarousel()}a.vars.$(b.target).closest(".vse-video-card").length&&null!=a.vars.visualSearchComponent&&(a.vars.visualSearchComponent.hideSearchTooltip(!0),a.vars.isMultiCarouselClosedForFirstTime=!0)}),a.vars.handleMultiCarousel=!1)};this.vars={A:c,$:c.$,isMobile:!1,player:null,feedback:null,clientPrefix:null,
placement:null,containerId:null,contentId:null,productAsin:null,playerFactory:null,ingressRelatedVideosCarousel:null,relatedVideosCarousel:null,keepCarouselOpenOnLinkClick:!1,watchAllClicked:!1,keepProductCarouselOpenOnClick:!1,videoVoteContainerFactory:null,activeVideoVoteContainer:null,isMshop:!1,isContinuousPlayFinished:!1,isFeedbackClosed:!0,showVotes:!1,defaultEntityId:e.EMPTY_STRING,videoVoteFailure:!1,videoVoteConfig:null,ccvDisclosureConfig:null,currentAssetSpec:null,initialVideo:null,relatedProductsNilgiriRequestCount:0,
popoverId:null,relatedProductsRequest:null,cursorOnVideoPlayerDiv:!1,lightBoxPausedVideo:!1,verticalLightBoxMaxWidth:1024,relatedProductsContainerFixedHeight:115,currentIndex:0,socialSharePageState:null,mShopFactory:null,lightboxOpened:!1,lightboxCarouselRegistered:!1,playFullScreenVideo:!1,ingressHasInitialAssetSpec:!0,playlist:null,isVideoImmersivePlayer:!1,secondsFromLastActivity:0,intervalUserActivityHandlerId:0,isVIPOverlayTimerSet:!1,isVIPOverlayOnTapEventRegistered:!1,lightboxOpenedFirstTime:!0,
skipRelatedVideosWait:!1,videoActionTrayComponents:null,socialShareId:null,shareCopyLinkSuccessText:"",ingressCarousel:null,ingressPlaylist:null,widgetStartTime:0,isMetricRecorded:!1,carouselPageSize:0,nextPage:0,previousPage:0,vipVideoDuration:0,isScrubbing:!1,vipControlsShouldPause:!0,vipPlayPauseToggle:null,shouldShowProfiles:!1,popoverName:null,isUpNextComponentActive:!1,upNextTimeoutHandle:null,useUpNextComponent:!1,upNextString:e.EMPTY_STRING,cancelString:e.EMPTY_STRING,watchIconFirstOpen:!0,
shopIconFirstOpen:!0,manualTriggerWatchIcon:!1,manualTriggerShopIcon:!1,customerReviewsConfig:null,useAutoplayFallback:!1,vipPlayIconClicked:!1,contentIdProductAsinMap:{},showLightboxV2Experience:!1,playerContainer:null,feedbackId:null,feedbackContainer:null,showContentCarousel:!0,useMultiCarousel:!1,useChannelCarousel:!1,hideWatchIcon:!1,multiCarouselExpanded:!1,handleMultiCarousel:!0,keepMultiCarouselOpen:!1,multiCarouselS1:null,multiCarouselS2:null,channelCarousels:[],isSwipingMultiCarousel:!1,
showPFOOnOverlay:!1,cacheOnProductAsin:!1,onSiteAttributionMetrics:null,useAllIVXComponents:!0,viewportMetaTag:null,viewportMetaTagContent:null,isClosedCaptionEnabled:!1,currentClosedCaptionsLang:null,closedCaptionsConfig:{},closedCaptionsTooltipTimerId:0,shouldHandleCCForLandscapeVideo:!1,playerUnHoverHandler:function(){},setMaxHeightToLBLeftColumn:!1,seekTime:0,rankingStrategy:e.EMPTY_STRING,videoUrlInlineVideoKey:e.EMPTY_STRING,showMoreMenuExperience:!1,disableFullScreenOnMshop:!1,disableCreatorClicksOnMshop:!1,
vipControlsShouldMute:!0,vipMuteUnmuteToggle:null,currentPlayerMode:"",inlinePlayerInitialized:!1,firstRelatedProductOverride:null,isMultiCarouselClosedForFirstTime:!1,showHotspots:!1,isHotspotsWeblabTriggered:!1,isCCWeblabTriggered:!1,isVideoTypeLabelPresent:!1,isTimeoutComplete:!1,showHeroExperience:!1,relatedProductsContainer:e.EMPTY_STRING,includeVideoInformationOverPlayer:!1,showSingleLBOverlay:!1,auiTruncate:null,updateCRText:!0,truncateWidgetId:"",expandButtonSelector:"",complementaryAsins:{},
CRV_TEXT_VERTICAL_PADDING_PX:44,isWeblabTriggeredMap:{},detachedCarousels:{},currentCarouselContentId:null};this.dom={$wrapper:null,$lbContainer:null,$lbLeftColumn:null,$lbLeftColumnPlaceholder:null,$lbRightColumn:null,$lbCCHeader:null,$lbTabContainer:null,$videoAuthor:null,$playerContainer:null,$mobileFixedContainer:null,$mobileMovableContainer:null,$relatedProductContainer:null,relatedProductsParentEl:null,$activeVideoOspLink:null,$activeVideoTitlePrefix:null,$activeVideoCRLink:null,$lbVideoCarousel:null,
$activeVideoCustomerProfile:null,$customerProfileContainer:null,$videoAuthorBlock:null,$activeVideoCRLinkWrapper:null,$profileLinkSelector:null,$followButtonSelector:null,$followEligibleCreator:null,$activeMetadataContainer:null};this.refTagRecorder=new M(c)}d.prototype.moveMetadataOverPlayer=function(c){c&&0<c.length&&this.vars.$(this.vars.playerContainer).prepend(c)};d.prototype.updateCRTextIfRequired=function(){this.vars.updateCRText&&(this.updateExpandWidgetOverlayText(this.vars.truncateWidgetId,
this.vars.expandButtonSelector),this.vars.updateCRText=!1)};d.prototype.isValidEntityToFollow=function(c){return!this.vars.A.objectIsEmpty(c.entityId)&&!this.vars.A.objectIsEmpty(c.entityType)&&c.entityId!==this.vars.defaultEntityId};d.prototype.hideFollowElements=function(){this.dom.$followEligibleCreator.length&&this.dom.$followEligibleCreator.addClass("vse-hidden");this.dom.$vseFollowClassSelector.addClass("vse-hidden")};d.prototype.hideFollowEligibleCreator=function(){this.dom.$followEligibleCreator.length&&
this.dom.$followEligibleCreator.addClass("vse-hidden")};d.prototype.updateFollowButtonAttributes=function(c){this.dom.$followButtonSelector.attr("data-type",c.entityType);this.dom.$followButtonSelector.attr("data-entity-id",c.entityId)};d.prototype.handleFollowButtonInitialization=function(){var c=this.dom.$followButtonSelector.attr("data-initialize"),a=this.dom.$followButtonSelector.attr("data-entity-id"),b=this.dom.$followButtonSelector.attr("data-type"),d=this.dom.$followButtonSelector.get(0);
this.dom.$vseFollowClassSelector.removeClass("vse-hidden");"false"===c?this.initializeNewFollowButton(b,a,d):this.reinitializeExistingButton(b,a,d)};d.prototype.initializeNewFollowButton=function(c,a,b){this.dom.$followButtonSelector.attr("data-initialize","true");v.now("follow-button-v3").execute(function(d){d?d.all().some(function(a){return"vsefollow"===a.element.id})?d.reInitializeButton(c,a,b):d.initializeButton(b):v.trigger("vsefollow")})};d.prototype.reinitializeExistingButton=function(c,a,
b){v.now("follow-button-v3").execute(function(d){b&&d.reInitializeButton(c,a,b)})};d.prototype.logFollowButtonError=function(c,a){m.logError(e.ATTRIBUTION_NAME,"Cannot update follow button. Video: "+c.contentId+", entityId: "+c.entityId,a)};d.prototype.getAciContentIdFromPlayerInstance=function(){try{return this.vars.player.player.playerInstance.config.aciContentId}catch(c){m.logError(e.ATTRIBUTION_NAME,"Failed to get aciContentId for the asset: "+this.vars.currentAssetSpec.contentId+" ",c)}};d.prototype.isDifferenceGreaterThan24Hours=
function(c,a){return 24<(c-a)/36E5};d.prototype.isCustomerReviewVideo=function(c){return c.vendorCode?"AOD60"==c.vendorCode:!1};d.prototype.isInfluencerVideo=function(c){return c.creatorType?"influencer"===c.creatorType.toLowerCase():!1};d.prototype.updateSignInToReportRedirect=function(){var c=this.vars.currentAssetSpec.contentId,a=this.A.$("#ive-login-to-report");if(0<a.length){var b=a.attr("href");b&&(b=b.replace(/(openid\.return_to=)([^&]+)/,function(a,b,d){a=decodeURIComponent(d);d="/"===a.charAt(a.length-
1);a=a.replace(/\/[^\/]+\/?$/,"/"+c+(d?"/":"")).replace(/:/g,"%3A");return b+a}),a.attr("href",b))}};d.prototype.getLocalStorage=function(c){try{return localStorage.getItem(c)}catch(a){return null}};d.prototype.setLocalStorage=function(c,a){try{localStorage.setItem(c,a)}catch(b){}};return d}(),Ha=e.VAP_EW+"subcomponent/",oa=function(){function d(){}d.getLazyLoadComponents=function(c,a,b,e,k){c.$("#"+a+" div[data-configuration]").each(function(){d.callSubComponentBuilder({A:c,context:b,handleFailure:k,
handleSuccess:e},c.$(this),3)})};d.callSubComponentBuilder=function(c,a,b){var e=c.A,k=c.context,n=c.handleFailure,g=c.handleSuccess,l=atob(a.attr("data-configuration")),q=JSON.parse(l),l=b,f={pageContext:k,configuration:q},x=e.now();b--;var p=l-b-1;C.sendRequest(e,Ha+q.type,f,function(b){var c=e.now()-x;m.count("vse_component_lazyLoaderHook:success:",c);m.count("vse_component_lazyLoaderHook:success:"+k.page+":"+k.placement+":"+q.type+":"+p,1);a.html(b);g(e,f)},function(g){(0===g.http.status||500<=
g.http.status&&599>=g.http.status)&&0<b?(m.count("vse_component_lazyLoaderHook:error:"+k.page+":"+k.placement+":"+q.type+":"+p,1),d.callSubComponentBuilder(c,a,b)):(m.count("vse_component_lazyLoaderHook:failure",1),n(e,f))})};return d}();try{var Ia=function(d){return new d(function(c,a){v.when("A","a-carousel-framework","a-carousel-constants","3p-promise","a-button","ready").register("VSEComponentAssets",function(a,d,n,r,g){return{setClientPrefix:function(c,q){var f=new na(a);f.vars.clientPrefix=
c;f.vars.setMaxHeightToLBLeftColumn=q.setMaxHeightToLBLeftColumn||!1;f.vars.templateId=q.templateId;f.vars.showLightboxV2Experience=q.showLightboxV2Experience||!1;f.vars.isMobile=a.capabilities.mobile;f.vars.disableFullScreenOnMshop=q.disableFullScreenOnMshop||!1;f.vars.skipRelatedVideosWait=q.callRelatedProductsWithoutRelatedVideos||!1;f.vars.A.objectIsEmpty(q)||(q.hasOwnProperty(e.IS_VIDEO_IMMERSIVE_PLAYER_KEY)&&(f.vars.isVideoImmersivePlayer=q.isVideoImmersivePlayer),q.hasOwnProperty(e.SHOW_CONTENT_CAROUSEL)&&
(f.vars.showContentCarousel=q.showContentCarousel));a.off("vse:ns:player:"+f.vars.clientPrefix+":init");a.off("vse:ns:metadata:"+f.vars.clientPrefix+":init");a.off("vse:ns:socialShare:"+f.vars.clientPrefix+":init");a.off("vse:ns:feedback:"+f.vars.clientPrefix+":init");a.off("vse:ns:relatedProducts:"+f.vars.clientPrefix+":init");a.off("vse:ns:relatedVideos:"+f.vars.clientPrefix+":init");a.off("vse:ns:relatedVideosVernacularExperience:"+f.vars.clientPrefix+"init");a.off("vse:ns:ingressCarousel:"+f.vars.clientPrefix+
":init");a.off("vse:"+f.vars.clientPrefix+":page:lightBoxOpened");a.off("vse:"+f.vars.clientPrefix+":page:lightBoxClosed");a.off("vse:"+f.vars.clientPrefix+":lazyload:relatedvideos:succeeded");a.off("vse:"+f.vars.clientPrefix+":page:watchAllClicked");a.off("vse:ns:"+f.vars.clientPrefix+":hideAdditionalUXFeatures");a.off("vse:ns:inlinePlayer:"+f.vars.clientPrefix+":init");v.when("mash").execute("VSEComponentAsset-Mash-Detection",function(a){f.vars.isMshop=!0;f.vars.mShopFactory=a});v.when("A","a-truncate").execute("ive-expand-component",
function(a,b){f.vars.auiTruncate=b});a.on("vse:ns:player:"+f.vars.clientPrefix+":init",function(d){try{var g=D.fetchLatestPageState(a,d);if(g){m.count(e.PLAYER_INITIALIZED+":"+f.vars.clientPrefix,1);var h=g.awaConfig;f.vars.isMobile=g.isMobile;f.vars.productAsin=g.productAsin;f.vars.playFullScreenVideo=g.enableFullScreenByDefault;f.vars.useHotspotsNX=g.useHotspotsNX;f.vars.hotSpotsV3Weblab=g.hotSpotsV3Weblab;f.vars.contentId=h.initialVideo;f.vars.shouldLoop=h.shouldLoop;f.vars.containerId=h.containerId;
f.vars.playerContainer="#"+f.vars.containerId+"-container";f.vars.placement=h.nexusMetricsConfig.placementContext;f.vars.nexusMetricsConfig=h.nexusMetricsConfig;f.vars.useUpNextComponent=h.useUpNextComponent;f.vars.enableClickBasedAttribution=h.enableClickBasedAttribution;f.vars.aciContentId=h.aciContentId;f.vars.linkCode=h.ospLinkCode;f.vars.customerId=h.customerId;f.vars.useAutoplayFallback=h.useAutoplayFallback;f.vars.useUpNextComponent&&(f.vars.upNextString=g.upNextString?g.upNextString:"UP NEXT",
f.vars.cancelString=g.cancelString?g.cancelString:"CANCEL");d={gatedP:G,EventEmitter:O,promise:r};var k={videoUrl:g.videoUrl,contentId:f.vars.contentId,vendorCode:g.vendorCode,ospTrackingLink:g.ospTrackingLink,vendorTrackingId:g.vendorTrackingId,productAsin:g.productAsin,videoReferenceId:g.videoReferenceId,eventTimestamp:f.vars.A.now(),imageUrl:g.imageUrl,duration:0,refTag:e.EMPTY_STRING,rankingStrategy:e.EMPTY_STRING,aciContentId:g.aciContentId,mimeType:g.mimeType,videoTitle:g.videoTitle,altText:g.altText,
creatorType:g.creatorType};f.setVideoDetails(f.vars.contentId,g);var n=g.initialClosedCaptions;f.vars.A.objectIsEmpty(n)||f.setInitialClosedCaptions(k,n);f.vars.isVideoImmersivePlayer&&f.setupVIPClosedCaptions(g.closedCaptionsConfig,n);h.initialVideo=k;f.vars.playerFactory=new Z(d);if(f.vars.A.objectIsEmpty(g.inlinePlayerConfig)||!0!==g.needPlayerFactory){f.vars.player=f.vars.playerFactory.create(h);!f.vars.isVideoImmersivePlayer&&f.vars.playFullScreenVideo&&(f.vars.player.aspectRatio(f.getAspectRatio(f.getDeviceOrientation())),
f.vars.player.fluid(!1));f.vars.isVideoImmersivePlayer&&(f.vars.player.on("playerClick",f.onPlayerTapHandler),f.vars.player.on("texttrackenable",f.onTextTrackEnable),f.vars.useAutoplayFallback&&(f.vars.player.on("autoplayFailed",f._playerFailedAutoplayHandler),f.vars.player.on("autoplaySucceeded",f._playerSucceededAutoplayHandler)));f.attachPlayerEventListeners();if(f.vars.A.objectIsEmpty(h.osaInstrumentationConfig))m.count(f.vars.clientPrefix+".noOsaInstrumentationConfig",1);else{var q={$container:f.vars.A.$("#"+
f.vars.containerId),schemaId:h.osaInstrumentationConfig.schemaId,producerId:h.osaInstrumentationConfig.producerId};f.vars.onSiteAttributionMetrics=new U(q,f.vars.player,f.vars.A,f.vars.isVideoImmersivePlayer,f.vars.clientPrefix)}"nexus"===h.metricsEmissionMethod&&f.vars.nexusMetricsConfig&&(f.vars.buildNexusPayload=H.makeApplicationNexusPayloadBuilder(f.vars.A,f.vars.nexusMetricsConfig),f.vars.emitMetricsToNexus=!0);var t=f.vars.A.$("#ive-"+f.vars.clientPrefix+"-player-label-container");t.length&&
f.vars.A.$(f.vars.playerContainer).append(t);f.vars.A.trigger("vsePlayer-"+f.vars.clientPrefix,{player:f.vars.player,containerId:f.vars.containerId});f.vars.A.trigger(f.vars.clientPrefix+":vse:player:registered")}else f.vars.A.trigger("ivePlayerFactory-"+f.vars.clientPrefix,{playerFactory:f.vars.playerFactory})}else m.count(e.PLAYER_PAGE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1),f.vars.A.trigger("vse-common-assets-player-"+d+"-initialization-failed")}catch(v){m.logFatal(e.ATTRIBUTION_NAME+
":"+f.vars.clientPrefix,"Fatal during player initialization.",v),m.count(c+".playerInitializationFatal",1)}});a.on("vse:ns:metadata:"+f.vars.clientPrefix+":init",function(d){try{var g=D.fetchLatestPageState(a,d);if(g){f.vars.defaultEntityId=g.defaultEntityId;g.entityId&&g.entityType&&f.setFollowEntities(g.entityId,g.entityType);g.showSingleLBOverlay&&(f.vars.showSingleLBOverlay=!0,f.vars.includeVideoInformationOverPlayer=!0);f.vars.showUploadDate=g.showUploadDate;f.vars.videoVoteConfig=g.videoVoteConfig;
f.vars.ccvDisclosureConfig=g.ccvDisclosureConfig;f.vars.videoVoteConfig=a.$.extend({},f.vars.videoVoteConfig);d={gatedP:G,promise:r};if(f.vars.videoVoteConfig.hasOwnProperty("placementContext")){f.vars.videoVoteConfig.dependencies=d;f.vars.videoVoteContainerFactory=new Q(a,f.vars.videoVoteConfig);var h="#vse-video-votes-lb-details-"+f.vars.videoVoteConfig.placementContext,k=0<f.vars.A.$("#"+f.vars.templateId+" "+h).length?"#"+f.vars.templateId+" "+h:h;f.vars.activeVideoVoteContainer=f.vars.videoVoteContainerFactory.createFromSelector(k)}g.nexusMetricsConfig&&
(f.vars.nexusMetricsConfig=g.nexusMetricsConfig,f.vars.buildNexusPayload=H.makeApplicationNexusPayloadBuilder(f.vars.A,f.vars.nexusMetricsConfig),f.vars.emitMetricsToNexus=!0,f.vars.customerId=f.vars.customerId||g.nexusMetricsConfig.customerId);g.customerReviewConfig&&(f.vars.customerReviewsConfig=g.customerReviewConfig,f.vars.customerReviewsConfig.showCustomerReviewMetadata&&(f.vars.A.delay(function(){f.compactReviewIfNeeded();f.updateReviewsExpandButtonVisibility()},250),f.attachReviewsPlayerEventListeners(),
f.vars.A.off("a:declarative:"+f.vars.clientPrefix+"-expand-review-content:click"),f.vars.A.off("a:declarative:"+f.vars.clientPrefix+"-expand-review-content:touch"),f.vars.A.declarative(f.vars.clientPrefix+"-expand-review-content","click touch",function(a){f.isReviewTextOverflow()&&!f.isReviewTextExpanded()&&(f.vars.$(e.VIPOverlaySelector).addClass("vse-reviews-expand-full-cr"),f.resetReviewTextStyle(),f.styleExpandedReviewText(),f.pauseVideoIfNeeded())}),f.vars.A.off("a:declarative:"+f.vars.clientPrefix+
"-collapse-review-content:click"),f.vars.A.off("a:declarative:"+f.vars.clientPrefix+"-collapse-review-content:touch"),f.vars.A.declarative(f.vars.clientPrefix+"-collapse-review-content","click touch",function(a){f.vars.$(e.VIPOverlaySelector).removeClass("vse-reviews-expand-full-cr");f.vars.$(".vse-reviews-content-ellipsis-wrapper").scrollTop(0);f.resetReviewTextStyle();f.vars.A.animationFrameDelay(function(){f.compactReviewIfNeeded();f.updateReviewsExpandButtonVisibility()});f.vars.vipControlsShouldPause&&
f.resumeVideoIfNeeded()}),f.vars.A.on("resize",f.handleReviewsOnResize)));f.vars.A.trigger(f.vars.clientPrefix+":vse:metadata:registered")}else m.count(e.METADATA_PAGE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1),f.vars.A.trigger("vse-common-assets-metadata-"+d+"-initialization-failed")}catch(n){m.logFatal(e.ATTRIBUTION_NAME+":"+f.vars.clientPrefix,"Fatal during metadata initialization.",n),m.count(c+".metadataInitializationFatal",1)}});a.on("vse:ns:socialShare:"+f.vars.clientPrefix+":init",
function(d){try{var g=D.fetchLatestPageState(a,d);if(g){f.vars.socialSharePageState=d;f.vars.socialShareId=g.id;f.vars.shareCopyLinkSuccessText=g.copySuccessText;f.vars.A.off("a:declarative:"+f.vars.clientPrefix+"-social-share-mshop-action:click");f.vars.A.off("a:declarative:"+f.vars.clientPrefix+"-social-share-mshop-action:touch");f.vars.A.declarative(f.vars.clientPrefix+"-social-share-mshop-action","click touch",function(a){f.vars.isMshop&&!f.vars.A.objectIsEmpty(f.vars.mShopFactory)&&(a=f.getActiveAsset(),
a=f.getMshopShareParams(a),f.vars.mShopFactory.share(a))});if(!f.vars.isMobile){var h=f.vars.A.$("#"+f.vars.socialShareId+"-trigger [aria-expanded]");a.off("a:popover:afterShow:"+f.vars.socialShareId+"-popover");a.on("a:popover:afterShow:"+f.vars.socialShareId+"-popover",function(){var a={eventName:e.METRIC_SHARE_ICON,stringPayload:e.EMPTY_STRING,intPayload:1,videoAsin:f.getVideoAsin(),rankingStrategy:f.getRankingStrategy(),groupType:f.getGroupType(),titleSessionId:f.vars.player?f.vars.player.getTitleSessionId().toString():
""};f.emitMetricToNexus(a);h.attr("aria-expanded","true")});a.off("a:popover:beforeHide:"+f.vars.socialShareId+"-popover");a.on("a:popover:beforeHide:"+f.vars.socialShareId+"-popover",function(){h.attr("aria-expanded","false")});k.isSecureContext&&navigator.clipboard||f.vars.A.$("#"+f.vars.socialShareId+"-copy").addClass("aok-hidden")}f.vars.A.off("a:declarative:"+f.vars.clientPrefix+"-swf-share-network:click");f.vars.A.declarative(f.vars.clientPrefix+"-swf-share-network","click",function(a){a=a.data;
var b=f.vars.A.state(f.vars.socialSharePageState);pa.share(b,a.network);m.count(e.socialShareClickMetricName,1);f.emitClickMetric(e.METRIC_SHARE_SELECTION_CLICK)});f.vars.A.trigger(f.vars.clientPrefix+":vse:socialShare:registered")}else m.count(e.SOCIAL_SHARE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1),f.vars.A.trigger("vse-common-assets-social-share-"+d+"-initialization-failed")}catch(n){m.logFatal(e.ATTRIBUTION_NAME+":"+f.vars.clientPrefix,"Fatal during socialShare initialization.",n),
m.count(c+".socialShareInitializationFatal",1)}});a.on("vse:ns:feedback:"+f.vars.clientPrefix+":init",function(a,b){try{b="true"===b;var d=c+"-ive-login-to-report-feedback";f.vars.showMoreMenuExperience=b;if(0<f.vars.A.$("#ive-login-to-report").length)f.vars.A.off("a:sheet:afterShow:"+d),f.vars.A.on("a:sheet:afterShow:"+d,function(a){f.updateSignInToReportRedirect();f.pauseVideoIfNeeded()}),f.vars.A.off("a:popover:afterShow:"+d),f.vars.A.on("a:popover:afterShow:"+d,function(a){f.updateSignInToReportRedirect();
f.pauseVideoIfNeeded();f.vars.isFeedbackClosed=!1}),f.vars.A.off("a:sheet:afterHide:"+d),f.vars.A.on("a:sheet:afterHide:"+d,function(a){f.resumeVideoIfNeeded()}),f.vars.A.off("a:popover:afterHide:"+d),f.vars.A.on("a:popover:afterHide:"+d,function(a){f.resumeVideoIfNeeded();f.vars.isFeedbackClosed=!0});else{var h=D.fetchLatestPageState(f.vars.A,a);if(!h){m.count(e.FEEDBACK_PAGE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1);f.vars.A.trigger("vse-common-assets-feedback-"+a+"-initialization-failed");
return}var k=h.id;f.vars.feedbackId=k;f.deRegisterFeedback(k);f.vars.A.on("vse:"+k+":feedback:shown",function(){f.pauseVideoIfNeeded();f.vars.isFeedbackClosed=!1;f.vars.$(".vse-fb-copyright").click(function(a){f.vars.isMshop&&f.vars.isVideoImmersivePlayer&&(a.preventDefault(),f.vars.feedback.showInfringementNotSupport())});f.vars.$(".vse-fb-report-illegal-content").click(function(a){f.vars.isMshop&&f.vars.isVideoImmersivePlayer&&(f.vars.feedback.closeFeedbackForm(),f.openExternalLinkFromLightBox(a))});
f.vars.showMoreMenuExperience?f.vars.$("#vse-report-trigger").click(function(a){a.preventDefault();f.emitClickMetric(e.METRIC_REPORT_CLICK)}):f.emitClickMetric(e.METRIC_REPORT_CLICK)});f.vars.A.off("vse:"+k+":feedback:submitted:success");f.vars.A.on("vse:"+k+":feedback:submitted:success",function(){f.emitClickMetric(e.METRIC_REPORT_SUBMIT);m.count(e.METRIC_REPORT_SUBMIT,1)});var n=new ya({A:f.vars.A,buttonApi:g});f.vars.feedback=n.create(k,a,b);f.updateFeedback(f.vars.currentAssetSpec);f.vars.isFeedbackClosed=
!0;f.vars.A.on("vse:"+k+":feedback:hidden",function(){f.vars.vipControlsShouldPause&&f.resumeVideoIfNeeded();f.vars.isFeedbackClosed=!0;f.vars.showMoreMenuExperience?f.vars.isVideoImmersivePlayer||f.vars.cursorOnVideoPlayerDiv||f.hideFeedbackLink(f.vars.feedbackContainer,f.vars.playerContainer):f.vars.cursorOnVideoPlayerDiv||f.hideFeedbackLink(f.vars.feedbackContainer,f.vars.playerContainer);f.vars.showMoreMenuExperience&&f.vars.$("#vse-report-trigger").unbind("click");f.vars.$(".vse-fb-copyright").unbind("click");
f.vars.isMshop&&f.vars.mShopFactory&&f.vars.A.delay(function(){f.vars.mShopFactory.dispatchEvent({type:"appOverlays.Hide"})},500)})}f.vars.feedbackContainer="#vse-"+f.vars.clientPrefix+"-feedback-container";f.vars.cursorOnVideoPlayerDiv=!1;f.vars.showMoreMenuExperience&&(f.vars.$(f.vars.feedbackContainer).css({display:"inline-block"}),f.handleMoreMenuMetric());var q=f.vars.A.$(f.vars.feedbackContainer);f.vars.showMoreMenuExperience&&f.vars.isVideoImmersivePlayer?f.vars.A.$("#"+f.vars.templateId+" .vse-lb-actions-container").prepend(q):
f.vars.A.$(f.vars.playerContainer).append(q);f.vars.isVideoImmersivePlayer||(f.vars.A.declarative.create(f.vars.$(f.vars.playerContainer),"feedback-overlays-player",{}),f.vars.A.declarative("feedback-overlays-player","mouseenter touchstart focus",function(){f.vars.isFeedbackClosed&&f.showFeedbackLink(f.vars.feedbackContainer,f.vars.playerContainer);f.vars.cursorOnVideoPlayerDiv=!0;f.vars.A.capabilities.touch&&f.vars.A.delay(f.feedBackMouseLeaveHandler,3E3)}),f.vars.A.declarative("feedback-overlays-player",
"mouseleave",f.feedBackMouseLeaveHandler));f.vars.A.trigger(f.vars.clientPrefix+":vse:feedback:registered")}catch(r){m.logFatal(e.ATTRIBUTION_NAME+":"+f.vars.clientPrefix,"Fatal during feedback initialization.",r),m.count(c+".feedbackInitializationFatal",1)}});a.on("vse:ns:relatedProducts:"+f.vars.clientPrefix+":init",function(a){try{!f.vars.isVideoImmersivePlayer||!f.vars.A.objectIsEmpty(f.vars.videoActionTrayComponents)&&f.vars.useMultiCarousel||(f.initializeVideoActionTray(null),f.setVIPOrientationProperties({carouselCardWidth:a}),
setTimeout(function(){return f.handleKeepProductCarouselOpen()},500))}catch(b){m.logFatal(e.ATTRIBUTION_NAME+":"+f.vars.clientPrefix,"Fatal during related products initialization.",b),m.count(c+".relatedProductsInitializationFatal",1)}});a.on("vse:ns:relatedVideos:"+f.vars.clientPrefix+":init",function(g){try{var p=D.fetchLatestPageState(a,g);if(p){f.vars.complementaryAsins=p.complementaryProducts?p.complementaryProducts.contentIdToComplementaryAsins:{};f.vars.currentAssetSpec&&f.showRelatedProducts(f.vars.currentAssetSpec);
f.vars.skipRelatedVideosWait=!0;var q=new R(d,n,a,{gatedP:G,promise:r});f.vars.useMultiCarousel=p.useMultiCarousel;f.vars.useChannelCarousel=p.useChannelCarousel;f.vars.emitMetricsToNexus=!!f.vars.nexusMetricsConfig;f.vars.enableWidgetMetricsAfterOneSecond=p.enableWidgetMetricsAfterOneSecond;f.vars.emitMetricsToNexus&&(f.vars.buildNexusPayload=H.makeApplicationNexusPayloadBuilder(f.vars.A,f.vars.nexusMetricsConfig));f.vars.hideWatchIcon=p.hideWatchIcon;f.vars.disableCreatorClicksOnMshop=p.disableCreatorClicksOnMshop;
d.createAll();d.initializeAll();f.vars.useChannelCarousel?(0===p.segmentNumber&&(f.vars.channelCarousels=[]),f.vars.channelCarousels[p.segmentNumber]=q.create(p),f.initializeMultiCarousel(!0,f.vars.channelCarousels[p.segmentNumber],p.segmentNumber),2===f.vars.channelCarousels.length&&f.vars.A.$("#"+f.vars.templateId+" "+e.VIPMultiCarouselWrapper).addClass("vse-vip-two-carousels"),f.multiCarouselHandler(),f.vars.A.on("resize",f.handleMultiChannelReviewIVXOnResize)):f.vars.useMultiCarousel?(f.vars.multiCarouselS2=
null,-1!==p.carouselName.indexOf("-G2")||-1!==p.carouselName.indexOf("-G4")?(f.vars.multiCarouselS2=q.create(p),f.initializeMultiCarousel(!1,f.vars.multiCarouselS2)):(f.vars.multiCarouselS1=q.create(p),f.initializeMultiCarousel(!0,f.vars.multiCarouselS1)),f.vars.A.objectIsEmpty(f.vars.multiCarouselS1)||f.vars.A.objectIsEmpty(f.vars.multiCarouselS2)||f.vars.A.$("#"+f.vars.templateId+" "+e.VIPMultiCarouselWrapper).addClass("vse-vip-two-carousels"),f.multiCarouselHandler()):f.vars.relatedVideosCarousel=
q.create(p);f.removeAriaHiddenFromCarouselCards();p.shouldUseVerticalThumbnail&&f.vars.A.delay(f.handleTooltipDisplayToShowCustomerReview,500);f.vars.A.declarative(p.carouselName+"-seeMoreRelatedVideosButtonClick","click touch",function(a){try{var b=a.$currentTarget.get()[0],c=f.vars.A.$(b).find("[data-segment-id]").attr("data-segment-id");f.emitClickMetric(e.METRIC_LB_SHOW_MORE_BUTTON_CLICK,c)}catch(d){m.logError(e.ATTRIBUTION_NAME,"Event target is undefined for show more click",d)}});f.vars.A.on("vse:contentCarousel:"+
p.carouselName+":click",function(c){f.vars.A.objectIsEmpty(f.vars.player)||(null!=f.vars.onSiteAttributionMetrics&&f.vars.onSiteAttributionMetrics.emitCarouselClickEvent(),f.vars.player.play(c),a.trigger("vse:ns:partialcomponents:"+f.vars.clientPrefix+":relatedvideos:click",c),f.vars.currentIndex=f.findIndex(c),f.vars.showVotes=f.shouldShowVotes(c),f.show(c),f.vars.currentAssetSpec=c,f.vars.showLightboxV2Experience&&f.resizeLB(),f.vars.useMultiCarousel&&f.vars.multiCarouselExpanded&&f.openCloseMultiCarousel(),
f.emitClickMetric(e.METRIC_LB_THUMBNAIL_CLICK),f.vars.isVideoImmersivePlayer&&(f.vars.isUpNextComponentActive&&f.removeUpNextComponent(),f.vars.videoActionTrayComponents.updateActiveVideoContentId(c),f.resetUserActivityTimer(),f.showVideoImmersivePlayerOverlay(),f.vars.isVIPOverlayTimerSet||(f.vars.intervalUserActivityHandlerId=f.userActivityCountDown()),f.vars.videoActionTrayComponents.reset(),f.emitClickMetric(e.METRIC_WATCH_THUMBNAIL_CLICK)),f.removeAriaHiddenFromCarouselCards())});f.vars.A.on("vse:ns:partialcomponents:"+
f.vars.clientPrefix+":relatedvideos:rotate",function(a){f.vars.currentIndex=f.findIndex(a);a=f.getCurrentlyPlayingVideoInCarousel(f.vars.currentIndex);f.show(a)});if(f.isImageBlockVIP()||-1==f.vars.currentIndex)f.vars.currentIndex=f.findIndex(f.vars.currentAssetSpec);var B=-1==f.vars.currentIndex?f.vars.currentAssetSpec:f.getCurrentlyPlayingVideoInCarouselMarkAsPlaying(f.vars.currentIndex);if(B!==t){f.vars.useAllIVXComponents&&f.updateVideoMetadataIfNeeded(B);f.markPlaying(B);f.vars.initialVideo=
B;f.vars.showVotes=f.shouldShowVotes(B);f.initializeHelpfulVotes();f.createContinuousPlayPlaylist(B);f.updateFollowCreatorButton(B);f.updateFeedback(B);f.refreshSocialSharePageState(B);f.vars.isVideoImmersivePlayer?(!f.vars.A.objectIsEmpty(f.vars.videoActionTrayComponents)&&f.vars.useMultiCarousel||f.initializeVideoActionTray(p.segmentTabs),f.setVIPOrientationProperties({carouselCardWidth:p.carouselCardWidth,verticalCarouselCardWidth:p.verticalCarouselCardWidth}),f.updateSegmentTab(B),f.vars.videoActionTrayComponents.updateActiveVideoContentId(B.contentId),
f.emitRelatedVideosRenderMetric(e.METRIC_WATCH_THUMBNAIL_RENDER,f.vars.relatedVideosCarousel),f.vars.keepCarouselOpenOnLinkClick=p.keepCarouselOpenOnLinkClick,f.vars.watchAllClicked?f.handleKeepVideoCarouselOpen():f.handleKeepProductCarouselOpen()):1===f.vars.playlist.length?a.trigger("vse:ns:relatedVideos:"+f.vars.clientPrefix+":hide"):f.toggleSingleLbCssClass(!1);f.vars.shouldShowProfiles=p.includeProfiles;-1==f.vars.currentIndex&&(f.isInfluencerVideo(B)||f.isCustomerReviewVideo(B))&&(f.vars.shouldShowProfiles=
!0);f.vars.shouldShowProfiles&&f.initializeCustomerProfile(B);p.includeVideoInformationOverPlayer&&(f.vars.includeVideoInformationOverPlayer=!0,f.moveMetadataOverPlayer(f.dom.$activeCrvMetadataContainer),f.moveMetadataOverPlayer(f.dom.$activeMetadataContainer),f.setupPlayerHoverHandler(),f.showPlayerOverlayFeaturesForAFewMS(3E3));(p.shouldUseVerticalThumbnail||p.includeVideoInformationOverPlayer)&&f.setupExpandCollapseTextWidget(f.vars.clientPrefix+"-toggle-full-text");f.vars.lightboxCarouselRegistered=
!0;var v=document.querySelectorAll("#"+f.vars.popoverId+" div.vse-video-item");!f.vars.carouselIntersectionObserver&&0<v.length&&k.IntersectionObserver&&(f.vars.carouselIntersectionObserver=new J(null,v,f.onIntersectionObserved,f.vars.enableWidgetMetricsAfterOneSecond));var I=document.querySelectorAll("#"+p.carouselName+" div.vse-sm-expander");!f.vars.carouselShowMoreIntersectionObserver&&0<I.length&&k.IntersectionObserver&&(f.vars.carouselShowMoreIntersectionObserver=new J(null,I,f.onIntersectionObservedForShowMoreButton,
f.vars.enableWidgetMetricsAfterOneSecond));f.vars.hotSpotsV3Weblab&&!f.vars.isHotspotsNXWeblabTriggered&&(f.triggerWeblab(f.vars.hotSpotsV3Weblab),f.vars.isHotspotsNXWeblabTriggered=!0);(B.showHotspots||B.hasHotspots||f.vars.useHotspotsNX)&&f.showOrHideSearchButton(B);f.vars.A.trigger(f.vars.clientPrefix+":vse:relatedVideos:registered")}}else f.vars.showVotes=!1,m.count(e.RV_PAGE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1),f.vars.A.trigger("vse-common-assets-carousel-"+g+"-initialization-failed")}catch(w){m.logFatal(e.ATTRIBUTION_NAME+
":"+f.vars.clientPrefix,"Fatal during Lightbox carousel initialization.",w),m.count(c+".lightboxCarouselInitializationFatal",1)}});a.on("vse:"+f.vars.clientPrefix+":page:watchAllClicked",function(){f.vars.watchAllClicked=!0});a.on("vse:ns:relatedVideosVernacularExperience:"+f.vars.clientPrefix+":init",function(){a.declarative("onSelectVideoLanguage","change",function(a){a=f.vars.$("input:radio[name\x3d'videoLanguage']:checked").val();a===e.HINDI?(f.vars.$("#"+e.relatedEnglishVideosContainer).addClass("aok-hidden"),
f.vars.$("#"+e.relatedHindiVideosContainer).removeClass("aok-hidden")):a===e.ENGLISH&&(f.vars.$("#"+e.relatedHindiVideosContainer).addClass("aok-hidden"),f.vars.$("#"+e.relatedEnglishVideosContainer).removeClass("aok-hidden"))})});a.on("vse:"+f.vars.clientPrefix+":seeMoreBlock:init",function(a,b){f.vars.isMobile&&f.vars.popoverId&&(f.vars.$("#"+f.vars.popoverId).find(e.VIPShopIconBlockSelector).addClass("aok-hidden"),f.vars.$("#"+f.vars.popoverId).find(e.VIPSeeMoreBlockSelector).removeClass("aok-hidden"),
f.vars.$("#"+f.vars.popoverId).find(e.VIPSeeMoreLinkSelector).attr("href",a),f.vars.$("#"+f.vars.popoverId).find(e.VIPSeeMoreTextSelector).text(b),f.vars.$("#"+f.vars.popoverId).find(".vse-airy-container").addClass("vse-spotlight-player-container"),f.vars.$("#"+f.vars.popoverId).find(".vse-vip-action-tray").addClass("vse-spotlight-vip-action-tray"))});a.on("vse:ns:"+f.vars.clientPrefix+":hideAdditionalUXFeatures",function(){f.vars.$("#"+f.vars.popoverId).find(e.VIPShareIconBlockSelector).addClass("aok-hidden");
f.vars.$("#"+f.vars.popoverId).find("."+e.VIPVideoHelpfulVotesClassName).css({display:"none",visibility:"hidden"})});a.on("vse:ns:ingressCarousel:"+f.vars.clientPrefix+":init",function(g,k){try{f.vars.widgetStartTime=k;var q=a.now(),t=D.fetchLatestPageState(a,g);if(t){f.vars.popoverName=t.lightboxPopoverConfig.popoverId;var v=f.vars.popoverName+"-trigger",I=f.vars.popoverName+"-wrapper",w=new R(d,n,a,{gatedP:G,EventEmitter:O,promise:r});f.vars.ingressCarousel=w.create(t);if(f.vars.A.objectIsEmpty(f.vars.ingressCarousel))throw new K("Cannot create Ingress Carousel. Carousel is null or undefined");
f.vars.ingressPlaylist=f.vars.ingressCarousel.getplaylist();f.vars.A.on(f.vars.A.constants.BROWSER_EVENTS.SCROLL,f.vseCsmWidgetLoadedMetrics);f.vseCsmWidgetLoadedMetrics();f.vars.modalFactory=f.getModalFactory();a.on("vse:contentCarousel:"+t.carouselName+":click",function(c){var d=f.vars.modalFactory&&f.vars.modalFactory.get(f.vars.$("#"+v));m.count(""+f.vars.clientPrefix+e.METRIC_WIDGET_CLICK,1);d?(d.show(),a.off("a:popover:afterShow:"+f.vars.popoverName),a.on("a:popover:afterShow:"+f.vars.popoverName,
function(d){a.$(d.popover.$popover).addClass(a.$("#"+I).data("cssClass"));a.trigger("vse:"+f.vars.clientPrefix+":page:lightBoxOpened",{assetSpec:c,lightBoxId:I})})):m.count(e.LB_POPOVER_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1)});a.on("a:popover:beforeHide:"+f.vars.popoverName,function(){a.objectIsEmpty(f.vars.ingressCarousel)||f.vars.ingressCarousel.destroy();a.trigger("vse:"+f.vars.clientPrefix+":page:lightBoxClosed")});var y=a.now();m.count(c+".requestToReadyDuration",y-k);m.count(c+".requestToInitDuration",
q-k);m.count(c+".initToReadyDuration",y-q);a.$("#vse-spinner").addClass("aok-hidden");f.vars.A.trigger(f.vars.clientPrefix+":vse:ingressCarousel:registered")}else f.vars.showVotes=!1,m.count(e.INGRESS_RV_PAGE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1),f.vars.A.trigger("vse-common-assets-carousel-"+g+"-initialization-failed")}catch(C){m.logFatal(e.ATTRIBUTION_NAME+":"+f.vars.clientPrefix,"Fatal during Ingress carousel initialization.",C),m.count(c+".ingressCarouselInitializationFatal",1),
f.vars.A.hide("#"+f.vars.clientPrefix+e.INGRESS_CAROUSEL_SUFFIX)}});a.on("vse:"+f.vars.clientPrefix+":page:lightBoxOpened",function(d){if(!0===d.enableClickBasedAttribution||!1===d.enableClickBasedAttribution)f.vars.enableClickBasedAttribution=d.enableClickBasedAttribution;!f.vars.aciContentId&&d.assetSpec&&d.assetSpec.aciContentId&&(f.vars.aciContentId=d.aciContentId);var g=f.vars.A.now();d.player&&d.templateId&&(f.vars.player=d.player,f.vars.useAllIVXComponents=!1,f.vars.templateId=d.templateId);
f.vars.firstRelatedProductOverride=d.firstRelatedProductOverride;f.vars.lightboxOpened=!0;f.vars.popoverId=d.lightBoxId;f.removeAriaHiddenFromCarouselCards();f.removeAudioOverlay();f.vars.A.objectIsEmpty(d.assetSpec)&&(f.vars.ingressHasInitialAssetSpec=!1);d.lazyLoadProductAsin&&(f.vars.lightboxCarouselRegistered=!1);d.showHeroExperience&&(f.vars.showHeroExperience=d.showHeroExperience);d.assetSpec&&d.assetSpec.audioNote&&f.createAudioOverlay(d.assetSpec);f.vars.lightboxCarouselRegistered?(f.vars.ingressHasInitialAssetSpec?
(f.vars.currentIndex=f.findIndex(d.assetSpec),f.vars.currentAssetSpec=f.getCurrentlyPlayingVideoInCarouselMarkAsPlaying(f.vars.currentIndex),f.vars.seekTime=d.assetSpec.seekTime,f.vars.videoUrlInlineVideoKey=d.assetSpec.videoUrl):(f.vars.currentAssetSpec=f.getActiveAsset(),f.vars.currentIndex=f.vars.currentAssetSpec.index),f.createContinuousPlayPlaylist(f.vars.currentAssetSpec)):(f.vars.seekTime=f.vars.ingressHasInitialAssetSpec?d.assetSpec.seekTime:d.seekTime,f.vars.rankingStrategy=f.vars.ingressHasInitialAssetSpec?
d.assetSpec.rankingStrategy:d.rankingStrategy,f.vars.videoUrlInlineVideoKey=f.vars.ingressHasInitialAssetSpec?d.assetSpec.videoUrl:d.videoUrl,f.vars.currentIndex=f.vars.ingressHasInitialAssetSpec&&!d.lazyLoadProductAsin?d.assetSpec.index:0,f.vars.currentAssetSpec=f.vars.ingressHasInitialAssetSpec?d.assetSpec:f.vars.initialVideo,f.vars.ingressHasInitialAssetSpec&&f.vars.initialVideo&&("vendorName entityId entityType closedCaptions labelDetails ccvDisclosure disableReportIllegalLink segmentNumber reportUrl".split(" ").forEach(function(a){f.vars.A.objectIsEmpty(f.vars.currentAssetSpec[a])&&
(f.vars.currentAssetSpec[a]=f.vars.initialVideo[a])}),"eligibleToTriggerCCWeblab"in f.vars.currentAssetSpec||(f.vars.currentAssetSpec.eligibleToTriggerCCWeblab=f.vars.initialVideo.eligibleToTriggerCCWeblab)));d.initialRelatedProducts?f.vars.currentAssetSpec.relatedProducts=d.initialRelatedProducts:!f.vars.currentAssetSpec.relatedProducts&&d.assetSpec&&d.assetSpec.productAsin&&(f.vars.currentAssetSpec.relatedProducts=d.assetSpec.productAsin);f.vars.currentAssetSpec&&f.vars.A.objectIsEmpty(f.vars.currentAssetSpec.rankingStrategy)&&
(f.vars.currentAssetSpec.rankingStrategy=f.vars.rankingStrategy);f.vars.lightboxOpenedFirstTime&&(f.getDomElements(f.vars.popoverId,f.vars.templateId),f.setUpSingleLBOverlayIfRequired(),f.vars.isMobile||(f.dom.$wrapper.closest(e.LightboxWrapperSelector).addClass(f.dom.$wrapper.attr("class")),f.addPlayerHoverHandler()),f.vars.showContentCarousel||(f.vars.showVotes=f.shouldShowVotes(f.vars.currentAssetSpec),f.initializeHelpfulVotes()));f.vars.A.capabilities.mobile&&!f.vars.A.capabilities.isAmazonApp&&
f.vars.$("body").scrollTop(1);f.vars.showHeroExperience||f.vars.$("body").addClass("vse-lb-no-scroll");f.vars.$("#"+f.vars.popoverId).addClass("vse-lb-opened");f.show(f.vars.currentAssetSpec);f.vars.lightboxOpenedFirstTime?(f.triggerAUIResize(),f.vars.isVideoImmersivePlayer||f.setupDefaultClosedCaptions()):(f.resizeLB(),f.resetCarouselWithSeeMore());if(f.vars.isVideoImmersivePlayer){var h=a.capabilities.isAmazonApp?"vse-vip-lb-mshop":"vse-vip-lb-mweb";f.vars.$(e.VIPLightboxSelector).addClass(h);f.vars.$("#"+
f.vars.popoverId).closest(".a-popover-secondary").addClass("vse-vip");a.capabilities.ios&&(f.vars.$(e.VIPLightboxSelector).addClass("vse-ivx-ios"),f.vars.viewportMetaTag=f.vars.$('meta[name\x3d"viewport"]'),f.vars.viewportMetaTagContent=f.vars.viewportMetaTag.attr("content"));f.needToUpdateVideoInfoLater()?f.clearCurrentVideoInfo():(f.resetUserActivityTimer(),f.showVideoImmersivePlayerOverlay());f.vars.useAutoplayFallback||(f.vars.intervalUserActivityHandlerId=f.userActivityCountDown());f.vars.useAllIVXComponents&&
f.initializeVIPControls();f.updateAudioToggleStatus();f.vars.lightboxOpenedFirstTime||(f.vars.useMultiCarousel||f.updateSegmentTab(f.vars.currentAssetSpec),f.vars.lightboxCarouselRegistered&&f.vars.videoActionTrayComponents.updateActiveVideoContentId(f.vars.currentAssetSpec.contentId),f.vars.watchAllClicked?f.handleKeepVideoCarouselOpen():f.handleKeepProductCarouselOpen());f.enableIVXOverlayOnTab();a.delay(function(){f.vars.$("body").addClass("vse-vip-body")},250)}f.vars.currentAssetSpec&&!f.vars.currentAssetSpec.eventTimestamp&&
(f.vars.currentAssetSpec.eventTimestamp=g);f.vars.currentAssetSpec.seekTime=f.vars.seekTime;f.vars.A.delay(function(){f.dom.$wrapper.find(".vse-lb-container").animate({opacity:1},200);f.vars.useAllIVXComponents&&(f.emitEventDurationMetric(e.METRIC_OPEN_LIGHTBOX_EVENT_EXECUTION,f.vars.A.now()-g),f.startPlaying(f.vars.currentAssetSpec))},200);f.dom.$activeVideoOspLink.unbind("click").click(function(a){f.vars.disableCreatorClicksOnMshop?f.closeIXVAndTriggerDisclosureEvent(a):f.openExternalLinkFromLightBox(a)});
f.dom.$activeVideoCRLink.click(function(a){a=f.vars.$(a.target).closest(".vse-cr-link").attr("href");f.openExternalLinkFromLightBox(a)});!f.vars.isMobile&&f.vars.placement&&-1!==f.vars.placement.toLowerCase().indexOf("search")&&f.vars.$("#"+f.vars.popoverId).closest(e.LightboxWrapperSelector).addClass("vse-responsive-lightbox");f.vars.isMobile&&f.vars.placement&&-1!==f.vars.placement.toLowerCase().indexOf("search")&&f.vars.$("#"+f.vars.popoverId).closest(e.LightboxWrapperSelector).removeClass("vse-responsive-lightbox").removeClass("vse-vertical-lightbox").addClass("vse-vip");
f.isImageBlockVIP()&&f.vars.$("#"+f.vars.popoverId).closest(".video-immersive-view-gallery").addClass("vse-vip");v.when("mash").execute("vse-mash-detection",function(a){f.vars.isMshop=!0;f.vars.mShopFactory=a;f.vars.disableFullScreenOnMshop||f.requestMshopFullscreen();document.addEventListener("visibilitychange",function(){"visible"==document.visibilityState&&!f.vars.disableFullScreenOnMshop&&f.vars.lightboxOpened&&f.requestMshopFullscreen()})});f.vars.showHeroExperience||(m.count(e.LB_OPENED+":"+
f.vars.clientPrefix,1),h={eventName:e.METRIC_LIGHTBOX_OPEN,videoAsin:f.vars.currentAssetSpec.contentId,stringPayload:e.EMPTY_STRING,intPayload:1,titleSessionId:f.vars.player.getTitleSessionId().toString()},f.emitMetricToNexus(h));var k=D.fetchLatestPageState(a,f.vars.templateId+"-lazyload-request-ps");if(f.vars.A.objectIsEmpty(k))f.vars.lightboxOpenedFirstTime=!1,m.count(e.LAZY_LOAD_PAGE_STATE_NOT_FOUND_ERROR_KEY+":"+f.vars.clientPrefix,1);else{var h=function(a,b){f.vars.A.trigger("vse:"+c+":lazyload:"+
b.configuration.type+":succeeded")},n=function(a,b){f.vars.A.trigger("vse:"+c+":lazyload:"+b.configuration.type+":failed")};f.vars.lightboxOpenedFirstTime?(k=a.$.extend({video:{contentID:f.vars.currentAssetSpec.contentId,contentIDType:"ASIN",videoURL:f.vars.currentAssetSpec.videoUrl,imageURL:f.vars.currentAssetSpec.imageURL}},k),d.lazyLoadProductAsin&&(k.product.contentID=d.lazyLoadProductAsin),oa.getLazyLoadComponents(f.vars.A,f.vars.popoverId,k,h,n),f.vars.lightboxOpenedFirstTime=!1):d.lazyLoadProductAsin&&
(k.product.contentID=d.lazyLoadProductAsin,oa.getLazyLoadComponents(f.vars.A,f.vars.popoverId,k,h,n))}});a.on("vse:"+f.vars.clientPrefix+":page:lightBoxClosed",function(){f.vars.lightboxOpened&&(f.vars.lightboxOpened=!1,f.vars.ingressHasInitialAssetSpec=!0,a.trigger("inlineVideo:immersiveViewClosed",{videoUrl:f.vars.videoUrlInlineVideoKey,seekTime:f.vars.player.getCurrentTime()}),f.dom.$wrapper.find(".vse-lb-container").animate({opacity:0}),f.vars.$("body").removeClass("vse-lb-no-scroll"),f.disableIVXOverlayOnTab(),
f.vars.useAllIVXComponents&&f.vars.player.pause(),f.vars.isVideoImmersivePlayer&&(f.vars.$("body").removeClass("vse-vip-body"),f.clearIntervalUserActivityHandler(),null!=f.vars.videoActionTrayComponents&&f.vars.videoActionTrayComponents.reset(),f.emitMetric(e.METRIC_VIP_CLOSE),f.vars.useAutoplayFallback&&!f.vars.vipPlayIconClicked&&(f.emitMetric(e.METRIC_VIP_CLOSE_WITHOUT_PLAY),m.count(f.vars.clientPrefix+":"+e.METRIC_VIP_CLOSE_WITHOUT_PLAY,1)),f.resetVIPControls(),f.vars.useMultiCarousel&&f.vars.multiCarouselExpanded&&
f.openCloseMultiCarousel(),f.vars.isMshop&&!f.vars.disableFullScreenOnMshop&&f.cancelMshopFullscreen(),f.vars.A.$("#"+f.vars.templateId+" ."+e.UpNextCancelClassName).click()),f.vars.customerReviewsConfig&&f.vars.customerReviewsConfig.showCustomerReviewMetadata&&f.vars.A.off("resize",f.handleReviewsOnResize),f.vars.useChannelCarousel&&f.vars.A.off("resize",f.handleMultiChannelReviewIVXOnResize),a.trigger("vse:ns:partialcomponents:"+f.vars.clientPrefix+":lightboxClosed"))});a.on("vse:"+f.vars.clientPrefix+
":lazyload:relatedvideos:succeeded",function(){f.resizeLB();f.emitPFORenderMetric(e.METRIC_PFO_RENDER)});a.on("vse:"+f.vars.clientPrefix+":lazyload:relatedvideos:failed",function(){f.vars.isVideoImmersivePlayer?f.vars.A.hide(f.vars.A.$("#"+f.vars.templateId+" "+e.VIPWatchIconBlockSelector)):f.vars.A.hide(f.vars.A.$("#"+f.vars.templateId+" div[class^\x3d'div-'][class$\x3d'lb'] .vse-lazyload-spinner"))});a.on("vse:ns:relatedVideos:"+f.vars.clientPrefix+":hide",function(){f.vars.lightboxOpened&&f.vars.isVideoImmersivePlayer?
f.vars.A.hide(f.vars.A.$("#"+f.vars.templateId+" "+e.VIPWatchIconBlockSelector)):f.toggleSingleLbCssClass(!0)});a.on("resize",function(){f.vars.lightboxOpened&&f.resizeLB()});a.on.orientationchange(function(a){!f.vars.isVideoImmersivePlayer&&f.vars.playFullScreenVideo&&(0===a.orientation?f.vars.player.aspectRatio(f.getAspectRatio(e.PORTRAIT)):f.vars.player.aspectRatio(f.getAspectRatio(e.LANDSCAPE)));f.vars.isMobile&&f.vars.lightboxOpened&&(f.vars.$("#"+f.vars.popoverId).height(k.innerHeight),f.dom.$lbContainer.height(k.innerHeight))});
a.on("vse:ns:inlinePlayer:"+f.vars.clientPrefix+":init",function(c){try{var d=D.fetchLatestPageState(a,c.pageStateName),g=new fa(a,f,c),h=a.$("#"+d.inlinePlayerConfig.lightboxClickHandlerSelector),k=c.popoverId&&c.popoverTriggerId;k&&g.addLightboxAfterShowAndBeforeHideEvents();g.initializePlayerOverlayComponents(h);g.addOrientationChangeHandler();var l={playerInstance:f.vars.player,changePlayerMode:g.changePlayerMode,startPlaying:g.startPlaying,updateVideoCountForExpandButton:g.updateVideoCountForExpandButton,
updateVideoInfoOverlay:g.updateVideoInfoOverlay,hideVideoCountForExpandButton:g.hideVideoCountForExpandButton,showHideCloseButtonForInlinePlayer:g.showHideCloseButtonForInlinePlayer};k?l.openLightbox=g.openLightbox:(l.movePlayerToLightbox=g.movePlayerToLightbox,l.movePlayerToIngress=g.movePlayerToIngress);d.needPlayerFactory?(l.playerFactoryConfig={playerFactory:f.vars.playerFactory,playerConfig:d,addPlayerLoadedHandler:g.addPlayerLoadedHandler},l.playerInstance=t,a.trigger("vse:ns:inlinePlayer:factory:"+
f.vars.clientPrefix+":ready",l)):(g.addPlayerLoadedHandler(),a.trigger("vse:ns:inlinePlayer:"+f.vars.clientPrefix+":ready",l),m.count("vse:ns:inlinePlayer:initSuccess",1))}catch(n){m.count("vse:ns:inlinePlayer:"+f.vars.clientPrefix+":initFailed",1),m.logError(e.ATTRIBUTION_NAME,"Fallback for inline player "+f.vars.clientPrefix,n),a.trigger("vse:ns:inlinePlayer:"+f.vars.clientPrefix+":initFailed",n),m.count("vse:ns:inlinePlayer:initFailed",1)}})},TestModules:Fa,Utils:na,_noneFeature:c()}})})};v.when("A",
"3p-promise").execute("VSE-gatedP-register-VSEComponentAssets-client",function(d,c){G.register("VSEComponentAssets","VSE-VSEComponentAssets-client-registered",Ia,c)});v.when("A","a-carousel-constants","a-carousel-framework","a-carousel-transition-slide").execute("vse-video-carousel-transition-registration",function(d,c,a,b){var e=k.vseFeatures||{};e["vse-video-carousel-transition-strategy"]||(d=new ea(d,c,b),a.registerStrategy("transition","vse-video-carousel-transition",d.get()),e["vse-video-carousel-transition-strategy"]=
!0)});v.when("A","a-carousel-framework","a-carousel-constants").execute("vse-display-strategy-registration",function(d,c,a){var b=k.vseFeatures||{};b["vse-video-carousel-display-strategy"]||(d=new da(d,a),c.registerStrategy("display","vse-video-carousel-display",d),b["vse-video-carousel-display-strategy"]=!0)})}catch(d){m.logError(e.ATTRIBUTION_NAME,"Error during VSE AUI module registration.",d),m.count(e.ATTRIBUTION_NAME+".moduleFatal",1)}})()});