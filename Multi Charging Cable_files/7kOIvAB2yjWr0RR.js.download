window.aui.amd_define("@amzn/webflow-js-register-view-model-mapper",["exports","@amzn/kata-web-framework-register","@amzn/webflow-rx","@amzn/kata-web-framework-rxjs-adapter"],function(i,a,o,u){"use strict";function p(t){const r=u.createRxAdapterScope();return(s,n)=>{const e=t(s,n);return e instanceof Promise?e.then(S=>c(S,s.initialViewModel,r)):c(e,s.initialViewModel,r)}}function c(t,r,s){const n={};for(const e in t)o.isReactiveViewValue(t[e])?n[e]=b(t[e],r[e],s):o.isReactiveViewPublisher(t[e])?n[e]=l(t[e]):typeof t[e]=="object"&&t[e]!==null&&typeof r[e]=="object"&&r[e]!==null?n[e]=c(t[e],r[e],s):n[e]=r[e]?r[e]:t[e];return n}function b(t,r,s){return s.asReactiveViewValue(t.reactiveViewValueObservable,{initialValue:r})}function l(t){return t.reactiveViewPublisherObservable.next.bind(t.reactiveViewPublisherObservable)}const f=(t,r)=>a.externalRegister(t,r),h=t=>a.externalLookup(t),g=async(t,r)=>{const s=await h(t);return await p(s)(r,t)};class w{constructor(){this.scopes=[{}]}getCurrentScope(){return this.scopes.slice(-1)[0]}bind(r,s){this.getCurrentScope()[r]=s}resolve(r){for(let s=this.scopes.length-1;s>=0;s--)if(this.scopes[s][r])return this.scopes[s][r];throw new Error("Variable not found")}enterScope(){this.scopes.push({})}exitScope(){if(this.scopes.length<=1)throw new Error("Variable table top scope cannot be exited");this.scopes.pop()}exitScopeWithReturnValue(r){return this.exitScope(),r}serialize(){const r=Object.assign({},...this.scopes),s=new WeakSet;return JSON.stringify(r,function(n,e){if(!(e instanceof o.Observable||e instanceof o.Subscriber)){if(typeof e=="object"&&e!==null){if(s.has(e))return;s.add(e)}return e}})}}i.VariableTable=w,i.executeViewModelMapper=g,i.registerViewModelMapper=f,i.wrapViewModelMapperWithReactivityRegistration=p,Object.defineProperty(i,Symbol.toStringTag,{value:"Module"})});
